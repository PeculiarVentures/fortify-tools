/*! For license information please see 10.dbbd03a0.chunk.js.LICENSE.txt */
(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[10],{151:function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var n=r(33),a=r(56);var i=r(57);function o(e,t,r){return(o=Object(i.a)()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var i=new(Function.bind.apply(e,n));return r&&Object(a.a)(i,r.prototype),i}).apply(null,arguments)}function u(e){var t="function"===typeof Map?new Map:void 0;return(u=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return o(e,arguments,Object(n.a)(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Object(a.a)(i,e)})(e)}},333:function(e,t,r){"use strict";r.r(t);var n=r(12),a=r(62),i=r(151),o=r(21),u=r(58),c=r(33),s=r(9),l=r(10),f=r(11),h=r(34),v=r(27),p=r(7),y=r(8),d=function(e,t,r,d){function b(e){return e&&"object"===typeof e&&"default"in e?e:{default:e}}var g=b(r),m=b(d),k=function(){function e(){Object(p.a)(this,e)}return Object(y.a)(e,null,[{key:"isArrayBuffer",value:function(e){return"[object ArrayBuffer]"===Object.prototype.toString.call(e)}},{key:"toArrayBuffer",value:function(e){var t=this.toUint8Array(e);return t.byteOffset||t.length?t.buffer.slice(t.byteOffset,t.byteOffset+t.length):t.buffer}},{key:"toUint8Array",value:function(e){if("undefined"!==typeof Buffer&&Buffer.isBuffer(e))return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);if(this.isArrayBuffer(e))return new Uint8Array(e);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}},{key:"isBufferSource",value:function(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}},{key:"isArrayBufferView",value:function(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}}]),e}();function O(e){return"undefined"!==typeof Buffer&&Buffer.isBuffer(e)?new Uint8Array(e):k.isArrayBufferView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e)}var w=function(){function e(){Object(p.a)(this,e)}return Object(y.a)(e,null,[{key:"isHex",value:function(e){return"string"===typeof e&&/^[a-z0-9]+$/i.test(e)}},{key:"isBase64",value:function(e){return"string"===typeof e&&/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},{key:"isBase64Url",value:function(e){return"string"===typeof e&&/^[a-zA-Z0-9-_]+$/i.test(e)}},{key:"ToString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",r=O(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);default:throw new Error("Unknown type of encoding '".concat(t,"'"))}}},{key:"FromString",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);default:throw new Error("Unknown type of encoding '".concat(t,"'"))}}},{key:"ToBase64",value:function(e){var t=O(e);if("undefined"!==typeof btoa){var r=this.ToString(t,"binary");return btoa(r)}return Buffer.from(t).toString("base64")}},{key:"FromBase64",value:function(t){var r=this.formatString(t);if(!r)return new ArrayBuffer(0);if(!e.isBase64(r))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return"undefined"!==typeof atob?this.FromBinary(atob(r)):new Uint8Array(Buffer.from(r,"base64")).buffer}},{key:"FromBase64Url",value:function(t){var r=this.formatString(t);if(!r)return new ArrayBuffer(0);if(!e.isBase64Url(r))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(r.replace(/\-/g,"+").replace(/\_/g,"/")))}},{key:"ToBase64Url",value:function(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}},{key:"FromUtf8String",value:function(e){for(var t=unescape(encodeURIComponent(e)),r=new Uint8Array(t.length),n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r.buffer}},{key:"ToUtf8String",value:function(e){var t=O(e),r=String.fromCharCode.apply(null,t);return decodeURIComponent(escape(r))}},{key:"FromBinary",value:function(e){for(var t=e.length,r=new Uint8Array(t),n=0;n<t;n++)r[n]=e.charCodeAt(n);return r.buffer}},{key:"ToBinary",value:function(e){for(var t=O(e),r="",n=t.length,a=0;a<n;a++)r+=String.fromCharCode(t[a]);return r}},{key:"ToHex",value:function(e){for(var t=O(e),r=[],n=t.length,a=0;a<n;a++){var i=t[a].toString(16);r.push(1===i.length?"0"+i:i)}return r.join("")}},{key:"FromHex",value:function(t){var r=this.formatString(t);if(!r)return new ArrayBuffer(0);if(!e.isHex(r))throw new TypeError("Argument 'hexString' is not HEX encoded");r.length%2&&(r="0".concat(r));for(var n=new Uint8Array(r.length/2),a=0;a<r.length;a+=2){var i=r.slice(a,a+2);n[a/2]=parseInt(i,16)}return n.buffer}},{key:"Base64Padding",value:function(e){var t=4-e.length%4;if(t<4)for(var r=0;r<t;r++)e+="=";return e}},{key:"formatString",value:function(e){return(null===e||void 0===e?void 0:e.replace(/[\n\r\t ]/g,""))||""}}]),e}();function x(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];for(var a=arguments[0],i=1;i<arguments.length;i++){var o=arguments[i];for(var u in o)a[u]=o[u]}return a}function j(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t.map((function(e){return e.byteLength})).reduce((function(e,t){return e+t})),a=new Uint8Array(n),i=0;return t.map((function(e){return new Uint8Array(e)})).forEach((function(e){var t,r=Object(v.a)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;a[i++]=n}}catch(o){r.e(o)}finally{r.f()}})),a.buffer}function B(e,t){if(!e||!t)return!1;if(e.byteLength!==t.byteLength)return!1;for(var r=new Uint8Array(e),n=new Uint8Array(t),a=0;a<e.byteLength;a++)if(r[a]!==n[a])return!1;return!0}function N(e,t,r,n){var a,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(a=e[u])&&(o=(i<3?a(o):i>3?a(t,r,o):a(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o}var E=function(){function e(){Object(p.a)(this,e)}return Object(y.a)(e,null,[{key:"set",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Uint8Array(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Uint8Array(t).buffer);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function I(e){return function(r){var n=r;n.localName=e.name||n.name||n.toString().match(/^function\s*([^\s(]+)/)[1],n.items=n.items||{},n.target=r,n.items=x({},n.items);var a=new t.Type(n.localName);for(var i in n.items){var o=n.items[i],u=void 0;o.repeated?u="repeated":o.required&&(u="required"),a.add(new t.Field(o.name,o.id,o.type,u))}n.protobuf=a}}function A(e){return function(t,r){var n=t.constructor,a=r;n.items=n.items||{},n.target!==n&&(n.items=x({},n.items),n.target=n),n.items[a]={id:e.id,type:e.type||"bytes",defaultValue:e.defaultValue,converter:e.converter||null,parser:e.parser||null},e.name=e.name||a,n.items[a].name=e.name,n.items[a].required=e.required||!1,n.items[a].repeated=e.repeated||!1,function(e,t,r){var n="_".concat(t),a={set:function(e){this[n]!==e&&(this.raw=null,this[n]=e)},get:function(){if(void 0===this[n]){var e=r.defaultValue;r.parser&&!r.repeated&&(e=new r.parser),this[n]=e}return this[n]},enumerable:!0};Object.defineProperty(e,n,{writable:!0,enumerable:!1}),Object.defineProperty(e,t,a)}(t,a,n.items[a])}}var S=function(){function e(){Object(p.a)(this,e)}return Object(y.a)(e,[{key:"isEmpty",value:function(){return void 0===this.raw}},{key:"hasChanged",value:function(){if(null===this.raw)return!0;var e=this.constructor,t=this;for(var r in e.items){var n=e.items[r];if(n.repeated){if(n.parser)return t[r].some((function(e){return e.hasChanged()}))}else if(n.parser&&t[r]&&t[r].hasChanged())return!0}return!1}},{key:"importProto",value:function(){var t=Object(h.a)(f.mark((function t(r){var n,a,i,o,u,c,s,l,h,p;return f.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.constructor,a=this,!(r instanceof e)){t.next=8;break}return t.next=5,r.exportProto();case 5:o=t.sent,t.next=9;break;case 8:o=r;case 9:t.prev=9,i=n.protobuf.decode(new Uint8Array(o)),t.next=16;break;case 13:throw t.prev=13,t.t0=t.catch(9),new Error("Error: Cannot decode message for ".concat(n.localName,".\n$ProtobufError: ").concat(t.t0.message));case 16:t.t1=f.keys(n.items);case 17:if((t.t2=t.t1()).done){t.next=52;break}u=t.t2.value,c=n.items[u],s=i[c.name],ArrayBuffer.isView(s)&&(s=new Uint8Array(s)),Array.isArray(s)||(c.repeated?a[u]=s=[]:s=[s]),c.repeated&&!a[u]&&(a[u]=[]),l=Object(v.a)(s),t.prev=25,l.s();case 27:if((h=l.n()).done){t.next=42;break}if(p=h.value,!c.repeated){t.next=37;break}return t.t3=a[u],t.next=33,this.importItem(c,p);case 33:t.t4=t.sent,t.t3.push.call(t.t3,t.t4),t.next=40;break;case 37:return t.next=39,this.importItem(c,p);case 39:a[u]=t.sent;case 40:t.next=27;break;case 42:t.next=47;break;case 44:t.prev=44,t.t5=t.catch(25),l.e(t.t5);case 47:return t.prev=47,l.f(),t.finish(47);case 50:t.next=17;break;case 52:this.raw=o;case 53:case"end":return t.stop()}}),t,this,[[9,13],[25,44,47,50]])})));return function(e){return t.apply(this,arguments)}}()},{key:"exportProto",value:function(){var e=Object(h.a)(f.mark((function e(){var t,r,n,a,i,o,u,c,s,l;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasChanged()){e.next=2;break}return e.abrupt("return",this.raw);case 2:t=this.constructor,r=this,n={},e.t0=f.keys(t.items);case 6:if((e.t1=e.t0()).done){e.next=32;break}a=e.t1.value,i=t.items[a],o=r[a],Array.isArray(o)||(o=void 0===o?[]:[o]),u=Object(v.a)(o),e.prev=12,u.s();case 14:if((c=u.n()).done){e.next=22;break}return s=c.value,e.next=18,this.exportItem(i,s);case 18:l=e.sent,i.repeated?(n[i.name]||(n[i.name]=[]),n[i.name].push(l)):n[i.name]=l;case 20:e.next=14;break;case 22:e.next=27;break;case 24:e.prev=24,e.t2=e.catch(12),u.e(e.t2);case 27:return e.prev=27,u.f(),e.finish(27);case 30:e.next=6;break;case 32:return this.raw=new Uint8Array(t.protobuf.encode(n).finish()).buffer,e.abrupt("return",this.raw);case 34:case"end":return e.stop()}}),e,this,[[12,24,27,30]])})));return function(){return e.apply(this,arguments)}}()},{key:"exportItem",value:function(){var e=Object(h.a)(f.mark((function e(t,r){var n,a,i,o;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.constructor,!t.parser){e.next=11;break}return i=r,e.next=5,i.exportProto();case 5:if(o=e.sent,!t.required||o){e.next=8;break}throw new Error("Error: Paramter '".concat(t.name,"' is required in '").concat(n.localName,"' protobuf message."));case 8:o&&(a=new Uint8Array(o)),e.next=22;break;case 11:if(!t.required||void 0!==r){e.next=13;break}throw new Error("Error: Paramter '".concat(t.name,"' is required in '").concat(n.localName,"' protobuf message."));case 13:if(!t.converter){e.next=20;break}if(void 0===r){e.next=18;break}return e.next=17,t.converter.set(r);case 17:a=e.sent;case 18:e.next=22;break;case 20:r instanceof ArrayBuffer&&(r=new Uint8Array(r)),a=r;case 22:return e.abrupt("return",a);case 23:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"importItem",value:function(){var e=Object(h.a)(f.mark((function e(t,r){var n,a,i;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.constructor,!t.parser){e.next=13;break}if(i=t.parser,!r||!r.byteLength){e.next=9;break}return e.next=6,i.importProto(new Uint8Array(r).buffer);case 6:a=e.sent,e.next=11;break;case 9:if(!t.required){e.next=11;break}throw new Error("Error: Parameter '".concat(t.name,"' is required in '").concat(n.localName,"' protobuf message."));case 11:e.next=25;break;case 13:if(!t.converter){e.next=24;break}if(!r||!r.byteLength){e.next=20;break}return e.next=17,t.converter.get(r);case 17:a=e.sent,e.next=22;break;case 20:if(!t.required){e.next=22;break}throw new Error("Error: Parameter '".concat(t.name,"' is required in '").concat(n.localName,"' protobuf message."));case 22:e.next=25;break;case 24:a=r;case 25:return e.abrupt("return",a);case 26:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}],[{key:"importProto",value:function(){var e=Object(h.a)(f.mark((function e(t){var r;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new this,e.next=3,r.importProto(t);case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function D(){}function C(){C.init.call(this)}function K(e){return void 0===e._maxListeners?C.defaultMaxListeners:e._maxListeners}function T(e,t,r){if(t)e.call(r);else for(var n=e.length,a=q(e,n),i=0;i<n;++i)a[i].call(r)}function U(e,t,r,n){if(t)e.call(r,n);else for(var a=e.length,i=q(e,a),o=0;o<a;++o)i[o].call(r,n)}function L(e,t,r,n,a){if(t)e.call(r,n,a);else for(var i=e.length,o=q(e,i),u=0;u<i;++u)o[u].call(r,n,a)}function X(e,t,r,n,a,i){if(t)e.call(r,n,a,i);else for(var o=e.length,u=q(e,o),c=0;c<o;++c)u[c].call(r,n,a,i)}function H(e,t,r,n){if(t)e.apply(r,n);else for(var a=e.length,i=q(e,a),o=0;o<a;++o)i[o].apply(r,n)}function R(e,t,r,n){var a,i,o,u;if("function"!==typeof r)throw new TypeError('"listener" argument must be a function');if((i=e._events)?(i.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),i=e._events),o=i[t]):(i=e._events=new D,e._eventsCount=0),o){if("function"===typeof o?o=i[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),!o.warned&&(a=K(e))&&a>0&&o.length>a){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=o.length,u=c,"function"===typeof console.warn?console.warn(u):console.log(u)}}else o=i[t]=r,++e._eventsCount;return e}function P(e,t,r){var n=!1;function a(){e.removeListener(t,a),n||(n=!0,r.apply(e,arguments))}return a.listener=r,a}function _(e){var t=this._events;if(t){var r=t[e];if("function"===typeof r)return 1;if(r)return r.length}return 0}function q(e,t){for(var r=new Array(t);t--;)r[t]=e[t];return r}D.prototype=Object.create(null),C.EventEmitter=C,C.usingDomains=!1,C.prototype.domain=void 0,C.prototype._events=void 0,C.prototype._maxListeners=void 0,C.defaultMaxListeners=10,C.init=function(){this.domain=null,C.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new D,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},C.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},C.prototype.getMaxListeners=function(){return K(this)},C.prototype.emit=function(e){var t,r,n,a,i,o,u,c="error"===e;if(o=this._events)c=c&&null==o.error;else if(!c)return!1;if(u=this.domain,c){if(t=arguments[1],!u){if(t instanceof Error)throw t;var s=new Error('Uncaught, unspecified "error" event. ('+t+")");throw s.context=t,s}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=u,t.domainThrown=!1,u.emit("error",t),!1}if(!(r=o[e]))return!1;var l="function"===typeof r;switch(n=arguments.length){case 1:T(r,l,this);break;case 2:U(r,l,this,arguments[1]);break;case 3:L(r,l,this,arguments[1],arguments[2]);break;case 4:X(r,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(a=new Array(n-1),i=1;i<n;i++)a[i-1]=arguments[i];H(r,l,this,a)}return!0},C.prototype.addListener=function(e,t){return R(this,e,t,!1)},C.prototype.on=C.prototype.addListener,C.prototype.prependListener=function(e,t){return R(this,e,t,!0)},C.prototype.once=function(e,t){if("function"!==typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,P(this,e,t)),this},C.prototype.prependOnceListener=function(e,t){if("function"!==typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,P(this,e,t)),this},C.prototype.removeListener=function(e,t){var r,n,a,i,o;if("function"!==typeof t)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(r=n[e]))return this;if(r===t||r.listener&&r.listener===t)0===--this._eventsCount?this._events=new D:(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!==typeof r){for(a=-1,i=r.length;i-- >0;)if(r[i]===t||r[i].listener&&r[i].listener===t){o=r[i].listener,a=i;break}if(a<0)return this;if(1===r.length){if(r[0]=void 0,0===--this._eventsCount)return this._events=new D,this;delete n[e]}else!function(e,t){for(var r=t,n=r+1,a=e.length;n<a;r+=1,n+=1)e[r]=e[n];e.pop()}(r,a);n.removeListener&&this.emit("removeListener",e,o||t)}return this},C.prototype.removeAllListeners=function(e){var t,r;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=new D,this._eventsCount=0):r[e]&&(0===--this._eventsCount?this._events=new D:delete r[e]),this;if(0===arguments.length){for(var n,a=Object.keys(r),i=0;i<a.length;++i)"removeListener"!==(n=a[i])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=new D,this._eventsCount=0,this}if("function"===typeof(t=r[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},C.prototype.listeners=function(e){var t,r=this._events;return r&&(t=r[e])?"function"===typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(t):[]},C.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):_.call(e,t)},C.prototype.listenerCount=_,C.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var V="ECDSA",J="ECDH",F="AES-CBC",M="SHA-256",G="HMAC",z=w.FromBinary("InfoText"),W=w.FromBinary("InfoRatchet"),Y=w.FromBinary("InfoMessageKeys"),Z=null;function $(){if(!Z)throw new Error("WebCrypto engine is empty. Use setEngine to resolve it.");return Z}"undefined"!==typeof self&&(Z={crypto:self.crypto,name:"WebCrypto"});var Q=function(){var e=function(){function e(){Object(p.a)(this,e)}return Object(y.a)(e,null,[{key:"generateKeyPair",value:function(){var e=Object(h.a)(f.mark((function e(t,r){var n,a,i,o,u;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t,a="ECDSA"===t?["sign","verify"]:["deriveKey","deriveBits"],e.next=4,$().crypto.subtle.generateKey({name:n,namedCurve:this.NAMED_CURVE},r,a);case 4:return i=e.sent,e.next=7,re.create(i.publicKey);case 7:return o=e.sent,u={privateKey:i.privateKey,publicKey:o},e.abrupt("return",u);case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"deriveBytes",value:function(e,t){return $().crypto.subtle.deriveBits({name:"ECDH",public:t.key},e,256)}},{key:"verify",value:function(e,t,r){return $().crypto.subtle.verify({name:"ECDSA",hash:this.DIGEST_ALGORITHM},e.key,r,t)}},{key:"sign",value:function(){var e=Object(h.a)(f.mark((function e(t,r){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",$().crypto.subtle.sign({name:"ECDSA",hash:this.DIGEST_ALGORITHM},t,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"ecKeyPairToJson",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t.privateKey,e.t1=t.publicKey.key,e.next=4,t.publicKey.thumbprint();case 4:return e.t2=e.sent,e.abrupt("return",{privateKey:e.t0,publicKey:e.t1,thumbprint:e.t2});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"ecKeyPairFromJson",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=t.privateKey,e.next=3,re.create(t.publicKey);case 3:return e.t1=e.sent,e.abrupt("return",{privateKey:e.t0,publicKey:e.t1});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}();return e.NAMED_CURVE="P-256",e.DIGEST_ALGORITHM="SHA-512",e}(),ee={name:"AES-CBC",length:256},te=function(){function e(){Object(p.a)(this,e)}return Object(y.a)(e,null,[{key:"randomBytes",value:function(e){var t=new Uint8Array(e);return $().crypto.getRandomValues(t),t.buffer}},{key:"digest",value:function(e,t){return $().crypto.subtle.digest(e,t)}},{key:"encrypt",value:function(e,t,r){return $().crypto.subtle.encrypt({name:F,iv:new Uint8Array(r)},e,t)}},{key:"decrypt",value:function(e,t,r){return $().crypto.subtle.decrypt({name:F,iv:new Uint8Array(r)},e,t)}},{key:"importHMAC",value:function(e){return $().crypto.subtle.importKey("raw",e,{name:G,hash:{name:M}},!1,["sign","verify"])}},{key:"importAES",value:function(e){return $().crypto.subtle.importKey("raw",e,ee,!1,["encrypt","decrypt"])}},{key:"sign",value:function(){var e=Object(h.a)(f.mark((function e(t,r){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$().crypto.subtle.sign({name:G,hash:M},t,r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"HKDF",value:function(){var e=Object(h.a)(f.mark((function e(t){var r,n,a,i,o,u,c,s=arguments;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=s.length>1&&void 0!==s[1]?s[1]:1,n=s.length>2?s[2]:void 0,a=s.length>3&&void 0!==s[3]?s[3]:new ArrayBuffer(0),n){e.next=7;break}return e.next=6,this.importHMAC(new Uint8Array(32).buffer);case 6:n=e.sent;case 7:return e.next=9,this.sign(n,t);case 9:return i=e.sent,new ArrayBuffer(32+a.byteLength+1),e.next=13,this.importHMAC(i);case 13:o=e.sent,u=[new ArrayBuffer(0)],c=0;case 16:if(!(c<r)){e.next=23;break}return e.next=19,this.sign(o,j(u[c],a,new Uint8Array([c+1]).buffer));case 19:u[c+1]=e.sent;case 20:c++,e.next=16;break;case 23:return e.abrupt("return",u.slice(1));case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),re=function(){function e(){Object(p.a)(this,e)}return Object(y.a)(e,[{key:"serialize",value:function(){return this.serialized}},{key:"thumbprint",value:function(){var e=Object(h.a)(f.mark((function e(){var t,r;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.serialize();case 2:return t=e.sent,e.next=5,te.digest("SHA-256",t);case 5:return r=e.sent,e.abrupt("return",w.ToHex(r));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isEqual",value:function(){var t=Object(h.a)(f.mark((function t(r){return f.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r&&r instanceof e){t.next=2;break}return t.abrupt("return",!1);case 2:return t.abrupt("return",B(this.serialized,r.serialized));case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}],[{key:"create",value:function(){var e=Object(h.a)(f.mark((function e(t){var r,n,a,i,o,u;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=new this,"ECDH"===(n=t.algorithm.name.toUpperCase())||"ECDSA"===n){e.next=4;break}throw new Error("Error: Unsupported asymmetric key algorithm.");case 4:if("public"===t.type){e.next=6;break}throw new Error("Error: Expected key type to be public but it was not.");case 6:return r.key=t,e.next=9,$().crypto.subtle.exportKey("jwk",t);case 9:if((a=e.sent).x&&a.y){e.next=12;break}throw new Error("Wrong JWK data for EC public key. Parameters x and y are required.");case 12:return i=w.FromBase64Url(a.x),o=w.FromBase64Url(a.y),u=w.ToBinary(i)+w.ToBinary(o),r.serialized=w.FromBinary(u),e.next=18,r.thumbprint();case 18:return r.id=e.sent,e.abrupt("return",r);case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"importKey",value:function(){var t=Object(h.a)(f.mark((function t(r,n){var a,i,o,u,c,s;return f.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=w.ToBase64Url(r.slice(0,32)),i=w.ToBase64Url(r.slice(32)),o={crv:Q.NAMED_CURVE,kty:"EC",x:a,y:i},u="ECDSA"===n?["verify"]:[],t.next=6,$().crypto.subtle.importKey("jwk",o,{name:n,namedCurve:Q.NAMED_CURVE},!0,u);case 6:return c=t.sent,t.next=9,e.create(c);case 9:return s=t.sent,t.abrupt("return",s);case 11:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}()}]),e}(),ne=function(){function e(t,r,n){Object(p.a)(this,e),this.id=t,this.signingKey=r,this.exchangeKey=n,this.preKeys=[],this.signedPreKeys=[]}return Object(y.a)(e,[{key:"toJSON",value:function(){var e=Object(h.a)(f.mark((function e(){var t,r,n,a,i,o,u,c;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],r=[],n=Object(v.a)(this.preKeys),e.prev=3,n.s();case 5:if((a=n.n()).done){e.next=14;break}return i=a.value,e.t0=t,e.next=10,Q.ecKeyPairToJson(i);case 10:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 12:e.next=5;break;case 14:e.next=19;break;case 16:e.prev=16,e.t2=e.catch(3),n.e(e.t2);case 19:return e.prev=19,n.f(),e.finish(19);case 22:o=Object(v.a)(this.signedPreKeys),e.prev=23,o.s();case 25:if((u=o.n()).done){e.next=34;break}return c=u.value,e.t3=r,e.next=30,Q.ecKeyPairToJson(c);case 30:e.t4=e.sent,e.t3.push.call(e.t3,e.t4);case 32:e.next=25;break;case 34:e.next=39;break;case 36:e.prev=36,e.t5=e.catch(23),o.e(e.t5);case 39:return e.prev=39,o.f(),e.finish(39);case 42:return e.t6=this.createdAt.toISOString(),e.next=45,Q.ecKeyPairToJson(this.exchangeKey);case 45:return e.t7=e.sent,e.t8=this.id,e.t9=t,e.t10=r,e.next=51,Q.ecKeyPairToJson(this.signingKey);case 51:return e.t11=e.sent,e.abrupt("return",{createdAt:e.t6,exchangeKey:e.t7,id:e.t8,preKeys:e.t9,signedPreKeys:e.t10,signingKey:e.t11});case 53:case"end":return e.stop()}}),e,this,[[3,16,19,22],[23,36,39,42]])})));return function(){return e.apply(this,arguments)}}()},{key:"fromJSON",value:function(){var e=Object(h.a)(f.mark((function e(t){var r,n,a,i,o,u;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.id=t.id,e.next=3,Q.ecKeyPairFromJson(t.signingKey);case 3:return this.signingKey=e.sent,e.next=6,Q.ecKeyPairFromJson(t.exchangeKey);case 6:this.exchangeKey=e.sent,this.preKeys=[],r=Object(v.a)(t.preKeys),e.prev=9,r.s();case 11:if((n=r.n()).done){e.next=20;break}return a=n.value,e.t0=this.preKeys,e.next=16,Q.ecKeyPairFromJson(a);case 16:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 18:e.next=11;break;case 20:e.next=25;break;case 22:e.prev=22,e.t2=e.catch(9),r.e(e.t2);case 25:return e.prev=25,r.f(),e.finish(25);case 28:this.signedPreKeys=[],i=Object(v.a)(t.signedPreKeys),e.prev=30,i.s();case 32:if((o=i.n()).done){e.next=41;break}return u=o.value,e.t3=this.signedPreKeys,e.next=37,Q.ecKeyPairFromJson(u);case 37:e.t4=e.sent,e.t3.push.call(e.t3,e.t4);case 39:e.next=32;break;case 41:e.next=46;break;case 43:e.prev=43,e.t5=e.catch(30),i.e(e.t5);case 46:return e.prev=46,i.f(),e.finish(46);case 49:case"end":return e.stop()}}),e,this,[[9,22,25,28],[30,43,46,49]])})));return function(t){return e.apply(this,arguments)}}()}],[{key:"fromJSON",value:function(){var e=Object(h.a)(f.mark((function e(t){var r,n,a;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Q.ecKeyPairFromJson(t.signingKey);case 2:return r=e.sent,e.next=5,Q.ecKeyPairFromJson(t.exchangeKey);case 5:return n=e.sent,(a=new this(t.id,r,n)).createdAt=new Date(t.createdAt),e.next=10,a.fromJSON(t);case 10:return e.abrupt("return",a);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"create",value:function(){var t=Object(h.a)(f.mark((function t(r){var n,a,i,o,u,c,s,l,h=arguments;return f.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=h.length>1&&void 0!==h[1]?h[1]:0,a=h.length>2&&void 0!==h[2]?h[2]:0,i=h.length>3&&void 0!==h[3]&&h[3],t.next=5,Q.generateKeyPair(V,i);case 5:return o=t.sent,t.next=8,Q.generateKeyPair(J,i);case 8:u=t.sent,(c=new e(r,o,u)).createdAt=new Date,s=0;case 12:if(!(s<a)){t.next=21;break}return t.t0=c.preKeys,t.next=16,Q.generateKeyPair("ECDH",i);case 16:t.t1=t.sent,t.t0.push.call(t.t0,t.t1);case 18:s++,t.next=12;break;case 21:l=0;case 22:if(!(l<n)){t.next=31;break}return t.t2=c.signedPreKeys,t.next=26,Q.generateKeyPair("ECDH",i);case 26:t.t3=t.sent,t.t2.push.call(t.t2,t.t3);case 28:l++,t.next=22;break;case 31:return t.abrupt("return",c);case 32:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),e}(),ae=function(){function e(){Object(p.a)(this,e)}return Object(y.a)(e,[{key:"fill",value:function(e){this.signingKey=e.signingKey,this.exchangeKey=e.exchangeKey,this.signature=e.signature,this.createdAt=e.createdAt}},{key:"verify",value:function(){return Q.verify(this.signingKey,this.exchangeKey.serialize(),this.signature)}},{key:"toJSON",value:function(){var e=Object(h.a)(f.mark((function e(){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this.createdAt.toISOString(),e.next=3,this.exchangeKey.key;case 3:return e.t1=e.sent,e.t2=this.id,e.t3=this.signature,e.next=8,this.signingKey.key;case 8:return e.t4=e.sent,e.next=11,this.signingKey.thumbprint();case 11:return e.t5=e.sent,e.abrupt("return",{createdAt:e.t0,exchangeKey:e.t1,id:e.t2,signature:e.t3,signingKey:e.t4,thumbprint:e.t5});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"fromJSON",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.id=t.id,this.signature=t.signature,e.next=4,re.create(t.signingKey);case 4:return this.signingKey=e.sent,e.next=7,re.create(t.exchangeKey);case 7:return this.exchangeKey=e.sent,this.createdAt=new Date(t.createdAt),e.next=11,this.verify();case 11:if(e.sent){e.next=14;break}throw new Error("Error: Wrong signature for RemoteIdentity");case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"fill",value:function(t){var r=new e;return r.fill(t),r}},{key:"fromJSON",value:function(){var e=Object(h.a)(f.mark((function e(t){var r;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new this,e.next=3,r.fromJSON(t);case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),ie=function(){var e=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(S);return N([A({id:0,type:"uint32",defaultValue:1})],e.prototype,"version",void 0),e=N([I({name:"Base"})],e)}(),oe=function(){function e(){Object(p.a)(this,e)}return Object(y.a)(e,null,[{key:"set",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Uint8Array(t.serialize()));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",re.importKey(t.buffer,"ECDSA"));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),ue=function(){function e(){Object(p.a)(this,e)}return Object(y.a)(e,null,[{key:"set",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Uint8Array(t.serialize()));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",re.importKey(t.buffer,"ECDH"));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),ce=function(){function e(){Object(p.a)(this,e)}return Object(y.a)(e,null,[{key:"set",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Uint8Array(w.FromString(t.toISOString())));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Date(w.ToString(t)));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),se=function(){var e,t=e=function(t){Object(s.a)(n,t);var r=Object(l.a)(n);function n(){return Object(p.a)(this,n),r.apply(this,arguments)}return Object(y.a)(n,[{key:"sign",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Q.sign(t,this.exchangeKey.serialize());case 2:this.signature=e.sent;case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"verify",value:function(){var e=Object(h.a)(f.mark((function e(){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Q.verify(this.signingKey,this.exchangeKey.serialize(),this.signature);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"fill",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.signingKey=t.signingKey.publicKey,this.exchangeKey=t.exchangeKey.publicKey,this.createdAt=t.createdAt,e.next=5,this.sign(t.signingKey.privateKey);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"fill",value:function(){var t=Object(h.a)(f.mark((function t(r){var n;return f.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new e,t.next=3,n.fill(r);case 3:return t.abrupt("return",n);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),n}(ie);return N([A({id:1,converter:oe})],t.prototype,"signingKey",void 0),N([A({id:2,converter:ue})],t.prototype,"exchangeKey",void 0),N([A({id:3})],t.prototype,"signature",void 0),N([A({id:4,converter:ce})],t.prototype,"createdAt",void 0),t=e=N([I({name:"Identity"})],t)}(),le=function(){var e=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(ie);return N([A({id:1,converter:ue,required:!0})],e.prototype,"senderRatchetKey",void 0),N([A({id:2,type:"uint32",required:!0})],e.prototype,"counter",void 0),N([A({id:3,type:"uint32",required:!0})],e.prototype,"previousCounter",void 0),N([A({id:4,converter:E,required:!0})],e.prototype,"cipherText",void 0),e=N([I({name:"Message"})],e)}(),fe=function(){var e=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return Object(y.a)(r,[{key:"sign",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signHMAC(t);case 2:this.signature=e.sent;case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"verify",value:function(){var e=Object(h.a)(f.mark((function e(t){var r;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.signHMAC(t);case 2:return r=e.sent,e.abrupt("return",B(r,this.signature));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getSignedRaw",value:function(){var e=Object(h.a)(f.mark((function e(){var t,r,n,a;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.receiverKey.serialize(),r=this.senderKey.serialize(),e.next=4,this.message.exportProto();case 4:return n=e.sent,a=j(t,r,n),e.abrupt("return",a);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"signHMAC",value:function(){var e=Object(h.a)(f.mark((function e(t){var r,n;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSignedRaw();case 2:return r=e.sent,e.next=5,te.sign(t,r);case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(ie);return N([A({id:1,converter:oe,required:!0})],e.prototype,"senderKey",void 0),N([A({id:2,parser:le,required:!0})],e.prototype,"message",void 0),N([A({id:3,required:!0})],e.prototype,"signature",void 0),e=N([I({name:"MessageSigned"})],e)}(),he=function(){var e=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(ie);return N([A({id:1,type:"uint32",required:!0})],e.prototype,"registrationId",void 0),N([A({id:2,type:"uint32"})],e.prototype,"preKeyId",void 0),N([A({id:3,type:"uint32",required:!0})],e.prototype,"preKeySignedId",void 0),N([A({id:4,converter:ue,required:!0})],e.prototype,"baseKey",void 0),N([A({id:5,parser:se,required:!0})],e.prototype,"identity",void 0),N([A({id:6,parser:fe,required:!0})],e.prototype,"signedMessage",void 0),e=N([I({name:"PreKeyMessage"})],e)}(),ve=function(){var e=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(ie);return N([A({id:1,type:"uint32",required:!0})],e.prototype,"id",void 0),N([A({id:2,converter:ue,required:!0})],e.prototype,"key",void 0),e=N([I({name:"PreKey"})],e)}(),pe=function(){var e=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return Object(y.a)(r,[{key:"sign",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Q.sign(t,this.key.serialize());case 2:this.signature=e.sent;case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"verify",value:function(e){return Q.verify(e,this.key.serialize(),this.signature)}}]),r}(ve);return N([A({id:3,converter:E,required:!0})],e.prototype,"signature",void 0),e=N([I({name:"PreKeySigned"})],e)}(),ye=function(){var e=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(ie);return N([A({id:1,type:"uint32",required:!0})],e.prototype,"registrationId",void 0),N([A({id:2,parser:se,required:!0})],e.prototype,"identity",void 0),N([A({id:3,parser:ve})],e.prototype,"preKey",void 0),N([A({id:4,parser:pe,required:!0})],e.prototype,"preKeySigned",void 0),e=N([I({name:"PreKeyBundle"})],e)}(),de=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;Object(p.a)(this,e),this.items=[],this.maxSize=t}return Object(y.a)(e,[{key:"length",get:function(){return this.items.length}},{key:"latest",get:function(){return this.items[this.length-1]}},{key:"push",value:function(e){this.length===this.maxSize&&(this.items=this.items.slice(1)),this.items.push(e)}},{key:"toJSON",value:function(){var e=Object(h.a)(f.mark((function e(){var t,r,n,a;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],r=Object(v.a)(this.items),e.prev=2,r.s();case 4:if((n=r.n()).done){e.next=13;break}return a=n.value,e.t0=t,e.next=9,a.toJSON();case 9:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 11:e.next=4;break;case 13:e.next=18;break;case 15:e.prev=15,e.t2=e.catch(2),r.e(e.t2);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return e.abrupt("return",t);case 22:case"end":return e.stop()}}),e,this,[[2,15,18,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"fromJSON",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.items=t;case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),be=new Uint8Array([1]).buffer,ge=new Uint8Array([2]).buffer,me=function(){function e(t){Object(p.a)(this,e),this.counter=0,this.rootKey=t}return Object(y.a)(e,[{key:"toJSON",value:function(){var e=Object(h.a)(f.mark((function e(){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{counter:this.counter,rootKey:this.rootKey});case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"fromJSON",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.counter=t.counter,this.rootKey=t.rootKey;case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"calculateKey",value:function(){var e=Object(h.a)(f.mark((function e(t){var r,n,a;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,te.sign(t,be);case 2:return r=e.sent,e.next=5,te.sign(t,ge);case 5:return n=e.sent,e.t0=r,e.next=9,te.importHMAC(n);case 9:return e.t1=e.sent,a={cipher:e.t0,rootKey:e.t1},e.abrupt("return",a);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"click",value:function(){var e=Object(h.a)(f.mark((function e(){var t,r;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.rootKey,e.next=3,this.calculateKey(t);case 3:return r=e.sent,this.rootKey=r.rootKey,this.counter++,e.abrupt("return",r.cipher);case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}],[{key:"fromJSON",value:function(){var e=Object(h.a)(f.mark((function e(t){var r;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new this(t.rootKey)).fromJSON(t),e.abrupt("return",r);case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),ke=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return Object(y.a)(r,[{key:"encrypt",value:function(){var e=Object(h.a)(f.mark((function e(t){var r,n,a,i,o,u;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.click();case 2:return r=e.sent,e.next=5,te.HKDF(r,3,void 0,Y);case 5:return n=e.sent,e.next=8,te.importAES(n[0]);case 8:return a=e.sent,e.next=11,te.importHMAC(n[1]);case 11:return i=e.sent,o=n[2].slice(0,16),e.next=15,te.encrypt(a,t,o);case 15:return u=e.sent,e.abrupt("return",{cipherText:u,hmacKey:i});case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(me),Oe=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).keys=[],e}return Object(y.a)(r,[{key:"toJSON",value:function(){var e=Object(h.a)(f.mark((function e(){var t;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(u.a)(Object(c.a)(r.prototype),"toJSON",this).call(this);case 2:return(t=e.sent).keys=this.keys,e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"fromJSON",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(u.a)(Object(c.a)(r.prototype),"fromJSON",this).call(this,t);case 2:this.keys=t.keys;case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"decrypt",value:function(){var e=Object(h.a)(f.mark((function e(t,r){var n,a,i,o,u,c;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getKey(r);case 2:return n=e.sent,e.next=5,te.HKDF(n,3,void 0,Y);case 5:return a=e.sent,e.next=8,te.importAES(a[0]);case 8:return i=e.sent,e.next=11,te.importHMAC(a[1]);case 11:return o=e.sent,u=a[2].slice(0,16),e.next=15,te.decrypt(i,t,u);case 15:return c=e.sent,e.abrupt("return",{cipherText:c,hmacKey:o});case 17:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getKey",value:function(){var e=Object(h.a)(f.mark((function e(t){var r,n;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.counter<=t)){e.next=7;break}return e.next=3,this.click();case 3:r=e.sent,this.keys.push(r),e.next=0;break;case 7:return n=this.keys[t],e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(me);function we(e,t,r,n,a){return xe.apply(this,arguments)}function xe(){return(xe=Object(h.a)(f.mark((function e(t,r,n,a,i){var o,u,c,s,l,h,v,p,y;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Q.deriveBytes(t.exchangeKey.privateKey,a);case 2:return o=e.sent,e.next=5,Q.deriveBytes(r.privateKey,n);case 5:return u=e.sent,e.next=8,Q.deriveBytes(r.privateKey,a);case 8:if(c=e.sent,s=new ArrayBuffer(0),!i){e.next=14;break}return e.next=13,Q.deriveBytes(r.privateKey,i);case 13:s=e.sent;case 14:for(l=new Uint8Array(32),h=0;h<l.length;h++)l[h]=255;return v=l.buffer,p=j(v,o,u,c,s),e.next=20,te.HKDF(p,1,void 0,z);case 20:return y=e.sent,e.next=23,te.importHMAC(y[0]);case 23:return e.abrupt("return",e.sent);case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function je(e,t,r,n,a){return Be.apply(this,arguments)}function Be(){return(Be=Object(h.a)(f.mark((function e(t,r,n,a,i){var o,u,c,s,l,h,v,p,y;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Q.deriveBytes(r.privateKey,n);case 2:return o=e.sent,e.next=5,Q.deriveBytes(t.exchangeKey.privateKey,a);case 5:return u=e.sent,e.next=8,Q.deriveBytes(r.privateKey,a);case 8:if(c=e.sent,s=new ArrayBuffer(0),!i){e.next=14;break}return e.next=13,Q.deriveBytes(i,a);case 13:s=e.sent;case 14:for(l=new Uint8Array(32),h=0;h<l.length;h++)l[h]=255;return v=l.buffer,p=j(v,o,u,c,s),e.next=20,te.HKDF(p,1,void 0,z);case 20:return y=e.sent,e.next=23,te.importHMAC(y[0]);case 23:return e.abrupt("return",e.sent);case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ne=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this)).options=n,e.counter=0,e.currentStep=new Ee,e.steps=new Ie(20),e.promises={},e}return Object(y.a)(r,[{key:"on",value:function(e,t){return Object(u.a)(Object(c.a)(r.prototype),"on",this).call(this,e,t)}},{key:"once",value:function(e,t){return Object(u.a)(Object(c.a)(r.prototype),"once",this).call(this,e,t)}},{key:"decrypt",value:function(){var e=Object(h.a)(f.mark((function e(t){var r=this;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.queuePromise("encrypt",Object(h.a)(f.mark((function e(){var n,a,i,o,u;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.message.senderRatchetKey,a=t.message,!(t.message.previousCounter<r.counter-20)){e.next=4;break}throw new Error("Error: Too old message");case 4:if((i=r.steps.getStep(n))||((o=new Ee).remoteRatchetKey=n,r.steps.push(o),r.currentStep=o,i=o),i.receivingChain){e.next=10;break}return e.next=9,r.createChain(r.currentRatchetKey.privateKey,n,Oe);case 9:i.receivingChain=e.sent;case 10:return e.next=12,i.receivingChain.decrypt(a.cipherText,a.counter);case 12:return u=e.sent,r.update(),t.senderKey=r.remoteIdentity.signingKey,t.receiverKey=r.identity.signingKey.publicKey,e.next=18,t.verify(u.hmacKey);case 18:if(e.sent){e.next=20;break}throw new Error("Error: The Message did not successfully verify!");case 20:return e.abrupt("return",u.cipherText);case 21:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"encrypt",value:function(){var e=Object(h.a)(f.mark((function e(t){var r=this;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.queuePromise("encrypt",Object(h.a)(f.mark((function e(){var n,a,i;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.currentStep.receivingChain||r.currentStep.sendingChain){e.next=5;break}return r.counter++,e.next=4,r.generateRatchetKey();case 4:r.currentRatchetKey=e.sent;case 5:if(r.currentStep.sendingChain){e.next=11;break}if(r.currentStep.remoteRatchetKey){e.next=8;break}throw new Error("currentStep has empty remoteRatchetKey");case 8:return e.next=10,r.createChain(r.currentRatchetKey.privateKey,r.currentStep.remoteRatchetKey,ke);case 10:r.currentStep.sendingChain=e.sent;case 11:return e.next=13,r.currentStep.sendingChain.encrypt(t);case 13:if(n=e.sent,r.update(),0!==r.steps.length||r.currentStep.receivingChain||1!==r.currentStep.sendingChain.counter){e.next=23;break}return(a=new he).registrationId=r.identity.id,a.preKeyId=r.remotePreKeyId,a.preKeySignedId=r.remotePreKeySignedId,a.baseKey=r.currentRatchetKey.publicKey,e.next=23,a.identity.fill(r.identity);case 23:return(i=new fe).receiverKey=r.remoteIdentity.signingKey,i.senderKey=r.identity.signingKey.publicKey,i.message.cipherText=n.cipherText,i.message.counter=r.currentStep.sendingChain.counter-1,i.message.previousCounter=r.counter,i.message.senderRatchetKey=r.currentRatchetKey.publicKey,e.next=32,i.sign(n.hmacKey);case 32:if(!a){e.next=37;break}return a.signedMessage=i,e.abrupt("return",a);case 37:return e.abrupt("return",i);case 38:case"end":return e.stop()}}),e)})))));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hasRatchetKey",value:function(){var e=Object(h.a)(f.mark((function e(t){var r,n,a,i;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t instanceof re){e.next=6;break}return e.next=3,re.create(t);case 3:r=e.sent,e.next=7;break;case 6:r=t;case 7:n=Object(v.a)(this.steps.items),e.prev=8,n.s();case 10:if((a=n.n()).done){e.next=18;break}return i=a.value,e.next=14,i.remoteRatchetKey.isEqual(r);case 14:if(!e.sent){e.next=16;break}return e.abrupt("return",!0);case 16:e.next=10;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(8),n.e(e.t0);case 23:return e.prev=23,n.f(),e.finish(23);case 26:return e.abrupt("return",!1);case 27:case"end":return e.stop()}}),e,this,[[8,20,23,26]])})));return function(t){return e.apply(this,arguments)}}()},{key:"toJSON",value:function(){var e=Object(h.a)(f.mark((function e(){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=this.counter,e.next=3,Q.ecKeyPairToJson(this.currentRatchetKey);case 3:return e.t1=e.sent,e.next=6,this.remoteIdentity.signingKey.thumbprint();case 6:return e.t2=e.sent,e.t3=this.rootKey,e.next=10,this.steps.toJSON();case 10:return e.t4=e.sent,e.abrupt("return",{counter:e.t0,ratchetKey:e.t1,remoteIdentity:e.t2,rootKey:e.t3,steps:e.t4});case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"fromJSON",value:function(){var e=Object(h.a)(f.mark((function e(t){var r,n,a;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Q.ecKeyPairFromJson(t.ratchetKey);case 2:this.currentRatchetKey=e.sent,this.counter=t.counter,this.rootKey=t.rootKey,r=Object(v.a)(t.steps),e.prev=6,r.s();case 8:if((n=r.n()).done){e.next=16;break}return a=n.value,e.next=12,Ee.fromJSON(a);case 12:this.currentStep=e.sent,this.steps.push(this.currentStep);case 14:e.next=8;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(6),r.e(e.t0);case 21:return e.prev=21,r.f(),e.finish(21);case 24:case"end":return e.stop()}}),e,this,[[6,18,21,24]])})));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(){this.emit("update")}},{key:"generateRatchetKey",value:function(){return Q.generateKeyPair("ECDH",!!this.options.exportableKeys)}},{key:"createChain",value:function(){var e=Object(h.a)(f.mark((function e(t,r,n){var a,i,o,u,c;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Q.deriveBytes(t,r);case 2:return a=e.sent,e.next=5,te.HKDF(a,2,this.rootKey,W);case 5:return i=e.sent,e.next=8,te.importHMAC(i[0]);case 8:return o=e.sent,e.next=11,te.importHMAC(i[1]);case 11:return u=e.sent,c=new n(u),this.rootKey=o,e.abrupt("return",c);case 15:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"queuePromise",value:function(e,t){var r=this,n=this.promises[e]||Promise.resolve(),a=this.promises[e]=n.then(t,t);return a.then((function(){r.promises[e]===a&&delete r.promises[e]})),a}}],[{key:"create",value:function(){var e=Object(h.a)(f.mark((function e(t,n){var a,i,o,u,c,s=arguments;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=s.length>2&&void 0!==s[2]?s[2]:{},o=new r(a),!(n instanceof ye)){e.next=24;break}return e.next=5,n.identity.verify();case 5:if(e.sent){e.next=7;break}throw new Error("Error: Remote client's identity key is invalid.");case 7:return e.next=9,n.preKeySigned.verify(n.identity.signingKey);case 9:if(e.sent){e.next=11;break}throw new Error("Error: Remote client's signed prekey is invalid.");case 11:return e.next=13,o.generateRatchetKey();case 13:return o.currentRatchetKey=e.sent,o.currentStep.remoteRatchetKey=n.preKeySigned.key,o.remoteIdentity=ae.fill(n.identity),o.remoteIdentity.id=n.registrationId,o.remotePreKeyId=n.preKey.id,o.remotePreKeySignedId=n.preKeySigned.id,e.next=21,we(t,o.currentRatchetKey,n.identity.exchangeKey,n.preKeySigned.key,n.preKey.key);case 21:i=e.sent,e.next=37;break;case 24:return e.next=26,n.identity.verify();case 26:if(e.sent){e.next=28;break}throw new Error("Error: Remote client's identity key is invalid.");case 28:if(u=t.signedPreKeys[n.preKeySignedId]){e.next=31;break}throw new Error("Error: PreKey with id ".concat(n.preKeySignedId," not found"));case 31:return void 0!==n.preKeyId&&(c=t.preKeys[n.preKeyId]),o.remoteIdentity=ae.fill(n.identity),o.currentRatchetKey=u,e.next=36,je(t,o.currentRatchetKey,n.identity.exchangeKey,n.signedMessage.message.senderRatchetKey,c&&c.privateKey);case 36:i=e.sent;case 37:return o.identity=t,o.id=t.id,o.rootKey=i,e.abrupt("return",o);case 41:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"fromJSON",value:function(){var e=Object(h.a)(f.mark((function e(t,n,a){var i;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=new r).identity=t,i.remoteIdentity=n,e.next=5,i.fromJSON(a);case 5:return e.abrupt("return",i);case 6:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()}]),r}(C),Ee=function(){function e(){Object(p.a)(this,e)}return Object(y.a)(e,[{key:"toJSON",value:function(){var e=Object(h.a)(f.mark((function e(){var t;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t={},this.remoteRatchetKey&&(t.remoteRatchetKey=this.remoteRatchetKey.key),!this.sendingChain){e.next=6;break}return e.next=5,this.sendingChain.toJSON();case 5:t.sendingChain=e.sent;case 6:if(!this.receivingChain){e.next=10;break}return e.next=9,this.receivingChain.toJSON();case 9:t.receivingChain=e.sent;case 10:return e.abrupt("return",t);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"fromJSON",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.remoteRatchetKey){e.next=4;break}return e.next=3,re.create(t.remoteRatchetKey);case 3:this.remoteRatchetKey=e.sent;case 4:if(!t.sendingChain){e.next=8;break}return e.next=7,ke.fromJSON(t.sendingChain);case 7:this.sendingChain=e.sent;case 8:if(!t.receivingChain){e.next=12;break}return e.next=11,Oe.fromJSON(t.receivingChain);case 11:this.receivingChain=e.sent;case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"fromJSON",value:function(){var e=Object(h.a)(f.mark((function e(t){var r;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new this,e.next=3,r.fromJSON(t);case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Ie=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return Object(y.a)(r,[{key:"getStep",value:function(e){var t;return this.items.some((function(r){return r.remoteRatchetKey.id===e.id&&(t=r),!!t})),t}}]),r}(de);function Ae(e,t,r,n){var a,i=arguments.length,o=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(a=e[u])&&(o=(i<3?a(o):i>3?a(t,r,o):a(t,r))||o);return i>3&&o&&Object.defineProperty(t,r,o),o}var Se,De,Ce,Ke,Te,Ue,Le,Xe,He,Re=function(){function e(){Object(p.a)(this,e)}return Object(y.a)(e,null,[{key:"set",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Uint8Array(w.FromUtf8String(t.toISOString())));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Date(w.ToUtf8String(t)));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Pe=function(){function e(){Object(p.a)(this,e)}return Object(y.a)(e,null,[{key:"set",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Uint8Array(w.FromHex(t)));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",w.ToHex(t));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),_e=function(){function e(){Object(p.a)(this,e)}return Object(y.a)(e,null,[{key:"set",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Uint8Array(w.FromUtf8String(t.toString(10))));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",parseInt(w.ToUtf8String(t),10));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),qe=Se=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).version=0,e}return r}(S);qe.INDEX=1,Ae([A({id:Se.INDEX++,type:"uint32",required:!0,defaultValue:1})],qe.prototype,"version",void 0);var Ve=De=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.call(this)).actionId="",e.action=e.constructor.ACTION,e}return r}(qe=Se=Ae([I({name:"BaseMessage"})],qe));Ve.INDEX=qe.INDEX,Ve.ACTION="action",Ae([A({id:De.INDEX++,type:"string",required:!0})],Ve.prototype,"action",void 0),Ae([A({id:De.INDEX++,type:"string",required:!1})],Ve.prototype,"actionId",void 0),Ve=De=Ae([I({name:"Action"})],Ve);var Je=Ce=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).name="",e}return Object(y.a)(r,[{key:"isEmpty",value:function(){return!this.name}},{key:"toAlgorithm",value:function(){return{name:this.name}}},{key:"fromAlgorithm",value:function(e){this.name=e.name}}]),r}(qe);Je.INDEX=qe.INDEX,Ae([A({id:Ce.INDEX++,type:"string",required:!0})],Je.prototype,"name",void 0),Je=Ce=Ae([I({name:"BaseAlgorithm"})],Je);var Fe=Ke=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return Object(y.a)(r,[{key:"toAlgorithm",value:function(){var e={},t=this.constructor;for(var r in t.items)if("version"!==r){var n=this[r];"labelStr"!==r?void 0!==n&&(n instanceof Je?n.isEmpty()||(e[r]=n.toAlgorithm()):e[r]=n):e.label=n}return e}},{key:"fromAlgorithm",value:function(e){e instanceof Ke&&(e=e.toAlgorithm());var t=this.constructor;for(var r in e)if(t.items&&r in t.items){var n=t.items[r];if(n.parser)switch(n.parser){case Je:this[r].fromAlgorithm(e[r]);break;default:throw new Error("Unsupported parser '".concat(n.parser.name,"'"))}else"label"===r&&"string"===typeof e.label?this.labelStr=e.label:this[r]=e[r]}}}]),r}(Je);Fe.INDEX=Je.INDEX,Ae([A({id:Ke.INDEX++,type:"bytes",parser:Je})],Fe.prototype,"hash",void 0),Ae([A({id:Ke.INDEX++,type:"bytes"})],Fe.prototype,"publicExponent",void 0),Ae([A({id:Ke.INDEX++,type:"uint32"})],Fe.prototype,"modulusLength",void 0),Ae([A({id:Ke.INDEX++,type:"uint32"})],Fe.prototype,"saltLength",void 0),Ae([A({id:Ke.INDEX++,type:"bytes"})],Fe.prototype,"label",void 0),Ae([A({id:Ke.INDEX++,type:"string"})],Fe.prototype,"namedCurve",void 0),Ae([A({id:Ke.INDEX++,converter:E})],Fe.prototype,"public",void 0),Ae([A({id:Ke.INDEX++,type:"uint32"})],Fe.prototype,"length",void 0),Ae([A({id:Ke.INDEX++})],Fe.prototype,"iv",void 0),Ae([A({id:Ke.INDEX++,type:"bool"})],Fe.prototype,"token",void 0),Ae([A({id:Ke.INDEX++,type:"bool"})],Fe.prototype,"sensitive",void 0),Ae([A({id:Ke.INDEX++,type:"string"})],Fe.prototype,"labelStr",void 0),Fe=Ke=Ae([I({name:"Algorithm"})],Fe);var Me=Te=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).providerID="",e.id="",e.type="",e}return r}(qe);Me.INDEX=qe.INDEX,Ae([A({id:Te.INDEX++,type:"string",required:!0})],Me.prototype,"providerID",void 0),Ae([A({id:Te.INDEX++,type:"bytes",required:!0,converter:Pe})],Me.prototype,"id",void 0),Ae([A({id:Te.INDEX++,type:"string",required:!0})],Me.prototype,"type",void 0),Me=Te=Ae([I({name:"CryptoItem"})],Me);var Ge=function(){function e(){Object(p.a)(this,e)}return Object(y.a)(e,null,[{key:"set",value:function(){var e=Object(h.a)(f.mark((function e(t){var r,n;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new Fe).fromAlgorithm(t),e.next=4,r.exportProto();case 4:return n=e.sent,e.abrupt("return",new Uint8Array(n));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(){var e=Object(h.a)(f.mark((function e(t){var r,n;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Fe,e.next=3,r.importProto(t);case 3:return n=r.toAlgorithm(),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),ze=Ue=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).type="secret",e.algorithm={name:""},e.extractable=!1,e.usages=[],e}return r}(Me);ze.INDEX=Me.INDEX,Ae([A({id:Ue.INDEX++,type:"bytes",required:!0,converter:Ge})],ze.prototype,"algorithm",void 0),Ae([A({id:Ue.INDEX++,type:"bool"})],ze.prototype,"extractable",void 0),Ae([A({id:Ue.INDEX++,type:"string",repeated:!0})],ze.prototype,"usages",void 0),ze=Ue=Ae([I({name:"CryptoKey"})],ze);var We=Le=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).privateKey=new ze,e.publicKey=new ze,e}return r}(qe);We.INDEX=qe.INDEX,Ae([A({id:Le.INDEX++,name:"privateKey",type:"bytes",required:!0,parser:ze})],We.prototype,"privateKey",void 0),Ae([A({id:Le.INDEX++,name:"publicKey",type:"bytes",parser:ze})],We.prototype,"publicKey",void 0),We=Le=Ae([I({name:"CryptoKeyPair"})],We);var Ye=Xe=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(e){var n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"error";return Object(p.a)(this,r),(n=t.call(this)).code=0,n.type="error",n.message="",n.name="Error",n.stack="",e&&(n.message=e,n.code=a,n.type=i),n}return r}(qe);Ye.INDEX=qe.INDEX,Ae([A({id:Xe.INDEX++,type:"uint32",defaultValue:0})],Ye.prototype,"code",void 0),Ae([A({id:Xe.INDEX++,type:"string",defaultValue:"error"})],Ye.prototype,"type",void 0),Ae([A({id:Xe.INDEX++,type:"string",defaultValue:""})],Ye.prototype,"message",void 0),Ae([A({id:Xe.INDEX++,type:"string",defaultValue:"Error"})],Ye.prototype,"name",void 0),Ae([A({id:Xe.INDEX++,type:"string",defaultValue:""})],Ye.prototype,"stack",void 0),Ye=Xe=Ae([I({name:"Error"})],Ye);var Ze=He=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this)).status=!1,e&&(n.actionId=e.actionId,n.action=e.action),n}return r}(Ve);Ze.INDEX=Ve.INDEX,Ae([A({id:He.INDEX++,type:"bool",defaultValue:!1})],Ze.prototype,"status",void 0),Ae([A({id:He.INDEX++,type:"bytes",parser:Ye})],Ze.prototype,"error",void 0),Ae([A({id:He.INDEX++,type:"bytes",converter:E})],Ze.prototype,"data",void 0),Ze=He=Ae([I({name:"Result"})],Ze);var $e=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(Ve);$e.INDEX=Ve.INDEX,$e.ACTION="auth",$e=Ae([I({name:"AuthRequest"})],$e);var Qe=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(Ve);Qe.INDEX=Ve.INDEX,Qe.ACTION="server/login",Qe=Ae([I({})],Qe);var et,tt=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(Ve);tt.INDEX=Ve.INDEX,tt.ACTION="server/isLoggedIn",tt=Ae([I({})],tt);var rt=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(Ve);rt.INDEX=Ve.INDEX,rt.ACTION="cardReader",rt=Ae([I({})],rt);var nt=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(Ve);nt.INDEX=Ve.INDEX,nt.ACTION="cardReader/readers",nt=Ae([I({})],nt);var at=et=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(e,n){var a;return Object(p.a)(this,r),(a=t.call(this)).reader="",a.atr="",e&&n&&(a.reader=e,a.atr=n),a}return r}(rt);at.INDEX=rt.INDEX,Ae([A({id:et.INDEX++,required:!0,type:"string",defaultValue:""})],at.prototype,"reader",void 0),Ae([A({id:et.INDEX++,required:!0,converter:Pe})],at.prototype,"atr",void 0);var it=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(at=et=Ae([I({})],at));it.INDEX=at.INDEX,it.ACTION=at.ACTION+"/insert",it=Ae([I({})],it);var ot,ut=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(at);ut.INDEX=at.INDEX,ut.ACTION=at.ACTION+"/remove",ut=Ae([I({})],ut);var ct=ot=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).providerID="",e}return r}(Ve);ct.INDEX=Ve.INDEX,ct.ACTION="crypto",Ae([A({id:ot.INDEX++,required:!0,type:"string"})],ct.prototype,"providerID",void 0);var st=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(ct=ot=Ae([I({})],ct));st.INDEX=ct.INDEX,st.ACTION="crypto/login",st=Ae([I({})],st);var lt=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(ct);lt.INDEX=ct.INDEX,lt.ACTION="crypto/logout",lt=Ae([I({})],lt);var ft=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(ct);ft.INDEX=ct.INDEX,ft.ACTION="crypto/isLoggedIn",ft=Ae([I({})],ft);var ht,vt,pt,yt,dt,bt,gt,mt,kt,Ot,wt,xt,jt,Bt,Nt,Et=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(ct);Et.INDEX=ct.INDEX,Et.ACTION="crypto/reset",Et=Ae([I({})],Et);var It=ht=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).id="",e.publicKey=new ze,e.type="x509",e.label="",e.token=!1,e.sensitive=!1,e}return r}(Me);It.INDEX=Me.INDEX,Ae([A({id:ht.INDEX++,required:!0,converter:Pe})],It.prototype,"id",void 0),Ae([A({id:ht.INDEX++,required:!0,parser:ze})],It.prototype,"publicKey",void 0),Ae([A({id:ht.INDEX++,required:!0,type:"string"})],It.prototype,"type",void 0),Ae([A({id:ht.INDEX++,type:"string",defaultValue:""})],It.prototype,"label",void 0),Ae([A({id:ht.INDEX++,type:"bool",defaultValue:!1})],It.prototype,"token",void 0),Ae([A({id:ht.INDEX++,type:"bool",defaultValue:!1})],It.prototype,"sensitive",void 0);var At=vt=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).type="x509",e.serialNumber="",e.issuerName="",e.subjectName="",e.notBefore=new Date,e.notAfter=new Date,e}return r}(It=ht=Ae([I({})],It));At.INDEX=It.INDEX,Ae([A({id:vt.INDEX++,required:!0,converter:Pe})],At.prototype,"serialNumber",void 0),Ae([A({id:vt.INDEX++,required:!0,type:"string"})],At.prototype,"issuerName",void 0),Ae([A({id:vt.INDEX++,required:!0,type:"string"})],At.prototype,"subjectName",void 0),Ae([A({id:vt.INDEX++,required:!0,converter:Re})],At.prototype,"notBefore",void 0),Ae([A({id:vt.INDEX++,required:!0,converter:Re})],At.prototype,"notAfter",void 0),At=vt=Ae([I({})],At);var St=pt=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).type="request",e.subjectName="",e}return r}(It);St.INDEX=It.INDEX,Ae([A({id:pt.INDEX++,required:!0,type:"string"})],St.prototype,"subjectName",void 0),St=pt=Ae([I({})],St);var Dt=yt=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).type="",e.value=new ArrayBuffer(0),e}return r}(qe);Dt.INDEX=qe.INDEX,Ae([A({id:yt.INDEX++,required:!0,type:"string"})],Dt.prototype,"type",void 0),Ae([A({id:yt.INDEX++,required:!0,converter:E})],Dt.prototype,"value",void 0),Dt=yt=Ae([I({})],Dt);var Ct=dt=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).items=[],e}return r}(qe);Ct.INDEX=qe.INDEX,Ae([A({id:dt.INDEX++,required:!0,repeated:!0,parser:Dt})],Ct.prototype,"items",void 0),Ct=dt=Ae([I({})],Ct);var Kt=bt=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).item=new It,e}return r}(ct);Kt.INDEX=ct.INDEX,Kt.ACTION="crypto/certificateStorage/setItem",Ae([A({id:bt.INDEX++,required:!0,parser:It})],Kt.prototype,"item",void 0),Kt=bt=Ae([I({})],Kt);var Tt=gt=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).key="",e.algorithm=new Fe,e.keyUsages=[],e}return r}(ct);Tt.INDEX=ct.INDEX,Tt.ACTION="crypto/certificateStorage/getItem",Ae([A({id:gt.INDEX++,required:!0,type:"string"})],Tt.prototype,"key",void 0),Ae([A({id:gt.INDEX++,parser:Fe})],Tt.prototype,"algorithm",void 0),Ae([A({id:gt.INDEX++,repeated:!0,type:"string"})],Tt.prototype,"keyUsages",void 0),Tt=gt=Ae([I({})],Tt);var Ut=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(ct);Ut.INDEX=ct.INDEX,Ut.ACTION="crypto/certificateStorage/keys",Ut=Ae([I({})],Ut);var Lt=mt=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).key="",e}return r}(ct);Lt.INDEX=ct.INDEX,Lt.ACTION="crypto/certificateStorage/getValue",Ae([A({id:mt.INDEX++,required:!0,type:"string"})],Lt.prototype,"key",void 0),Lt=mt=Ae([I({})],Lt);var Xt=kt=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).key="",e}return r}(ct);Xt.INDEX=ct.INDEX,Xt.ACTION="crypto/certificateStorage/removeItem",Ae([A({id:kt.INDEX++,required:!0,type:"string"})],Xt.prototype,"key",void 0),Xt=kt=Ae([I({})],Xt);var Ht=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(ct);Ht.INDEX=ct.INDEX,Ht.ACTION="crypto/certificateStorage/clear",Ht=Ae([I({})],Ht);var Rt=Ot=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).format="raw",e.data=new ArrayBuffer(0),e.algorithm=new Fe,e.keyUsages=[],e}return r}(ct);Rt.INDEX=ct.INDEX,Rt.ACTION="crypto/certificateStorage/import",Ae([A({id:Ot.INDEX++,required:!0,type:"string"})],Rt.prototype,"format",void 0),Ae([A({id:Ot.INDEX++,required:!0,converter:E})],Rt.prototype,"data",void 0),Ae([A({id:Ot.INDEX++,required:!0,parser:Fe})],Rt.prototype,"algorithm",void 0),Ae([A({id:Ot.INDEX++,repeated:!0,type:"string"})],Rt.prototype,"keyUsages",void 0),Rt=Ot=Ae([I({})],Rt);var Pt=wt=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).format="raw",e.item=new It,e}return r}(ct);Pt.INDEX=ct.INDEX,Pt.ACTION="crypto/certificateStorage/export",Ae([A({id:wt.INDEX++,required:!0,type:"string"})],Pt.prototype,"format",void 0),Ae([A({id:wt.INDEX++,required:!0,parser:It})],Pt.prototype,"item",void 0),Pt=wt=Ae([I({})],Pt);var _t=xt=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).item=new It,e}return r}(ct);_t.INDEX=ct.INDEX,_t.ACTION="crypto/certificateStorage/indexOf",Ae([A({id:xt.INDEX++,required:!0,parser:It})],_t.prototype,"item",void 0),_t=xt=Ae([I({})],_t);var qt=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).item=new It,e}return r}(ct);qt.INDEX=ct.INDEX,qt.ACTION="crypto/certificateStorage/getChain",Ae([A({id:Kt.INDEX++,required:!0,parser:It})],qt.prototype,"item",void 0),qt=Ae([I({})],qt);var Vt=jt=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).url="",e}return r}(ct);Vt.INDEX=ct.INDEX,Vt.ACTION="crypto/certificateStorage/getCRL",Ae([A({id:jt.INDEX++,required:!0,type:"string"})],Vt.prototype,"url",void 0),Vt=jt=Ae([I({})],Vt);var Jt=Bt=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).method="get",e}return r}(qe);Jt.INDEX=qe.INDEX,Ae([A({id:Bt.INDEX++,required:!1,type:"string",defaultValue:"get"})],Jt.prototype,"method",void 0),Jt=Bt=Ae([I({})],Jt);var Ft,Mt,Gt,zt,Wt=Nt=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).url="",e.request=new ArrayBuffer(0),e.options=new Jt,e}return r}(ct);Wt.INDEX=ct.INDEX,Wt.ACTION="crypto/certificateStorage/getOCSP",Ae([A({id:Nt.INDEX++,required:!0,type:"string"})],Wt.prototype,"url",void 0),Ae([A({id:Nt.INDEX++,required:!0,converter:E})],Wt.prototype,"request",void 0),Ae([A({id:Nt.INDEX++,required:!1,parser:Jt})],Wt.prototype,"options",void 0),Wt=Nt=Ae([I({})],Wt);var Yt=Ft=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).item=new ze,e}return r}(ct);Yt.INDEX=ct.INDEX,Yt.ACTION="crypto/keyStorage/setItem",Ae([A({id:Ft.INDEX++,required:!0,parser:ze})],Yt.prototype,"item",void 0),Yt=Ft=Ae([I({})],Yt);var Zt=Mt=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).key="",e.algorithm=new Fe,e.extractable=!1,e.keyUsages=[],e}return r}(ct);Zt.INDEX=ct.INDEX,Zt.ACTION="crypto/keyStorage/getItem",Ae([A({id:Mt.INDEX++,required:!0,type:"string"})],Zt.prototype,"key",void 0),Ae([A({id:Mt.INDEX++,parser:Fe})],Zt.prototype,"algorithm",void 0),Ae([A({id:Mt.INDEX++,type:"bool"})],Zt.prototype,"extractable",void 0),Ae([A({id:Mt.INDEX++,repeated:!0,type:"string"})],Zt.prototype,"keyUsages",void 0),Zt=Mt=Ae([I({})],Zt);var $t=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(ct);$t.INDEX=ct.INDEX,$t.ACTION="crypto/keyStorage/keys",$t=Ae([I({})],$t);var Qt=Gt=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).key="",e}return r}(ct);Qt.INDEX=ct.INDEX,Qt.ACTION="crypto/keyStorage/removeItem",Ae([A({id:Gt.INDEX++,required:!0,type:"string"})],Qt.prototype,"key",void 0),Qt=Gt=Ae([I({})],Qt);var er=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(ct);er.INDEX=ct.INDEX,er.ACTION="crypto/keyStorage/clear",er=Ae([I({})],er);var tr,rr,nr,ar,ir,or,ur=zt=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).item=new ze,e}return r}(ct);ur.INDEX=ct.INDEX,ur.ACTION="crypto/keyStorage/indexOf",Ae([A({id:zt.INDEX++,required:!0,parser:ze})],ur.prototype,"item",void 0),ur=zt=Ae([I({})],ur);var cr=tr=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this)).major=0,n.minor=0,e&&x(Object(o.a)(n),e),n}return r}(qe);cr.INDEX=qe.INDEX,Ae([A({id:tr.INDEX++,required:!0,type:"uint32"})],cr.prototype,"major",void 0),Ae([A({id:tr.INDEX++,required:!0,type:"uint32"})],cr.prototype,"minor",void 0),cr=tr=Ae([I({})],cr);var sr=rr=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this)).label="",n.manufacturerID="",n.model="",n.serialNumber="",n.flags=0,n.hardwareVersion=new cr,n.firmwareVersion=new cr,n.maxSessionCount=0,n.sessionCount=0,n.maxRwSessionCount=0,n.rwSessionCount=0,n.maxPinLen=0,n.minPinLen=0,n.totalPublicMemory=0,n.freePublicMemory=0,n.totalPrivateMemory=0,n.freePrivateMemory=0,e&&(x(Object(o.a)(n),e),n.firmwareVersion=new cr(e.firmwareVersion),n.hardwareVersion=new cr(e.hardwareVersion)),n}return r}(qe);sr.INDEX=qe.INDEX,Ae([A({id:rr.INDEX++,required:!0,type:"string"})],sr.prototype,"label",void 0),Ae([A({id:rr.INDEX++,required:!0,type:"string"})],sr.prototype,"manufacturerID",void 0),Ae([A({id:rr.INDEX++,required:!0,type:"string"})],sr.prototype,"model",void 0),Ae([A({id:rr.INDEX++,required:!0,type:"string"})],sr.prototype,"serialNumber",void 0),Ae([A({id:rr.INDEX++,required:!0,type:"uint32"})],sr.prototype,"flags",void 0),Ae([A({id:rr.INDEX++,required:!0,parser:cr})],sr.prototype,"hardwareVersion",void 0),Ae([A({id:rr.INDEX++,required:!0,parser:cr})],sr.prototype,"firmwareVersion",void 0),Ae([A({id:rr.INDEX++,required:!0,type:"uint32"})],sr.prototype,"maxSessionCount",void 0),Ae([A({id:rr.INDEX++,required:!0,type:"uint32"})],sr.prototype,"sessionCount",void 0),Ae([A({id:rr.INDEX++,required:!0,type:"uint32"})],sr.prototype,"maxRwSessionCount",void 0),Ae([A({id:rr.INDEX++,required:!0,type:"uint32"})],sr.prototype,"rwSessionCount",void 0),Ae([A({id:rr.INDEX++,required:!0,type:"uint32"})],sr.prototype,"maxPinLen",void 0),Ae([A({id:rr.INDEX++,required:!0,type:"uint32"})],sr.prototype,"minPinLen",void 0),Ae([A({id:rr.INDEX++,required:!0,converter:_e})],sr.prototype,"totalPublicMemory",void 0),Ae([A({id:rr.INDEX++,required:!0,converter:_e})],sr.prototype,"freePublicMemory",void 0),Ae([A({id:rr.INDEX++,required:!0,converter:_e})],sr.prototype,"totalPrivateMemory",void 0),Ae([A({id:rr.INDEX++,required:!0,converter:_e})],sr.prototype,"freePrivateMemory",void 0),sr=rr=Ae([I({})],sr);var lr=nr=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this)).id="",n.name="",n.readOnly=!1,n.algorithms=[],n.isRemovable=!1,n.atr="",n.isHardware=!1,n.card="",e&&(x(Object(o.a)(n),e),e.token&&(n.token=new sr(e.token))),n}return r}(qe);lr.INDEX=qe.INDEX,Ae([A({id:nr.INDEX++,required:!0,type:"string"})],lr.prototype,"id",void 0),Ae([A({id:nr.INDEX++,required:!0,type:"string"})],lr.prototype,"name",void 0),Ae([A({id:nr.INDEX++,type:"bool",defaultValue:!1})],lr.prototype,"readOnly",void 0),Ae([A({id:nr.INDEX++,repeated:!0,type:"string"})],lr.prototype,"algorithms",void 0),Ae([A({id:nr.INDEX++,type:"bool",defaultValue:!1})],lr.prototype,"isRemovable",void 0),Ae([A({id:nr.INDEX++,type:"string"})],lr.prototype,"atr",void 0),Ae([A({id:nr.INDEX++,type:"bool",defaultValue:!1})],lr.prototype,"isHardware",void 0),Ae([A({id:nr.INDEX++,type:"string"})],lr.prototype,"card",void 0),Ae([A({id:nr.INDEX++,parser:sr})],lr.prototype,"token",void 0),lr=nr=Ae([I({})],lr);var fr=ar=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).name="",e.providers=[],e}return r}(qe);fr.INDEX=qe.INDEX,Ae([A({id:ar.INDEX++,type:"string",required:!0})],fr.prototype,"name",void 0),Ae([A({id:ar.INDEX++,repeated:!0,parser:lr})],fr.prototype,"providers",void 0),fr=ar=Ae([I({})],fr);var hr=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(Ve);hr.INDEX=Ve.INDEX,hr.ACTION="provider/action/info",hr=Ae([I({})],hr);var vr=ir=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).cryptoID="",e}return r}(Ve);vr.INDEX=Ve.INDEX,vr.ACTION="provider/action/getCrypto",Ae([A({id:ir.INDEX++,required:!0,type:"string"})],vr.prototype,"cryptoID",void 0),vr=ir=Ae([I({})],vr);var pr=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(Ve);pr.INDEX=Ve.INDEX,pr.ACTION="provider/event/authorized",pr=Ae([I({})],pr);var yr,dr,br,gr,mr,kr,Or,wr,xr,jr,Br=or=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this)).added=[],n.removed=[],e&&x(Object(o.a)(n),e),n}return r}(Ve);Br.INDEX=Ve.INDEX,Br.ACTION="provider/event/token",Ae([A({id:or.INDEX++,repeated:!0,parser:lr})],Br.prototype,"added",void 0),Ae([A({id:or.INDEX++,repeated:!0,parser:lr})],Br.prototype,"removed",void 0),Ae([A({id:or.INDEX++,type:"bytes",parser:Ye})],Br.prototype,"error",void 0),Br=or=Ae([I({name:"ProviderTokenEvent"})],Br);var Nr=yr=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).algorithm=new Fe,e.data=new ArrayBuffer(0),e}return r}(ct);Nr.INDEX=ct.INDEX,Nr.ACTION="crypto/subtle/digest",Ae([A({id:yr.INDEX++,required:!0,parser:Fe})],Nr.prototype,"algorithm",void 0),Ae([A({id:yr.INDEX++,required:!0,converter:E})],Nr.prototype,"data",void 0),Nr=yr=Ae([I({})],Nr);var Er=dr=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).algorithm=new Fe,e.extractable=!1,e.usage=[],e}return r}(ct);Er.INDEX=ct.INDEX,Er.ACTION="crypto/subtle/generateKey",Ae([A({id:dr.INDEX++,type:"bytes",required:!0,parser:Fe})],Er.prototype,"algorithm",void 0),Ae([A({id:dr.INDEX++,type:"bool",required:!0})],Er.prototype,"extractable",void 0),Ae([A({id:dr.INDEX++,type:"string",repeated:!0})],Er.prototype,"usage",void 0),Er=dr=Ae([I({})],Er);var Ir=br=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).algorithm=new Fe,e.key=new ze,e.data=new ArrayBuffer(0),e}return r}(ct);Ir.INDEX=ct.INDEX,Ir.ACTION="crypto/subtle/sign",Ae([A({id:br.INDEX++,required:!0,parser:Fe})],Ir.prototype,"algorithm",void 0),Ae([A({id:br.INDEX++,required:!0,parser:ze})],Ir.prototype,"key",void 0),Ae([A({id:br.INDEX++,required:!0,converter:E})],Ir.prototype,"data",void 0);var Ar=gr=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).signature=new ArrayBuffer(0),e}return r}(Ir=br=Ae([I({})],Ir));Ar.INDEX=Ir.INDEX,Ar.ACTION="crypto/subtle/verify",Ae([A({id:gr.INDEX++,required:!0,converter:E})],Ar.prototype,"signature",void 0),Ar=gr=Ae([I({})],Ar);var Sr=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(Ir);Sr.INDEX=Ir.INDEX,Sr.ACTION="crypto/subtle/encrypt",Sr=Ae([I({})],Sr);var Dr=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(Ir);Dr.INDEX=Ir.INDEX,Dr.ACTION="crypto/subtle/decrypt",Dr=Ae([I({})],Dr);var Cr=mr=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).algorithm=new Fe,e.key=new ze,e.length=0,e}return r}(ct);Cr.INDEX=ct.INDEX,Cr.ACTION="crypto/subtle/deriveBits",Ae([A({id:mr.INDEX++,required:!0,parser:Fe})],Cr.prototype,"algorithm",void 0),Ae([A({id:mr.INDEX++,required:!0,parser:ze})],Cr.prototype,"key",void 0),Ae([A({id:mr.INDEX++,required:!0,type:"uint32"})],Cr.prototype,"length",void 0),Cr=mr=Ae([I({})],Cr);var Kr=kr=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).algorithm=new Fe,e.key=new ze,e.derivedKeyType=new Fe,e.extractable=!1,e.usage=[],e}return r}(ct);Kr.INDEX=ct.INDEX,Kr.ACTION="crypto/subtle/deriveKey",Ae([A({id:kr.INDEX++,required:!0,parser:Fe})],Kr.prototype,"algorithm",void 0),Ae([A({id:kr.INDEX++,required:!0,parser:ze})],Kr.prototype,"key",void 0),Ae([A({id:kr.INDEX++,required:!0,parser:Fe})],Kr.prototype,"derivedKeyType",void 0),Ae([A({id:kr.INDEX++,type:"bool"})],Kr.prototype,"extractable",void 0),Ae([A({id:kr.INDEX++,type:"string",repeated:!0})],Kr.prototype,"usage",void 0),Kr=kr=Ae([I({})],Kr);var Tr=Or=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).format="",e.wrappedKey=new ArrayBuffer(0),e.unwrappingKey=new ze,e.unwrapAlgorithm=new Fe,e.unwrappedKeyAlgorithm=new Fe,e.extractable=!1,e.keyUsage=[],e}return r}(ct);Tr.INDEX=ct.INDEX,Tr.ACTION="crypto/subtle/unwrapKey",Ae([A({id:Or.INDEX++,required:!0,type:"string"})],Tr.prototype,"format",void 0),Ae([A({id:Or.INDEX++,required:!0,converter:E})],Tr.prototype,"wrappedKey",void 0),Ae([A({id:Or.INDEX++,required:!0,parser:ze})],Tr.prototype,"unwrappingKey",void 0),Ae([A({id:Or.INDEX++,required:!0,parser:Fe})],Tr.prototype,"unwrapAlgorithm",void 0),Ae([A({id:Or.INDEX++,required:!0,parser:Fe})],Tr.prototype,"unwrappedKeyAlgorithm",void 0),Ae([A({id:Or.INDEX++,type:"bool"})],Tr.prototype,"extractable",void 0),Ae([A({id:Or.INDEX++,type:"string",repeated:!0})],Tr.prototype,"keyUsage",void 0),Tr=Or=Ae([I({})],Tr);var Ur=wr=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).format="",e.key=new ze,e.wrappingKey=new ze,e.wrapAlgorithm=new Fe,e}return r}(ct);Ur.INDEX=ct.INDEX,Ur.ACTION="crypto/subtle/wrapKey",Ae([A({id:wr.INDEX++,required:!0,type:"string"})],Ur.prototype,"format",void 0),Ae([A({id:wr.INDEX++,required:!0,parser:ze})],Ur.prototype,"key",void 0),Ae([A({id:wr.INDEX++,required:!0,parser:ze})],Ur.prototype,"wrappingKey",void 0),Ae([A({id:wr.INDEX++,required:!0,parser:Fe})],Ur.prototype,"wrapAlgorithm",void 0),Ur=wr=Ae([I({})],Ur);var Lr=xr=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).format="",e.key=new ze,e}return r}(ct);Lr.INDEX=ct.INDEX,Lr.ACTION="crypto/subtle/exportKey",Ae([A({id:xr.INDEX++,type:"string",required:!0})],Lr.prototype,"format",void 0),Ae([A({id:xr.INDEX++,required:!0,parser:ze})],Lr.prototype,"key",void 0),Lr=xr=Ae([I({})],Lr);var Xr=jr=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).format="",e.keyData=new ArrayBuffer(0),e.algorithm=new Fe,e.extractable=!1,e.keyUsages=[],e}return r}(ct);Xr.INDEX=ct.INDEX,Xr.ACTION="crypto/subtle/importKey",Ae([A({id:jr.INDEX++,type:"string",required:!0})],Xr.prototype,"format",void 0),Ae([A({id:jr.INDEX++,required:!0,converter:E})],Xr.prototype,"keyData",void 0),Ae([A({id:jr.INDEX++,required:!0,parser:Fe})],Xr.prototype,"algorithm",void 0),Ae([A({id:jr.INDEX++,required:!0,type:"bool"})],Xr.prototype,"extractable",void 0),Ae([A({id:jr.INDEX++,type:"string",repeated:!0})],Xr.prototype,"keyUsages",void 0),Xr=jr=Ae([I({})],Xr);var Hr=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this)).client=e,n.onEvent=n.onEvent.bind(Object(o.a)(n)),n.client.on("listening",(function(){n.client.on("event",n.onEvent)})).on("close",(function(){n.client.removeListener("event",n.onEvent)})),n}return Object(y.a)(r,[{key:"readers",value:function(){var e=Object(h.a)(f.mark((function e(){var t;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.send(new nt);case 2:return t=e.sent,e.abrupt("return",JSON.parse(w.ToString(t)));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"on",value:function(e,t){return Object(u.a)(Object(c.a)(r.prototype),"on",this).call(this,e,t)}},{key:"emit",value:function(e){for(var t,n=arguments.length,a=new Array(n>1?n-1:0),i=1;i<n;i++)a[i-1]=arguments[i];return(t=Object(u.a)(Object(c.a)(r.prototype),"emit",this)).call.apply(t,[this,e].concat(a))}},{key:"onEvent",value:function(e){var t=this;Object(h.a)(f.mark((function r(){return f.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.t0=e.action,r.next=r.t0===it.ACTION?3:r.t0===ut.ACTION?9:15;break;case 3:return r.t1=t,r.next=6,it.importProto(e);case 6:return r.t2=r.sent,r.t1.onInsert.call(r.t1,r.t2),r.abrupt("break",15);case 9:return r.t3=t,r.next=12,ut.importProto(e);case 12:return r.t4=r.sent,r.t3.onRemove.call(r.t3,r.t4),r.abrupt("break",15);case 15:case"end":return r.stop()}}),r)})))().catch((function(e){return t.emit("error",e)}))}},{key:"onInsert",value:function(e){this.emit("insert",e)}},{key:"onRemove",value:function(e){this.emit("remove",e)}}]),r}(C);function Rr(e,t){return Pr.apply(this,arguments)}function Pr(){return(Pr=Object(h.a)(f.mark((function e(t,r){var n,a,i,o;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.thumbprint();case 2:return n=e.sent,e.next=5,r.thumbprint();case 5:return a=e.sent,i=w.FromHex(n+a),e.next=9,$().crypto.subtle.digest("SHA-256",i);case 9:return o=e.sent,e.abrupt("return",parseInt(w.ToHex(o),16).toString().substr(2,6));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var _r=function e(t,r){Object(p.a)(this,e),this.target=t,this.event=r},qr=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this,e.message)).name="CryptoServerError",n.code=e.code,n.type=e.type,n}return r}(Object(i.a)(Error)),Vr=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(_r),Jr=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(e,n,a,i){var o;return Object(p.a)(this,r),(o=t.call(this,e,"close")).remoteAddress=n,o.reasonCode=a,o.description=i,o}return r}(Vr),Fr=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(e,n){var a;return Object(p.a)(this,r),(a=t.call(this,e,"error")).error=n,a}return r}(Vr),Mr=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(e,n){var a;return Object(p.a)(this,r),(a=t.call(this,e,"listening")).address=n,a}return r}(Vr);function Gr(){return/firefox\/([\w\.-]+)$/i.test(self.navigator.userAgent)}function zr(){return/(edge|edgios|edga|edg)\/((\d+)?[\w\.]+)/i.test(self.navigator.userAgent)}function Wr(){return/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i.test(self.navigator.userAgent)}var Yr,Zr={name:"ECDH",namedCurve:"P-256"},$r={name:"ECDSA",namedCurve:"P-256"},Qr={name:"AES-CBC",iv:new ArrayBuffer(16)};function en(e){return tn.apply(this,arguments)}function tn(){return(tn=Object(h.a)(f.mark((function e(t){var r,n,a,i,o,u,c,s;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("ECDH"===(r=t.algorithm.name.toUpperCase())||"ECDSA"===r){e.next=3;break}throw new Error("Error: Unsupported asymmetric key algorithm.");case 3:if("public"===t.type){e.next=5;break}throw new Error("Error: Expected key type to be public but it was not.");case 5:return e.next=7,$().crypto.subtle.exportKey("jwk",t);case 7:if((n=e.sent).x&&n.y){e.next=10;break}throw new Error("Wrong JWK data for EC public key. Parameters x and y are required.");case 10:return a=w.FromBase64Url(n.x),i=w.FromBase64Url(n.y),o=w.ToBinary(a)+w.ToBinary(i),u=t,c=w.FromBinary(o),e.t0=w,e.next=18,$().crypto.subtle.digest("SHA-256",c);case 18:return e.t1=e.sent,s=e.t0.ToHex.call(e.t0,e.t1),e.abrupt("return",{id:s,key:u,serialized:c});case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function rn(e,t){return nn.apply(this,arguments)}function nn(){return(nn=Object(h.a)(f.mark((function e(t,r){var n;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,en(r);case 2:n=e.sent,t.id=n.id,t.key=n.key,t.serialized=n.serialized;case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(e){e[e.connecting=0]="connecting",e[e.open=1]="open",e[e.closing=2]="closing",e[e.closed=3]="closed"}(Yr||(Yr={}));var an=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this)).stack={},n.messageCounter=0,n.storage=e,n}return Object(y.a)(r,[{key:"state",get:function(){return this.socket?this.socket.readyState:Yr.closed}},{key:"connect",value:function(e,t){var r=this;return this.getServerInfo(e).then((function(n){var i=n.version.split(".").map((function(e){return parseInt(e,10)})),o=Object(a.a)(i,3),u=o[0],c=o[1];o[2];if(u<1||1===u&&c<2)throw new Error("Current version of WebCryptoSocket doesn't work with WebCryptoServer v".concat(n.version,". Please update your client to the latest version."));r.serviceInfo=n;var s="wss://".concat(e);r.socket=t?new m.default(s,void 0,t):new m.default(s),r.socket.binaryType="arraybuffer",r.socket.onerror=function(e){r.emit("error",new Fr(r,e.error))},r.socket.onopen=function(){Object(h.a)(f.mark((function t(){var a,i,o;return f.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.storage.loadIdentity();case 2:if(a=t.sent){t.next=9;break}return t.next=6,ne.create(1,0,0,Wr()||zr()||Gr());case 6:return a=t.sent,t.next=9,r.storage.saveIdentity(a);case 9:return i="0",t.next=12,ye.importProto(w.FromBase64(n.preKey));case 12:return o=t.sent,t.next=15,Ne.create(a,o);case 15:return r.cipher=t.sent,t.next=18,r.storage.saveRemoteIdentity(i,r.cipher.remoteIdentity);case 18:r.emit("listening",new Mr(r,e));case 19:case"end":return t.stop()}}),t)})))().catch((function(e){return r.emit("error",new Fr(r,e))}))},r.socket.onclose=function(t){for(var n in r.stack){r.stack[n].reject(new Error("Cannot finish operation. Session was closed"))}r.emit("close",new Jr(r,e,t.code,t.reason))},r.socket.onmessage=function(e){e.data instanceof ArrayBuffer&&fe.importProto(e.data).then((function(e){if(!r.cipher)throw new Error("Client cipher is not initialized");return r.cipher.decrypt(e)})).then((function(e){r.onMessage(e)})).catch((function(e){r.emit("error",new Fr(r,e))}))}})).catch((function(e){r.emit("error",new Fr(r,e))})),this}},{key:"close",value:function(){this.socket&&this.socket.close()}},{key:"on",value:function(e,t){return Object(u.a)(Object(c.a)(r.prototype),"on",this).call(this,e,t)}},{key:"once",value:function(e,t){return Object(u.a)(Object(c.a)(r.prototype),"once",this).call(this,e,t)}},{key:"challenge",value:function(){var e=Object(h.a)(f.mark((function e(){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.cipher){e.next=2;break}throw new Error("Client cipher is not initialized");case 2:return e.abrupt("return",Rr(this.cipher.remoteIdentity.signingKey,this.cipher.identity.signingKey.publicKey));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isLoggedIn",value:function(){var e=Object(h.a)(f.mark((function e(){var t,r;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new tt,e.next=3,this.send(t);case 3:return r=e.sent,e.abrupt("return",!!r&&!!new Uint8Array(r)[0]);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=Object(h.a)(f.mark((function e(){var t;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Qe,e.next=3,this.send(t);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(e){var t=this;return new Promise((function(r,n){t.checkSocketState(),e||(e=new Ve),e.action=e.action,e.actionId=(t.messageCounter++).toString(),e.exportProto().then((function(e){if(!t.cipher)throw new Error("Client cipher is not initialized");return t.cipher.encrypt(e).then((function(e){return e.exportProto()}))})).then((function(a){if(!t.socket)throw new Error("Client socket is not initialized");t.stack[e.actionId]={resolve:r,reject:n},t.socket.send(a)})).catch(n)}))}},{key:"getServerInfo",value:function(){var e=Object(h.a)(f.mark((function e(t){var r,n,a;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="https://".concat(t).concat("/.well-known/webcrypto-socket"),e.next=3,g.default(r);case 3:if(200===(n=e.sent).status){e.next=8;break}throw new Error("Cannot get wellknown link");case 8:return e.next=10,n.json();case 10:return a=e.sent,e.abrupt("return",a);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkSocketState",value:function(){if(this.state!==Yr.open)throw new Error("Socket connection is not open")}},{key:"onMessage",value:function(){var e=Object(h.a)(f.mark((function e(t){var r,n,a,i,o;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ve.importProto(t);case 2:if(r=e.sent,!(n=this.stack[r.actionId])){e.next=16;break}return delete this.stack[r.actionId],e.t0=Ze,e.next=9,r.exportProto();case 9:return e.t1=e.sent,e.next=12,e.t0.importProto.call(e.t0,e.t1);case 12:(a=e.sent).error&&a.error.message?(i=a.error,o=new qr(i),n.reject(o)):n.resolve(a.data),e.next=17;break;case 16:this.emit("event",r);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(C);function on(e,t){return e(t={exports:{}},t.exports),t.exports}function un(e,t){var r=0;if(1===e.length)return e[0];for(var n=e.length-1;n>=0;n--)r+=e[e.length-1-n]*Math.pow(2,t*n);return r}function cn(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=r,a=e,i=0,o=Math.pow(2,t),u=1;u<8;u++){if(e<o){var c=void 0;if(n<0)c=new ArrayBuffer(u),i=u;else{if(n<u)return new ArrayBuffer(0);c=new ArrayBuffer(n),i=n}for(var s=new Uint8Array(c),l=u-1;l>=0;l--){var f=Math.pow(2,l*t);s[i-l-1]=Math.floor(a/f),a-=s[i-l-1]*f}return c}o*=Math.pow(2,t)}return new ArrayBuffer(0)}var sn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",ln="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=";var fn=Math.log(2);var hn,vn,pn,yn=Object.freeze({__proto__:null,getUTCDate:function(e){return new Date(e.getTime()+6e4*e.getTimezoneOffset())},getParametersValue:function(e,t,r){return e instanceof Object===!1?r:t in e?e[t]:r},bufferToHexCodes:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.byteLength-r,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i="",o=Object(v.a)(new Uint8Array(e,r,n));try{for(o.s();!(t=o.n()).done;){var u=t.value,c=u.toString(16).toUpperCase();1===c.length&&(i+="0"),i+=c,a&&(i+=" ")}}catch(s){o.e(s)}finally{o.f()}return i.trim()},checkBufferParams:function(e,t,r,n){return t instanceof ArrayBuffer===!1?(e.error='Wrong parameter: inputBuffer must be "ArrayBuffer"',!1):0===t.byteLength?(e.error="Wrong parameter: inputBuffer has zero length",!1):r<0?(e.error="Wrong parameter: inputOffset less than zero",!1):n<0?(e.error="Wrong parameter: inputLength less than zero",!1):!(t.byteLength-r-n<0)||(e.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1)},utilFromBase:un,utilToBase:cn,utilConcatBuf:function(){for(var e=0,t=0,r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];for(var i=0,o=n;i<o.length;i++){var u=o[i];e+=u.byteLength}for(var c=new ArrayBuffer(e),s=new Uint8Array(c),l=0,f=n;l<f.length;l++){var h=f[l];s.set(new Uint8Array(h),t),t+=h.byteLength}return c},utilConcatView:function(){for(var e=0,t=0,r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];for(var i=0,o=n;i<o.length;i++){var u=o[i];e+=u.length}for(var c=new ArrayBuffer(e),s=new Uint8Array(c),l=0,f=n;l<f.length;l++){var h=f[l];s.set(h,t),t+=h.length}return s},utilDecodeTC:function(){var e=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){var t=255===e[0]&&128&e[1],r=0===e[0]&&0===(128&e[1]);(t||r)&&this.warnings.push("Needlessly long format")}for(var n=new ArrayBuffer(this.valueHex.byteLength),a=new Uint8Array(n),i=0;i<this.valueHex.byteLength;i++)a[i]=0;a[0]=128&e[0];for(var o=un(a,8),u=new ArrayBuffer(this.valueHex.byteLength),c=new Uint8Array(u),s=0;s<this.valueHex.byteLength;s++)c[s]=e[s];return c[0]&=127,un(c,8)-o},utilEncodeTC:function(e){for(var t=e<0?-1*e:e,r=128,n=1;n<8;n++){if(t<=r){if(e<0){var a=cn(r-t,8,n);return new Uint8Array(a)[0]|=128,a}var i=cn(t,8,n),o=new Uint8Array(i);if(128&o[0]){var u=i.slice(0),c=new Uint8Array(u);i=new ArrayBuffer(i.byteLength+1),o=new Uint8Array(i);for(var s=0;s<u.byteLength;s++)o[s+1]=c[s];o[0]=0}return i}r*=Math.pow(2,8)}return new ArrayBuffer(0)},isEqualBuffer:function(e,t){if(e.byteLength!==t.byteLength)return!1;for(var r=new Uint8Array(e),n=new Uint8Array(t),a=0;a<r.length;a++)if(r[a]!==n[a])return!1;return!0},padNumber:function(e,t){var r=e.toString(10);if(t<r.length)return"";for(var n=t-r.length,a=new Array(n),i=0;i<n;i++)a[i]="0";return a.join("").concat(r)},toBase64:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=0,i=0,o=0,u="",c=t?ln:sn;if(n){for(var s=0,l=0;l<e.length;l++)if(0!==e.charCodeAt(l)){s=l;break}e=e.slice(s)}for(;a<e.length;){var f=e.charCodeAt(a++);a>=e.length&&(i=1);var h=e.charCodeAt(a++);a>=e.length&&(o=1);var v=e.charCodeAt(a++),p=f>>2,y=(3&f)<<4|h>>4,d=(15&h)<<2|v>>6,b=63&v;1===i?d=b=64:1===o&&(b=64),u+=r?64===d?"".concat(c.charAt(p)).concat(c.charAt(y)):64===b?"".concat(c.charAt(p)).concat(c.charAt(y)).concat(c.charAt(d)):"".concat(c.charAt(p)).concat(c.charAt(y)).concat(c.charAt(d)).concat(c.charAt(b)):"".concat(c.charAt(p)).concat(c.charAt(y)).concat(c.charAt(d)).concat(c.charAt(b))}return u},fromBase64:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=t?ln:sn;function a(e){for(var t=0;t<64;t++)if(n.charAt(t)===e)return t;return 64}function i(e){return 64===e?0:e}for(var o=0,u="";o<e.length;){var c=a(e.charAt(o++)),s=o>=e.length?0:a(e.charAt(o++)),l=o>=e.length?0:a(e.charAt(o++)),f=o>=e.length?0:a(e.charAt(o++)),h=i(c)<<2|i(s)>>4,v=(15&i(s))<<4|i(l)>>2,p=(3&i(l))<<6|i(f);u+=String.fromCharCode(h),64!==l&&(u+=String.fromCharCode(v)),64!==f&&(u+=String.fromCharCode(p))}if(r){for(var y=u.length,d=-1,b=y-1;b>=0;b--)if(0!==u.charCodeAt(b)){d=b;break}u=-1!==d?u.slice(0,d+1):""}return u},arrayBufferToString:function(e){var t,r="",n=new Uint8Array(e),a=Object(v.a)(n);try{for(a.s();!(t=a.n()).done;){var i=t.value;r+=String.fromCharCode(i)}}catch(o){a.e(o)}finally{a.f()}return r},stringToArrayBuffer:function(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),a=0;a<t;a++)n[a]=e.charCodeAt(a);return r},nearestPowerOf2:function(e){var t=Math.log(e)/fn,r=Math.floor(t),n=Math.round(t);return r===n?r:n},clearProps:function(e,t){var r,n=Object(v.a)(t);try{for(n.s();!(r=n.n()).done;){delete e[r.value]}}catch(a){n.e(a)}finally{n.f()}}}),dn=on((function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.fromBER=ye,t.compareSchema=de,t.verifySchema=function(e,t){if(t instanceof Object===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};var r=ye(e);if(-1===r.offset)return{verified:!1,result:r.result};return de(r.result,r.result,t)},t.fromJSON=function(e){},t.RawData=t.Repeated=t.Any=t.Choice=t.TIME=t.Duration=t.DateTime=t.TimeOfDay=t.DATE=t.GeneralizedTime=t.UTCTime=t.CharacterString=t.GeneralString=t.VisibleString=t.GraphicString=t.IA5String=t.VideotexString=t.TeletexString=t.PrintableString=t.NumericString=t.UniversalString=t.BmpString=t.RelativeObjectIdentifier=t.Utf8String=t.ObjectIdentifier=t.Enumerated=t.Integer=t.BitString=t.OctetString=t.Null=t.Set=t.Sequence=t.Boolean=t.EndOfContent=t.Constructed=t.Primitive=t.BaseBlock=t.ValueBlock=t.HexBlock=void 0;var r=[new Uint8Array([1])],n="0123456789",a=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(p.a)(this,e),this.blockLength=(0,yn.getParametersValue)(t,"blockLength",0),this.error=(0,yn.getParametersValue)(t,"error",""),this.warnings=(0,yn.getParametersValue)(t,"warnings",[]),this.valueBeforeDecode="valueBeforeDecode"in t?t.valueBeforeDecode.slice(0):new ArrayBuffer(0)}return Object(y.a)(e,[{key:"toJSON",value:function(){return{blockName:this.constructor.blockName(),blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:(0,yn.bufferToHexCodes)(this.valueBeforeDecode,0,this.valueBeforeDecode.byteLength)}}}],[{key:"blockName",value:function(){return"baseBlock"}}]),e}(),i=function(e){return function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).isHexOnly=(0,yn.getParametersValue)(n,"isHexOnly",!1),e.valueHex="valueHex"in n?n.valueHex.slice(0):new ArrayBuffer(0),e}return Object(y.a)(r,[{key:"fromBER",value:function(e,t,r){return!1===(0,yn.checkBufferParams)(this,e,t,r)?-1:0===new Uint8Array(e,t,r).length?(this.warnings.push("Zero buffer length"),t):(this.valueHex=e.slice(t,t+r),this.blockLength=r,t+r)}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!0!==this.isHexOnly?(this.error='Flag "isHexOnly" is not set, abort',new ArrayBuffer(0)):!0===e?new ArrayBuffer(this.valueHex.byteLength):this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=Object(u.a)(Object(c.a)(r.prototype),"toJSON",this).call(this)}catch(t){}return e.blockName=this.constructor.blockName(),e.isHexOnly=this.isHexOnly,e.valueHex=(0,yn.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"hexBlock"}}]),r}(e)};t.HexBlock=i;var o=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),e=t.call(this),"idBlock"in n?(e.isHexOnly=(0,yn.getParametersValue)(n.idBlock,"isHexOnly",!1),e.valueHex=(0,yn.getParametersValue)(n.idBlock,"valueHex",new ArrayBuffer(0)),e.tagClass=(0,yn.getParametersValue)(n.idBlock,"tagClass",-1),e.tagNumber=(0,yn.getParametersValue)(n.idBlock,"tagNumber",-1),e.isConstructed=(0,yn.getParametersValue)(n.idBlock,"isConstructed",!1)):(e.tagClass=-1,e.tagNumber=-1,e.isConstructed=!1),e}return Object(y.a)(r,[{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=0;switch(this.tagClass){case 1:n|=0;break;case 2:n|=64;break;case 3:n|=128;break;case 4:n|=192;break;default:return this.error="Unknown tag class",new ArrayBuffer(0)}if(this.isConstructed&&(n|=32),this.tagNumber<31&&!this.isHexOnly){if(e=new ArrayBuffer(1),t=new Uint8Array(e),!r){var a=this.tagNumber;n|=a&=31,t[0]=n}return e}if(!1===this.isHexOnly){var i=(0,yn.utilToBase)(this.tagNumber,7),o=new Uint8Array(i),u=i.byteLength;if(e=new ArrayBuffer(u+1),(t=new Uint8Array(e))[0]=31|n,!r){for(var c=0;c<u-1;c++)t[c+1]=128|o[c];t[u]=o[u-1]}return e}if(e=new ArrayBuffer(this.valueHex.byteLength+1),(t=new Uint8Array(e))[0]=31|n,!1===r){for(var s=new Uint8Array(this.valueHex),l=0;l<s.length-1;l++)t[l+1]=128|s[l];t[this.valueHex.byteLength]=s[s.length-1]}return e}},{key:"fromBER",value:function(e,t,r){if(!1===(0,yn.checkBufferParams)(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);if(0===n.length)return this.error="Zero buffer length",-1;switch(192&n[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=32===(32&n[0]),this.isHexOnly=!1;var a=31&n[0];if(31!==a)this.tagNumber=a,this.blockLength=1;else{var i=1;this.valueHex=new ArrayBuffer(255);for(var o=255,u=new Uint8Array(this.valueHex);128&n[i];){if(u[i-1]=127&n[i],++i>=n.length)return this.error="End of input reached before message was fully decoded",-1;if(i===o){o+=255;for(var c=new ArrayBuffer(o),s=new Uint8Array(c),l=0;l<u.length;l++)s[l]=u[l];this.valueHex=new ArrayBuffer(o),u=new Uint8Array(this.valueHex)}}this.blockLength=i+1,u[i-1]=127&n[i];for(var f=new ArrayBuffer(i),h=new Uint8Array(f),v=0;v<i;v++)h[v]=u[v];this.valueHex=new ArrayBuffer(i),(u=new Uint8Array(this.valueHex)).set(h),this.blockLength<=9?this.tagNumber=(0,yn.utilFromBase)(u,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}},{key:"toJSON",value:function(){var e={};try{e=Object(u.a)(Object(c.a)(r.prototype),"toJSON",this).call(this)}catch(t){}return e.blockName=this.constructor.blockName(),e.tagClass=this.tagClass,e.tagNumber=this.tagNumber,e.isConstructed=this.isConstructed,e}}],[{key:"blockName",value:function(){return"identificationBlock"}}]),r}(i(a)),f=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),e=t.call(this),"lenBlock"in n?(e.isIndefiniteForm=(0,yn.getParametersValue)(n.lenBlock,"isIndefiniteForm",!1),e.longFormUsed=(0,yn.getParametersValue)(n.lenBlock,"longFormUsed",!1),e.length=(0,yn.getParametersValue)(n.lenBlock,"length",0)):(e.isIndefiniteForm=!1,e.longFormUsed=!1,e.length=0),e}return Object(y.a)(r,[{key:"fromBER",value:function(e,t,r){if(!1===(0,yn.checkBufferParams)(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);if(0===n.length)return this.error="Zero buffer length",-1;if(255===n[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===n[0],!0===this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&n[0]),!1===this.longFormUsed)return this.length=n[0],this.blockLength=1,t+this.blockLength;var a=127&n[0];if(a>8)return this.error="Too big integer",-1;if(a+1>n.length)return this.error="End of input reached before message was fully decoded",-1;for(var i=new Uint8Array(a),o=0;o<a;o++)i[o]=n[o+1];return 0===i[a-1]&&this.warnings.push("Needlessly long encoded length"),this.length=(0,yn.utilFromBase)(i,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unneccesary usage of long length form"),this.blockLength=a+1,t+this.blockLength}},{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return e=new ArrayBuffer(1),!1===r&&((t=new Uint8Array(e))[0]=128),e;if(!0===this.longFormUsed){var n=(0,yn.utilToBase)(this.length,8);if(n.byteLength>127)return this.error="Too big length",new ArrayBuffer(0);if(e=new ArrayBuffer(n.byteLength+1),!0===r)return e;var a=new Uint8Array(n);(t=new Uint8Array(e))[0]=128|n.byteLength;for(var i=0;i<n.byteLength;i++)t[i+1]=a[i];return e}return e=new ArrayBuffer(1),!1===r&&((t=new Uint8Array(e))[0]=this.length),e}},{key:"toJSON",value:function(){var e={};try{e=Object(u.a)(Object(c.a)(r.prototype),"toJSON",this).call(this)}catch(t){}return e.blockName=this.constructor.blockName(),e.isIndefiniteForm=this.isIndefiniteForm,e.longFormUsed=this.longFormUsed,e.length=this.length,e}}],[{key:"blockName",value:function(){return"lengthBlock"}}]),r}(a),h=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),t.call(this,e)}return Object(y.a)(r,[{key:"fromBER",value:function(e,t,r){throw TypeError('User need to make a specific function in a class which extends "ValueBlock"')}},{key:"toBER",value:function(){throw TypeError('User need to make a specific function in a class which extends "ValueBlock"')}}],[{key:"blockName",value:function(){return"valueBlock"}}]),r}(a);t.ValueBlock=h;var v=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h;return Object(p.a)(this,r),e=t.call(this,n),"name"in n&&(e.name=n.name),"optional"in n&&(e.optional=n.optional),"primitiveSchema"in n&&(e.primitiveSchema=n.primitiveSchema),e.idBlock=new o(n),e.lenBlock=new f(n),e.valueBlock=new a(n),e}return Object(y.a)(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"toBER",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=this.idBlock.toBER(t),n=this.valueBlock.toBER(!0);this.lenBlock.length=n.byteLength;var a,i=this.lenBlock.toBER(t);if(e=(0,yn.utilConcatBuf)(r,i),a=!1===t?this.valueBlock.toBER(t):new ArrayBuffer(this.lenBlock.length),e=(0,yn.utilConcatBuf)(e,a),!0===this.lenBlock.isIndefiniteForm){var o=new ArrayBuffer(2);if(!1===t){var u=new Uint8Array(o);u[0]=0,u[1]=0}e=(0,yn.utilConcatBuf)(e,o)}return e}},{key:"toJSON",value:function(){var e={};try{e=Object(u.a)(Object(c.a)(r.prototype),"toJSON",this).call(this)}catch(t){}return e.idBlock=this.idBlock.toJSON(),e.lenBlock=this.lenBlock.toJSON(),e.valueBlock=this.valueBlock.toJSON(),"name"in this&&(e.name=this.name),"optional"in this&&(e.optional=this.optional),"primitiveSchema"in this&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}}],[{key:"blockName",value:function(){return"BaseBlock"}}]),r}(a);t.BaseBlock=v;var d=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).valueHex="valueHex"in n?n.valueHex.slice(0):new ArrayBuffer(0),e.isHexOnly=(0,yn.getParametersValue)(n,"isHexOnly",!0),e}return Object(y.a)(r,[{key:"fromBER",value:function(e,t,r){if(!1===(0,yn.checkBufferParams)(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);if(0===n.length)return this.warnings.push("Zero buffer length"),t;this.valueHex=new ArrayBuffer(n.length);for(var a=new Uint8Array(this.valueHex),i=0;i<n.length;i++)a[i]=n[i];return this.blockLength=r,t+r}},{key:"toBER",value:function(){return this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=Object(u.a)(Object(c.a)(r.prototype),"toJSON",this).call(this)}catch(t){}return e.valueHex=(0,yn.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength),e.isHexOnly=this.isHexOnly,e}}],[{key:"blockName",value:function(){return"PrimitiveValueBlock"}}]),r}(h),b=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n,d)).idBlock.isConstructed=!1,e}return Object(y.a)(r,null,[{key:"blockName",value:function(){return"PRIMITIVE"}}]),r}(v);t.Primitive=b;var g=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).value=(0,yn.getParametersValue)(n,"value",[]),e.isIndefiniteForm=(0,yn.getParametersValue)(n,"isIndefiniteForm",!1),e}return Object(y.a)(r,[{key:"fromBER",value:function(e,t,r){var n=t,a=r;if(!1===(0,yn.checkBufferParams)(this,e,t,r))return-1;if(0===new Uint8Array(e,t,r).length)return this.warnings.push("Zero buffer length"),t;for(var i,o,u=t;i=this.isIndefiniteForm,o=r,(!0===i?1:o)>0;){var c=pe(e,u,r);if(-1===c.offset)return this.error=c.result.error,this.warnings.concat(c.result.warnings),-1;if(u=c.offset,this.blockLength+=c.result.blockLength,r-=c.result.blockLength,this.value.push(c.result),!0===this.isIndefiniteForm&&c.result.constructor.blockName()===O.blockName())break}return!0===this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.blockName()===O.blockName()?this.value.pop():this.warnings.push("No EndOfContent block encoded")),this.valueBeforeDecode=e.slice(n,n+a),u}},{key:"toBER",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new ArrayBuffer(0),r=0;r<this.value.length;r++){var n=this.value[r].toBER(e);t=(0,yn.utilConcatBuf)(t,n)}return t}},{key:"toJSON",value:function(){var e={};try{e=Object(u.a)(Object(c.a)(r.prototype),"toJSON",this).call(this)}catch(n){}e.isIndefiniteForm=this.isIndefiniteForm,e.value=[];for(var t=0;t<this.value.length;t++)e.value.push(this.value[t].toJSON());return e}}],[{key:"blockName",value:function(){return"ConstructedValueBlock"}}]),r}(h),m=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n,g)).idBlock.isConstructed=!0,e}return Object(y.a)(r,[{key:"fromBER",value:function(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}}],[{key:"blockName",value:function(){return"CONSTRUCTED"}}]),r}(v);t.Constructed=m;var k=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),t.call(this,e)}return Object(y.a)(r,[{key:"fromBER",value:function(e,t,r){return t}},{key:"toBER",value:function(){return new ArrayBuffer(0)}}],[{key:"blockName",value:function(){return"EndOfContentValueBlock"}}]),r}(h),O=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n,k)).idBlock.tagClass=1,e.idBlock.tagNumber=0,e}return Object(y.a)(r,null,[{key:"blockName",value:function(){return"EndOfContent"}}]),r}(v);t.EndOfContent=O;var w=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Object(p.a)(this,r),(e=t.call(this,n)).value=(0,yn.getParametersValue)(n,"value",!1),e.isHexOnly=(0,yn.getParametersValue)(n,"isHexOnly",!1),"valueHex"in n)e.valueHex=n.valueHex.slice(0);else if(e.valueHex=new ArrayBuffer(1),!0===e.value){var a=new Uint8Array(e.valueHex);a[0]=255}return e}return Object(y.a)(r,[{key:"fromBER",value:function(e,t,r){if(!1===(0,yn.checkBufferParams)(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,this.valueHex=new ArrayBuffer(n.length);for(var a=new Uint8Array(this.valueHex),i=0;i<n.length;i++)a[i]=n[i];return 0!==yn.utilDecodeTC.call(this)?this.value=!0:this.value=!1,this.blockLength=r,t+r}},{key:"toBER",value:function(){return this.valueHex}},{key:"toJSON",value:function(){var e={};try{e=Object(u.a)(Object(c.a)(r.prototype),"toJSON",this).call(this)}catch(t){}return e.value=this.value,e.isHexOnly=this.isHexOnly,e.valueHex=(0,yn.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"BooleanValueBlock"}}]),r}(h),x=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n,w)).idBlock.tagClass=1,e.idBlock.tagNumber=1,e}return Object(y.a)(r,null,[{key:"blockName",value:function(){return"Boolean"}}]),r}(v);t.Boolean=x;var j=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=16,e}return Object(y.a)(r,null,[{key:"blockName",value:function(){return"Sequence"}}]),r}(m);t.Sequence=j;var B=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=17,e}return Object(y.a)(r,null,[{key:"blockName",value:function(){return"Set"}}]),r}(m);t.Set=B;var N=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n,a)).idBlock.tagClass=1,e.idBlock.tagNumber=5,e}return Object(y.a)(r,[{key:"fromBER",value:function(e,t,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+r}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new ArrayBuffer(2);if(!0===e)return t;var r=new Uint8Array(t);return r[0]=5,r[1]=0,t}}],[{key:"blockName",value:function(){return"Null"}}]),r}(v);t.Null=N;var E=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).isConstructed=(0,yn.getParametersValue)(n,"isConstructed",!1),e}return Object(y.a)(r,[{key:"fromBER",value:function(e,t,n){var a=0;if(!0===this.isConstructed){if(this.isHexOnly=!1,-1===(a=g.prototype.fromBER.call(this,e,t,n)))return a;for(var i=0;i<this.value.length;i++){var o=this.value[i].constructor.blockName();if(o===O.blockName()){if(!0===this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(o!==I.blockName())return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,a=Object(u.a)(Object(c.a)(r.prototype),"fromBER",this).call(this,e,t,n),this.blockLength=n;return a}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!0===this.isConstructed)return g.prototype.toBER.call(this,e);var t=new ArrayBuffer(this.valueHex.byteLength);return!0===e||0===this.valueHex.byteLength?t:t=this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=Object(u.a)(Object(c.a)(r.prototype),"toJSON",this).call(this)}catch(t){}return e.isConstructed=this.isConstructed,e.isHexOnly=this.isHexOnly,e.valueHex=(0,yn.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"OctetStringValueBlock"}}]),r}(i(g)),I=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n,E)).idBlock.tagClass=1,e.idBlock.tagNumber=4,e}return Object(y.a)(r,[{key:"fromBER",value:function(e,t,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===n?(0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),t):Object(u.a)(Object(c.a)(r.prototype),"fromBER",this).call(this,e,t,n)}},{key:"isEqual",value:function(e){return e instanceof r!==!1&&JSON.stringify(this)===JSON.stringify(e)}}],[{key:"blockName",value:function(){return"OctetString"}}]),r}(v);t.OctetString=I;var A=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).unusedBits=(0,yn.getParametersValue)(n,"unusedBits",0),e.isConstructed=(0,yn.getParametersValue)(n,"isConstructed",!1),e.blockLength=e.valueHex.byteLength,e}return Object(y.a)(r,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;var n=-1;if(!0===this.isConstructed){if(-1===(n=g.prototype.fromBER.call(this,e,t,r)))return n;for(var a=0;a<this.value.length;a++){var i=this.value[a].constructor.blockName();if(i===O.blockName()){if(!0===this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(i!==S.blockName())return this.error="BIT STRING may consists of BIT STRINGs only",-1;if(this.unusedBits>0&&this.value[a].valueBlock.unusedBits>0)return this.error='Usign of "unused bits" inside constructive BIT STRING allowed for least one only',-1;if(this.unusedBits=this.value[a].valueBlock.unusedBits,this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1}return n}if(!1===(0,yn.checkBufferParams)(this,e,t,r))return-1;var o=new Uint8Array(e,t,r);if(this.unusedBits=o[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;this.valueHex=new ArrayBuffer(o.length-1);for(var u=new Uint8Array(this.valueHex),c=0;c<r-1;c++)u[c]=o[c+1];return this.blockLength=o.length,t+r}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!0===this.isConstructed)return g.prototype.toBER.call(this,e);if(!0===e)return new ArrayBuffer(this.valueHex.byteLength+1);if(0===this.valueHex.byteLength)return new ArrayBuffer(0);var t=new Uint8Array(this.valueHex),r=new ArrayBuffer(this.valueHex.byteLength+1),n=new Uint8Array(r);n[0]=this.unusedBits;for(var a=0;a<this.valueHex.byteLength;a++)n[a+1]=t[a];return r}},{key:"toJSON",value:function(){var e={};try{e=Object(u.a)(Object(c.a)(r.prototype),"toJSON",this).call(this)}catch(t){}return e.unusedBits=this.unusedBits,e.isConstructed=this.isConstructed,e.isHexOnly=this.isHexOnly,e.valueHex=(0,yn.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"BitStringValueBlock"}}]),r}(i(g)),S=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n,A)).idBlock.tagClass=1,e.idBlock.tagNumber=3,e}return Object(y.a)(r,[{key:"fromBER",value:function(e,t,n){return 0===n?t:(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,Object(u.a)(Object(c.a)(r.prototype),"fromBER",this).call(this,e,t,n))}},{key:"isEqual",value:function(e){return e instanceof r!==!1&&JSON.stringify(this)===JSON.stringify(e)}}],[{key:"blockName",value:function(){return"BitString"}}]),r}(v);t.BitString=S;var D=function(e){Object(s.a)(a,e);var t=Object(l.a)(a);function a(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,a),e=t.call(this,r),"value"in r&&(e.valueDec=r.value),e}return Object(y.a)(a,[{key:"valueHex",get:function(){return this._valueHex},set:function(e){this._valueHex=e.slice(0),e.byteLength>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,e.byteLength>0&&(this._valueDec=yn.utilDecodeTC.call(this)))}},{key:"valueDec",get:function(){return this._valueDec},set:function(e){this._valueDec=e,this.isHexOnly=!1,this._valueHex=(0,yn.utilEncodeTC)(e)}},{key:"fromDER",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=this.fromBER(e,t,r);if(-1===a)return a;var i=new Uint8Array(this._valueHex);if(0===i[0]&&0!==(128&i[1])){var o=new ArrayBuffer(this._valueHex.byteLength-1),u=new Uint8Array(o);u.set(new Uint8Array(this._valueHex,1,this._valueHex.byteLength-1)),this._valueHex=o.slice(0)}else if(0!==n&&this._valueHex.byteLength<n){n-this._valueHex.byteLength>1&&(n=this._valueHex.byteLength+1);var c=new ArrayBuffer(n),s=new Uint8Array(c);s.set(i,n-this._valueHex.byteLength),this._valueHex=c.slice(0)}return a}},{key:"toDER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new Uint8Array(this._valueHex);switch(!0){case 0!==(128&t[0]):var r=new ArrayBuffer(this._valueHex.byteLength+1),n=new Uint8Array(r);n[0]=0,n.set(t,1),this._valueHex=r.slice(0);break;case 0===t[0]&&0===(128&t[1]):var a=new ArrayBuffer(this._valueHex.byteLength-1),i=new Uint8Array(a);i.set(new Uint8Array(this._valueHex,1,this._valueHex.byteLength-1)),this._valueHex=a.slice(0)}return this.toBER(e)}},{key:"fromBER",value:function(e,t,r){var n=Object(u.a)(Object(c.a)(a.prototype),"fromBER",this).call(this,e,t,r);return-1===n?n:(this.blockLength=r,t+r)}},{key:"toBER",value:function(){return this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=Object(u.a)(Object(c.a)(a.prototype),"toJSON",this).call(this)}catch(t){}return e.valueDec=this.valueDec,e}},{key:"toString",value:function(){function e(e,t){for(var r=new Uint8Array([0]),n=new Uint8Array(e),a=new Uint8Array(t),i=n.slice(0),o=i.length-1,u=a.slice(0),c=u.length-1,s=0,l=0,f=c<o?o:c;f>=0;f--,l++){switch(!0){case l<u.length:s=i[o-l]+u[c-l]+r[0];break;default:s=i[o-l]+r[0]}switch(r[0]=s/10,!0){case l>=i.length:i=(0,yn.utilConcatView)(new Uint8Array([s%10]),i);break;default:i[o-l]=s%10}}return r[0]>0&&(i=(0,yn.utilConcatView)(r,i)),i.slice(0)}function t(e){if(e>=r.length)for(var t=r.length;t<=e;t++){for(var n=new Uint8Array([0]),a=r[t-1].slice(0),i=a.length-1;i>=0;i--){var o=new Uint8Array([(a[i]<<1)+n[0]]);n[0]=o[0]/10,a[i]=o[0]%10}n[0]>0&&(a=(0,yn.utilConcatView)(n,a)),r.push(a)}return r[e]}function a(e,t){for(var r,n=0,a=new Uint8Array(e),i=new Uint8Array(t),o=a.slice(0),u=o.length-1,c=i.slice(0),s=c.length-1,l=0,f=s;f>=0;f--,l++)switch(r=o[u-l]-c[s-l]-n,!0){case r<0:n=1,o[u-l]=r+10;break;default:n=0,o[u-l]=r}if(n>0)for(var h=u-s+1;h>=0;h--,l++){if(!((r=o[u-l]-n)<0)){n=0,o[u-l]=r;break}n=1,o[u-l]=r+10}return o.slice()}for(var i,o=8*this._valueHex.byteLength-1,u=new Uint8Array(8*this._valueHex.byteLength/3),c=0,s=new Uint8Array(this._valueHex),l="",f=!1,h=this._valueHex.byteLength-1;h>=0;h--){i=s[h];for(var v=0;v<8;v++){if(1===(1&i))switch(c){case o:u=a(t(c),u),l="-";break;default:u=e(u,t(c))}c++,i>>=1}}for(var p=0;p<u.length;p++)u[p]&&(f=!0),f&&(l+=n.charAt(u[p]));return!1===f&&(l+=n.charAt(0)),l}}],[{key:"blockName",value:function(){return"IntegerValueBlock"}}]),a}(i(h)),C=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n,D)).idBlock.tagClass=1,e.idBlock.tagNumber=2,e}return Object(y.a)(r,[{key:"isEqual",value:function(e){return e instanceof r?this.valueBlock.isHexOnly&&e.valueBlock.isHexOnly?(0,yn.isEqualBuffer)(this.valueBlock.valueHex,e.valueBlock.valueHex):this.valueBlock.isHexOnly===e.valueBlock.isHexOnly&&this.valueBlock.valueDec===e.valueBlock.valueDec:e instanceof ArrayBuffer&&(0,yn.isEqualBuffer)(this.valueBlock.valueHex,e)}},{key:"convertToDER",value:function(){var e=new r({valueHex:this.valueBlock.valueHex});return e.valueBlock.toDER(),e}},{key:"convertFromDER",value:function(){var e=this.valueBlock.valueHex.byteLength%2?this.valueBlock.valueHex.byteLength+1:this.valueBlock.valueHex.byteLength,t=new r({valueHex:this.valueBlock.valueHex});return t.valueBlock.fromDER(t.valueBlock.valueHex,0,t.valueBlock.valueHex.byteLength,e),t}}],[{key:"blockName",value:function(){return"Integer"}}]),r}(v);t.Integer=C;var K=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=10,e}return Object(y.a)(r,null,[{key:"blockName",value:function(){return"Enumerated"}}]),r}(C);t.Enumerated=K;var T=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).valueDec=(0,yn.getParametersValue)(n,"valueDec",-1),e.isFirstSid=(0,yn.getParametersValue)(n,"isFirstSid",!1),e}return Object(y.a)(r,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;if(!1===(0,yn.checkBufferParams)(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);this.valueHex=new ArrayBuffer(r);for(var a=new Uint8Array(this.valueHex),i=0;i<r&&(a[i]=127&n[i],this.blockLength++,0!==(128&n[i]));i++);for(var o=new ArrayBuffer(this.blockLength),u=new Uint8Array(o),c=0;c<this.blockLength;c++)u[c]=a[c];return this.valueHex=o.slice(0),a=new Uint8Array(this.valueHex),0!==(128&n[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===a[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=(0,yn.utilFromBase)(a,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}},{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isHexOnly){if(!0===r)return new ArrayBuffer(this.valueHex.byteLength);var n=new Uint8Array(this.valueHex);e=new ArrayBuffer(this.blockLength),t=new Uint8Array(e);for(var a=0;a<this.blockLength-1;a++)t[a]=128|n[a];return t[this.blockLength-1]=n[this.blockLength-1],e}var i=(0,yn.utilToBase)(this.valueDec,7);if(0===i.byteLength)return this.error="Error during encoding SID value",new ArrayBuffer(0);if(e=new ArrayBuffer(i.byteLength),!1===r){var o=new Uint8Array(i);t=new Uint8Array(e);for(var u=0;u<i.byteLength-1;u++)t[u]=128|o[u];t[i.byteLength-1]=o[i.byteLength-1]}return e}},{key:"toString",value:function(){var e="";if(!0===this.isHexOnly)e=(0,yn.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength);else if(this.isFirstSid){var t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}},{key:"toJSON",value:function(){var e={};try{e=Object(u.a)(Object(c.a)(r.prototype),"toJSON",this).call(this)}catch(t){}return e.valueDec=this.valueDec,e.isFirstSid=this.isFirstSid,e}}],[{key:"blockName",value:function(){return"sidBlock"}}]),r}(i(a)),U=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).fromString((0,yn.getParametersValue)(n,"value","")),e}return Object(y.a)(r,[{key:"fromBER",value:function(e,t,r){for(var n=t;r>0;){var a=new T;if(-1===(n=a.fromBER(e,n,r)))return this.blockLength=0,this.error=a.error,n;0===this.value.length&&(a.isFirstSid=!0),this.blockLength+=a.blockLength,r-=a.blockLength,this.value.push(a)}return n}},{key:"toBER",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new ArrayBuffer(0),r=0;r<this.value.length;r++){var n=this.value[r].toBER(e);if(0===n.byteLength)return this.error=this.value[r].error,new ArrayBuffer(0);t=(0,yn.utilConcatBuf)(t,n)}return t}},{key:"fromString",value:function(e){this.value=[];var t=0,r=0,n="",a=!1;do{if(n=-1===(r=e.indexOf(".",t))?e.substr(t):e.substr(t,r-t),t=r+1,a){var i=this.value[0],o=0;switch(i.valueDec){case 0:break;case 1:o=40;break;case 2:o=80;break;default:return this.value=[],!1}var u=parseInt(n,10);if(isNaN(u))return!0;i.valueDec=u+o,a=!1}else{var c=new T;if(c.valueDec=parseInt(n,10),isNaN(c.valueDec))return!0;0===this.value.length&&(c.isFirstSid=!0,a=!0),this.value.push(c)}}while(-1!==r);return!0}},{key:"toString",value:function(){for(var e="",t=!1,r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var n=this.value[r].toString();0!==r&&(e="".concat(e,".")),t?(n="{".concat(n,"}"),this.value[r].isFirstSid?e="2.{".concat(n," - 80}"):e+=n):e+=n}return e}},{key:"toJSON",value:function(){var e={};try{e=Object(u.a)(Object(c.a)(r.prototype),"toJSON",this).call(this)}catch(n){}e.value=this.toString(),e.sidArray=[];for(var t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}],[{key:"blockName",value:function(){return"ObjectIdentifierValueBlock"}}]),r}(h),L=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n,U)).idBlock.tagClass=1,e.idBlock.tagNumber=6,e}return Object(y.a)(r,null,[{key:"blockName",value:function(){return"ObjectIdentifier"}}]),r}(v);t.ObjectIdentifier=L;var X=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).isHexOnly=!0,e.value="",e}return Object(y.a)(r,[{key:"toJSON",value:function(){var e={};try{e=Object(u.a)(Object(c.a)(r.prototype),"toJSON",this).call(this)}catch(t){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"Utf8StringValueBlock"}}]),r}(i(a)),H=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),e=t.call(this,n,X),"value"in n&&e.fromString(n.value),e.idBlock.tagClass=1,e.idBlock.tagNumber=12,e}return Object(y.a)(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.valueBlock.value=String.fromCharCode.apply(null,new Uint8Array(e));try{this.valueBlock.value=decodeURIComponent(escape(this.valueBlock.value))}catch(t){this.warnings.push('Error during "decodeURIComponent": '.concat(t,", using raw string"))}}},{key:"fromString",value:function(e){var t=unescape(encodeURIComponent(e)),r=t.length;this.valueBlock.valueHex=new ArrayBuffer(r);for(var n=new Uint8Array(this.valueBlock.valueHex),a=0;a<r;a++)n[a]=t.charCodeAt(a);this.valueBlock.value=e}}],[{key:"blockName",value:function(){return"Utf8String"}}]),r}(v);t.Utf8String=H;var R=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).valueDec=(0,yn.getParametersValue)(n,"valueDec",-1),e}return Object(y.a)(r,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;if(!1===(0,yn.checkBufferParams)(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);this.valueHex=new ArrayBuffer(r);for(var a=new Uint8Array(this.valueHex),i=0;i<r&&(a[i]=127&n[i],this.blockLength++,0!==(128&n[i]));i++);for(var o=new ArrayBuffer(this.blockLength),u=new Uint8Array(o),c=0;c<this.blockLength;c++)u[c]=a[c];return this.valueHex=o.slice(0),a=new Uint8Array(this.valueHex),0!==(128&n[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===a[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=(0,yn.utilFromBase)(a,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}},{key:"toBER",value:function(){var e,t,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isHexOnly){if(!0===r)return new ArrayBuffer(this.valueHex.byteLength);var n=new Uint8Array(this.valueHex);e=new ArrayBuffer(this.blockLength),t=new Uint8Array(e);for(var a=0;a<this.blockLength-1;a++)t[a]=128|n[a];return t[this.blockLength-1]=n[this.blockLength-1],e}var i=(0,yn.utilToBase)(this.valueDec,7);if(0===i.byteLength)return this.error="Error during encoding SID value",new ArrayBuffer(0);if(e=new ArrayBuffer(i.byteLength),!1===r){var o=new Uint8Array(i);t=new Uint8Array(e);for(var u=0;u<i.byteLength-1;u++)t[u]=128|o[u];t[i.byteLength-1]=o[i.byteLength-1]}return e}},{key:"toString",value:function(){return!0===this.isHexOnly?(0,yn.bufferToHexCodes)(this.valueHex,0,this.valueHex.byteLength):this.valueDec.toString()}},{key:"toJSON",value:function(){var e={};try{e=Object(u.a)(Object(c.a)(r.prototype),"toJSON",this).call(this)}catch(t){}return e.valueDec=this.valueDec,e}}],[{key:"blockName",value:function(){return"relativeSidBlock"}}]),r}(i(a)),P=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).fromString((0,yn.getParametersValue)(n,"value","")),e}return Object(y.a)(r,[{key:"fromBER",value:function(e,t,r){for(var n=t;r>0;){var a=new R;if(-1===(n=a.fromBER(e,n,r)))return this.blockLength=0,this.error=a.error,n;this.blockLength+=a.blockLength,r-=a.blockLength,this.value.push(a)}return n}},{key:"toBER",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new ArrayBuffer(0),r=0;r<this.value.length;r++){var n=this.value[r].toBER(e);if(0===n.byteLength)return this.error=this.value[r].error,new ArrayBuffer(0);t=(0,yn.utilConcatBuf)(t,n)}return t}},{key:"fromString",value:function(e){this.value=[];var t=0,r=0,n="";do{n=-1===(r=e.indexOf(".",t))?e.substr(t):e.substr(t,r-t),t=r+1;var a=new R;if(a.valueDec=parseInt(n,10),isNaN(a.valueDec))return!0;this.value.push(a)}while(-1!==r);return!0}},{key:"toString",value:function(){for(var e="",t=!1,r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var n=this.value[r].toString();0!==r&&(e="".concat(e,".")),e+=t?n="{".concat(n,"}"):n}return e}},{key:"toJSON",value:function(){var e={};try{e=Object(u.a)(Object(c.a)(r.prototype),"toJSON",this).call(this)}catch(n){}e.value=this.toString(),e.sidArray=[];for(var t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}],[{key:"blockName",value:function(){return"RelativeObjectIdentifierValueBlock"}}]),r}(h),_=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n,P)).idBlock.tagClass=1,e.idBlock.tagNumber=13,e}return Object(y.a)(r,null,[{key:"blockName",value:function(){return"RelativeObjectIdentifier"}}]),r}(v);t.RelativeObjectIdentifier=_;var q=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).isHexOnly=!0,e.value="",e}return Object(y.a)(r,[{key:"toJSON",value:function(){var e={};try{e=Object(u.a)(Object(c.a)(r.prototype),"toJSON",this).call(this)}catch(t){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"BmpStringValueBlock"}}]),r}(i(a)),V=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),e=t.call(this,n,q),"value"in n&&e.fromString(n.value),e.idBlock.tagClass=1,e.idBlock.tagNumber=30,e}return Object(y.a)(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){for(var t=e.slice(0),r=new Uint8Array(t),n=0;n<r.length;n+=2){var a=r[n];r[n]=r[n+1],r[n+1]=a}this.valueBlock.value=String.fromCharCode.apply(null,new Uint16Array(t))}},{key:"fromString",value:function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(2*t);for(var r=new Uint8Array(this.valueBlock.valueHex),n=0;n<t;n++){var a=(0,yn.utilToBase)(e.charCodeAt(n),8),i=new Uint8Array(a);if(!(i.length>2))for(var o=2-i.length,u=i.length-1;u>=0;u--)r[2*n+u+o]=i[u]}this.valueBlock.value=e}}],[{key:"blockName",value:function(){return"BmpString"}}]),r}(v);t.BmpString=V;var J=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).isHexOnly=!0,e.value="",e}return Object(y.a)(r,[{key:"toJSON",value:function(){var e={};try{e=Object(u.a)(Object(c.a)(r.prototype),"toJSON",this).call(this)}catch(t){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"UniversalStringValueBlock"}}]),r}(i(a)),F=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),e=t.call(this,n,J),"value"in n&&e.fromString(n.value),e.idBlock.tagClass=1,e.idBlock.tagNumber=28,e}return Object(y.a)(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){for(var t=e.slice(0),r=new Uint8Array(t),n=0;n<r.length;n+=4)r[n]=r[n+3],r[n+1]=r[n+2],r[n+2]=0,r[n+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}},{key:"fromString",value:function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(4*t);for(var r=new Uint8Array(this.valueBlock.valueHex),n=0;n<t;n++){var a=(0,yn.utilToBase)(e.charCodeAt(n),8),i=new Uint8Array(a);if(!(i.length>4))for(var o=4-i.length,u=i.length-1;u>=0;u--)r[4*n+u+o]=i[u]}this.valueBlock.value=e}}],[{key:"blockName",value:function(){return"UniversalString"}}]),r}(v);t.UniversalString=F;var M=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).value="",e.isHexOnly=!0,e}return Object(y.a)(r,[{key:"toJSON",value:function(){var e={};try{e=Object(u.a)(Object(c.a)(r.prototype),"toJSON",this).call(this)}catch(t){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"SimpleStringValueBlock"}}]),r}(i(a)),G=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),e=t.call(this,n,M),"value"in n&&e.fromString(n.value),e}return Object(y.a)(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.valueBlock.value=String.fromCharCode.apply(null,new Uint8Array(e))}},{key:"fromString",value:function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(t);for(var r=new Uint8Array(this.valueBlock.valueHex),n=0;n<t;n++)r[n]=e.charCodeAt(n);this.valueBlock.value=e}}],[{key:"blockName",value:function(){return"SIMPLESTRING"}}]),r}(v),z=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=18,e}return Object(y.a)(r,null,[{key:"blockName",value:function(){return"NumericString"}}]),r}(G);t.NumericString=z;var W=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=19,e}return Object(y.a)(r,null,[{key:"blockName",value:function(){return"PrintableString"}}]),r}(G);t.PrintableString=W;var Y=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=20,e}return Object(y.a)(r,null,[{key:"blockName",value:function(){return"TeletexString"}}]),r}(G);t.TeletexString=Y;var Z=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=21,e}return Object(y.a)(r,null,[{key:"blockName",value:function(){return"VideotexString"}}]),r}(G);t.VideotexString=Z;var $=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=22,e}return Object(y.a)(r,null,[{key:"blockName",value:function(){return"IA5String"}}]),r}(G);t.IA5String=$;var Q=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=25,e}return Object(y.a)(r,null,[{key:"blockName",value:function(){return"GraphicString"}}]),r}(G);t.GraphicString=Q;var ee=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=26,e}return Object(y.a)(r,null,[{key:"blockName",value:function(){return"VisibleString"}}]),r}(G);t.VisibleString=ee;var te=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=27,e}return Object(y.a)(r,null,[{key:"blockName",value:function(){return"GeneralString"}}]),r}(G);t.GeneralString=te;var re=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=29,e}return Object(y.a)(r,null,[{key:"blockName",value:function(){return"CharacterString"}}]),r}(G);t.CharacterString=re;var ne=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Object(p.a)(this,r),(e=t.call(this,n)).year=0,e.month=0,e.day=0,e.hour=0,e.minute=0,e.second=0,"value"in n){e.fromString(n.value),e.valueBlock.valueHex=new ArrayBuffer(n.value.length);for(var a=new Uint8Array(e.valueBlock.valueHex),i=0;i<n.value.length;i++)a[i]=n.value.charCodeAt(i)}return"valueDate"in n&&(e.fromDate(n.valueDate),e.valueBlock.valueHex=e.toBuffer()),e.idBlock.tagClass=1,e.idBlock.tagNumber=23,e}return Object(y.a)(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.fromString(String.fromCharCode.apply(null,new Uint8Array(e)))}},{key:"toBuffer",value:function(){for(var e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t}},{key:"fromDate",value:function(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}},{key:"fromString",value:function(e){var t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/gi.exec(e);if(null!==t){var r=parseInt(t[1],10);this.year=r>=50?1900+r:2e3+r,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}else this.error="Wrong input string for convertion"}},{key:"toString",value:function(){var e=new Array(7);return e[0]=(0,yn.padNumber)(this.year<2e3?this.year-1900:this.year-2e3,2),e[1]=(0,yn.padNumber)(this.month,2),e[2]=(0,yn.padNumber)(this.day,2),e[3]=(0,yn.padNumber)(this.hour,2),e[4]=(0,yn.padNumber)(this.minute,2),e[5]=(0,yn.padNumber)(this.second,2),e[6]="Z",e.join("")}},{key:"toJSON",value:function(){var e={};try{e=Object(u.a)(Object(c.a)(r.prototype),"toJSON",this).call(this)}catch(t){}return e.year=this.year,e.month=this.month,e.day=this.day,e.hour=this.hour,e.minute=this.minute,e.second=this.second,e}}],[{key:"blockName",value:function(){return"UTCTime"}}]),r}(ee);t.UTCTime=ne;var ae=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Object(p.a)(this,r),(e=t.call(this,n)).year=0,e.month=0,e.day=0,e.hour=0,e.minute=0,e.second=0,e.millisecond=0,"value"in n){e.fromString(n.value),e.valueBlock.valueHex=new ArrayBuffer(n.value.length);for(var a=new Uint8Array(e.valueBlock.valueHex),i=0;i<n.value.length;i++)a[i]=n.value.charCodeAt(i)}return"valueDate"in n&&(e.fromDate(n.valueDate),e.valueBlock.valueHex=e.toBuffer()),e.idBlock.tagClass=1,e.idBlock.tagNumber=24,e}return Object(y.a)(r,[{key:"fromBER",value:function(e,t,r){var n=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===n?(this.error=this.valueBlock.error,n):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),n)}},{key:"fromBuffer",value:function(e){this.fromString(String.fromCharCode.apply(null,new Uint8Array(e)))}},{key:"toBuffer",value:function(){for(var e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return t}},{key:"fromDate",value:function(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds(),this.millisecond=e.getUTCMilliseconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}},{key:"fromString",value:function(e){var t,r=!1,n="",a="",i=0,o=0,u=0;if("Z"===e[e.length-1])n=e.substr(0,e.length-1),r=!0;else{var c=new Number(e[e.length-1]);if(isNaN(c.valueOf()))throw new Error("Wrong input string for convertion");n=e}if(r){if(-1!==n.indexOf("+"))throw new Error("Wrong input string for convertion");if(-1!==n.indexOf("-"))throw new Error("Wrong input string for convertion")}else{var s=1,l=n.indexOf("+"),f="";if(-1===l&&(l=n.indexOf("-"),s=-1),-1!==l){if(f=n.substr(l+1),n=n.substr(0,l),2!==f.length&&4!==f.length)throw new Error("Wrong input string for convertion");var h=new Number(f.substr(0,2));if(isNaN(h.valueOf()))throw new Error("Wrong input string for convertion");if(o=s*h,4===f.length){if(h=new Number(f.substr(2,2)),isNaN(h.valueOf()))throw new Error("Wrong input string for convertion");u=s*h}}}var v=n.indexOf(".");if(-1===v&&(v=n.indexOf(",")),-1!==v){var p=new Number("0".concat(n.substr(v)));if(isNaN(p.valueOf()))throw new Error("Wrong input string for convertion");i=p.valueOf(),a=n.substr(0,v)}else a=n;switch(!0){case 8===a.length:if(t=/(\d{4})(\d{2})(\d{2})/gi,-1!==v)throw new Error("Wrong input string for convertion");break;case 10===a.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})/gi,-1!==v){var y=60*i;this.minute=Math.floor(y),y=60*(y-this.minute),this.second=Math.floor(y),y=1e3*(y-this.second),this.millisecond=Math.floor(y)}break;case 12===a.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==v){var d=60*i;this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case 14===a.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==v){var b=1e3*i;this.millisecond=Math.floor(b)}break;default:throw new Error("Wrong input string for convertion")}var g=t.exec(a);if(null===g)throw new Error("Wrong input string for convertion");for(var m=1;m<g.length;m++)switch(m){case 1:this.year=parseInt(g[m],10);break;case 2:this.month=parseInt(g[m],10);break;case 3:this.day=parseInt(g[m],10);break;case 4:this.hour=parseInt(g[m],10)+o;break;case 5:this.minute=parseInt(g[m],10)+u;break;case 6:this.second=parseInt(g[m],10);break;default:throw new Error("Wrong input string for convertion")}if(!1===r){var k=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=k.getUTCFullYear(),this.month=k.getUTCMonth(),this.day=k.getUTCDay(),this.hour=k.getUTCHours(),this.minute=k.getUTCMinutes(),this.second=k.getUTCSeconds(),this.millisecond=k.getUTCMilliseconds()}}},{key:"toString",value:function(){var e=[];return e.push((0,yn.padNumber)(this.year,4)),e.push((0,yn.padNumber)(this.month,2)),e.push((0,yn.padNumber)(this.day,2)),e.push((0,yn.padNumber)(this.hour,2)),e.push((0,yn.padNumber)(this.minute,2)),e.push((0,yn.padNumber)(this.second,2)),0!==this.millisecond&&(e.push("."),e.push((0,yn.padNumber)(this.millisecond,3))),e.push("Z"),e.join("")}},{key:"toJSON",value:function(){var e={};try{e=Object(u.a)(Object(c.a)(r.prototype),"toJSON",this).call(this)}catch(t){}return e.year=this.year,e.month=this.month,e.day=this.day,e.hour=this.hour,e.minute=this.minute,e.second=this.second,e.millisecond=this.millisecond,e}}],[{key:"blockName",value:function(){return"GeneralizedTime"}}]),r}(ee);t.GeneralizedTime=ae;var ie=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=31,e}return Object(y.a)(r,null,[{key:"blockName",value:function(){return"DATE"}}]),r}(H);t.DATE=ie;var oe=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=32,e}return Object(y.a)(r,null,[{key:"blockName",value:function(){return"TimeOfDay"}}]),r}(H);t.TimeOfDay=oe;var ue=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=33,e}return Object(y.a)(r,null,[{key:"blockName",value:function(){return"DateTime"}}]),r}(H);t.DateTime=ue;var ce=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=34,e}return Object(y.a)(r,null,[{key:"blockName",value:function(){return"Duration"}}]),r}(H);t.Duration=ce;var se=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(p.a)(this,r),(e=t.call(this,n)).idBlock.tagClass=1,e.idBlock.tagNumber=14,e}return Object(y.a)(r,null,[{key:"blockName",value:function(){return"TIME"}}]),r}(H);t.TIME=se;var le=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(p.a)(this,e),this.value=(0,yn.getParametersValue)(t,"value",[]),this.optional=(0,yn.getParametersValue)(t,"optional",!1)};t.Choice=le;var fe=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(p.a)(this,e),this.name=(0,yn.getParametersValue)(t,"name",""),this.optional=(0,yn.getParametersValue)(t,"optional",!1)};t.Any=fe;var he=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(p.a)(this,e),this.name=(0,yn.getParametersValue)(t,"name",""),this.optional=(0,yn.getParametersValue)(t,"optional",!1),this.value=(0,yn.getParametersValue)(t,"value",new fe),this.local=(0,yn.getParametersValue)(t,"local",!1)};t.Repeated=he;var ve=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(p.a)(this,e),this.data=(0,yn.getParametersValue)(t,"data",new ArrayBuffer(0))}return Object(y.a)(e,[{key:"fromBER",value:function(e,t,r){return this.data=e.slice(t,r),t+r}},{key:"toBER",value:function(){return this.data}}]),e}();function pe(e,t,r){var n=t;var i=new v({},Object),o=new a;if(!1===(0,yn.checkBufferParams)(o,e,t,r))return i.error=o.error,{offset:-1,result:i};if(0===new Uint8Array(e,t,r).length)return this.error="Zero buffer length",{offset:-1,result:i};var u=i.idBlock.fromBER(e,t,r);if(i.warnings.concat(i.idBlock.warnings),-1===u)return i.error=i.idBlock.error,{offset:-1,result:i};if(t=u,r-=i.idBlock.blockLength,u=i.lenBlock.fromBER(e,t,r),i.warnings.concat(i.lenBlock.warnings),-1===u)return i.error=i.lenBlock.error,{offset:-1,result:i};if(t=u,r-=i.lenBlock.blockLength,!1===i.idBlock.isConstructed&&!0===i.lenBlock.isIndefiniteForm)return i.error="Indefinite length form used for primitive encoding form",{offset:-1,result:i};var c=v;switch(i.idBlock.tagClass){case 1:if(i.idBlock.tagNumber>=37&&!1===i.idBlock.isHexOnly)return i.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:i};switch(i.idBlock.tagNumber){case 0:if(!0===i.idBlock.isConstructed&&i.lenBlock.length>0)return i.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:i};c=O;break;case 1:c=x;break;case 2:c=C;break;case 3:c=S;break;case 4:c=I;break;case 5:c=N;break;case 6:c=L;break;case 10:c=K;break;case 12:c=H;break;case 13:c=_;break;case 14:c=se;break;case 15:return i.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:i};case 16:c=j;break;case 17:c=B;break;case 18:c=z;break;case 19:c=W;break;case 20:c=Y;break;case 21:c=Z;break;case 22:c=$;break;case 23:c=ne;break;case 24:c=ae;break;case 25:c=Q;break;case 26:c=ee;break;case 27:c=te;break;case 28:c=F;break;case 29:c=re;break;case 30:c=V;break;case 31:c=ie;break;case 32:c=oe;break;case 33:c=ue;break;case 34:c=ce;break;default:var s;(s=!0===i.idBlock.isConstructed?new m:new b).idBlock=i.idBlock,s.lenBlock=i.lenBlock,s.warnings=i.warnings,u=(i=s).fromBER(e,t,r)}break;case 2:case 3:case 4:default:c=!0===i.idBlock.isConstructed?m:b}return u=(i=function(e,t){if(e instanceof t)return e;var r=new t;return r.idBlock=e.idBlock,r.lenBlock=e.lenBlock,r.warnings=e.warnings,r.valueBeforeDecode=e.valueBeforeDecode.slice(0),r}(i,c)).fromBER(e,t,!0===i.lenBlock.isIndefiniteForm?r:i.lenBlock.length),i.valueBeforeDecode=e.slice(n,n+i.blockLength),{offset:u,result:i}}function ye(e){if(0===e.byteLength){var t=new v({},Object);return t.error="Input buffer has zero length",{offset:-1,result:t}}return pe(e,0,e.byteLength)}function de(e,t,r){if(r instanceof le){for(var n=0;n<r.value.length;n++){if(!0===de(e,t,r.value[n]).verified)return{verified:!0,result:e}}var a={verified:!1,result:{error:"Wrong values for Choice type"}};return r.hasOwnProperty("name")&&(a.name=r.name),a}if(r instanceof fe)return r.hasOwnProperty("name")&&(e[r.name]=t),{verified:!0,result:e};if(e instanceof Object===!1)return{verified:!1,result:{error:"Wrong root object"}};if(t instanceof Object===!1)return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(r instanceof Object===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("idBlock"in r===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("fromBER"in r.idBlock===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("toBER"in r.idBlock===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};var i=r.idBlock.toBER(!1);if(0===i.byteLength)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(-1===r.idBlock.fromBER(i,0,i.byteLength))return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(!1===r.idBlock.hasOwnProperty("tagClass"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagClass!==t.idBlock.tagClass)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("tagNumber"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagNumber!==t.idBlock.tagNumber)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("isConstructed"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isConstructed!==t.idBlock.isConstructed)return{verified:!1,result:e};if("isHexOnly"in r.idBlock===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isHexOnly!==t.idBlock.isHexOnly)return{verified:!1,result:e};if(!0===r.idBlock.isHexOnly){if("valueHex"in r.idBlock===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};var o=new Uint8Array(r.idBlock.valueHex),u=new Uint8Array(t.idBlock.valueHex);if(o.length!==u.length)return{verified:!1,result:e};for(var c=0;c<o.length;c++)if(o[c]!==u[1])return{verified:!1,result:e}}if(r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(e[r.name]=t)),!0===r.idBlock.isConstructed){var s=0,l={verified:!1},f=r.valueBlock.value.length;if(f>0&&r.valueBlock.value[0]instanceof he&&(f=t.valueBlock.value.length),0===f)return{verified:!0,result:e};if(0===t.valueBlock.value.length&&0!==r.valueBlock.value.length){for(var h=!0,v=0;v<r.valueBlock.value.length;v++)h=h&&(r.valueBlock.value[v].optional||!1);return!0===h?{verified:!0,result:e}:(r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&delete e[r.name]),e.error="Inconsistent object length",{verified:!1,result:e})}for(var p=0;p<f;p++)if(p-s>=t.valueBlock.value.length){if(!1===r.valueBlock.value[p].optional){var y={verified:!1,result:e};return e.error="Inconsistent length between ASN.1 data and schema",r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(delete e[r.name],y.name=r.name)),y}}else if(r.valueBlock.value[0]instanceof he){if(!1===(l=de(e,t.valueBlock.value[p],r.valueBlock.value[0].value)).verified){if(!0!==r.valueBlock.value[0].optional)return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&delete e[r.name]),l;s++}if("name"in r.valueBlock.value[0]&&r.valueBlock.value[0].name.length>0){var d={};"undefined"===typeof(d="local"in r.valueBlock.value[0]&&!0===r.valueBlock.value[0].local?t:e)[r.valueBlock.value[0].name]&&(d[r.valueBlock.value[0].name]=[]),d[r.valueBlock.value[0].name].push(t.valueBlock.value[p])}}else if(!1===(l=de(e,t.valueBlock.value[p-s],r.valueBlock.value[p])).verified){if(!0!==r.valueBlock.value[p].optional)return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&delete e[r.name]),l;s++}if(!1===l.verified){var b={verified:!1,result:e};return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(delete e[r.name],b.name=r.name)),b}return{verified:!0,result:e}}if("primitiveSchema"in r&&"valueHex"in t.valueBlock){var g=ye(t.valueBlock.valueHex);if(-1===g.offset){var m={verified:!1,result:g.result};return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(delete e[r.name],m.name=r.name)),m}return de(e,g.result,r.primitiveSchema)}return{verified:!0,result:e}}t.RawData=ve})),bn=(hn=dn)&&hn.__esModule&&Object.prototype.hasOwnProperty.call(hn,"default")?hn.default:hn,gn=dn.fromBER,mn=dn.compareSchema,kn=dn.verifySchema,On=dn.fromJSON,wn=dn.RawData,xn=dn.Repeated,jn=dn.Any,Bn=dn.Choice,Nn=dn.TIME,En=dn.Duration,In=dn.DateTime,An=dn.TimeOfDay,Sn=dn.DATE,Dn=dn.GeneralizedTime,Cn=dn.UTCTime,Kn=dn.CharacterString,Tn=dn.GeneralString,Un=dn.VisibleString,Ln=dn.GraphicString,Xn=dn.IA5String,Hn=dn.VideotexString,Rn=dn.TeletexString,Pn=dn.PrintableString,_n=dn.NumericString,qn=dn.UniversalString,Vn=dn.BmpString,Jn=dn.RelativeObjectIdentifier,Fn=dn.Utf8String,Mn=dn.ObjectIdentifier,Gn=dn.Enumerated,zn=dn.Integer,Wn=dn.BitString,Yn=dn.OctetString,Zn=dn.Null,$n=dn.Set,Qn=dn.Sequence,ea=dn.Boolean,ta=dn.EndOfContent,ra=dn.Constructed,na=dn.Primitive,aa=dn.BaseBlock,ia=dn.ValueBlock,oa=dn.HexBlock,ua=Object.freeze({__proto__:null,default:bn,__moduleExports:dn,fromBER:gn,compareSchema:mn,verifySchema:kn,fromJSON:On,RawData:wn,Repeated:xn,Any:jn,Choice:Bn,TIME:Nn,Duration:En,DateTime:In,TimeOfDay:An,DATE:Sn,GeneralizedTime:Dn,UTCTime:Cn,CharacterString:Kn,GeneralString:Tn,VisibleString:Un,GraphicString:Ln,IA5String:Xn,VideotexString:Hn,TeletexString:Rn,PrintableString:Pn,NumericString:_n,UniversalString:qn,BmpString:Vn,RelativeObjectIdentifier:Jn,Utf8String:Fn,ObjectIdentifier:Mn,Enumerated:Gn,Integer:zn,BitString:Wn,OctetString:Yn,Null:Zn,Set:$n,Sequence:Qn,Boolean:ea,EndOfContent:ta,Constructed:ra,Primitive:na,BaseBlock:aa,ValueBlock:ia,HexBlock:oa});!function(e){e[e.Sequence=0]="Sequence",e[e.Set=1]="Set",e[e.Choice=2]="Choice"}(vn||(vn={})),function(e){e[e.Any=1]="Any",e[e.Boolean=2]="Boolean",e[e.OctetString=3]="OctetString",e[e.BitString=4]="BitString",e[e.Integer=5]="Integer",e[e.Enumerated=6]="Enumerated",e[e.ObjectIdentifier=7]="ObjectIdentifier",e[e.Utf8String=8]="Utf8String",e[e.BmpString=9]="BmpString",e[e.UniversalString=10]="UniversalString",e[e.NumericString=11]="NumericString",e[e.PrintableString=12]="PrintableString",e[e.TeletexString=13]="TeletexString",e[e.VideotexString=14]="VideotexString",e[e.IA5String=15]="IA5String",e[e.GraphicString=16]="GraphicString",e[e.VisibleString=17]="VisibleString",e[e.GeneralString=18]="GeneralString",e[e.CharacterString=19]="CharacterString",e[e.UTCTime=20]="UTCTime",e[e.GeneralizedTime=21]="GeneralizedTime",e[e.DATE=22]="DATE",e[e.TimeOfDay=23]="TimeOfDay",e[e.DateTime=24]="DateTime",e[e.Duration=25]="Duration",e[e.TIME=26]="TIME",e[e.Null=27]="Null"}(pn||(pn={}));var ca={fromASN:function(e){return e instanceof Zn?null:e.valueBeforeDecode},toASN:function(e){if(null===e)return new Zn;var t=gn(e);if(t.result.error)throw new Error(t.result.error);return t.result}},sa={fromASN:function(e){return e.valueBlock.valueHex.byteLength>4?e.valueBlock.toString():e.valueBlock.valueDec},toASN:function(e){return new zn({value:e})}},la={fromASN:function(e){return e.valueBlock.valueDec},toASN:function(e){return new Gn({value:e})}},fa={fromASN:function(e){return e.valueBlock.valueHex},toASN:function(e){return new Wn({valueHex:e})}},ha={fromASN:function(e){return e.valueBlock.toString()},toASN:function(e){return new Mn({value:e})}},va={fromASN:function(e){return e.valueBlock.value},toASN:function(e){return new ea({value:e})}},pa={fromASN:function(e){return e.valueBlock.valueHex},toASN:function(e){return new Yn({valueHex:e})}};function ya(e){return{fromASN:function(e){return e.valueBlock.value},toASN:function(t){return new e({value:t})}}}var da=ya(Fn),ba=ya(Vn),ga=ya(qn),ma=ya(_n),ka=ya(Pn),Oa=ya(Rn),wa=ya(Hn),xa=ya(Xn),ja=ya(Ln),Ba=ya(Un),Na=ya(Tn),Ea=ya(Kn),Ia={fromASN:function(e){return e.toDate()},toASN:function(e){return new Cn({valueDate:e})}},Aa={fromASN:function(e){return e.toDate()},toASN:function(e){return new Dn({valueDate:e})}},Sa={fromASN:function(e){return null},toASN:function(e){return new Zn}};function Da(e){switch(e){case pn.Any:return ca;case pn.BitString:return fa;case pn.BmpString:return ba;case pn.Boolean:return va;case pn.CharacterString:return Ea;case pn.Enumerated:return la;case pn.GeneralString:return Na;case pn.GeneralizedTime:return Aa;case pn.GraphicString:return ja;case pn.IA5String:return xa;case pn.Integer:return sa;case pn.Null:return Sa;case pn.NumericString:return ma;case pn.ObjectIdentifier:return ha;case pn.OctetString:return pa;case pn.PrintableString:return ka;case pn.TeletexString:return Oa;case pn.UTCTime:return Ia;case pn.UniversalString:return ga;case pn.Utf8String:return da;case pn.VideotexString:return wa;case pn.VisibleString:return Ba;default:return null}}function Ca(e){return e&&e.prototype?!(!e.prototype.toASN||!e.prototype.fromASN)||Ca(e.prototype):!!(e&&e.toASN&&e.fromASN)}function Ka(e,t){if(!e||!t)return!1;if(e.byteLength!==t.byteLength)return!1;for(var r=new Uint8Array(e),n=new Uint8Array(t),a=0;a<e.byteLength;a++)if(r[a]!==n[a])return!1;return!0}var Ta,Ua=new(function(){function e(){Object(p.a)(this,e),this.items=new WeakMap}return Object(y.a)(e,[{key:"has",value:function(e){return this.items.has(e)}},{key:"get",value:function(e){var t,r,n,a,i=this.items.get(e);if(!i)throw new Error("Cannot get schema for '".concat(null!==(a=null===(n=null===(r=null===(t=e)||void 0===t?void 0:t.prototype)||void 0===r?void 0:r.constructor)||void 0===n?void 0:n.name)&&void 0!==a?a:e,"' target"));return i}},{key:"cache",value:function(e){var t=this.get(e);t.schema||(t.schema=this.create(e,!0))}},{key:"createDefault",value:function(e){var t={type:vn.Sequence,items:{}},r=this.findParentSchema(e);return r&&(Object.assign(t,r),t.items=Object.assign({},t.items,r.items)),t}},{key:"create",value:function(e,t){var r=this.items.get(e)||this.createDefault(e),n=[];for(var a in r.items){var i=r.items[a],o=t?a:"",u=void 0;if("number"===typeof i.type){var c=pn[i.type],s=ua[c];if(!s)throw new Error("Cannot get ASN1 class by name '".concat(c,"'"));u=new s({name:o})}else if(Ca(i.type)){u=(new i.type).toSchema(o)}else if(i.optional){this.get(i.type).type===vn.Choice?u=new jn({name:o}):(u=this.create(i.type,!1)).name=o}else u=new jn({name:o});var l=!!i.optional||void 0!==i.defaultValue;if(i.repeated)u.name="",u=new("set"===i.repeated?$n:Qn)({name:"",value:[new xn({name:o,value:u})]});if(null!==i.context&&void 0!==i.context)if(i.implicit)if("number"===typeof i.type||Ca(i.type)){var f=i.repeated?ra:na;n.push(new f({name:o,optional:l,idBlock:{tagClass:3,tagNumber:i.context}}))}else{this.cache(i.type);var h=!!i.repeated,v=h?u:this.get(i.type).schema;v=v.valueBlock?v.valueBlock.value:v.value,n.push(new ra({name:h?"":o,optional:l,idBlock:{tagClass:3,tagNumber:i.context},value:v}))}else n.push(new ra({optional:l,idBlock:{tagClass:3,tagNumber:i.context},value:[u]}));else u.optional=l,n.push(u)}switch(r.type){case vn.Sequence:return new Qn({value:n,name:""});case vn.Set:return new $n({value:n,name:""});case vn.Choice:return new Bn({value:n,name:""});default:throw new Error("Unsupported ASN1 type in use")}}},{key:"set",value:function(e,t){return this.items.set(e,t),this}},{key:"findParentSchema",value:function(e){var t=e.__proto__;return t?this.items.get(t)||this.findParentSchema(t):null}}]),e}()),La=function(e){return function(t){var r;Ua.has(t)?r=Ua.get(t):(r=Ua.createDefault(t),Ua.set(t,r)),Object.assign(r,e)}},Xa=function(e){return function(t,r){var n;Ua.has(t.constructor)?n=Ua.get(t.constructor):(n=Ua.createDefault(t.constructor),Ua.set(t.constructor,n));var a=Object.assign({},e);if("number"===typeof a.type&&!a.converter){var i=Da(e.type);if(!i)throw new Error("Cannot get default converter for property '".concat(r,"' of ").concat(t.constructor.name));a.converter=i}n.items[r]=a}},Ha=function(){function e(){Object(p.a)(this,e)}return Object(y.a)(e,null,[{key:"serialize",value:function(e){return e instanceof aa?e.toBER(!1):this.toASN(e).toBER(!1)}},{key:"toASN",value:function(t){var r=this;if(t&&Ca(t.constructor))return t.toASN();var n=t.constructor,a=Ua.get(n);Ua.cache(n);var i,o=[];if(a.itemType)if("number"===typeof a.itemType){var u=Da(a.itemType);if(!u)throw new Error("Cannot get default converter for array item of ".concat(n.name," ASN1 schema"));o=t.map((function(e){return u.toASN(e)}))}else o=t.map((function(e){return r.toAsnItem({type:a.itemType},"[]",n,e)}));else for(var c in a.items){var s=a.items[c],l=t[c];if(!(void 0===l||s.defaultValue===l||"object"===typeof s.defaultValue&&"object"===typeof l&&Ka(this.serialize(s.defaultValue),this.serialize(l)))){var f=e.toAsnItem(s,c,n,l);if("number"===typeof s.context)if(s.implicit)if(s.repeated||"number"!==typeof s.type&&!Ca(s.type))o.push(new ra({optional:s.optional,idBlock:{tagClass:3,tagNumber:s.context},value:f.valueBlock.value}));else{var h={};h.valueHex=f.valueBlock.toBER(),o.push(new na(Object.assign({optional:s.optional,idBlock:{tagClass:3,tagNumber:s.context}},h)))}else o.push(new ra({optional:s.optional,idBlock:{tagClass:3,tagNumber:s.context},value:[f]}));else s.repeated?o=o.concat(f):o.push(f)}}switch(a.type){case vn.Sequence:i=new Qn({value:o});break;case vn.Set:i=new $n({value:o});break;case vn.Choice:if(!o[0])throw new Error("Schema '".concat(n.name,"' has wrong data. Choice cannot be empty."));i=o[0]}return i}},{key:"toAsnItem",value:function(e,t,r,n){var a,i=this;if("number"===typeof e.type){var o=e.converter;if(!o)throw new Error("Property '".concat(t,"' doesn't have converter for type ").concat(pn[e.type]," in schema '").concat(r.name,"'"));if(e.repeated){var u=Array.from(n,(function(e){return o.toASN(e)}));a=new("sequence"===e.repeated?Qn:$n)({value:u})}else a=o.toASN(n)}else if(e.repeated){var c=Array.from(n,(function(e){return i.toASN(e)}));a=new("sequence"===e.repeated?Qn:$n)({value:c})}else a=this.toASN(n);return a}}]),e}(),Ra=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(e,n){var a;return Object(p.a)(this,r),(a=t.call(this,n?"".concat(e,". See the inner exception for more details."):e)).message=e,a.innerError=n,a}return r}(Object(i.a)(Error)));function Pa(e,t){if(!function(e,t){switch(t){case Ta.Boolean:return"boolean"===typeof e;case Ta.Number:return"number"===typeof e;case Ta.String:return"string"===typeof e}return!0}(e,t))throw new TypeError("Value must be ".concat(Ta[t]))}function _a(e){return e&&e.prototype?!(!e.prototype.toJSON||!e.prototype.fromJSON)||_a(e.prototype):!!(e&&e.toJSON&&e.fromJSON)}!function(e){e[e.Any=0]="Any",e[e.Boolean=1]="Boolean",e[e.Number=2]="Number",e[e.String=3]="String"}(Ta||(Ta={}));var qa="default",Va=new(function(){function e(){Object(p.a)(this,e),this.items=new Map}return Object(y.a)(e,[{key:"has",value:function(e){return this.items.has(e)||!!this.findParentSchema(e)}},{key:"get",value:function(e){var t=this.items.get(e)||this.findParentSchema(e);if(!t)throw new Error("Cannot get schema for current target");return t}},{key:"create",value:function(e){var t={names:{}},r=this.findParentSchema(e);if(r)for(var n in Object.assign(t,r),t.names={},r.names)t.names[n]=Object.assign({},r.names[n]);return t.target=e,t}},{key:"set",value:function(e,t){return this.items.set(e,t),this}},{key:"findParentSchema",value:function(e){var t=e.__proto__;return t?this.items.get(t)||this.findParentSchema(t):null}}]),e}()),Ja=function(){function e(t){Object(p.a)(this,e),this.pattern=new RegExp(t)}return Object(y.a)(e,[{key:"validate",value:function(e){var t=new RegExp(this.pattern.source,this.pattern.flags);if("string"!==typeof e)throw new Ra("Incoming value must be string");if(!t.exec(e))throw new Ra("Value doesn't match to pattern '".concat(t.toString(),"'"))}}]),e}(),Fa=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.MIN_VALUE,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MAX_VALUE;Object(p.a)(this,e),this.min=t,this.max=r}return Object(y.a)(e,[{key:"validate",value:function(e){if(Pa(e,Ta.Number),!(this.min<=e&&e<=this.max)){var t=this.min===Number.MIN_VALUE?"MIN":this.min,r=this.max===Number.MAX_VALUE?"MAX":this.max;throw new Ra("Value doesn't match to diapason [".concat(t,",").concat(r,"]"))}}}]),e}(),Ma=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.MIN_VALUE,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MAX_VALUE;Object(p.a)(this,e),this.min=t,this.max=r}return Object(y.a)(e,[{key:"validate",value:function(e){if(Pa(e,Ta.Number),!(this.min<e&&e<this.max)){var t=this.min===Number.MIN_VALUE?"MIN":this.min,r=this.max===Number.MAX_VALUE?"MAX":this.max;throw new Ra("Value doesn't match to diapason (".concat(t,",").concat(r,")"))}}}]),e}(),Ga=function(){function e(t,r,n){Object(p.a)(this,e),this.length=t,this.minLength=r,this.maxLength=n}return Object(y.a)(e,[{key:"validate",value:function(e){if(void 0===this.length){if(void 0!==this.minLength&&e.length<this.minLength)throw new Ra("Value length must be more than ".concat(this.minLength,"."));if(void 0!==this.maxLength&&e.length>this.maxLength)throw new Ra("Value length must be less than ".concat(this.maxLength,"."))}else if(e.length!==this.length)throw new Ra("Value length must be exactly ".concat(this.length,"."))}}]),e}(),za=function(){function e(t){Object(p.a)(this,e),this.enumeration=t}return Object(y.a)(e,[{key:"validate",value:function(e){if(Pa(e,Ta.String),!this.enumeration.includes(e))throw new Ra("Value must be one of ".concat(this.enumeration.map((function(e){return"'".concat(e,"'")})).join(", ")))}}]),e}();function Wa(e){var t=[];return e.pattern&&t.push(new Ja(e.pattern)),e.type!==Ta.Number&&e.type!==Ta.Any||(void 0===e.minInclusive&&void 0===e.maxInclusive||t.push(new Fa(e.minInclusive,e.maxInclusive)),void 0===e.minExclusive&&void 0===e.maxExclusive||t.push(new Ma(e.minExclusive,e.maxExclusive)),void 0!==e.enumeration&&t.push(new za(e.enumeration))),(e.type===Ta.String||e.repeated||e.type===Ta.Any)&&(void 0===e.length&&void 0===e.minLength&&void 0===e.maxLength||t.push(new Ga(e.length,e.minLength,e.maxLength))),t}var Ya=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,r){var n,a="Cannot set type for ".concat(r," property of ").concat(t.constructor.name," schema");Va.has(t.constructor)?(n=Va.get(t.constructor)).target!==t.constructor&&(n=Va.create(t.constructor),Va.set(t.constructor,n)):(n=Va.create(t.constructor),Va.set(t.constructor,n));var i,o={type:Ta.Any,validations:[]},u=Object.assign(o,e);if(u.validations=Wa(u),"number"!==typeof u.type&&!Va.has(u.type)&&!_a(u.type))throw new Error("".concat(a,". Assigning type doesn't have schema."));i=Array.isArray(e.schema)?e.schema:[e.schema||qa];var c,s=Object(v.a)(i);try{for(s.s();!(c=s.n()).done;){var l=c.value;n.names[l]||(n.names[l]={}),n.names[l][r]=u}}catch(f){s.e(f)}finally{s.f()}}},Za=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){return Object(p.a)(this,r),t.apply(this,arguments)}return r}(Object(i.a)(Error)),$a=function(){function e(){Object(p.a)(this,e)}return Object(y.a)(e,null,[{key:"toArrayBuffer",value:function(e){var t=e.replace(/-{5}(BEGIN|END) .*-{5}/g,"").replace("\r","").replace("\n","");return w.FromBase64(t)}},{key:"toUint8Array",value:function(e){var t=this.toArrayBuffer(e);return new Uint8Array(t)}},{key:"fromBufferSource",value:function(e,t){for(var r,n=w.ToBase64(e),a=0,i=[];(r=n.slice(a,a+=64)).length&&(i.push(r),!(r.length<64)););var o=t.toUpperCase();return"-----BEGIN ".concat(o,"-----\n").concat(i.join("\n"),"\n-----END ").concat(o,"-----")}},{key:"isPEM",value:function(e){return/-----BEGIN .+-----[A-Za-z0-9+\/\+\=\s\n]+-----END .+-----/i.test(e)}},{key:"getTagName",value:function(e){if(!this.isPEM(e))throw new Error("Bad parameter. Incoming data is not right PEM");var t=/-----BEGIN (.+)-----/.exec(e);if(!t)throw new Error("Cannot get tag from PEM");return t[1]}},{key:"hasTagName",value:function(e,t){var r=this.getTagName(e);return t.toLowerCase()===r.toLowerCase()}},{key:"isCertificate",value:function(e){return this.hasTagName(e,"certificate")}},{key:"isCertificateRequest",value:function(e){return this.hasTagName(e,"certificate request")}},{key:"isCRL",value:function(e){return this.hasTagName(e,"x509 crl")}},{key:"isPublicKey",value:function(e){return this.hasTagName(e,"public key")}}]),e}(),Qa=function e(t){Object(p.a)(this,e),t&&(this.value=t)};Ae([Xa({type:pn.ObjectIdentifier})],Qa.prototype,"value",void 0),Qa=Ae([La({type:vn.Choice})],Qa);var ei=function e(t){Object(p.a)(this,e),Object.assign(this,t)};Ae([Xa({type:pn.ObjectIdentifier})],ei.prototype,"algorithm",void 0),Ae([Xa({type:pn.Any,optional:!0})],ei.prototype,"parameters",void 0);var ti=function e(){Object(p.a)(this,e),this.version=0,this.privateKeyAlgorithm=new ei,this.privateKey=new ArrayBuffer(0)};Ae([Xa({type:pn.Integer})],ti.prototype,"version",void 0),Ae([Xa({type:ei})],ti.prototype,"privateKeyAlgorithm",void 0),Ae([Xa({type:pn.OctetString})],ti.prototype,"privateKey",void 0),Ae([Xa({type:pn.Any,optional:!0})],ti.prototype,"attributes",void 0);var ri=function e(){Object(p.a)(this,e),this.publicKeyAlgorithm=new ei,this.publicKey=new ArrayBuffer(0)};Ae([Xa({type:ei})],ri.prototype,"publicKeyAlgorithm",void 0),Ae([Xa({type:pn.BitString})],ri.prototype,"publicKey",void 0);var ni={fromJSON:function(e){return w.FromBase64Url(e)},toJSON:function(e){return w.ToBase64Url(new Uint8Array(e))}},ai={fromASN:function(e){var t=e.valueBlock.valueHex;return new Uint8Array(t)[0]?e.valueBlock.valueHex:e.valueBlock.valueHex.slice(1)},toASN:function(e){var t=new Uint8Array(e)[0]>127?Buffer.concat([Buffer.from([0]),Buffer.from(e)]):Buffer.from(e);return new zn({valueHex:new Uint8Array(t).buffer})}},ii=Object.freeze({__proto__:null,JsonBase64UrlArrayBufferConverter:ni,AsnIntegerArrayBufferConverter:ai}),oi=function e(){Object(p.a)(this,e),this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0)};Ae([Xa({type:pn.Integer,converter:sa})],oi.prototype,"version",void 0),Ae([Xa({type:pn.Integer,converter:ai}),Ya({name:"n",converter:ni})],oi.prototype,"modulus",void 0),Ae([Xa({type:pn.Integer,converter:ai}),Ya({name:"e",converter:ni})],oi.prototype,"publicExponent",void 0),Ae([Xa({type:pn.Integer,converter:ai}),Ya({name:"d",converter:ni})],oi.prototype,"privateExponent",void 0),Ae([Xa({type:pn.Integer,converter:ai}),Ya({name:"p",converter:ni})],oi.prototype,"prime1",void 0),Ae([Xa({type:pn.Integer,converter:ai}),Ya({name:"q",converter:ni})],oi.prototype,"prime2",void 0),Ae([Xa({type:pn.Integer,converter:ai}),Ya({name:"dp",converter:ni})],oi.prototype,"exponent1",void 0),Ae([Xa({type:pn.Integer,converter:ai}),Ya({name:"dq",converter:ni})],oi.prototype,"exponent2",void 0),Ae([Xa({type:pn.Integer,converter:ai}),Ya({name:"qi",converter:ni})],oi.prototype,"coefficient",void 0),Ae([Xa({type:pn.Any,optional:!0})],oi.prototype,"otherPrimeInfos",void 0);var ui=function e(){Object(p.a)(this,e),this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0)};Ae([Xa({type:pn.Integer,converter:ai}),Ya({name:"n",converter:ni})],ui.prototype,"modulus",void 0),Ae([Xa({type:pn.Integer,converter:ai}),Ya({name:"e",converter:ni})],ui.prototype,"publicExponent",void 0);var ci=function(){function e(t){Object(p.a)(this,e),this.value=new ArrayBuffer(0),t&&(this.value=t)}return Object(y.a)(e,[{key:"toJSON",value:function(){var e=new Uint8Array(this.value);if(4!==e[0])throw new Za("Wrong ECPoint. Current version supports only Uncompressed (0x04) point");var t=(e=new Uint8Array(this.value.slice(1))).length/2;return{x:w.ToBase64Url(e.buffer.slice(0,0+t)),y:w.ToBase64Url(e.buffer.slice(0+t,0+t+t))}}},{key:"fromJSON",value:function(e){if(!("x"in e))throw new Error("x: Missing required property");if(!("y"in e))throw new Error("y: Missing required property");var t=w.FromBase64Url(e.x),r=w.FromBase64Url(e.y),n=Buffer.concat([new Uint8Array([4]),new Uint8Array(t),new Uint8Array(r)]);return this.value=new Uint8Array(n).buffer,this}}]),e}();Ae([Xa({type:pn.OctetString})],ci.prototype,"value",void 0),ci=Ae([La({type:vn.Choice})],ci);var si=function(){function e(){Object(p.a)(this,e),this.version=1,this.privateKey=new ArrayBuffer(0)}return Object(y.a)(e,[{key:"fromJSON",value:function(e){if(!("d"in e))throw new Error("d: Missing required property");if(this.privateKey=w.FromBase64Url(e.d),"x"in e){var t=new ci;t.fromJSON(e),this.publicKey=Ha.toASN(t).valueBlock.valueHex}return this}},{key:"toJSON",value:function(){var e={};return e.d=w.ToBase64Url(this.privateKey),this.publicKey&&Object.assign(e,new ci(this.publicKey).toJSON()),e}}]),e}();Ae([Xa({type:pn.Integer,converter:sa})],si.prototype,"version",void 0),Ae([Xa({type:pn.OctetString})],si.prototype,"privateKey",void 0),Ae([Xa({context:0,type:pn.Any,optional:!0})],si.prototype,"parameters",void 0),Ae([Xa({context:1,type:pn.BitString,optional:!0})],si.prototype,"publicKey",void 0);var li={fromASN:function(e){var t=new Uint8Array(e.valueBlock.valueHex);return 0===t[0]?t.buffer.slice(1):t.buffer},toASN:function(e){var t=new Uint8Array(e);if(t[0]>127){var r=new Uint8Array(t.length+1);return r.set(t,1),new zn({valueHex:r.buffer})}return new zn({valueHex:e})}},fi=Object.freeze({__proto__:null,AsnIntegerWithoutPaddingConverter:li}),hi=function(){function e(){Object(p.a)(this,e),this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0)}return Object(y.a)(e,[{key:"toWebCryptoSignature",value:function(e){e=this.getPointSize();var t=this.addPadding(e,k.toUint8Array(this.r)),r=this.addPadding(e,k.toUint8Array(this.s)),n=new Uint8Array(t.byteLength+r.byteLength);return n.set(t,0),n.set(r,t.length),n.buffer}},{key:"getPointSize",value:function(){switch(Math.max(this.r.byteLength,this.s.byteLength)){case 31:case 32:return 32;case 47:case 48:return 48;case 65:case 66:return 66}throw new Error("Unsupported EC point size")}},{key:"addPadding",value:function(e,t){var r=new Uint8Array(e),n=k.toUint8Array(t);return r.set(n,e-n.length),r}},{key:"removePadding",value:function(e){for(var t=k.toUint8Array(e),r=0;r<t.length;r++)if(t[r])return t.slice(r);return new Uint8Array(0)}}],[{key:"fromWebCryptoSignature",value:function(e){var t=k.toUint8Array(e),r=t.byteLength/2,n=new this;return n.r=n.removePadding(t.slice(0,r)),n.s=n.removePadding(t.slice(r,2*r)),n}}]),e}();Ae([Xa({type:pn.Integer,converter:li})],hi.prototype,"r",void 0),Ae([Xa({type:pn.Integer,converter:li})],hi.prototype,"s",void 0);var vi=function e(){Object(p.a)(this,e)};Ae([Xa({type:pn.OctetString}),Ya({type:Ta.String,converter:ni})],vi.prototype,"d",void 0),vi=Ae([La({type:vn.Choice})],vi);function pi(e){if(e instanceof Fe)return e;var t,r=new Fe;if("string"===typeof e)r.fromAlgorithm({name:e});else if((t=e)instanceof Object&&"name"in t&&"hash"in t){var a=Object(n.a)({},e);a.hash=pi(e.hash),r.fromAlgorithm(a)}else r.fromAlgorithm(Object(n.a)({},e));return r}function yi(e,t){if(!e||"object"!==typeof e&&"string"!==typeof e)throw new TypeError("".concat(t,": Is wrong type. Must be Object or String"));if("object"===typeof e&&!("name"in e))throw new TypeError("".concat(t,": Required property 'name' is missed"))}function di(e,t){if(!function(e){return e instanceof ze}(e))throw new TypeError("".concat(t,": Is not type CryptoKey"))}function bi(e,t){if(!function(e){return e instanceof It}(e))throw new TypeError("".concat(t,": Is not type CryptoCertificate"))}function gi(e,t){if(!k.isBufferSource(e))throw new TypeError("".concat(t,": Is wrong type. Must be ArrayBuffer or ArrayBuffer view"))}function mi(e,t){if(!Array.isArray(e))throw new TypeError("".concat(t,": Is not type Array"))}function ki(e,t,r){if(typeof e!==t)throw new TypeError("".concat(r,": Is not type '").concat(t,"'"))}Object.freeze({__proto__:null,converters:fi,get ObjectIdentifier(){return Qa},AlgorithmIdentifier:ei,PrivateKeyInfo:ti,PublicKeyInfo:ri,RsaPrivateKey:oi,RsaPublicKey:ui,EcPrivateKey:si,get EcPublicKey(){return ci},EcDsaSignature:hi,get CurvePrivateKey(){return vi},idX25519:"1.3.101.110",idX448:"1.3.101.111",idEd25519:"1.3.101.112",idEd448:"1.3.101.113"}),Object.freeze({__proto__:null,converters:ii});var Oi=["raw","pem","x509","request"],wi=function(){function e(t){Object(p.a)(this,e),this.provider=t}return Object(y.a)(e,[{key:"indexOf",value:function(){var e=Object(h.a)(f.mark((function e(t){var r,n;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return bi(t,"item"),(r=new _t).providerID=this.provider.id,r.item=t,e.next=6,this.provider.client.send(r);case 6:return n=e.sent,e.abrupt("return",n?w.ToUtf8String(n):null);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hasItem",value:function(){var e=Object(h.a)(f.mark((function e(t){var r;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.indexOf(t);case 2:return r=e.sent,e.abrupt("return",!!r);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"exportCert",value:function(){var e=Object(h.a)(f.mark((function e(t,r){var n,a,i,o;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ki(t,"string","format"),bi(r,"item"),(n=new Pt).providerID=this.provider.id,n.format="raw",n.item=r,e.next=8,this.provider.client.send(n);case 8:if(a=e.sent,"raw"!==t){e.next=13;break}return e.abrupt("return",a);case 13:i="",e.t0=r.type,e.next="x509"===e.t0?17:"request"===e.t0?19:21;break;case 17:return i="CERTIFICATE",e.abrupt("break",22);case 19:return i="CERTIFICATE REQUEST",e.abrupt("break",22);case 21:throw new Error("Cannot create PEM for unknown type of certificate item");case 22:return o=$a.fromBufferSource(a,i),e.abrupt("return",o);case 24:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"importCert",value:function(){var e=Object(h.a)(f.mark((function e(t,r,n,a){var i,o,u,c,s;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ki(t,"string","format"),~Oi.indexOf(t)){e.next=3;break}throw new TypeError("format: Is invalid value. Must be ".concat(Oi.join(", ")));case 3:if("pem"===t?ki(r,"string","data"):gi(r,"data"),yi(n,"algorithm"),mi(a,"keyUsages"),i=pi(n),!k.isBufferSource(r)){e.next=11;break}o=k.toArrayBuffer(r),e.next=16;break;case 11:if("string"!==typeof r){e.next=15;break}o=$a.toArrayBuffer(r),e.next=16;break;case 15:throw new TypeError("data: Is not type String, ArrayBuffer or ArrayBufferView");case 16:return(u=new Rt).providerID=this.provider.id,u.format="raw",u.data=o,u.algorithm=i,u.keyUsages=a,e.next=24,this.provider.client.send(u);case 24:return c=e.sent,e.next=27,It.importProto(c);case 27:if(s=e.sent,"request"!==t&&"x509"!==t||s.type===t){e.next=30;break}throw new TypeError("Imported item is not ".concat(t));case 30:return e.abrupt("return",this.prepareCertItem(s));case 31:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a){return e.apply(this,arguments)}}()},{key:"keys",value:function(){var e=Object(h.a)(f.mark((function e(){var t,r,n;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new Ut).providerID=this.provider.id,e.next=4,this.provider.client.send(t);case 4:if(!(r=e.sent)){e.next=8;break}return n=w.ToUtf8String(r).split(","),e.abrupt("return",n);case 8:return e.abrupt("return",[]);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getValue",value:function(){var e=Object(h.a)(f.mark((function e(t){var r,n;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ki(t,"string","key"),(r=new Lt).providerID=this.provider.id,r.key=t,e.next=6,this.provider.client.send(r);case 6:if(!(n=e.sent)){e.next=9;break}return e.abrupt("return",n);case 9:return e.abrupt("return",null);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getItem",value:function(){var e=Object(h.a)(f.mark((function e(t,r,n){var a,i,o;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ki(t,"string","key"),r&&(yi(r,"algorithm"),mi(n,"keyUsages")),(a=new Tt).providerID=this.provider.id,a.key=t,r&&(a.algorithm=pi(r),a.keyUsages=n),e.next=8,this.provider.client.send(a);case 8:if(!(i=e.sent)||!i.byteLength){e.next=14;break}return e.next=12,It.importProto(i);case 12:return o=e.sent,e.abrupt("return",this.prepareCertItem(o));case 14:throw new Error("Cannot get CryptoCertificate from storage by index");case 15:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"setItem",value:function(){var e=Object(h.a)(f.mark((function e(t){var r,n;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return bi(t,"value"),(r=new Kt).providerID=this.provider.id,r.item=t,e.next=6,this.provider.client.send(r);case 6:return n=e.sent,e.abrupt("return",w.ToUtf8String(n));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"removeItem",value:function(){var e=Object(h.a)(f.mark((function e(t){var r;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ki(t,"string","key"),(r=new Xt).providerID=this.provider.id,r.key=t,e.next=6,this.provider.client.send(r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"clear",value:function(){var e=Object(h.a)(f.mark((function e(){var t;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new Ht).providerID=this.provider.id,e.next=4,this.provider.client.send(t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getChain",value:function(){var e=Object(h.a)(f.mark((function e(t){var r,n,a;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return bi(t,"value"),(r=new qt).providerID=this.provider.id,r.item=t,e.next=6,this.provider.client.send(r);case 6:return n=e.sent,e.next=9,Ct.importProto(n);case 9:return a=e.sent,e.abrupt("return",a.items);case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getCRL",value:function(){var e=Object(h.a)(f.mark((function e(t){var r,n;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ki(t,"string","url"),(r=new Vt).providerID=this.provider.id,r.url=t,e.next=6,this.provider.client.send(r);case 6:return n=e.sent,e.abrupt("return",n);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getOCSP",value:function(){var e=Object(h.a)(f.mark((function e(t,r,n){var a,i,o;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ki(t,"string","url"),gi(r,"request"),(a=new Wt).providerID=this.provider.id,a.url=t,a.request=k.toArrayBuffer(r),n)for(i in n)a.options[i]=n[i];return e.next=9,this.provider.client.send(a);case 9:return o=e.sent,e.abrupt("return",o);case 11:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"findPrivateKey",value:function(){var e=Object(h.a)(f.mark((function e(t){var r,n,i,o,u;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=4;break}e.t0=t,e.next=7;break;case 4:return e.next=6,this.provider.certStorage.indexOf(t);case 6:e.t0=e.sent;case 7:return(r=e.t0)||(r=""),n=r.split("-"),i=Object(a.a)(n,3),o=i[2],e.next=12,this.provider.keyStorage.keys();case 12:if(u=e.sent.find((function(e){var t=e.split("-"),r=Object(a.a)(t,3),n=r[0],i=r[2];return"private"===n&&i===o}))){e.next=15;break}return e.abrupt("return",null);case 15:return e.next=17,this.provider.keyStorage.getItem(u);case 17:return e.abrupt("return",e.sent);case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"prepareCertItem",value:function(){var e=Object(h.a)(f.mark((function e(t){var r,n;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.exportProto();case 2:r=e.sent,e.t0=t.type,e.next="x509"===e.t0?6:"request"===e.t0?10:14;break;case 6:return e.next=8,At.importProto(r);case 8:return n=e.sent,e.abrupt("break",15);case 10:return e.next=12,St.importProto(r);case 12:return n=e.sent,e.abrupt("break",15);case 14:throw new Error("Unsupported CertificateItem type '".concat(t.type,"'"));case 15:return n.provider=this.provider,e.abrupt("return",n);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"isX509Certificate",value:function(e){return e instanceof At}},{key:"isCertificateRequest",value:function(e){return e instanceof St}}]),e}(),xi=function(){function e(t){Object(p.a)(this,e),this.service=t}return Object(y.a)(e,[{key:"keys",value:function(){var e=Object(h.a)(f.mark((function e(){var t,r,n;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new $t).providerID=this.service.id,e.next=4,this.service.client.send(t);case 4:if(!(r=e.sent)){e.next=8;break}return n=w.ToUtf8String(r).split(","),e.abrupt("return",n);case 8:return e.abrupt("return",[]);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"indexOf",value:function(){var e=Object(h.a)(f.mark((function e(t){var r,n;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return di(t,"item"),(r=new ur).providerID=this.service.id,r.item=t,e.next=6,this.service.client.send(r);case 6:return n=e.sent,e.abrupt("return",n?w.ToUtf8String(n):null);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"hasItem",value:function(){var e=Object(h.a)(f.mark((function e(t){var r;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.indexOf(t);case 2:return r=e.sent,e.abrupt("return",!!r);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getItem",value:function(){var e=Object(h.a)(f.mark((function e(t,r,n,a){var i,o,u;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ki(t,"string","key"),r&&(yi(r,"algorithm"),ki(n,"boolean","extractable"),mi(a,"usages")),(i=new Zt).providerID=this.service.id,i.key=t,r&&(i.algorithm=pi(r),i.extractable=n,i.keyUsages=a),e.next=8,this.service.client.send(i);case 8:if(!(o=e.sent)||!o.byteLength){e.next=15;break}return e.next=12,ze.importProto(o);case 12:u=e.sent,e.next=16;break;case 15:throw new Error("Cannot get CryptoKey from key storage by index");case 16:return e.abrupt("return",u);case 17:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a){return e.apply(this,arguments)}}()},{key:"setItem",value:function(){var e=Object(h.a)(f.mark((function e(t){var r,n;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return di(t,"value"),(r=new Yt).providerID=this.service.id,r.item=t,e.next=6,this.service.client.send(r);case 6:return n=e.sent,e.abrupt("return",w.ToUtf8String(n));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"removeItem",value:function(){var e=Object(h.a)(f.mark((function e(t){var r;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ki(t,"string","key"),(r=new Qt).providerID=this.service.id,r.key=t,e.next=6,this.service.client.send(r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"clear",value:function(){var e=Object(h.a)(f.mark((function e(){var t;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new er).providerID=this.service.id,e.next=4,this.service.client.send(t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),ji=function(){function e(t){Object(p.a)(this,e),this.service=t}return Object(y.a)(e,[{key:"encrypt",value:function(){var e=Object(h.a)(f.mark((function e(t,r,n){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.encryptData(t,r,n,"encrypt"));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"decrypt",value:function(){var e=Object(h.a)(f.mark((function e(t,r,n){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.encryptData(t,r,n,"decrypt"));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"deriveBits",value:function(){var e=Object(h.a)(f.mark((function e(t,r,n){var a,i,o;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return yi(t,"algorithm"),di(r,"baseKey"),ki(n,"number","length"),di((a=pi(t)).public,"algorithm.public"),e.next=7,a.public.exportProto();case 7:return a.public=e.sent,(i=new Cr).providerID=this.service.id,i.algorithm=a,i.key=r,i.length=n,e.next=15,this.service.client.send(i);case 15:return o=e.sent,e.abrupt("return",o);case 17:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"deriveKey",value:function(){var e=Object(h.a)(f.mark((function e(t,r,n,a,i){var o,u,c,s;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return yi(t,"algorithm"),di(r,"baseKey"),yi(n,"algorithm"),ki(a,"boolean","extractable"),mi(i,"keyUsages"),di((o=pi(t)).public,"algorithm.public"),e.next=9,o.public.exportProto();case 9:return o.public=e.sent,u=pi(n),(c=new Kr).providerID=this.service.id,c.algorithm=o,c.derivedKeyType.fromAlgorithm(u),c.key=r,c.extractable=a,c.usage=i,e.next=20,this.service.client.send(c);case 20:return s=e.sent,e.next=23,ze.importProto(s);case 23:return e.abrupt("return",e.sent);case 24:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,i){return e.apply(this,arguments)}}()},{key:"digest",value:function(){var e=Object(h.a)(f.mark((function e(t,r){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",$().crypto.subtle.digest(t,r));case 1:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"generateKey",value:function(){var e=Object(h.a)(f.mark((function e(t,r,n){var a,i,o,u,c;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return yi(t,"algorithm"),ki(r,"boolean","extractable"),mi(n,"keyUsages"),a=pi(t),(i=new Er).providerID=this.service.id,i.algorithm=a,i.extractable=r,i.usage=n,e.next=11,this.service.client.send(i);case 11:return o=e.sent,e.prev=12,e.next=15,We.importProto(o);case 15:return u=e.sent,e.abrupt("return",u);case 19:return e.prev=19,e.t0=e.catch(12),e.next=23,ze.importProto(o);case 23:return c=e.sent,e.abrupt("return",c);case 25:case"end":return e.stop()}}),e,this,[[12,19]])})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"exportKey",value:function(){var e=Object(h.a)(f.mark((function e(t,r){var n,a;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ki(t,"string","format"),di(r,"key"),(n=new Lr).providerID=this.service.id,n.format=t,n.key=r,e.next=8,this.service.client.send(n);case 8:if(a=e.sent,"jwk"!==t){e.next=13;break}return e.abrupt("return",JSON.parse(w.ToBinary(a)));case 13:return e.abrupt("return",a);case 14:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"importKey",value:function(){var e=Object(h.a)(f.mark((function e(t,r,n,a,i){var o,u,c,s;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ki(t,"string","format"),yi(n,"algorithm"),ki(a,"boolean","extractable"),mi(i,"keyUsages"),o=pi(n),"jwk"===t?u=w.FromUtf8String(JSON.stringify(r)):(gi(r,"keyData"),u=k.toArrayBuffer(r)),(c=new Xr).providerID=this.service.id,c.algorithm=o,c.keyData=u,c.format=t,c.extractable=a,c.keyUsages=i,e.next=15,this.service.client.send(c);case 15:return s=e.sent,e.next=18,ze.importProto(s);case 18:return e.abrupt("return",e.sent);case 19:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,i){return e.apply(this,arguments)}}()},{key:"sign",value:function(){var e=Object(h.a)(f.mark((function e(t,r,n){var a,i,o,u;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return yi(t,"algorithm"),di(r,"key"),gi(n,"data"),a=pi(t),i=k.toArrayBuffer(n),(o=new Ir).providerID=this.service.id,o.algorithm=a,o.key=r,o.data=i,e.next=12,this.service.client.send(o);case 12:return u=e.sent,e.abrupt("return",u);case 14:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"verify",value:function(){var e=Object(h.a)(f.mark((function e(t,r,n,a){var i,o,u,c,s;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return yi(t,"algorithm"),di(r,"key"),gi(n,"signature"),gi(a,"data"),i=pi(t),o=k.toArrayBuffer(n),u=k.toArrayBuffer(a),(c=new Ar).providerID=this.service.id,c.algorithm=i,c.key=r,c.data=u,c.signature=o,e.next=15,this.service.client.send(c);case 15:return s=e.sent,e.abrupt("return",!!new Uint8Array(s)[0]);case 17:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a){return e.apply(this,arguments)}}()},{key:"wrapKey",value:function(){var e=Object(h.a)(f.mark((function e(t,r,n,a){var i,o,u;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ki(t,"string","format"),di(r,"key"),di(n,"wrappingKey"),yi(a,"wrapAlgorithm"),i=pi(a),(o=new Ur).providerID=this.service.id,o.wrapAlgorithm=i,o.key=r,o.wrappingKey=n,o.format=t,e.next=13,this.service.client.send(o);case 13:return u=e.sent,e.abrupt("return",u);case 15:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a){return e.apply(this,arguments)}}()},{key:"unwrapKey",value:function(){var e=Object(h.a)(f.mark((function e(t,r,n,a,i,o,u){var c,s,l,h,v;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ki(t,"string","format"),gi(r,"wrappedKey"),di(n,"unwrappingKey"),yi(a,"unwrapAlgorithm"),yi(i,"unwrappedKeyAlgorithm"),ki(o,"boolean","extractable"),mi(u,"keyUsages"),c=pi(a),s=pi(i),l=k.toArrayBuffer(r),(h=new Tr).providerID=this.service.id,h.format=t,h.unwrapAlgorithm=c,h.unwrappedKeyAlgorithm=s,h.unwrappingKey=n,h.wrappedKey=l,h.extractable=o,h.keyUsage=u,e.next=21,this.service.client.send(h);case 21:return v=e.sent,e.next=24,ze.importProto(v);case 24:return e.abrupt("return",e.sent);case 25:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a,i,o,u){return e.apply(this,arguments)}}()},{key:"encryptData",value:function(){var e=Object(h.a)(f.mark((function e(t,r,n,a){var i,o,u,c;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return yi(t,"algorithm"),di(r,"key"),gi(n,"data"),i=pi(t),o=k.toArrayBuffer(n),(u=new("encrypt"===a?Sr:Dr)).providerID=this.service.id,u.algorithm=i,u.key=r,u.data=o,e.next=13,this.service.client.send(u);case 13:return c=e.sent,e.abrupt("return",c);case 15:case"end":return e.stop()}}),e,this)})));return function(t,r,n,a){return e.apply(this,arguments)}}()}]),e}(),Bi=function(){function e(t,r){Object(p.a)(this,e),this.client=t,this.id=r,this.subtle=new ji(this),this.keyStorage=new xi(this),this.certStorage=new wi(this)}return Object(y.a)(e,[{key:"getRandomValues",value:function(e){return $().crypto.getRandomValues(e)}},{key:"login",value:function(){var e=Object(h.a)(f.mark((function e(){var t;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new st).providerID=this.id,e.abrupt("return",this.client.send(t));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=Object(h.a)(f.mark((function e(){var t;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new lt).providerID=this.id,e.abrupt("return",this.client.send(t));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"reset",value:function(){var e=Object(h.a)(f.mark((function e(){var t;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new Et).providerID=this.id,e.abrupt("return",this.client.send(t));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isLoggedIn",value:function(){var e=Object(h.a)(f.mark((function e(){var t,r;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new ft).providerID=this.id,e.next=4,this.client.send(t);case 4:return r=e.sent,e.abrupt("return",!!new Uint8Array(r)[0]);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),Ni=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this)).client=new an(e.storage),n.cardReader=new Hr(n.client),n}return Object(y.a)(r,[{key:"state",get:function(){return this.client.state}},{key:"connect",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.FORTIFY,n=arguments.length>1?arguments[1]:void 0;return this.removeAllListeners(),this.client.connect(t,n).on("error",(function(t){e.emit("error",t.error)})).on("event",(function(t){Object(h.a)(f.mark((function r(){var n,a;return f.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:r.t0=t.action,r.next=r.t0===Br.ACTION?3:r.t0===pr.ACTION?11:19;break;case 3:return r.t1=Br,r.next=6,t.exportProto();case 6:return r.t2=r.sent,r.next=9,r.t1.importProto.call(r.t1,r.t2);case 9:n=r.sent,e.emit("token",n);case 11:return r.t3=pr,r.next=14,t.exportProto();case 14:return r.t4=r.sent,r.next=17,r.t3.importProto.call(r.t3,r.t4);case 17:a=r.sent,e.emit("auth",a);case 19:case"end":return r.stop()}}),r)})))()})).on("listening",(function(r){e.emit("listening",t)})).on("close",(function(t){e.emit("close",t.remoteAddress)})),this}},{key:"close",value:function(){this.client.close()}},{key:"on",value:function(e,t){return console.log("SocketProvider:on",e),Object(u.a)(Object(c.a)(r.prototype),"on",this).call(this,e,t)}},{key:"once",value:function(e,t){return Object(u.a)(Object(c.a)(r.prototype),"once",this).call(this,e,t)}},{key:"info",value:function(){var e=Object(h.a)(f.mark((function e(){var t,r,n;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new hr,e.next=3,this.client.send(t);case 3:return r=e.sent,e.next=6,fr.importProto(r);case 6:return n=e.sent,e.abrupt("return",n);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"challenge",value:function(){var e=Object(h.a)(f.mark((function e(){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.client.challenge());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isLoggedIn",value:function(){var e=Object(h.a)(f.mark((function e(){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.client.isLoggedIn());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=Object(h.a)(f.mark((function e(){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.client.login());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCrypto",value:function(){var e=Object(h.a)(f.mark((function e(t){var r;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=new vr).cryptoID=t,e.next=4,this.client.send(r);case 4:return e.abrupt("return",new Bi(this.client,t));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(C);Ni.FORTIFY="127.0.0.1:31337";var Ei=function e(){Object(p.a)(this,e)},Ii=on((function(e){!function(){function t(e){return Array.prototype.slice.call(e)}function r(e){return new Promise((function(t,r){e.onsuccess=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function n(e,t,n){var a,i=new Promise((function(i,o){r(a=e[t].apply(e,n)).then(i,o)}));return i.request=a,i}function a(e,t,r){var a=n(e,t,r);return a.then((function(e){if(e)return new l(e,a.request)}))}function i(e,t,r){r.forEach((function(r){Object.defineProperty(e.prototype,r,{get:function(){return this[t][r]},set:function(e){this[t][r]=e}})}))}function o(e,t,r,a){a.forEach((function(a){a in r.prototype&&(e.prototype[a]=function(){return n(this[t],a,arguments)})}))}function u(e,t,r,n){n.forEach((function(n){n in r.prototype&&(e.prototype[n]=function(){return this[t][n].apply(this[t],arguments)})}))}function c(e,t,r,n){n.forEach((function(n){n in r.prototype&&(e.prototype[n]=function(){return a(this[t],n,arguments)})}))}function s(e){this._index=e}function l(e,t){this._cursor=e,this._request=t}function f(e){this._store=e}function h(e){this._tx=e,this.complete=new Promise((function(t,r){e.oncomplete=function(){t()},e.onerror=function(){r(e.error)},e.onabort=function(){r(e.error)}}))}function v(e,t,r){this._db=e,this.oldVersion=t,this.transaction=new h(r)}function p(e){this._db=e}i(s,"_index",["name","keyPath","multiEntry","unique"]),o(s,"_index",IDBIndex,["get","getKey","getAll","getAllKeys","count"]),c(s,"_index",IDBIndex,["openCursor","openKeyCursor"]),i(l,"_cursor",["direction","key","primaryKey","value"]),o(l,"_cursor",IDBCursor,["update","delete"]),["advance","continue","continuePrimaryKey"].forEach((function(e){e in IDBCursor.prototype&&(l.prototype[e]=function(){var t=this,n=arguments;return Promise.resolve().then((function(){return t._cursor[e].apply(t._cursor,n),r(t._request).then((function(e){if(e)return new l(e,t._request)}))}))})})),f.prototype.createIndex=function(){return new s(this._store.createIndex.apply(this._store,arguments))},f.prototype.index=function(){return new s(this._store.index.apply(this._store,arguments))},i(f,"_store",["name","keyPath","indexNames","autoIncrement"]),o(f,"_store",IDBObjectStore,["put","add","delete","clear","get","getAll","getKey","getAllKeys","count"]),c(f,"_store",IDBObjectStore,["openCursor","openKeyCursor"]),u(f,"_store",IDBObjectStore,["deleteIndex"]),h.prototype.objectStore=function(){return new f(this._tx.objectStore.apply(this._tx,arguments))},i(h,"_tx",["objectStoreNames","mode"]),u(h,"_tx",IDBTransaction,["abort"]),v.prototype.createObjectStore=function(){return new f(this._db.createObjectStore.apply(this._db,arguments))},i(v,"_db",["name","version","objectStoreNames"]),u(v,"_db",IDBDatabase,["deleteObjectStore","close"]),p.prototype.transaction=function(){return new h(this._db.transaction.apply(this._db,arguments))},i(p,"_db",["name","version","objectStoreNames"]),u(p,"_db",IDBDatabase,["close"]),["openCursor","openKeyCursor"].forEach((function(e){[f,s].forEach((function(r){e in r.prototype&&(r.prototype[e.replace("open","iterate")]=function(){var r=t(arguments),n=r[r.length-1],a=this._store||this._index,i=a[e].apply(a,r.slice(0,-1));i.onsuccess=function(){n(i.result)}})}))})),[s,f].forEach((function(e){e.prototype.getAll||(e.prototype.getAll=function(e,t){var r=this,n=[];return new Promise((function(a){r.iterateCursor(e,(function(e){e?(n.push(e.value),void 0===t||n.length!=t?e.continue():a(n)):a(n)}))}))})}));var y={open:function(e,t,r){var a=n(indexedDB,"open",[e,t]),i=a.request;return i&&(i.onupgradeneeded=function(e){r&&r(new v(i.result,e.oldVersion,i.transaction))}),a.then((function(e){return new p(e)}))},delete:function(e){return n(indexedDB,"deleteDatabase",[e])}};e.exports=y,e.exports.default=e.exports}()})),Ai=on((function(e){"undefined"!=typeof indexedDB?e.exports=Ii:e.exports={open:function(){return Promise.reject("IDB requires a browser environment")},delete:function(){return Promise.reject("IDB requires a browser environment")}}}));Ai.open;var Si=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(e){var n;return Object(p.a)(this,r),(n=t.call(this)).db=e,n}return Object(y.a)(r,[{key:"loadWrapKey",value:function(){var e=Object(h.a)(f.mark((function e(){var t,n;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.transaction(r.IDENTITY_STORAGE).objectStore(r.IDENTITY_STORAGE).get(r.WRAP_KEY);case 2:if(!(t=e.sent)){e.next=11;break}if(Qr.iv=t.iv,!(t.key instanceof ArrayBuffer)){e.next=10;break}return e.next=8,$().crypto.subtle.importKey("raw",t.key,{name:Qr.name,length:256},!0,["encrypt","decrypt","wrapKey","unwrapKey"]);case 8:return n=e.sent,e.abrupt("return",{key:n,iv:t.iv});case 10:return e.abrupt("return",{key:t.key,iv:t.iv});case 11:return e.abrupt("return",null);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"saveWrapKey",value:function(){var e=Object(h.a)(f.mark((function e(t){var a,i;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!zr()&&!Wr()){e.next=7;break}return e.next=3,$().crypto.subtle.exportKey("raw",t.key);case 3:i=e.sent,a={key:i,iv:t.iv},e.next=8;break;case 7:a=Object(n.a)({},t);case 8:return e.next=10,this.db.transaction(r.IDENTITY_STORAGE,"readwrite").objectStore(r.IDENTITY_STORAGE).put(a,r.WRAP_KEY);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadIdentity",value:function(){var e=Object(h.a)(f.mark((function e(){var t,n,a;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.transaction(r.IDENTITY_STORAGE).objectStore(r.IDENTITY_STORAGE).get(r.IDENTITY);case 2:if(t=e.sent,n=null,!t){e.next=26;break}if(!(Gr()||zr()||Wr())){e.next=23;break}return e.next=8,this.loadWrapKey();case 8:if((a=e.sent)&&a.key.usages.some((function(e){return"encrypt"===e}))&&t.exchangeKey.privateKey instanceof ArrayBuffer){e.next=11;break}return e.abrupt("return",null);case 11:return e.next=13,$().crypto.subtle.unwrapKey("jwk",t.exchangeKey.privateKey,a.key,Qr,Zr,!1,["deriveKey","deriveBits"]);case 13:return t.exchangeKey.privateKey=e.sent,e.next=16,$().crypto.subtle.unwrapKey("jwk",t.signingKey.privateKey,a.key,Qr,$r,!1,["sign"]);case 16:return t.signingKey.privateKey=e.sent,e.next=19,$().crypto.subtle.unwrapKey("jwk",t.exchangeKey.publicKey,a.key,Qr,Zr,!0,[]);case 19:return t.exchangeKey.publicKey=e.sent,e.next=22,$().crypto.subtle.unwrapKey("jwk",t.signingKey.publicKey,a.key,Qr,$r,!0,["verify"]);case 22:t.signingKey.publicKey=e.sent;case 23:return e.next=25,ne.fromJSON(t);case 25:n=e.sent;case 26:return e.abrupt("return",n);case 27:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"saveIdentity",value:function(){var e=Object(h.a)(f.mark((function e(t){var n,a,i,o;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Gr()||zr()||Wr())){e.next=20;break}return e.next=3,$().crypto.subtle.generateKey({name:Qr.name,length:256},zr()||Wr(),["wrapKey","unwrapKey","encrypt","decrypt"]);case 3:return e.t0=e.sent,e.t1=$().crypto.getRandomValues(new Uint8Array(Qr.iv)).buffer,n={key:e.t0,iv:e.t1},e.next=8,this.saveWrapKey(n);case 8:return e.next=10,$().crypto.subtle.generateKey(t.exchangeKey.privateKey.algorithm,!0,["deriveKey","deriveBits"]);case 10:return a=e.sent,t.exchangeKey.privateKey=a.privateKey,e.next=14,rn(t.exchangeKey.publicKey,a.publicKey);case 14:return e.next=16,$().crypto.subtle.generateKey(t.signingKey.privateKey.algorithm,!0,["sign","verify"]);case 16:return i=e.sent,t.signingKey.privateKey=i.privateKey,e.next=20,rn(t.signingKey.publicKey,i.publicKey);case 20:return e.next=22,t.toJSON();case 22:if(o=e.sent,!n){e.next=36;break}return e.next=26,$().crypto.subtle.wrapKey("jwk",t.exchangeKey.privateKey,n.key,Qr);case 26:return o.exchangeKey.privateKey=e.sent,e.next=29,$().crypto.subtle.wrapKey("jwk",t.signingKey.privateKey,n.key,Qr);case 29:return o.signingKey.privateKey=e.sent,e.next=32,$().crypto.subtle.wrapKey("jwk",t.exchangeKey.publicKey.key,n.key,Qr);case 32:return o.exchangeKey.publicKey=e.sent,e.next=35,$().crypto.subtle.wrapKey("jwk",t.signingKey.publicKey.key,n.key,Qr);case 35:o.signingKey.publicKey=e.sent;case 36:return e.next=38,this.db.transaction(r.IDENTITY_STORAGE,"readwrite").objectStore(r.IDENTITY_STORAGE).put(o,r.IDENTITY);case 38:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadRemoteIdentity",value:function(){var e=Object(h.a)(f.mark((function e(t){var n,a,i;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.transaction(r.REMOTE_STORAGE).objectStore(r.REMOTE_STORAGE).get(t);case 2:if(n=e.sent,a=null,!n){e.next=18;break}return e.next=7,this.loadWrapKey();case 7:if(!(i=e.sent)){e.next=15;break}return e.next=11,$().crypto.subtle.unwrapKey("jwk",n.exchangeKey,i.key,Qr,Zr,!0,[]);case 11:return n.exchangeKey=e.sent,e.next=14,$().crypto.subtle.unwrapKey("jwk",n.signingKey,i.key,Qr,$r,!0,["verify"]);case 14:n.signingKey=e.sent;case 15:return e.next=17,ae.fromJSON(n);case 17:a=e.sent;case 18:return e.abrupt("return",a);case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"saveRemoteIdentity",value:function(){var e=Object(h.a)(f.mark((function e(t,n){var a,i;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.toJSON();case 2:return a=e.sent,e.next=5,this.loadWrapKey();case 5:if(!(i=e.sent)){e.next=13;break}return e.next=9,$().crypto.subtle.wrapKey("jwk",a.exchangeKey,i.key,Qr);case 9:return a.exchangeKey=e.sent,e.next=12,$().crypto.subtle.wrapKey("jwk",a.signingKey,i.key,Qr);case 12:a.signingKey=e.sent;case 13:return e.next=15,this.db.transaction(r.REMOTE_STORAGE,"readwrite").objectStore(r.REMOTE_STORAGE).put(a,t);case 15:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"loadSession",value:function(){var e=Object(h.a)(f.mark((function e(t){var n,a,i,o;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.transaction(r.SESSION_STORAGE).objectStore(r.SESSION_STORAGE).get(t);case 2:if(n=e.sent,a=null,!n){e.next=18;break}return e.next=7,this.loadIdentity();case 7:if(i=e.sent){e.next=10;break}throw new Error("Identity is empty");case 10:return e.next=12,this.loadRemoteIdentity(t);case 12:if(o=e.sent){e.next=15;break}throw new Error("Remote identity is not found");case 15:return e.next=17,Ne.fromJSON(i,o,n);case 17:a=e.sent;case 18:return e.abrupt("return",a);case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"saveSession",value:function(){var e=Object(h.a)(f.mark((function e(t,n){var a;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.toJSON();case 2:return a=e.sent,e.next=5,this.db.transaction(r.SESSION_STORAGE,"readwrite").objectStore(r.SESSION_STORAGE).put(a,t);case 5:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}],[{key:"create",value:function(){var e=Object(h.a)(f.mark((function e(){var t,n=this;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ai.open(this.STORAGE_NAME,2,(function(e){1===e.oldVersion&&(e.deleteObjectStore(n.SESSION_STORAGE),e.deleteObjectStore(n.IDENTITY_STORAGE),e.deleteObjectStore(n.REMOTE_STORAGE)),e.createObjectStore(n.SESSION_STORAGE),e.createObjectStore(n.IDENTITY_STORAGE),e.createObjectStore(n.REMOTE_STORAGE)}));case 2:return t=e.sent,e.abrupt("return",new r(t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),r}(Ei);Si.STORAGE_NAME="webcrypto-remote",Si.IDENTITY_STORAGE="identity",Si.SESSION_STORAGE="sessions",Si.REMOTE_STORAGE="remoteIdentity",Si.WRAP_KEY="wkey",Si.IDENTITY="identity";var Di=function(e){Object(s.a)(r,e);var t=Object(l.a)(r);function r(){var e;return Object(p.a)(this,r),(e=t.apply(this,arguments)).remoteIdentities={},e.sessions={},e}return Object(y.a)(r,[{key:"loadIdentity",value:function(){var e=Object(h.a)(f.mark((function e(){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.identity||null);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"saveIdentity",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.identity=t;case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadRemoteIdentity",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.remoteIdentities[t]||null);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"saveRemoteIdentity",value:function(){var e=Object(h.a)(f.mark((function e(t,r){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.remoteIdentities[t]=r;case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"loadSession",value:function(){var e=Object(h.a)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sessions[t]||null);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"saveSession",value:function(){var e=Object(h.a)(f.mark((function e(t,r){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.sessions[t]=r;case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(Ei);return e.BrowserStorage=Si,e.CertificateStorage=wi,e.CryptoServerError=qr,e.KeyStorage=xi,e.MemoryStorage=Di,e.RatchetStorage=Ei,e.SocketCrypto=Bi,e.SocketProvider=Ni,e.getEngine=$,e.setEngine=function(e,t){Z={crypto:t,name:e}},Object.defineProperty(e,"__esModule",{value:!0}),e}({},protobuf,fetch.bind(self),WebSocket);self.WebcryptoSocket=d}}]);
//# sourceMappingURL=10.dbbd03a0.chunk.js.map