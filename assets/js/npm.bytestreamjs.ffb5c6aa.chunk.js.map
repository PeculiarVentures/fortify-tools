{"version":3,"sources":["webpack:///./node_modules/bytestreamjs/src/bytestream.js"],"names":["ByteStream","parameters","this","clear","key","Object","keys","length","i","_view","stub","fromUint8Array","view","fromArrayBuffer","buffer","fromString","string","fromHexString","hexstring","value","_buffer","slice","Uint8Array","ArrayBuffer","set","byteLength","array","stringLength","charCodeAt","start","result","String","fromCharCode","hexString","hexMap","Map","j","temp","get","charAt","str","toString","toUpperCase","Error","stream","end","size","initialSize","streamViewLength","copyView","realloc","pattern","backward","patternLength","patternArray","push","equal","equalStart","patterns","id","position","findPattern","valid","patternFound","findFirstIn","Array","from","left","right","currentLength","findFirstNotIn","firstIn","skipNotPatterns","firstNotIn","skipPatterns","findFirstSequence","leftPattern","rightPattern","isEqual","currentPositionLeft","leftPatterns","findAllPatternIn","rightPatterns","splice","sort","a","b","inputLeftPatterns","inputRightPatterns","findAllIn","searchPattern","replacePattern","findAllResult","output","status","searchPatternPositions","replacePatternPositions","element","patternDifference","changedBuffer","changedView","currentPosition","k","SeqStream","_length","_start","appendBlock","prevLength","prevStart","_stream","gap","findAllNotIn","findAllSequences","findPairedPatterns","findPairedArrays","char","number","Uint16Array","Uint32Array","changeLength","block","getBlock","parseByteMap","map","elements","dataView","resultArray","elementsCount","count","mapLength","structureLength","maxlength","name","defaultValue","type","bitsToStringArray","BitStream","bitsCount","fromByteStream","byteStream","fromUint32","uint32","byteIndex","shiftRight","join","shift","needShrink","shiftMask","shrink","bitsOffset","valueShift","startIndex","startOffset","endIndex","endOffset","bitsLength","initialValue","initialValueLength","reversedValue","stringStream","stringPattern","stringPatterns","stringLeftPattern","stringRightPattern","stringLeftPatterns","stringRightPatterns","stringSearchPattern","stringReplacePattern","SeqBitStream","copy","bitsLengthIndex","getBitsString","initialOffset","valueView"],"mappings":"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","file":"assets/js/npm.bytestreamjs.ffb5c6aa.chunk.js","sourcesContent":["/*\r\n * Copyright (c) 2016-2018, Peculiar Ventures\r\n * All rights reserved.\r\n *\r\n * Author 2016-2018, Yury Strozhevsky <www.strozhevsky.com>.\r\n *\r\n */\r\n//**************************************************************************************\r\nexport class ByteStream\r\n{\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleLoopsJS\r\n\t/**\r\n\t * Constructor for ByteStream class\r\n\t * @param {{[length]: number, [stub]: number, [view]: Uint8Array, [buffer]: ArrayBuffer, [string]: string, [hexstring]: string}} parameters\r\n\t */\r\n\tconstructor(parameters = {})\r\n\t{\r\n\t\tthis.clear();\r\n\t\t\r\n\t\tfor(const key of Object.keys(parameters))\r\n\t\t{\r\n\t\t\tswitch(key)\r\n\t\t\t{\r\n\t\t\t\tcase \"length\":\r\n\t\t\t\t\tthis.length = parameters.length;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"stub\":\r\n\t\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\t\tfor(let i = 0; i < this._view.length; i++)\r\n\t\t\t\t\t\tthis._view[i] = parameters.stub;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"view\":\r\n\t\t\t\t\tthis.fromUint8Array(parameters.view);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"buffer\":\r\n\t\t\t\t\tthis.fromArrayBuffer(parameters.buffer);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"string\":\r\n\t\t\t\t\tthis.fromString(parameters.string);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"hexstring\":\r\n\t\t\t\t\tthis.fromHexString(parameters.hexstring);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Setter for \"buffer\"\r\n\t * @param {ArrayBuffer} value\r\n\t */\r\n\tset buffer(value)\r\n\t{\r\n\t\tthis._buffer = value.slice(0);\r\n\t\tthis._view = new Uint8Array(this._buffer);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Getter for \"buffer\"\r\n\t * @returns {ArrayBuffer}\r\n\t */\r\n\tget buffer()\r\n\t{\r\n\t\treturn this._buffer;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Setter for \"view\"\r\n\t * @param {Uint8Array} value\r\n\t */\r\n\tset view(value)\r\n\t{\r\n\t\tthis._buffer = new ArrayBuffer(value.length);\r\n\t\tthis._view = new Uint8Array(this._buffer);\r\n\t\t\r\n\t\tthis._view.set(value);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Getter for \"view\"\r\n\t * @returns {Uint8Array}\r\n\t */\r\n\tget view()\r\n\t{\r\n\t\treturn this._view;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Getter for \"length\"\r\n\t * @returns {number}\r\n\t */\r\n\tget length()\r\n\t{\r\n\t\treturn this._buffer.byteLength;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Setter for \"length\"\r\n\t * @param {number} value\r\n\t */\r\n\tset length(value)\r\n\t{\r\n\t\tthis._buffer = new ArrayBuffer(value);\r\n\t\tthis._view = new Uint8Array(this._buffer);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Clear existing stream\r\n\t */\r\n\tclear()\r\n\t{\r\n\t\tthis._buffer = new ArrayBuffer(0);\r\n\t\tthis._view = new Uint8Array(this._buffer);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Initialize \"Stream\" object from existing \"ArrayBuffer\"\r\n\t * @param {!ArrayBuffer} array The ArrayBuffer to copy from\r\n\t */\r\n\tfromArrayBuffer(array)\r\n\t{\r\n\t\tthis.buffer = array;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionNamingConventionJS\r\n\t/**\r\n\t * Initialize \"Stream\" object from existing \"Uint8Array\"\r\n\t * @param {!Uint8Array} array The Uint8Array to copy from\r\n\t */\r\n\tfromUint8Array(array)\r\n\t{\r\n\t\tthis._buffer = new ArrayBuffer(array.length);\r\n\t\tthis._view = new Uint8Array(this._buffer);\r\n\t\t\r\n\t\tthis._view.set(array);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Initialize \"Stream\" object from existing string\r\n\t * @param {string} string The string to initialize from\r\n\t */\r\n\tfromString(string)\r\n\t{\r\n\t\tconst stringLength = string.length;\r\n\t\t\r\n\t\tthis.length = stringLength;\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tfor(let i = 0; i < stringLength; i++)\r\n\t\t\tthis.view[i] = string.charCodeAt(i);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Represent \"Stream\" object content as a string\r\n\t * @param {number} [start] Start position to convert to string\r\n\t * @param {number} [length] Length of array to convert to string\r\n\t * @returns {string}\r\n\t */\r\n\ttoString(start = 0, length = (this.view.length - start))\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tlet result = \"\";\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Check input parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((start >= this.view.length) || (start < 0))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((length >= this.view.length) || (length < 0))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.view.length - start;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Convert array of bytes to string\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tfor(let i = start; i < (start + length); i++)\r\n\t\t\tresult += String.fromCharCode(this.view[i]);\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionTooLongJS\r\n\t/**\r\n\t * Initialize \"Stream\" object from existing hexdecimal string\r\n\t * @param {string} hexString String to initialize from\r\n\t */\r\n\tfromHexString(hexString)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst stringLength = hexString.length;\r\n\t\t\r\n\t\tthis.buffer = new ArrayBuffer(stringLength >> 1);\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\r\n\t\tconst hexMap = new Map();\r\n\t\t\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"0\", 0x00);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"1\", 0x01);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"2\", 0x02);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"3\", 0x03);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"4\", 0x04);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"5\", 0x05);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"6\", 0x06);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"7\", 0x07);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"8\", 0x08);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"9\", 0x09);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"A\", 0x0A);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"a\", 0x0A);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"B\", 0x0B);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"b\", 0x0B);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"C\", 0x0C);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"c\", 0x0C);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"D\", 0x0D);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"d\", 0x0D);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"E\", 0x0E);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"e\", 0x0E);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"F\", 0x0F);\r\n\t\t// noinspection MagicNumberJS\r\n\t\thexMap.set(\"f\", 0x0F);\r\n\t\t\r\n\t\tlet j = 0;\r\n\t\t// noinspection MagicNumberJS\r\n\t\tlet temp = 0x00;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Convert char-by-char\r\n\t\tfor(let i = 0; i < stringLength; i++)\r\n\t\t{\r\n\t\t\t// noinspection NegatedIfStatementJS\r\n\t\t\tif(!(i % 2))\r\n\t\t\t{\r\n\t\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\t\ttemp = hexMap.get(hexString.charAt(i)) << 4;\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\t\ttemp |= hexMap.get(hexString.charAt(i));\r\n\t\t\t\t\r\n\t\t\t\tthis.view[j] = temp;\r\n\t\t\t\tj++;\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Represent \"Stream\" object content as a hexdecimal string\r\n\t * @param {number} [start=0] Start position to convert to string\r\n\t * @param {number} [length=(this.view.length - start)] Length of array to convert to string\r\n\t * @returns {string}\r\n\t */\r\n\ttoHexString(start = 0, length = (this.view.length - start))\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tlet result = \"\";\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Check input parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((start >= this.view.length) || (start < 0))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((length >= this.view.length) || (length < 0))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.view.length - start;\r\n\t\t}\r\n\t\t//endregion\r\n\r\n\t\tfor(let i = start; i < (start + length); i++)\r\n\t\t{\r\n\t\t\t// noinspection ChainedFunctionCallJS\r\n\t\t\tconst str = this.view[i].toString(16).toUpperCase();\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, ConditionalExpressionJS, EqualityComparisonWithCoercionJS\r\n\t\t\tresult = result + ((str.length == 1) ? \"0\" : \"\") + str;\r\n\t\t}\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Return copy of existing \"Stream\"\r\n\t * @param {number} [start=0] Start position of the copy\r\n\t * @param {number} [length=this.view.length] Length of the copy\r\n\t * @returns {ByteStream}\r\n\t */\r\n\tcopy(start = 0, length = (this._buffer.byteLength - start))\r\n\t{\r\n\t\t//region Check input parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((start === 0) && (this._buffer.byteLength === 0))\r\n\t\t\treturn new ByteStream();\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((start < 0) || (start > (this._buffer.byteLength - 1)))\r\n\t\t\tthrow new Error(`Wrong start position: ${start}`);\r\n\t\t//endregion\r\n\t\t\r\n\t\tconst stream = new ByteStream();\r\n\t\t\r\n\t\tstream._buffer = this._buffer.slice(start, start + length);\r\n\t\tstream._view = new Uint8Array(stream._buffer);\r\n\t\t\r\n\t\treturn stream;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Return slice of existing \"Stream\"\r\n\t * @param {number} [start=0] Start position of the slice\r\n\t * @param {number} [end=this._buffer.byteLength] End position of the slice\r\n\t * @returns {ByteStream}\r\n\t */\r\n\tslice(start = 0, end = this._buffer.byteLength)\r\n\t{\r\n\t\t//region Check input parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((start === 0) && (this._buffer.byteLength === 0))\r\n\t\t\treturn new ByteStream();\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((start < 0) || (start > (this._buffer.byteLength - 1)))\r\n\t\t\tthrow new Error(`Wrong start position: ${start}`);\r\n\t\t//endregion\r\n\t\t\r\n\t\tconst stream = new ByteStream();\r\n\t\t\r\n\t\tstream._buffer = this._buffer.slice(start, end);\r\n\t\tstream._view = new Uint8Array(stream._buffer);\r\n\t\t\r\n\t\treturn stream;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Change size of existing \"Stream\"\r\n\t * @param {!number} size Size for new \"Stream\"\r\n\t */\r\n\trealloc(size)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst buffer = new ArrayBuffer(size);\r\n\t\tconst view = new Uint8Array(buffer);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Create a new ArrayBuffer content\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(size > this._view.length)\r\n\t\t\tview.set(this._view);\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\tview.set(new Uint8Array(this._buffer, 0, size));\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initialize \"Stream\" with new \"ArrayBuffer\"\r\n\t\tthis._buffer = buffer.slice(0);\r\n\t\tthis._view = new Uint8Array(this._buffer);\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Append a new \"Stream\" content to the current \"Stream\"\r\n\t * @param {ByteStream} stream A new \"stream\" to append to current \"stream\"\r\n\t */\r\n\tappend(stream)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst initialSize = this._buffer.byteLength;\r\n\t\tconst streamViewLength = stream._buffer.byteLength;\r\n\t\t\r\n\t\tconst copyView = stream._view.slice();\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Re-allocate current internal buffer\r\n\t\tthis.realloc(initialSize + streamViewLength);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Copy input stream content to a new place\r\n\t\tthis._view.set(copyView, initialSize);\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Insert \"Stream\" content to the current \"Stream\" at specific position\r\n\t * @param {ByteStream} stream A new \"stream\" to insert to current \"stream\"\r\n\t * @param {number} [start=0] Start position to insert to\r\n\t * @param {number} [length]\r\n\t * @returns {boolean}\r\n\t */\r\n\tinsert(stream, start = 0, length = (this._buffer.byteLength - start))\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(start > (this._buffer.byteLength - 1))\r\n\t\t\treturn false;\r\n\t\t\r\n\t\tif(length > (this._buffer.byteLength - start))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this._buffer.byteLength - start;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Check input variables\r\n\t\tif(length > stream._buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = stream._buffer.byteLength;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Update content of the current stream\r\n\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(length == stream._buffer.byteLength)\r\n\t\t\tthis._view.set(stream._view, start);\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\tthis._view.set(stream._view.slice(0, length), start);\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Check that two \"Stream\" objects has equal content\r\n\t * @param {ByteStream} stream Stream to compare with\r\n\t * @returns {boolean}\r\n\t */\r\n\tisEqual(stream)\r\n\t{\r\n\t\t//region Check length of both buffers\r\n\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(this._buffer.byteLength != stream._buffer.byteLength)\r\n\t\t\treturn false;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Compare each byte of both buffers\r\n\t\tfor(let i = 0; i < stream._buffer.byteLength; i++)\r\n\t\t{\r\n\t\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(this.view[i] != stream.view[i])\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Check that current \"Stream\" objects has equal content with input \"Uint8Array\"\r\n\t * @param {Uint8Array} view View to compare with\r\n\t * @returns {boolean}\r\n\t */\r\n\tisEqualView(view)\r\n\t{\r\n\t\t//region Check length of both buffers\r\n\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(view.length != this.view.length)\r\n\t\t\treturn false;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Compare each byte of both buffers\r\n\t\tfor(let i = 0; i < view.length; i++)\r\n\t\t{\r\n\t\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(this.view[i] != view[i])\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn true;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS, FunctionTooLongJS\r\n\t/**\r\n\t * Find any byte pattern in \"Stream\"\r\n\t * @param {ByteStream} pattern Stream having pattern value\r\n\t * @param {?number} [start] Start position to search from\r\n\t * @param {?number} [length] Length of byte block to search at\r\n\t * @param {boolean} [backward] Flag to search in backward order\r\n\t * @returns {number}\r\n\t */\r\n\tfindPattern(pattern, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Check input variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\r\n\t\t\tstart = (backward) ? this.buffer.byteLength : 0;\r\n\t\t}\r\n\t\t\r\n\t\tif(start > this.buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = this.buffer.byteLength;\r\n\t\t}\r\n\t\t\r\n\t\tif(backward)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > start)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\tconst patternLength = pattern.buffer.byteLength;\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(patternLength > length)\r\n\t\t\treturn (-1);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Make a \"pre-read\" array for pattern\r\n\t\tconst patternArray = [];\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tfor(let i = 0; i < patternLength; i++)\r\n\t\t\tpatternArray.push(pattern.view[i]);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Search for pattern\r\n\t\tfor(let i = 0; i <= (length - patternLength); i++)\r\n\t\t{\r\n\t\t\tlet equal = true;\r\n\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\tconst equalStart = (backward) ? (start - patternLength - i) : (start + i);\r\n\t\t\t\r\n\t\t\tfor(let j = 0; j < patternLength; j++)\r\n\t\t\t{\r\n\t\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\t\tif(this.view[j + equalStart] != patternArray[j])\r\n\t\t\t\t{\r\n\t\t\t\t\tequal = false;\r\n\t\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(equal)\r\n\t\t\t{\r\n\t\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\t\treturn (backward) ? (start - patternLength - i) : (start + patternLength + i); // Position after the pattern found\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn (-1);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection OverlyComplexFunctionJS\r\n\t/**\r\n\t * Find first position of any pattern from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [start] Start position to search from\r\n\t * @param {?number} [length] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {{id: number, position: number}}\r\n\t */\r\n\tfindFirstIn(patterns, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\r\n\t\t\tstart = (backward) ? this.buffer.byteLength : 0;\r\n\t\t}\r\n\t\t\r\n\t\tif(start > this.buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = this.buffer.byteLength;\r\n\t\t}\r\n\t\t\r\n\t\tif(backward)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > start)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst result = {\r\n\t\t\tid: (-1),\r\n\t\t\tposition: (backward) ? 0 : (start + length),\r\n\t\t\tlength: 0\r\n\t\t};\r\n\t\t//endregion\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tconst position = this.findPattern(patterns[i], start, length, backward);\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(position != (-1))\r\n\t\t\t{\r\n\t\t\t\tlet valid = false;\r\n\t\t\t\tconst patternLength = patterns[i].length;\r\n\r\n\t\t\t\tif(backward)\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\t\tif((position - patternLength) >= (result.position - result.length))\r\n\t\t\t\t\t\tvalid = true;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\t\tif((position - patternLength) <= (result.position - result.length))\r\n\t\t\t\t\t\tvalid = true;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(valid)\r\n\t\t\t\t{\r\n\t\t\t\t\tresult.position = position;\r\n\t\t\t\t\tresult.id = i;\r\n\t\t\t\t\tresult.length = patternLength;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find all positions of any pattern from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [start] Start position to search from\r\n\t * @param {?number} [length] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllIn(patterns, start = 0, length = (this.buffer.byteLength - start))\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst result = [];\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(start > (this.buffer.byteLength - 1))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\r\n\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tlet patternFound = {\r\n\t\t\tid: (-1),\r\n\t\t\tposition: start\r\n\t\t};\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find all accurences of patterns\r\n\t\tdo\r\n\t\t{\r\n\t\t\tconst position = patternFound.position;\r\n\t\t\t\r\n\t\t\tpatternFound = this.findFirstIn(patterns, patternFound.position, length);\r\n\t\t\t\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(patternFound.id == (-1))\r\n\t\t\t{\r\n\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength -= (patternFound.position - position);\r\n\t\t\t\r\n\t\t\tresult.push({\r\n\t\t\t\tid: patternFound.id,\r\n\t\t\t\tposition: patternFound.position\r\n\t\t\t});\r\n\t\t} while(true); // eslint-disable-line\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find all positions of a pattern\r\n\t * @param {ByteStream} pattern Stream having pattern value\r\n\t * @param {?number} [start] Start position to search from\r\n\t * @param {?number} [length] Length of byte block to search at\r\n\t * @returns {Array|number} Array with all pattern positions or (-1) if failed\r\n\t */\r\n\tfindAllPatternIn(pattern, start = 0, length = (this.buffer.byteLength - start))\r\n\t{\r\n\t\t//region Check input variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\tif(start > this.buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = this.buffer.byteLength;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\tconst result = [];\r\n\t\t\r\n\t\tconst patternLength = pattern.buffer.byteLength;\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(patternLength > length)\r\n\t\t\treturn (-1);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Make a \"pre-read\" array for pattern\r\n\t\tconst patternArray = Array.from(pattern.view);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Search for pattern\r\n\t\tfor(let i = 0; i <= (length - patternLength); i++)\r\n\t\t{\r\n\t\t\tlet equal = true;\r\n\t\t\tconst equalStart = start + i;\r\n\t\t\t\r\n\t\t\tfor(let j = 0; j < patternLength; j++)\r\n\t\t\t{\r\n\t\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\t\tif(this.view[j + equalStart] != patternArray[j])\r\n\t\t\t\t{\r\n\t\t\t\t\tequal = false;\r\n\t\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(equal)\r\n\t\t\t{\r\n\t\t\t\tresult.push(start + patternLength + i); // Position after the pattern found\r\n\t\t\t\ti += (patternLength - 1); // On next step of \"for\" we will have \"i++\"\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection OverlyComplexFunctionJS, FunctionTooLongJS\r\n\t/**\r\n\t * Find first position of data, not included in patterns from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n\t * @param {?number} [start] Start position to search from\r\n\t * @param {?number} [length] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {{left: {id: number, position: *}, right: {id: number, position: number}, value: ByteStream}}\r\n\t */\r\n\tfindFirstNotIn(patterns, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\r\n\t\t\tstart = (backward) ? this.buffer.byteLength : 0;\r\n\t\t}\r\n\t\t\r\n\t\tif(start > this.buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = this.buffer.byteLength;\r\n\t\t}\r\n\t\t\r\n\t\tif(backward)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > start)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tconst result = {\r\n\t\t\tleft: {\r\n\t\t\t\tid: (-1),\r\n\t\t\t\tposition: start\r\n\t\t\t},\r\n\t\t\tright: {\r\n\t\t\t\tid: (-1),\r\n\t\t\t\tposition: 0\r\n\t\t\t},\r\n\t\t\tvalue: new ByteStream()\r\n\t\t};\r\n\t\t\r\n\t\tlet currentLength = length;\r\n\t\t//endregion\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\twhile(currentLength > 0)\r\n\t\t{\r\n\t\t\t//region Search for nearest \"pattern\"\r\n\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\tresult.right = this.findFirstIn(patterns,\r\n\t\t\t\t(backward) ? (start - length + currentLength) : (start + length - currentLength),\r\n\t\t\t\tcurrentLength,\r\n\t\t\t\tbackward);\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region No pattern at all\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(result.right.id == (-1))\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = currentLength;\r\n\t\t\t\t\r\n\t\t\t\tif(backward)\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\t\tstart -= length;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\t\tstart = result.left.position;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tresult.value = new ByteStream();\r\n\t\t\t\t\r\n\t\t\t\tresult.value._buffer = this._buffer.slice(start, start + length);\r\n\t\t\t\tresult.value._view = new Uint8Array(result.value._buffer);\r\n\t\t\t\t\r\n\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Check distance between two patterns\r\n\t\t\t// noinspection ConditionalExpressionJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(result.right.position != ((backward) ? (result.left.position - patterns[result.right.id].buffer.byteLength) : (result.left.position + patterns[result.right.id].buffer.byteLength)))\r\n\t\t\t{\r\n\t\t\t\tif(backward)\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\t\tstart = result.right.position + patterns[result.right.id].buffer.byteLength;\r\n\t\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\t\tlength = result.left.position - result.right.position - patterns[result.right.id].buffer.byteLength;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\t\tstart = result.left.position;\r\n\t\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\t\tlength = result.right.position - result.left.position - patterns[result.right.id].buffer.byteLength;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tresult.value = new ByteStream();\r\n\t\t\t\t\r\n\t\t\t\tresult.value._buffer = this._buffer.slice(start, start + length);\r\n\t\t\t\tresult.value._view = new Uint8Array(result.value._buffer);\r\n\t\t\t\t\r\n\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Store information about previous pattern\r\n\t\t\tresult.left = result.right;\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Change current length\r\n\t\t\tcurrentLength -= patterns[result.right.id]._buffer.byteLength;\r\n\t\t\t//endregion\r\n\t\t}\r\n\t\t\r\n\t\t//region Swap \"patterns\" in case of backward order\r\n\t\tif(backward)\r\n\t\t{\r\n\t\t\tconst temp = result.right;\r\n\t\t\tresult.right = result.left;\r\n\t\t\tresult.left = temp;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find all positions of data, not included in patterns from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n\t * @param {?number} [start] Start position to search from\r\n\t * @param {?number} [length] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllNotIn(patterns, start = null, length = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst result = [];\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(start > (this.buffer.byteLength - 1))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tlet patternFound = {\r\n\t\t\tleft: {\r\n\t\t\t\tid: (-1),\r\n\t\t\t\tposition: start\r\n\t\t\t},\r\n\t\t\tright: {\r\n\t\t\t\tid: (-1),\r\n\t\t\t\tposition: start\r\n\t\t\t},\r\n\t\t\tvalue: new ByteStream()\r\n\t\t};\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find all accurences of patterns\r\n\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\tdo\r\n\t\t{\r\n\t\t\tconst position = patternFound.right.position;\r\n\t\t\t\r\n\t\t\tpatternFound = this.findFirstNotIn(patterns, patternFound.right.position, length);\r\n\t\t\t\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength -= (patternFound.right.position - position);\r\n\t\t\t\r\n\t\t\tresult.push({\r\n\t\t\t\tleft: {\r\n\t\t\t\t\tid: patternFound.left.id,\r\n\t\t\t\t\tposition: patternFound.left.position\r\n\t\t\t\t},\r\n\t\t\t\tright: {\r\n\t\t\t\t\tid: patternFound.right.id,\r\n\t\t\t\t\tposition: patternFound.right.position\r\n\t\t\t\t},\r\n\t\t\t\tvalue: patternFound.value\r\n\t\t\t});\r\n\t\t} while(patternFound.right.id != (-1));\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS\r\n\t/**\r\n\t * Find position of a sequence of any patterns from input array\r\n\t * @param {Array.<ByteStream>} patterns Array of pattern to look for\r\n\t * @param {?number} [start] Start position to search from\r\n\t * @param {?number} [length] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {*}\r\n\t */\r\n\tfindFirstSequence(patterns, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\r\n\t\t\tstart = (backward) ? this.buffer.byteLength : 0;\r\n\t\t}\r\n\t\t\r\n\t\tif(start > this.buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = this.buffer.byteLength;\r\n\t\t}\r\n\t\t\r\n\t\tif(backward)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > start)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find first byte from sequence\r\n\t\tconst firstIn = this.skipNotPatterns(patterns, start, length, backward);\r\n\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\tif(firstIn == (-1))\r\n\t\t{\r\n\t\t\treturn {\r\n\t\t\t\tposition: (-1),\r\n\t\t\t\tvalue: new ByteStream()\r\n\t\t\t};\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find first byte not in sequence\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst firstNotIn = this.skipPatterns(patterns,\r\n\t\t\tfirstIn,\r\n\t\t\tlength - ((backward) ? (start - firstIn) : (firstIn - start)),\r\n\t\t\tbackward);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Make output value\r\n\t\tif(backward)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = firstNotIn;\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = (firstIn - firstNotIn);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = firstIn;\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = (firstNotIn - firstIn);\r\n\t\t}\r\n\t\t\r\n\t\tconst value = new ByteStream();\r\n\t\t\r\n\t\tvalue._buffer = this._buffer.slice(start, start + length);\r\n\t\tvalue._view = new Uint8Array(value._buffer);\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn {\r\n\t\t\tposition: firstNotIn,\r\n\t\t\tvalue\r\n\t\t};\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find all positions of a sequence of any patterns from input array\r\n\t * @param {Array.<ByteStream>} patterns Array of patterns to search for\r\n\t * @param {?number} [start] Start position to search from\r\n\t * @param {?number} [length] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllSequences(patterns, start = null, length = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst result = [];\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(start > (this.buffer.byteLength - 1))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tlet patternFound = {\r\n\t\t\tposition: start,\r\n\t\t\tvalue: new ByteStream()\r\n\t\t};\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find all accurences of patterns\r\n\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\tdo\r\n\t\t{\r\n\t\t\tconst position = patternFound.position;\r\n\t\t\t\r\n\t\t\tpatternFound = this.findFirstSequence(patterns, patternFound.position, length);\r\n\t\t\t\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(patternFound.position != (-1))\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength -= (patternFound.position - position);\r\n\t\t\t\t\r\n\t\t\t\tresult.push({\r\n\t\t\t\t\tposition: patternFound.position,\r\n\t\t\t\t\tvalue: patternFound.value\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\t\r\n\t\t} while(patternFound.position != (-1));\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS, FunctionTooLongJS\r\n\t/**\r\n\t * Find all paired patterns in the stream\r\n\t * @param {ByteStream} leftPattern Left pattern to search for\r\n\t * @param {ByteStream} rightPattern Right pattern to search for\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindPairedPatterns(leftPattern, rightPattern, start = null, length = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst result = [];\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(leftPattern.isEqual(rightPattern))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(start > (this.buffer.byteLength - 1))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tlet currentPositionLeft = 0;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find all \"left patterns\" as sorted array\r\n\t\tconst leftPatterns = this.findAllPatternIn(leftPattern, start, length);\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(leftPatterns.length == 0)\r\n\t\t\treturn result;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find all \"right patterns\" as sorted array\r\n\t\tconst rightPatterns = this.findAllPatternIn(rightPattern, start, length);\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(rightPatterns.length == 0)\r\n\t\t\treturn result;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Combine patterns\r\n\t\twhile(currentPositionLeft < leftPatterns.length)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(rightPatterns.length == 0)\r\n\t\t\t{\r\n\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(leftPatterns[0] == rightPatterns[0])\r\n\t\t\t{\r\n\t\t\t\t// Possible situation when one pattern is a part of another\r\n\t\t\t\t// For example \"stream\" and \"endstream\"\r\n\t\t\t\t// In case when we have only \"endstream\" in fact \"stream\" will be also found at the same position\r\n\t\t\t\t// (position of the pattern is an index AFTER the pattern)\r\n\t\t\t\t\r\n\t\t\t\tresult.push({\r\n\t\t\t\t\tleft: leftPatterns[0],\r\n\t\t\t\t\tright: rightPatterns[0]\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tleftPatterns.splice(0, 1);\r\n\t\t\t\trightPatterns.splice(0, 1);\r\n\t\t\t\t\r\n\t\t\t\t// noinspection ContinueStatementJS\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(leftPatterns[currentPositionLeft] > rightPatterns[0])\r\n\t\t\t{\r\n\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\twhile(leftPatterns[currentPositionLeft] < rightPatterns[0])\r\n\t\t\t{\r\n\t\t\t\tcurrentPositionLeft++;\r\n\t\t\t\t\r\n\t\t\t\tif(currentPositionLeft >= leftPatterns.length)\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tresult.push({\r\n\t\t\t\tleft: leftPatterns[currentPositionLeft - 1],\r\n\t\t\t\tright: rightPatterns[0]\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tleftPatterns.splice(currentPositionLeft - 1, 1);\r\n\t\t\trightPatterns.splice(0, 1);\r\n\t\t\t\r\n\t\t\tcurrentPositionLeft = 0;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Sort result\r\n\t\tresult.sort((a, b) => (a.left - b.left));\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS, FunctionTooLongJS\r\n\t/**\r\n\t * Find all paired patterns in the stream\r\n\t * @param {Array.<ByteStream>} inputLeftPatterns Array of left patterns to search for\r\n\t * @param {Array.<ByteStream>} inputRightPatterns Array of right patterns to search for\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindPairedArrays(inputLeftPatterns, inputRightPatterns, start = null, length = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst result = [];\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(start > (this.buffer.byteLength - 1))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tlet currentPositionLeft = 0;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find all \"left patterns\" as sorted array\r\n\t\tconst leftPatterns = this.findAllIn(inputLeftPatterns, start, length);\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(leftPatterns.length == 0)\r\n\t\t\treturn result;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find all \"right patterns\" as sorted array\r\n\t\tconst rightPatterns = this.findAllIn(inputRightPatterns, start, length);\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(rightPatterns.length == 0)\r\n\t\t\treturn result;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Combine patterns\r\n\t\twhile(currentPositionLeft < leftPatterns.length)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(rightPatterns.length == 0)\r\n\t\t\t{\r\n\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(leftPatterns[0].position == rightPatterns[0].position)\r\n\t\t\t{\r\n\t\t\t\t// Possible situation when one pattern is a part of another\r\n\t\t\t\t// For example \"stream\" and \"endstream\"\r\n\t\t\t\t// In case when we have only \"endstream\" in fact \"stream\" will be also found at the same position\r\n\t\t\t\t// (position of the pattern is an index AFTER the pattern)\r\n\t\t\t\t\r\n\t\t\t\tresult.push({\r\n\t\t\t\t\tleft: leftPatterns[0],\r\n\t\t\t\t\tright: rightPatterns[0]\r\n\t\t\t\t});\r\n\t\t\t\t\r\n\t\t\t\tleftPatterns.splice(0, 1);\r\n\t\t\t\trightPatterns.splice(0, 1);\r\n\t\t\t\t\r\n\t\t\t\t// noinspection ContinueStatementJS\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(leftPatterns[currentPositionLeft].position > rightPatterns[0].position)\r\n\t\t\t{\r\n\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\twhile(leftPatterns[currentPositionLeft].position < rightPatterns[0].position)\r\n\t\t\t{\r\n\t\t\t\tcurrentPositionLeft++;\r\n\t\t\t\t\r\n\t\t\t\tif(currentPositionLeft >= leftPatterns.length)\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tresult.push({\r\n\t\t\t\tleft: leftPatterns[currentPositionLeft - 1],\r\n\t\t\t\tright: rightPatterns[0]\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tleftPatterns.splice(currentPositionLeft - 1, 1);\r\n\t\t\trightPatterns.splice(0, 1);\r\n\t\t\t\r\n\t\t\tcurrentPositionLeft = 0;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Sort result\r\n\t\tresult.sort((a, b) => (a.left.position - b.left.position));\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS, FunctionTooLongJS\r\n\t/**\r\n\t * Replace one patter with other\r\n\t * @param {ByteStream} searchPattern The pattern to search for\r\n\t * @param {ByteStream} replacePattern The pattern to replace initial pattern\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @param {Array|null} [findAllResult=null] Pre-calculated results of \"findAllIn\"\r\n\t * @returns {*}\r\n\t */\r\n\treplacePattern(searchPattern, replacePattern, start = null, length = null, findAllResult = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tlet result;\r\n\t\t\r\n\t\tlet i;\r\n\t\tconst output = {\r\n\t\t\tstatus: (-1),\r\n\t\t\tsearchPatternPositions: [],\r\n\t\t\treplacePatternPositions: []\r\n\t\t};\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(start > (this.buffer.byteLength - 1))\r\n\t\t\treturn false;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t\r\n\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find a pattern to search for\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif(findAllResult == null)\r\n\t\t{\r\n\t\t\tresult = this.findAllIn([searchPattern], start, length);\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(result.length == 0)\r\n\t\t\t\treturn output;\r\n\t\t}\r\n\t\telse\r\n\t\t\tresult = findAllResult;\r\n\t\t\r\n\t\t// noinspection NestedFunctionCallJS\r\n\t\toutput.searchPatternPositions.push(...Array.from(result, element => element.position));\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Variables for new buffer initialization\r\n\t\tconst patternDifference = searchPattern.buffer.byteLength - replacePattern.buffer.byteLength;\r\n\t\t\r\n\t\tconst changedBuffer = new ArrayBuffer(this.view.length - (result.length * patternDifference));\r\n\t\tconst changedView = new Uint8Array(changedBuffer);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Copy data from 0 to start\r\n\t\t// noinspection NestedFunctionCallJS\r\n\t\tchangedView.set(new Uint8Array(this.buffer, 0, start));\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Replace pattern\r\n\t\tfor(i = 0; i < result.length; i++)\r\n\t\t{\r\n\t\t\t//region Initial variables\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, ConditionalExpressionJS, EqualityComparisonWithCoercionJS\r\n\t\t\tconst currentPosition = (i == 0) ? start : result[i - 1].position;\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Copy bytes other then search pattern\r\n\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\tchangedView.set(new Uint8Array(this.buffer, currentPosition, result[i].position - searchPattern.buffer.byteLength - currentPosition), currentPosition - i * patternDifference);\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Put replace pattern in a new buffer\r\n\t\t\tchangedView.set(replacePattern.view, result[i].position - searchPattern.buffer.byteLength - i * patternDifference);\r\n\t\t\t\r\n\t\t\toutput.replacePatternPositions.push(result[i].position - searchPattern.buffer.byteLength - i * patternDifference);\r\n\t\t\t//endregion\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Copy data from the end of old buffer\r\n\t\ti--;\r\n\t\t// noinspection NestedFunctionCallJS\r\n\t\tchangedView.set(new Uint8Array(this.buffer, result[i].position, this.buffer.byteLength - result[i].position), result[i].position - searchPattern.buffer.byteLength + replacePattern.buffer.byteLength - i * patternDifference);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Re-initialize existing buffer\r\n\t\tthis.buffer = changedBuffer;\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t//endregion\r\n\t\t\r\n\t\toutput.status = 1;\r\n\t\t\r\n\t\treturn output;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS, FunctionTooLongJS\r\n\t/**\r\n\t * Skip any pattern from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {*}\r\n\t */\r\n\tskipPatterns(patterns, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\r\n\t\t\tstart = (backward) ? this.buffer.byteLength : 0;\r\n\t\t}\r\n\t\t\r\n\t\tif(start > this.buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = this.buffer.byteLength;\r\n\t\t}\r\n\t\t\r\n\t\tif(backward)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > start)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tlet result = start;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Search for pattern\r\n\t\tfor(let k = 0; k < patterns.length; k++)\r\n\t\t{\r\n\t\t\tconst patternLength = patterns[k].buffer.byteLength;\r\n\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\tconst equalStart = (backward) ? (result - patternLength) : (result);\r\n\t\t\tlet equal = true;\r\n\t\t\t\r\n\t\t\tfor(let j = 0; j < patternLength; j++)\r\n\t\t\t{\r\n\t\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\t\tif(this.view[j + equalStart] != patterns[k].view[j])\r\n\t\t\t\t{\r\n\t\t\t\t\tequal = false;\r\n\t\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(equal)\r\n\t\t\t{\r\n\t\t\t\tk = (-1);\r\n\t\t\t\t\r\n\t\t\t\tif(backward)\r\n\t\t\t\t{\r\n\t\t\t\t\tresult -= patternLength;\r\n\t\t\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\t\t\t\tif(result <= 0)\r\n\t\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t\telse\r\n\t\t\t\t{\r\n\t\t\t\t\tresult += patternLength;\r\n\t\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\t\tif(result >= (start + length))\r\n\t\t\t\t\t\treturn result;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleLoopsJS, OverlyComplexFunctionJS, FunctionTooLongJS\r\n\t/**\r\n\t * Skip any pattern not from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should not be ommited\r\n\t * @param start\r\n\t * @param length\r\n\t * @param backward\r\n\t * @returns {number}\r\n\t */\r\n\tskipNotPatterns(patterns, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS, ConditionalExpressionJS\r\n\t\t\tstart = (backward) ? this.buffer.byteLength : 0;\r\n\t\t}\r\n\t\t\r\n\t\tif(start > this.buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = this.buffer.byteLength;\r\n\t\t}\r\n\t\t\r\n\t\tif(backward)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > start)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = start;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\t\tif(length == null)\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif(length > (this.buffer.byteLength - start))\r\n\t\t\t{\r\n\t\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\t\tlength = this.buffer.byteLength - start;\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tlet result = (-1);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Search for pattern\r\n\t\tfor(let i = 0; i < length; i++)\r\n\t\t{\r\n\t\t\tfor(let k = 0; k < patterns.length; k++)\r\n\t\t\t{\r\n\t\t\t\tconst patternLength = patterns[k].buffer.byteLength;\r\n\t\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\t\tconst equalStart = (backward) ? (start - i - patternLength) : (start + i);\r\n\t\t\t\tlet equal = true;\r\n\t\t\t\t\r\n\t\t\t\tfor(let j = 0; j < patternLength; j++)\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\t\t\tif(this.view[j + equalStart] != patterns[k].view[j])\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tequal = false;\r\n\t\t\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tif(equal)\r\n\t\t\t\t{\r\n\t\t\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\t\t\tresult = (backward) ? (start - i) : (start + i); // Exact position of pattern found\r\n\t\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(result != (-1))\r\n\t\t\t{\r\n\t\t\t\t// noinspection BreakStatementJS\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n}\r\n//**************************************************************************************\r\nexport class SeqStream \r\n{\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Constructor for \"SeqStream\" class\r\n\t * @param {{[stream]: ByteStream, [length]: number, [backward]: boolean, [start]: number, [appendBlock]: number}} parameters\r\n\t */\r\n\tconstructor(parameters = {})\r\n\t{\r\n\t\t/**\r\n\t\t * Major stream\r\n\t\t * @type {ByteStream}\r\n\t\t */\r\n\t\tthis.stream = new ByteStream();\r\n\t\t/**\r\n\t\t * Length of the major stream\r\n\t\t * @type {number}\r\n\t\t */\r\n\t\tthis._length = 0;\r\n\t\t/**\r\n\t\t * Flag to search in backward direction\r\n\t\t * @type {boolean}\r\n\t\t */\r\n\t\tthis.backward = false;\r\n\t\t/**\r\n\t\t * Start position to search\r\n\t\t * @type {number}\r\n\t\t */\r\n\t\tthis._start = 0;\r\n\t\t/**\r\n\t\t * Length of a block when append information to major stream\r\n\t\t * @type {number}\r\n\t\t */\r\n\t\tthis.appendBlock = 0;\r\n\t\t\r\n\t\tthis.prevLength = 0;\r\n\t\tthis.prevStart = 0;\r\n\t\t\r\n\t\tfor(const key of Object.keys(parameters))\r\n\t\t{\r\n\t\t\tswitch(key)\r\n\t\t\t{\r\n\t\t\t\tcase \"stream\":\r\n\t\t\t\t\tthis.stream = parameters.stream;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"backward\":\r\n\t\t\t\t\tthis.backward = parameters.backward;\r\n\t\t\t\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\t\t\t\tthis._start = this.stream.buffer.byteLength;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"length\":\r\n\t\t\t\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\t\t\t\tthis._length = parameters.length;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"start\":\r\n\t\t\t\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\t\t\t\tthis._start = parameters.start;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"appendBlock\":\r\n\t\t\t\t\tthis.appendBlock = parameters.appendBlock;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"view\":\r\n\t\t\t\t\tthis.stream = new ByteStream({ view: parameters.view});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"buffer\":\r\n\t\t\t\t\tthis.stream = new ByteStream({ buffer: parameters.buffer});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"string\":\r\n\t\t\t\t\tthis.stream = new ByteStream({ string: parameters.string});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"hexstring\":\r\n\t\t\t\t\tthis.stream = new ByteStream({ hexstring: parameters.hexstring});\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Setter for \"stream\" property\r\n\t * @param {ByteStream} value\r\n\t */\r\n\tset stream(value)\r\n\t{\r\n\t\tthis._stream = value;\r\n\t\t\r\n\t\tthis.prevLength = this._length;\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis._length = value._buffer.byteLength;\r\n\t\t\r\n\t\tthis.prevStart = this._start;\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis._start = 0;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Getter for \"stream\" property\r\n\t * @returns {ByteStream}\r\n\t */\r\n\tget stream()\r\n\t{\r\n\t\treturn this._stream;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Setter for \"length\" property\r\n\t * @param {number} value\r\n\t */\r\n\tset length(value)\r\n\t{\r\n\t\tthis.prevLength = this._length;\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis._length = value;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Getter for \"length\" property\r\n\t * @returns {number}\r\n\t */\r\n\tget length()\r\n\t{\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(this.appendBlock)\r\n\t\t\treturn this.start;\r\n\t\t\r\n\t\treturn this._length;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Setter for \"start\" property\r\n\t * @param {number} value\r\n\t */\r\n\tset start(value)\r\n\t{\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(value > this.stream.buffer.byteLength)\r\n\t\t\treturn;\r\n\t\t\r\n\t\t//region Initialization of \"prev\" internal variables\r\n\t\tthis.prevStart = this._start;\r\n\t\tthis.prevLength = this._length;\r\n\t\t//endregion\r\n\t\t\r\n\t\t// noinspection JSUnusedGlobalSymbols, ConditionalExpressionJS\r\n\t\tthis._length -= ((this.backward) ? (this._start - value) : (value - this._start));\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis._start = value;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Getter for \"start\" property\r\n\t * @returns {number}\r\n\t */\r\n\tget start()\r\n\t{\r\n\t\treturn this._start;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Return ArrayBuffer with having value of existing SeqStream length\r\n\t * @return {ArrayBuffer}\r\n\t */\r\n\tget buffer()\r\n\t{\r\n\t\treturn this._stream._buffer.slice(0, this._length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Reset current position of the \"SeqStream\"\r\n\t */\r\n\tresetPosition()\r\n\t{\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis._start = this.prevStart;\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis._length = this.prevLength;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find any byte pattern in \"ByteStream\"\r\n\t * @param {ByteStream} pattern Stream having pattern value\r\n\t * @param {?number} [gap] Maximum gap between start position and position of nearest object\r\n\t * @returns {number}\r\n\t */\r\n\tfindPattern(pattern, gap = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((gap == null) || (gap > this.length))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tgap = this.length;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Find pattern\r\n\t\tconst result = this.stream.findPattern(pattern, this.start, this.length, this.backward);\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(result == (-1))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\tif(this.backward)\r\n\t\t{\r\n\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\tif(result < (this.start - pattern.buffer.byteLength - gap))\r\n\t\t\t\treturn (-1);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\tif(result > (this.start + pattern.buffer.byteLength + gap))\r\n\t\t\t\treturn (-1);\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Create new values\r\n\t\tthis.start = result;\r\n\t\t//endregion ;\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find first position of any pattern from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [gap] Maximum gap between start position and position of nearest object\r\n\t * @returns {{id: number, position: number}}\r\n\t */\r\n\tfindFirstIn(patterns, gap = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((gap == null) || (gap > this.length))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tgap = this.length;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Search for patterns\r\n\t\tconst result = this.stream.findFirstIn(patterns, this.start, this.length, this.backward);\r\n\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(result.id == (-1))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\tif(this.backward)\r\n\t\t{\r\n\t\t\tif(result.position < (this.start - patterns[result.id].buffer.byteLength - gap))\r\n\t\t\t{\r\n\t\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\t\treturn {\r\n\t\t\t\t\tid: (-1),\r\n\t\t\t\t\tposition: (this.backward) ? 0 : (this.start + this.length)\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif(result.position > (this.start + patterns[result.id].buffer.byteLength + gap))\r\n\t\t\t{\r\n\t\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\t\treturn {\r\n\t\t\t\t\tid: (-1),\r\n\t\t\t\t\tposition: (this.backward) ? 0 : (this.start + this.length)\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Create new values\r\n\t\tthis.start = result.position;\r\n\t\t//endregion ;\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find all positions of any pattern from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be found\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllIn(patterns)\r\n\t{\r\n\t\t// In case of \"backward order\" the start position is at the end on stream.\r\n\t\t// In case of \"normal order\" the start position is at the begging of the stream.\r\n\t\t// But in fact for search for all patterns we need to have start position in \"normal order\".\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst start = (this.backward) ? (this.start - this.length) : this.start;\r\n\t\t\r\n\t\treturn this.stream.findAllIn(patterns, start, this.length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS\r\n\t/**\r\n\t * Find first position of data, not included in patterns from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n\t * @param {?number} gap Maximum gap between start position and position of nearest object\r\n\t * @returns {*}\r\n\t */\r\n\tfindFirstNotIn(patterns, gap = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((gap == null) || (gap > this._length))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tgap = this._length;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Search for patterns\r\n\t\tconst result = this._stream.findFirstNotIn(patterns, this._start, this._length, this.backward);\r\n\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif((result.left.id == (-1)) && (result.right.id == (-1)))\r\n\t\t\treturn result;\r\n\t\t\r\n\t\tif(this.backward)\r\n\t\t{\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(result.right.id != (-1))\r\n\t\t\t{\r\n\t\t\t\tif(result.right.position < (this._start - patterns[result.right.id]._buffer.byteLength - gap))\r\n\t\t\t\t{\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tleft: {\r\n\t\t\t\t\t\t\tid: (-1),\r\n\t\t\t\t\t\t\tposition: this._start\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tright: {\r\n\t\t\t\t\t\t\tid: (-1),\r\n\t\t\t\t\t\t\tposition: 0\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tvalue: new ByteStream()\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS\r\n\t\t\tif(result.left.id != (-1))\r\n\t\t\t{\r\n\t\t\t\tif(result.left.position > (this._start + patterns[result.left.id]._buffer.byteLength + gap))\r\n\t\t\t\t{\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tleft: {\r\n\t\t\t\t\t\t\tid: (-1),\r\n\t\t\t\t\t\t\tposition: this._start\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tright: {\r\n\t\t\t\t\t\t\tid: (-1),\r\n\t\t\t\t\t\t\tposition: 0\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t\tvalue: new ByteStream()\r\n\t\t\t\t\t};\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Create new values\r\n\t\tif(this.backward)\r\n\t\t{\r\n\t\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(result.left.id == (-1))\r\n\t\t\t\tthis.start = 0;\r\n\t\t\telse\r\n\t\t\t\tthis.start = result.left.position;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(result.right.id == (-1))\r\n\t\t\t\tthis.start = (this._start + this._length);\r\n\t\t\telse\r\n\t\t\t\tthis.start = result.right.position;\r\n\t\t}\r\n\t\t//endregion ;\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find all positions of data, not included in patterns from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllNotIn(patterns)\r\n\t{\r\n\t\t// In case of \"backward order\" the start position is at the end on stream.\r\n\t\t// In case of \"normal order\" the start position is at the begging of the stream.\r\n\t\t// But in fact for search for all patterns we need to have start position in \"normal order\".\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst start = (this.backward) ? (this._start - this._length) : this._start;\r\n\t\t\r\n\t\treturn this._stream.findAllNotIn(patterns, start, this._length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find position of a sequence of any patterns from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n\t * @param {?number} [length] Length to search sequence for\r\n\t * @param {?number} [gap] Maximum gap between start position and position of nearest object\r\n\t * @returns {*}\r\n\t */\r\n\tfindFirstSequence(patterns, length = null, gap = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((length == null) || (length > this._length))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this._length;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((gap == null) || (gap > length))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tgap = length;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Search for sequence\r\n\t\tconst result = this._stream.findFirstSequence(patterns, this._start, length, this.backward);\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(result.value.buffer.byteLength == 0)\r\n\t\t\treturn result;\r\n\t\t\r\n\t\tif(this.backward)\r\n\t\t{\r\n\t\t\tif(result.position < (this._start - result.value._buffer.byteLength - gap))\r\n\t\t\t{\r\n\t\t\t\treturn {\r\n\t\t\t\t\tposition: (-1),\r\n\t\t\t\t\tvalue: new ByteStream()\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tif(result.position > (this._start + result.value._buffer.byteLength + gap))\r\n\t\t\t{\r\n\t\t\t\treturn {\r\n\t\t\t\t\tposition: (-1),\r\n\t\t\t\t\tvalue: new ByteStream()\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Create new values\r\n\t\tthis.start = result.position;\r\n\t\t//endregion ;\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find position of a sequence of any patterns from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be found\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllSequences(patterns)\r\n\t{\r\n\t\t// In case of \"backward order\" the start position is at the end on stream.\r\n\t\t// In case of \"normal order\" the start position is at the begging of the stream.\r\n\t\t// But in fact for search for all patterns we need to have start position in \"normal order\".\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst start = (this.backward) ? (this.start - this.length) : this.start;\r\n\t\t\r\n\t\treturn this.stream.findAllSequences(patterns, start, this.length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find all paired patterns in the stream\r\n\t * @param {ByteStream} leftPattern Left pattern to search for\r\n\t * @param {ByteStream} rightPattern Right pattern to search for\r\n\t * @param {?number} [gap] Maximum gap between start position and position of nearest object\r\n\t * @returns {Array}\r\n\t */\r\n\tfindPairedPatterns(leftPattern, rightPattern, gap = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((gap == null) || (gap > this.length))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tgap = this.length;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t// In case of \"backward order\" the start position is at the end on stream.\r\n\t\t// In case of \"normal order\" the start position is at the begging of the stream.\r\n\t\t// But in fact for search for all patterns we need to have start position in \"normal order\".\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst start = (this.backward) ? (this.start - this.length) : this.start;\r\n\t\t\r\n\t\t//region Search for patterns\r\n\t\tconst result = this.stream.findPairedPatterns(leftPattern, rightPattern, start, this.length);\r\n\t\tif(result.length)\r\n\t\t{\r\n\t\t\tif(this.backward)\r\n\t\t\t{\r\n\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\tif(result[0].right < (this.start - rightPattern.buffer.byteLength - gap))\r\n\t\t\t\t\treturn [];\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\tif(result[0].left > (this.start + leftPattern.buffer.byteLength + gap))\r\n\t\t\t\t\treturn [];\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Find all paired patterns in the stream\r\n\t * @param {Array.<ByteStream>} leftPatterns Array of left patterns to search for\r\n\t * @param {Array.<ByteStream>} rightPatterns Array of right patterns to search for\r\n\t * @param {?number} [gap] Maximum gap between start position and position of nearest object\r\n\t * @returns {Array}\r\n\t */\r\n\tfindPairedArrays(leftPatterns, rightPatterns, gap = null)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((gap == null) || (gap > this.length))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tgap = this.length;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t// In case of \"backward order\" the start position is at the end on stream.\r\n\t\t// In case of \"normal order\" the start position is at the begging of the stream.\r\n\t\t// But in fact for search for all patterns we need to have start position in \"normal order\".\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst start = (this.backward) ? (this.start - this.length) : this.start;\r\n\t\t\r\n\t\t//region Search for patterns\r\n\t\tconst result = this.stream.findPairedArrays(leftPatterns, rightPatterns, start, this.length);\r\n\t\tif(result.length)\r\n\t\t{\r\n\t\t\tif(this.backward)\r\n\t\t\t{\r\n\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\tif(result[0].right.position < (this.start - rightPatterns[result[0].right.id].buffer.byteLength - gap))\r\n\t\t\t\t\treturn [];\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\tif(result[0].left.position > (this.start + leftPatterns[result[0].left.id].buffer.byteLength + gap))\r\n\t\t\t\t\treturn [];\r\n\t\t\t}\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Replace one patter with other\r\n\t * @param {ByteStream} searchPattern The pattern to search for\r\n\t * @param {ByteStream} replacePattern The pattern to replace initial pattern\r\n\t * @returns {*}\r\n\t */\r\n\treplacePattern(searchPattern, replacePattern)\r\n\t{\r\n\t\t// In case of \"backward order\" the start position is at the end on stream.\r\n\t\t// In case of \"normal order\" the start position is at the begging of the stream.\r\n\t\t// But in fact for search for all patterns we need to have start position in \"normal order\".\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst start = (this.backward) ? (this.start - this.length) : this.start;\r\n\t\t\r\n\t\treturn this.stream.replacePattern(searchPattern, replacePattern, start, this.length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Skip of any pattern from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n\t * @returns {*}\r\n\t */\r\n\tskipPatterns(patterns)\r\n\t{\r\n\t\tconst result = this.stream.skipPatterns(patterns, this.start, this.length, this.backward);\r\n\t\t\r\n\t\t//region Create new values\r\n\t\tthis.start = result;\r\n\t\t//endregion ;\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Skip of any pattern from input array\r\n\t * @param {Array.<ByteStream>} patterns Array with patterns which should be ommited\r\n\t * @returns {number}\r\n\t */\r\n\tskipNotPatterns(patterns)\r\n\t{\r\n\t\tconst result = this.stream.skipNotPatterns(patterns, this.start, this.length, this.backward);\r\n\t\t// noinspection NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\tif(result == (-1))\r\n\t\t\treturn (-1);\r\n\t\t\r\n\t\t//region Create new values\r\n\t\tthis.start = result;\r\n\t\t//endregion ;\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Append a new \"Stream\" content to the current \"Stream\"\r\n\t * @param {ByteStream} stream A new \"stream\" to append to current \"stream\"\r\n\t */\r\n\tappend(stream)\r\n\t{\r\n\t\tif((this._start + stream._buffer.byteLength) > this._stream._buffer.byteLength)\r\n\t\t{\r\n\t\t\tif(stream._buffer.byteLength > this.appendBlock)\r\n\t\t\t{\r\n\t\t\t\t// noinspection MagicNumberJS\r\n\t\t\t\tthis.appendBlock = (stream._buffer.byteLength + 1000);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\r\n\t\t}\r\n\t\t\r\n\t\tthis._stream._view.set(stream._view, this._start);\r\n\t\t\r\n\t\tthis._length += (stream._buffer.byteLength * 2);\r\n\t\tthis.start = (this._start + stream._buffer.byteLength);\r\n\t\tthis.prevLength -= (stream._buffer.byteLength * 2);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Append a \"view\" content to the current \"Stream\"\r\n\t * @param {Uint8Array} view A new \"view\" to append to current \"stream\"\r\n\t */\r\n\tappendView(view)\r\n\t{\r\n\t\tif((this._start + view.length) > this._stream._buffer.byteLength)\r\n\t\t{\r\n\t\t\tif(view.length > this.appendBlock)\r\n\t\t\t{\r\n\t\t\t\t// noinspection MagicNumberJS\r\n\t\t\t\tthis.appendBlock = (view.length + 1000);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\r\n\t\t}\r\n\t\t\r\n\t\tthis._stream._view.set(view, this._start);\r\n\t\t\r\n\t\tthis._length += (view.length * 2);\r\n\t\tthis.start = (this._start + view.length);\r\n\t\tthis.prevLength -= (view.length * 2);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Append a new char to the current \"Stream\"\r\n\t * @param {number} char A new char to append to current \"stream\"\r\n\t */\r\n\tappendChar(char)\r\n\t{\r\n\t\tif((this._start + 1) > this._stream._buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnLefSideOfComparisonJS\r\n\t\t\tif(1 > this.appendBlock)\r\n\t\t\t{\r\n\t\t\t\t// noinspection MagicNumberJS\r\n\t\t\t\tthis.appendBlock = 1000;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\r\n\t\t}\r\n\t\t\r\n\t\tthis._stream._view[this._start] = char;\r\n\t\t\r\n\t\tthis._length += 2;\r\n\t\tthis.start = (this._start + 1);\r\n\t\tthis.prevLength -= 2;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionNamingConventionJS\r\n\t/**\r\n\t * Append a new number to the current \"Stream\"\r\n\t * @param {number} number A new unsigned 16-bit integer to append to current \"stream\"\r\n\t */\r\n\tappendUint16(number)\r\n\t{\r\n\t\tif((this._start + 2) > this._stream._buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnLefSideOfComparisonJS\r\n\t\t\tif(2 > this.appendBlock)\r\n\t\t\t{\r\n\t\t\t\t// noinspection MagicNumberJS\r\n\t\t\t\tthis.appendBlock = 1000;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\r\n\t\t}\r\n\t\t\r\n\t\tconst value = new Uint16Array([number]);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\t\t\r\n\t\tthis._stream._view[this._start] = view[1];\r\n\t\tthis._stream._view[this._start + 1] = view[0];\r\n\t\t\r\n\t\tthis._length += 4;\r\n\t\tthis.start = (this._start + 2);\r\n\t\tthis.prevLength -= 4;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionNamingConventionJS\r\n\t/**\r\n\t * Append a new number to the current \"Stream\"\r\n\t * @param {number} number A new unsigned 24-bit integer to append to current \"stream\"\r\n\t */\r\n\tappendUint24(number)\r\n\t{\r\n\t\tif((this._start + 3) > this._stream._buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnLefSideOfComparisonJS\r\n\t\t\tif(3 > this.appendBlock)\r\n\t\t\t{\r\n\t\t\t\t// noinspection MagicNumberJS\r\n\t\t\t\tthis.appendBlock = 1000;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\r\n\t\t}\r\n\t\t\r\n\t\tconst value = new Uint32Array([number]);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\t\t\r\n\t\tthis._stream._view[this._start] = view[2];\r\n\t\tthis._stream._view[this._start + 1] = view[1];\r\n\t\tthis._stream._view[this._start + 2] = view[0];\r\n\t\t\r\n\t\tthis._length += 6;\r\n\t\tthis.start = (this._start + 3);\r\n\t\tthis.prevLength -= 6;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionNamingConventionJS\r\n\t/**\r\n\t * Append a new number to the current \"Stream\"\r\n\t * @param {number} number A new unsigned 32-bit integer to append to current \"stream\"\r\n\t */\r\n\tappendUint32(number)\r\n\t{\r\n\t\tif((this._start + 4) > this._stream._buffer.byteLength)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnLefSideOfComparisonJS\r\n\t\t\tif(4 > this.appendBlock)\r\n\t\t\t{\r\n\t\t\t\t// noinspection MagicNumberJS\r\n\t\t\t\tthis.appendBlock = 1000;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tthis._stream.realloc(this._stream._buffer.byteLength + this.appendBlock);\r\n\t\t}\r\n\t\t\r\n\t\tconst value = new Uint32Array([number]);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\t\t\r\n\t\tthis._stream._view[this._start] = view[3];\r\n\t\tthis._stream._view[this._start + 1] = view[2];\r\n\t\tthis._stream._view[this._start + 2] = view[1];\r\n\t\tthis._stream._view[this._start + 3] = view[0];\r\n\t\t\r\n\t\tthis._length += 8;\r\n\t\tthis.start = (this._start + 4);\r\n\t\tthis.prevLength -= 8;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Get a block of data\r\n\t * @param {number} size Size of the data block to get\r\n\t * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n\t * @returns {Array}\r\n\t */\r\n\tgetBlock(size, changeLength = true)\r\n\t{\r\n\t\t//region Check input parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif(this._length <= 0)\r\n\t\t\treturn [];\r\n\t\t\r\n\t\tif(this._length < size)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tsize = this._length;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\tlet result;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Getting result depends on \"backward\" flag\r\n\t\tif(this.backward)\r\n\t\t{\r\n\t\t\tconst buffer = this._stream._buffer.slice(this._length - size, this._length);\r\n\t\t\tconst view = new Uint8Array(buffer);\r\n\t\t\t\r\n\t\t\tresult = new Array(size);\r\n\t\t\t\r\n\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\tfor(let i = 0; i < size; i++)\r\n\t\t\t\tresult[size - 1 - i] = view[i];\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tconst buffer = this._stream._buffer.slice(this._start, this._start + size);\r\n\t\t\t\r\n\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\tresult = Array.from(new Uint8Array(buffer));\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Change \"length\" value if needed\r\n\t\tif(changeLength)\r\n\t\t{\r\n\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\tthis.start += ((this.backward) ? ((-1) * size) : size);\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS, FunctionNamingConventionJS\r\n\t/**\r\n\t * Get 2-byte unsigned integer value\r\n\t * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n\t * @returns {number}\r\n\t */\r\n\tgetUint16(changeLength = true)\r\n\t{\r\n\t\tconst block = this.getBlock(2, changeLength);\r\n\t\t\r\n\t\t//region Check posibility for convertion\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif(block.length < 2)\r\n\t\t\treturn 0;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Convert byte array to \"Uint32Array\" value\r\n\t\tconst value = new Uint16Array(1);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\t\t\r\n\t\tview[0] = block[1];\r\n\t\tview[1] = block[0];\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn value[0];\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS, FunctionNamingConventionJS\r\n\t/**\r\n\t * Get 3-byte unsigned integer value\r\n\t * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n\t * @returns {number}\r\n\t */\r\n\tgetUint24(changeLength = true)\r\n\t{\r\n\t\tconst block = this.getBlock(3, changeLength);\r\n\t\t\r\n\t\t//region Check posibility for convertion\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif(block.length < 3)\r\n\t\t\treturn 0;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Convert byte array to \"Uint32Array\" value\r\n\t\tconst value = new Uint32Array(1);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tfor(let i = 3; i >= 1; i--)\r\n\t\t\tview[3 - i] = block[i - 1];\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn value[0];\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS, FunctionNamingConventionJS\r\n\t/**\r\n\t * Get 4-byte unsigned integer value\r\n\t * @param {boolean} [changeLength=true] Should we change \"length\" and \"start\" value after reading the data block\r\n\t * @returns {number}\r\n\t */\r\n\tgetUint32(changeLength = true)\r\n\t{\r\n\t\tconst block = this.getBlock(4, changeLength);\r\n\t\t\r\n\t\t//region Check posibility for convertion\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif(block.length < 4)\r\n\t\t\treturn 0;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Convert byte array to \"Uint32Array\" value\r\n\t\tconst value = new Uint32Array(1);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tfor(let i = 3; i >= 0; i--)\r\n\t\t\tview[3 - i] = block[i];\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn value[0];\r\n\t}\r\n\t//**********************************************************************************\r\n}\r\n//**************************************************************************************\r\n// noinspection FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS, OverlyComplexFunctionJS, FunctionTooLongJS\r\n/**\r\n * Get parsed values from \"byte map\"\r\n * @param {ByteStream} stream Stream to parse data from\r\n * @param {Object} map Object with information how to parse \"byte map\"\r\n * @param {number} elements Number of elements in parsing byte map\r\n * @param {?number} [start=null] Start position to parse from\r\n * @param {?number} [length=null] Length of byte block to parse from\r\n * @returns {*}\r\n */\r\nexport function parseByteMap(stream, map, elements, start = null, length = null)\r\n{\r\n\t/*\r\n\t Map example:\r\n\t \r\n\t let map = [\r\n\t {\r\n\t type: \"string\",\r\n\t name: \"type\",\r\n\t minlength: 1,\r\n\t maxlength: 1,\r\n\t func: function(array)\r\n\t {\r\n\t let result = {\r\n\t status: (-1),\r\n\t length: 1\r\n\t };\r\n\t \r\n\t switch(array[0])\r\n\t {\r\n\t case 0x6E: // \"n\"\r\n\t result.value = \"n\";\r\n\t break;\r\n\t case 0x66: // \"f\"\r\n\t result.value = \"f\";\r\n\t break;\r\n\t default:\r\n\t return result;\r\n\t }\r\n\t \r\n\t result.status = 1;\r\n\t \r\n\t return result;\r\n\t }\r\n\t },\r\n\t {\r\n\t type: \"check\",\r\n\t minlength: 1,\r\n\t maxlength: 2,\r\n\t func: function(array)\r\n\t {\r\n\t let position = (-1);\r\n\t \r\n\t if(array[0] == 0x0A)\r\n\t position = 1;\r\n\t if(array[1] == 0x0A)\r\n\t position = 2;\r\n\t \r\n\t return {\r\n\t status: (position > 0) ? 1 : (-1),\r\n\t length: position\r\n\t };\r\n\t }\r\n\t }\r\n\t ];\r\n\t */\r\n\t\r\n\t//region Initial variables\r\n\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\tif(start === null)\r\n\t{\r\n\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\tstart = 0;\r\n\t}\r\n\t\r\n\t// noinspection NonBlockStatementBodyJS\r\n\tif(start > (stream.buffer.byteLength - 1))\r\n\t\treturn false;\r\n\t\r\n\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\tif(length === null)\r\n\t{\r\n\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\tlength = stream.buffer.byteLength - start;\r\n\t}\r\n\t\r\n\tif(length > (stream.buffer.byteLength - start))\r\n\t{\r\n\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\tlength = stream.buffer.byteLength - start;\r\n\t}\r\n\t\r\n\tlet dataView;\r\n\t\r\n\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\tif((start == 0) && (length == stream.buffer.byteLength))\r\n\t\tdataView = stream.view;\r\n\telse\r\n\t\tdataView = new Uint8Array(stream.buffer, start, length);\r\n\t\r\n\tconst resultArray = new Array(elements);\r\n\tlet elementsCount = 0;\r\n\t\r\n\tlet count = 0;\r\n\tconst mapLength = map.length;\r\n\t//endregion\r\n\t\r\n\t//region Parse all byte, structure by structure\r\n\twhile(count < length)\r\n\t{\r\n\t\tlet structureLength = 0;\r\n\t\t\r\n\t\tresultArray[elementsCount] = {};\r\n\t\t\r\n\t\tfor(let i = 0; i < mapLength; i++)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, JSUnresolvedVariable, EqualityComparisonWithCoercionJS\r\n\t\t\tif(map[i].maxlength == 0)\r\n\t\t\t{\r\n\t\t\t\t// noinspection NonBlockStatementBodyJS\r\n\t\t\t\tif(\"defaultValue\" in map[i])\r\n\t\t\t\t\t(resultArray[elementsCount])[map[i].name] = map[i].defaultValue;\r\n\t\t\t\t\r\n\t\t\t\t// noinspection ContinueStatementJS\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// noinspection JSUnresolvedVariable\r\n\t\t\tconst array = new Array(map[i].maxlength);\r\n\t\t\t\r\n\t\t\t// noinspection JSUnresolvedVariable\r\n\t\t\tfor(let j = 0; j < map[i].maxlength; j++)\r\n\t\t\t{\r\n\t\t\t\t// noinspection IncrementDecrementResultUsedJS\r\n\t\t\t\tarray[j] = dataView[count++];\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// noinspection JSUnresolvedVariable\r\n\t\t\tconst result = (map[i].func)(array);\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\t\tif(result.status == (-1))\r\n\t\t\t{\r\n\t\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS, EqualityComparisonWithCoercionJS\r\n\t\t\t\tif(resultArray.length == 1)\r\n\t\t\t\t\treturn [];\r\n\r\n\t\t\t\treturn resultArray.slice(0, resultArray.length - 1);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\t\tif(map[i].type != \"check\")\r\n\t\t\t\t(resultArray[elementsCount])[map[i].name] = result.value;\r\n\t\t\t\r\n\t\t\t// noinspection JSUnresolvedVariable\r\n\t\t\tcount -= (map[i].maxlength - result.length);\r\n\t\t\tstructureLength += result.length;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection IncrementDecrementResultUsedJS\r\n\t\t(resultArray[elementsCount++]).structureLength = structureLength;\r\n\t}\r\n\t//endregion\r\n\t\r\n\treturn resultArray;\r\n}\r\n//**************************************************************************************\r\n//region \"Bits-to-string\" array\r\nconst bitsToStringArray = [\r\n\t\"00000000\", \"00000001\", \"00000010\",\r\n\t\"00000011\", \"00000100\", \"00000101\",\r\n\t\"00000110\", \"00000111\", \"00001000\",\r\n\t\"00001001\", \"00001010\", \"00001011\",\r\n\t\"00001100\", \"00001101\", \"00001110\",\r\n\t\"00001111\", \"00010000\", \"00010001\",\r\n\t\"00010010\", \"00010011\", \"00010100\",\r\n\t\"00010101\", \"00010110\", \"00010111\",\r\n\t\"00011000\", \"00011001\", \"00011010\",\r\n\t\"00011011\", \"00011100\", \"00011101\",\r\n\t\"00011110\", \"00011111\", \"00100000\",\r\n\t\"00100001\", \"00100010\", \"00100011\",\r\n\t\"00100100\", \"00100101\", \"00100110\",\r\n\t\"00100111\", \"00101000\", \"00101001\",\r\n\t\"00101010\", \"00101011\", \"00101100\",\r\n\t\"00101101\", \"00101110\", \"00101111\",\r\n\t\"00110000\", \"00110001\", \"00110010\",\r\n\t\"00110011\", \"00110100\", \"00110101\",\r\n\t\"00110110\", \"00110111\", \"00111000\",\r\n\t\"00111001\", \"00111010\", \"00111011\",\r\n\t\"00111100\", \"00111101\", \"00111110\",\r\n\t\"00111111\", \"01000000\", \"01000001\",\r\n\t\"01000010\", \"01000011\", \"01000100\",\r\n\t\"01000101\", \"01000110\", \"01000111\",\r\n\t\"01001000\", \"01001001\", \"01001010\",\r\n\t\"01001011\", \"01001100\", \"01001101\",\r\n\t\"01001110\", \"01001111\", \"01010000\",\r\n\t\"01010001\", \"01010010\", \"01010011\",\r\n\t\"01010100\", \"01010101\", \"01010110\",\r\n\t\"01010111\", \"01011000\", \"01011001\",\r\n\t\"01011010\", \"01011011\", \"01011100\",\r\n\t\"01011101\", \"01011110\", \"01011111\",\r\n\t\"01100000\", \"01100001\", \"01100010\",\r\n\t\"01100011\", \"01100100\", \"01100101\",\r\n\t\"01100110\", \"01100111\", \"01101000\",\r\n\t\"01101001\", \"01101010\", \"01101011\",\r\n\t\"01101100\", \"01101101\", \"01101110\",\r\n\t\"01101111\", \"01110000\", \"01110001\",\r\n\t\"01110010\", \"01110011\", \"01110100\",\r\n\t\"01110101\", \"01110110\", \"01110111\",\r\n\t\"01111000\", \"01111001\", \"01111010\",\r\n\t\"01111011\", \"01111100\", \"01111101\",\r\n\t\"01111110\", \"01111111\", \"10000000\",\r\n\t\"10000001\", \"10000010\", \"10000011\",\r\n\t\"10000100\", \"10000101\", \"10000110\",\r\n\t\"10000111\", \"10001000\", \"10001001\",\r\n\t\"10001010\", \"10001011\", \"10001100\",\r\n\t\"10001101\", \"10001110\", \"10001111\",\r\n\t\"10010000\", \"10010001\", \"10010010\",\r\n\t\"10010011\", \"10010100\", \"10010101\",\r\n\t\"10010110\", \"10010111\", \"10011000\",\r\n\t\"10011001\", \"10011010\", \"10011011\",\r\n\t\"10011100\", \"10011101\", \"10011110\",\r\n\t\"10011111\", \"10100000\", \"10100001\",\r\n\t\"10100010\", \"10100011\", \"10100100\",\r\n\t\"10100101\", \"10100110\", \"10100111\",\r\n\t\"10101000\", \"10101001\", \"10101010\",\r\n\t\"10101011\", \"10101100\", \"10101101\",\r\n\t\"10101110\", \"10101111\", \"10110000\",\r\n\t\"10110001\", \"10110010\", \"10110011\",\r\n\t\"10110100\", \"10110101\", \"10110110\",\r\n\t\"10110111\", \"10111000\", \"10111001\",\r\n\t\"10111010\", \"10111011\", \"10111100\",\r\n\t\"10111101\", \"10111110\", \"10111111\",\r\n\t\"11000000\", \"11000001\", \"11000010\",\r\n\t\"11000011\", \"11000100\", \"11000101\",\r\n\t\"11000110\", \"11000111\", \"11001000\",\r\n\t\"11001001\", \"11001010\", \"11001011\",\r\n\t\"11001100\", \"11001101\", \"11001110\",\r\n\t\"11001111\", \"11010000\", \"11010001\",\r\n\t\"11010010\", \"11010011\", \"11010100\",\r\n\t\"11010101\", \"11010110\", \"11010111\",\r\n\t\"11011000\", \"11011001\", \"11011010\",\r\n\t\"11011011\", \"11011100\", \"11011101\",\r\n\t\"11011110\", \"11011111\", \"11100000\",\r\n\t\"11100001\", \"11100010\", \"11100011\",\r\n\t\"11100100\", \"11100101\", \"11100110\",\r\n\t\"11100111\", \"11101000\", \"11101001\",\r\n\t\"11101010\", \"11101011\", \"11101100\",\r\n\t\"11101101\", \"11101110\", \"11101111\",\r\n\t\"11110000\", \"11110001\", \"11110010\",\r\n\t\"11110011\", \"11110100\", \"11110101\",\r\n\t\"11110110\", \"11110111\", \"11111000\",\r\n\t\"11111001\", \"11111010\", \"11111011\",\r\n\t\"11111100\", \"11111101\", \"11111110\",\r\n\t\"11111111\"\r\n];\r\n//endregion\r\n//**************************************************************************************\r\nexport class BitStream\r\n{\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Constructor for \"BitStream\" class\r\n\t * @param {{[byteStream]: ByteStream, [view]: Uint8Array, [buffer]: ArrayBuffer, [string]: string, [bitsCount]: number}} parameters\r\n\t */\r\n\tconstructor(parameters = {})\r\n\t{\r\n\t\tthis.buffer = new ArrayBuffer(0);\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\r\n\t\tthis.bitsCount = 0; // Number of bits stored in current \"BitStream\"\r\n\t\t\r\n\t\tfor(const key of Object.keys(parameters))\r\n\t\t{\r\n\t\t\tswitch(key)\r\n\t\t\t{\r\n\t\t\t\tcase \"byteStream\":\r\n\t\t\t\t\tthis.fromByteStream(parameters.byteStream);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"view\":\r\n\t\t\t\t\tthis.fromUint8Array(parameters.view);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"buffer\":\r\n\t\t\t\t\tthis.fromArrayBuffer(parameters.buffer);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"string\":\r\n\t\t\t\t\tthis.fromString(parameters.string);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"uint32\":\r\n\t\t\t\t\tthis.fromUint32(parameters.uint32);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase \"bitsCount\":\r\n\t\t\t\t\tthis.bitsCount = parameters.bitsCount;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Clear existing stream\r\n\t */\r\n\tclear()\r\n\t{\r\n\t\tthis.buffer = new ArrayBuffer(0);\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\r\n\t\tthis.bitsCount = 0;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Initialize \"BitStream\" by data from existing \"ByteStream\"\r\n\t * @param {ByteStream} stream\r\n\t */\r\n\tfromByteStream(stream)\r\n\t{\r\n\t\tthis.buffer = stream.buffer.slice(0);\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\r\n\t\tthis.bitsCount = this.view.length << 3;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Initialize \"BitStream\" object from existing \"ArrayBuffer\"\r\n\t * @param {ArrayBuffer} array The ArrayBuffer to copy from\r\n\t */\r\n\tfromArrayBuffer(array)\r\n\t{\r\n\t\tthis.buffer = array.slice(0);\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\r\n\t\tthis.bitsCount = this.view.length << 3;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionNamingConventionJS\r\n\t/**\r\n\t * Initialize \"BitStream\" object from existing \"Uint8Array\"\r\n\t * @param {Uint8Array} array The Uint8Array to copy from\r\n\t */\r\n\tfromUint8Array(array)\r\n\t{\r\n\t\tthis.buffer = new ArrayBuffer(array.length);\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\r\n\t\tthis.view.set(array);\r\n\t\t\r\n\t\tthis.bitsCount = this.view.length << 3;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Initialize \"BitStream\" object from existing bit string\r\n\t * @param {string} string The string to initialize from\r\n\t */\r\n\tfromString(string)\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst stringLength = string.length;\r\n\t\t\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tthis.buffer = new ArrayBuffer((stringLength >> 3) + ((stringLength % 8) ? 1 : 0));\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\r\n\t\tthis.bitsCount = ((stringLength >> 3) + 1) << 3; // In order to handle correct shifting\r\n\t\t\r\n\t\tlet byteIndex = 0;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Convert from \"bit string\" to bytes\r\n\t\tfor(let i = 0; i < stringLength; i++)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\t\tif(string[i] == \"1\")\r\n\t\t\t\tthis.view[byteIndex] |= 1 << (7 - (i % 8));\r\n\t\t\t\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\t\tif(i && (((i + 1) % 8) == 0))\r\n\t\t\t\tbyteIndex++;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Shift \"BitStream\" into correct position\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(stringLength % 8)\r\n\t\t\tthis.shiftRight(8 - (stringLength % 8));\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Change \"bitsCount\"\r\n\t\tthis.bitsCount = stringLength;\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Initialize \"BitStream\" object from existing uint32 number\r\n\t * @param {Number} number The string to initialize from\r\n\t */\r\n\tfromUint32(uint32)\r\n\t{\r\n\t\tthis.buffer = new ArrayBuffer(4);\r\n\t\tthis.view = new Uint8Array(this.buffer);\r\n\r\n\t\tconst value = new Uint32Array([uint32]);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\t\t\r\n\t\tfor(let i = 3; i >= 0; i--)\r\n\t\t\tthis.view[i] = view[3 - i];\r\n\r\n\t\tthis.bitsCount = 32;\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Represent \"BitStream\" object content as a string\r\n\t * @param {?number} [start=null] Start number to convert to string from\r\n\t * @param {?number} [length=null] Length of BitStream to convert to string\r\n\t * @returns {string}\r\n\t */\r\n\ttoString(start = null, length = null)\r\n\t{\r\n\t\t//region Check input parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((start >= this.view.length) || (start < 0))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.view.length - start;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif((length >= this.view.length) || (length < 0))\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = this.view.length - start;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\tconst result = [];\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Convert from bytes to \"bit string\"\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tfor(let i = start; i < (start + length); i++)\r\n\t\t\tresult.push(bitsToStringArray[this.view[i]]);\r\n\t\t//endregion\r\n\t\t\r\n\t\t// noinspection ChainedFunctionCallJS\r\n\t\treturn result.join(\"\").slice((this.view.length << 3) - this.bitsCount);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Shift entire \"BitStream\" value right to number of bits\r\n\t * @param {number} shift Number of bits to shift value\r\n\t * @param {boolean} [needShrink=true] Need to shrink result or not\r\n\t */\r\n\tshiftRight(shift, needShrink = true)\r\n\t{\r\n\t\t//region Check parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\tif(this.view.length == 0)\r\n\t\t\treturn;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((shift < 0) || (shift > 8))\r\n\t\t\tthrow new Error(\"The \\\"shift\\\" parameter must be in range 0-8\");\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(shift > this.bitsCount)\r\n\t\t\tthrow new Error(\"The \\\"shift\\\" parameter can not be bigger than \\\"this.bitsCount\\\"\");\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\t// noinspection MagicNumberJS\r\n\t\tconst shiftMask = 0xFF >> (8 - shift);\r\n\t\tthis.view[this.view.length - 1] >>= shift;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Shift value\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tfor(let i = (this.view.length - 2); i >= 0; i--)\r\n\t\t{\r\n\t\t\t// noinspection NonShortCircuitBooleanExpressionJS\r\n\t\t\tthis.view[i + 1] |= (this.view[i] & shiftMask) << (8 - shift);\r\n\t\t\tthis.view[i] >>= shift;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Decrease number of bits stored into value\r\n\t\tthis.bitsCount -= shift;\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\tif(this.bitsCount == 0)\r\n\t\t\tthis.clear();\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Change stream size if needed\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(needShrink)\r\n\t\t\tthis.shrink();\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Shift entire \"BitStream\" value left to number of bits\r\n\t * @param {number} shift Number of bits to shift value\r\n\t */\r\n\tshiftLeft(shift)\r\n\t{\r\n\t\t/*\r\n\t\t NOTE: We do not really shift value because of internal structure of \"BitStream\":\r\n\t\t all bytes inside \"BitStream\" are aligned to right position. So, even if we will\r\n\t\t really shift value to left after that we will need again shift it right to the\r\n\t\t same number of bits. Thus all that we do here is hiding of left bits and descresing\r\n\t\t the \"bitsCount\" number.\r\n\t\t */\r\n\t\t\r\n\t\t//region Check parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\tif(this.view.length == 0)\r\n\t\t\treturn;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((shift < 0) || (shift > 8))\r\n\t\t\tthrow new Error(\"The \\\"shift\\\" parameter must be in range 0-8\");\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(shift > this.bitsCount)\r\n\t\t\tthrow new Error(\"The \\\"shift\\\" parameter can not be bigger than \\\"this.bitsCount\\\"\");\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Remove shifted bits\r\n\t\t// noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\r\n\t\tconst bitsOffset = this.bitsCount & 0x07;\r\n\t\tif(bitsOffset > shift)\r\n\t\t{\r\n\t\t\t// noinspection MagicNumberJS\r\n\t\t\tthis.view[0] &= 0xFF >> (bitsOffset + shift);\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\t//region Change size of buffer\r\n\t\t\tconst buffer = new ArrayBuffer(this.buffer.byteLength - 1);\r\n\t\t\tconst view = new Uint8Array(buffer);\r\n\t\t\t\r\n\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\tview.set(new Uint8Array(this.buffer, 1, this.buffer.byteLength - 1));\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Mask item with index 0\r\n\t\t\t// noinspection MagicNumberJS\r\n\t\t\tview[0] &= 0xFF >> (shift - bitsOffset);\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Store final array into current stream\r\n\t\t\tthis.buffer = buffer.slice(0);\r\n\t\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\t//endregion\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Decrease number of bits stored into value\r\n\t\tthis.bitsCount -= shift;\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\tif(this.bitsCount == 0)\r\n\t\t\tthis.clear();\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS, FunctionTooLongJS\r\n\t/**\r\n\t * Return slice of existing \"BitStream\"\r\n\t * @param {?number} [start=null] Start position of the slice (in bits)\r\n\t * @param {?number} [end=null] End position of the slice (in bits)\r\n\t * @returns {BitStream}\r\n\t */\r\n\tslice(start = null, end = null)\r\n\t{\r\n\t\t//region Make ability to pass non-value bits\r\n\t\tlet valueShift = 0;\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(this.bitsCount % 8)\r\n\t\t\tvalueShift = (8 - (this.bitsCount % 8));\r\n\t\t\r\n\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\tstart += valueShift;\r\n\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\tend += valueShift;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(start == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tstart = 0;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((start < 0) || (start > ((this.view.length << 3) - 1)))\r\n\t\t\treturn new BitStream(); //(\"Wrong start position: \" + start);\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(end == null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tend = (this.view.length << 3) - 1;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((end < 0) || (end > ((this.view.length << 3) - 1)))\r\n\t\t\treturn new BitStream(); //(\"Wrong end position: \" + end);\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif((end - start + 1) > this.bitsCount)\r\n\t\t\treturn new BitStream(); //(\"Maximum length is \" + this.bitsCount);\r\n\t\t\r\n\t\tconst startIndex = start >> 3;\r\n\t\t// noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\r\n\t\tconst startOffset = start & 0x07;\r\n\t\t\r\n\t\tconst endIndex = end >> 3;\r\n\t\t// noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\r\n\t\tconst endOffset = end & 0x07;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, ConditionalExpressionJS, EqualityComparisonWithCoercionJS\r\n\t\tconst bitsLength = ((endIndex - startIndex) == 0) ? 1 : (endIndex - startIndex + 1);\r\n\t\t\r\n\t\tconst result = new BitStream();\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Store \"primary bytes\"\r\n\t\tresult.buffer = new ArrayBuffer(bitsLength);\r\n\t\tresult.view = new Uint8Array(result.buffer);\r\n\t\tresult.bitsCount = bitsLength << 3;\r\n\t\t\r\n\t\t// noinspection NestedFunctionCallJS\r\n\t\tresult.view.set(new Uint8Array(this.buffer, startIndex, bitsLength));\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Change \"start byte\"\r\n\t\t// noinspection MagicNumberJS\r\n\t\tresult.view[0] &= (0xFF >> startOffset);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Change \"end byte\"\r\n\t\t// noinspection MagicNumberJS\r\n\t\tresult.view[bitsLength] &= (0xFF << (7 - endOffset));\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Shift result array to right\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(7 - endOffset)\r\n\t\t\tresult.shiftRight(7 - endOffset, false);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Set final number of bits\r\n\t\tresult.bitsCount = (end - start + 1);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Cut unnecessary bytes from result\r\n\t\tresult.shrink();\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Return copy of existing \"BitStream\"\r\n\t * @param {?number} [start=null] Start position of the copy (in bits)\r\n\t * @param {?number} [length=null] Length of the copy (in bits)\r\n\t * @returns {BitStream}\r\n\t */\r\n\tcopy(start = null, length = null)\r\n\t{\r\n\t\t//region Check input parameters\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif((start < 0) || (start > ((this.view.length << 3) - 1)))\r\n\t\t\treturn new BitStream(); //(\"Wrong start position: \" + start);\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS\r\n\t\tif(length === null)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = (this.view.length << 3) - start - 1;\r\n\t\t}\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(length > this.bitsCount)\r\n\t\t\treturn new BitStream(); //(\"Maximum length is \" + this.bitsCount);\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn this.slice(start, start + length - 1);\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Shrink unnecessary bytes in current stream accordingly to \"bitsCount\" value\r\n\t */\r\n\tshrink()\r\n\t{\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tconst currentLength = (this.bitsCount >> 3) + ((this.bitsCount % 8) ? 1 : 0);\r\n\t\tif(currentLength < this.buffer.byteLength)\r\n\t\t{\r\n\t\t\t//region Change size of buffer\r\n\t\t\tconst buffer = new ArrayBuffer(currentLength);\r\n\t\t\tconst view = new Uint8Array(buffer);\r\n\t\t\t\r\n\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\tview.set(new Uint8Array(this.buffer, this.buffer.byteLength - currentLength, currentLength));\r\n\t\t\t//endregion\r\n\t\t\t\r\n\t\t\t//region Store final array into current stream\r\n\t\t\tthis.buffer = buffer.slice(0);\r\n\t\t\tthis.view = new Uint8Array(this.buffer);\r\n\t\t\t//endregion\r\n\t\t}\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Reverse bits order in each byte in the stream\r\n\t * Got it from here: http://graphics.stanford.edu/~seander/bithacks.html#ReverseByteWith32Bits\r\n\t */\r\n\treverseBytes()\r\n\t{\r\n\t\t//region Reverse bits order in each byte in the stream\r\n\t\tfor(let i = 0; i < this.view.length; i++)\r\n\t\t{\r\n\t\t\t// noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\r\n\t\t\tthis.view[i] = ((this.view[i] * 0x0802 & 0x22110) | (this.view[i] * 0x8020 & 0x88440)) * 0x10101 >> 16;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Shift \"most significant\" byte\r\n\t\tif(this.bitsCount % 8)\r\n\t\t{\r\n\t\t\t// noinspection ConditionalExpressionJS\r\n\t\t\tconst currentLength = (this.bitsCount >> 3) + ((this.bitsCount % 8) ? 1 : 0);\r\n\t\t\t// noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\r\n\t\t\tthis.view[this.view.length - currentLength] >>= (8 - (this.bitsCount & 0x07));\r\n\t\t}\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Reverse all bits in entire \"BitStream\"\r\n\t */\r\n\treverseValue()\r\n\t{\r\n\t\tconst initialValue = this.toString();\r\n\t\tconst initialValueLength = initialValue.length;\r\n\t\t\r\n\t\tconst reversedValue = new Array(initialValueLength);\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tfor(let i = 0; i < initialValueLength; i++)\r\n\t\t\treversedValue[initialValueLength - 1 - i] = initialValue[i];\r\n\t\t\r\n\t\t// noinspection NestedFunctionCallJS\r\n\t\tthis.fromString(reversedValue.join(\"\"));\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Trying to represent entire \"BitStream\" as an unsigned integer.\r\n\t * @return {number}\r\n\t */\r\n\tgetNumberValue()\r\n\t{\r\n\t\t//region Initial variables\r\n\t\tconst byteLength = (this.buffer.byteLength - 1);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Check posibility for convertion\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tif(byteLength > 3)\r\n\t\t\treturn (-1);\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\tif(byteLength == (-1))\r\n\t\t\treturn 0;\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Convert byte array to \"Uint32Array\" value\r\n\t\tconst value = new Uint32Array(1);\r\n\t\tconst view = new Uint8Array(value.buffer);\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, NonBlockStatementBodyJS\r\n\t\tfor(let i = byteLength; i >= 0; i--)\r\n\t\t\tview[byteLength - i] = this.view[i];\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn value[0];\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find any bit pattern in \"BitStream\"\r\n\t * @param {BitStream} pattern Stream having pattern value\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {number}\r\n\t */\r\n\tfindPattern(pattern, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\tconst stringPattern = new ByteStream({\r\n\t\t\tstring: pattern.toString()\r\n\t\t});\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findPattern(stringPattern, start, length, backward);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find first position of any pattern from input array\r\n\t * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {{id: number, position: number}}\r\n\t */\r\n\tfindFirstIn(patterns, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringPatterns = new Array(patterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tstringPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: patterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findFirstIn(stringPatterns, start, length, backward);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find all positions of any pattern from input array\r\n\t * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllIn(patterns, start = null, length = null)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringPatterns = new Array(patterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tstringPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: patterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findAllIn(stringPatterns, start, length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find all positions of a pattern\r\n\t * @param {BitStream} pattern Stream having pattern value\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {Array|number}\r\n\t */\r\n\tfindAllPatternIn(pattern, start = null, length = null)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\" \r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\tconst stringPattern = new ByteStream({\r\n\t\t\tstring: pattern.toString()\r\n\t\t});\r\n\t\t//endregion \r\n\t\t\r\n\t\treturn stringStream.findAllPatternIn(stringPattern, start, length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find first position of data, not included in patterns from input array\r\n\t * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {{left: {id: number, position: *}, right: {id: number, position: number}, value: ByteStream}}\r\n\t */\r\n\tfindFirstNotIn(patterns, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringPatterns = new Array(patterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tstringPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: patterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findFirstNotIn(stringPatterns, start, length, backward);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find all positions of data, not included in patterns from input array\r\n\t * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllNotIn(patterns, start = null, length = null)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringPatterns = new Array(patterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tstringPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: patterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findAllNotIn(stringPatterns, start, length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find position of a sequence of any patterns from input array\r\n\t * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {{position, value}|*}\r\n\t */\r\n\tfindFirstSequence(patterns, start = null, length = null, backward = false)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringPatterns = new Array(patterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tstringPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: patterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findFirstSequence(stringPatterns, start, length, backward);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find position of a sequence of any patterns from input array\r\n\t * @param {Array.<BitStream>} patterns Array with patterns which should be found\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindAllSequences(patterns, start, length)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringPatterns = new Array(patterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tstringPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: patterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findAllSequences(stringPatterns, start, length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Find all paired patterns in the stream\r\n\t * @param {BitStream} leftPattern Left pattern to search for\r\n\t * @param {BitStream} rightPattern Right pattern to search for\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindPairedPatterns(leftPattern, rightPattern, start = null, length = null)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\tconst stringLeftPattern = new ByteStream({\r\n\t\t\tstring: leftPattern.toString()\r\n\t\t});\r\n\t\tconst stringRightPattern = new ByteStream({\r\n\t\t\tstring: rightPattern.toString()\r\n\t\t});\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findPairedPatterns(stringLeftPattern, stringRightPattern, start, length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleLoopsJS\r\n\t/**\r\n\t * Find all paired patterns in the stream\r\n\t * @param {Array.<BitStream>} inputLeftPatterns Array of left patterns to search for\r\n\t * @param {Array.<BitStream>} inputRightPatterns Array of right patterns to search for\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {Array}\r\n\t */\r\n\tfindPairedArrays(inputLeftPatterns, inputRightPatterns, start = null, length = null)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringLeftPatterns = new Array(inputLeftPatterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < inputLeftPatterns.length; i++)\r\n\t\t{\r\n\t\t\tstringLeftPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: inputLeftPatterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t\r\n\t\tconst stringRightPatterns = new Array(inputRightPatterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < inputRightPatterns.length; i++)\r\n\t\t{\r\n\t\t\tstringRightPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: inputRightPatterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.findPairedArrays(stringLeftPatterns, stringRightPatterns, start, length);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Replace one pattern with other\r\n\t * @param {BitStream} searchPattern The pattern to search for\r\n\t * @param {BitStream} replacePattern The pattern to replace initial pattern\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @returns {boolean}\r\n\t */\r\n\treplacePattern(searchPattern, replacePattern, start = null, length = null)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\tconst stringSearchPattern = new ByteStream({\r\n\t\t\tstring: searchPattern.toString()\r\n\t\t});\r\n\t\tconst stringReplacePattern = new ByteStream({\r\n\t\t\tstring: replacePattern.toString()\r\n\t\t});\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Re-initialize existing data\r\n\t\tif(stringStream.findPairedPatterns(stringSearchPattern, stringReplacePattern, start, length))\r\n\t\t{\r\n\t\t\t// noinspection NestedFunctionCallJS\r\n\t\t\tthis.fromString(stringStream.toString());\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn false;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Skip any pattern from input array\r\n\t * @param {Array.<BitStream>} patterns Array with patterns which should be ommited\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {*}\r\n\t */\r\n\tskipPatterns(patterns, start, length, backward)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringPatterns = new Array(patterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tstringPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: patterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.skipPatterns(stringPatterns, start, length, backward);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Skip any pattern not from input array\r\n\t * @param {Array.<BitStream>} patterns Array with patterns which should be ommited\r\n\t * @param {?number} [start=null] Start position to search from\r\n\t * @param {?number} [length=null] Length of byte block to search at\r\n\t * @param {boolean} [backward=false] Flag to search in backward order\r\n\t * @returns {number}\r\n\t */\r\n\tskipNotPatterns(patterns, start, length, backward)\r\n\t{\r\n\t\t//region Convert \"BitStream\" values to \"ByteStream\"\r\n\t\tconst stringStream = new ByteStream({\r\n\t\t\tstring: this.toString()\r\n\t\t});\r\n\t\t\r\n\t\tconst stringPatterns = new Array(patterns.length);\r\n\t\t\r\n\t\tfor(let i = 0; i < patterns.length; i++)\r\n\t\t{\r\n\t\t\tstringPatterns[i] = new ByteStream({\r\n\t\t\t\tstring: patterns[i].toString()\r\n\t\t\t});\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn stringStream.skipNotPatterns(stringPatterns, start, length, backward);\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Append a new \"BitStream\" content to the current \"BitStream\"\r\n\t * @param {BitStream} stream A new \"stream\" to append to current \"stream\"\r\n\t */\r\n\tappend(stream)\r\n\t{\r\n\t\t//region Initialize current stream with new data\r\n\t\t// noinspection NestedFunctionCallJS\r\n\t\tthis.fromString([\r\n\t\t\tthis.toString(),\r\n\t\t\tstream.toString()\r\n\t\t].join(\"\"));\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n}\r\n//**************************************************************************************\r\nexport class SeqBitStream\r\n{\r\n\t//**********************************************************************************\r\n\tconstructor(parameters = {})\r\n\t{\r\n\t\t//region Internal variables\r\n\t\tthis.stream = new BitStream();\r\n\t\t\r\n\t\tthis._start = 0;\r\n\t\tthis._length = this.stream.bitsCount;\r\n\t\t\r\n\t\tthis.backward = false;\r\n\t\t\r\n\t\tthis.appendBlock = 0;\r\n\t\t//endregion\r\n\t\t\r\n\t\tfor(const key of Object.keys(parameters))\r\n\t\t{\r\n\t\t\tswitch(key)\r\n\t\t\t{\r\n\t\t\t\tcase \"stream\":\r\n\t\t\t\tcase \"start\":\r\n\t\t\t\tcase \"length\":\r\n\t\t\t\tcase \"backward\":\r\n\t\t\t\tcase \"appendBlock\":\r\n\t\t\t\t\tthis[key] = parameters[key];\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tdefault:\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\tset start(value)\r\n\t{\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(value > this.stream.bitsCount)\r\n\t\t\treturn;\r\n\t\t\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tthis._length -= ((this.backward) ? (this._start - value) : (value - this._start));\r\n\t\tthis._start = value;\r\n\t\t\r\n\t\t//region Initialization of \"prev\" internal variables\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis.prevStart = this._start;\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis.prevLength = this._length;\r\n\t\t//endregion\r\n\t}\r\n\t//**********************************************************************************\r\n\tget start()\r\n\t{\r\n\t\treturn this._start;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionWithMultipleReturnPointsJS\r\n\tset length(value)\r\n\t{\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(value > this.stream.bitsCount)\r\n\t\t\treturn;\r\n\t\t\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis.prevLength = this._length;\r\n\t\tthis._length = value;\r\n\t}\r\n\t//**********************************************************************************\r\n\tget length()\r\n\t{\r\n\t\treturn this._length;\r\n\t}\r\n\t//**********************************************************************************\r\n\tset stream(value)\r\n\t{\r\n\t\tthis._stream = value;\r\n\t\t\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis.prevLength = this._length;\r\n\t\tthis._length = value.bitsCount;\r\n\t\t\r\n\t\t// noinspection JSUnusedGlobalSymbols\r\n\t\tthis.prevStart = this._start;\r\n\t\t// noinspection ConditionalExpressionJS\r\n\t\tthis._start = (this.backward) ? this.length : 0;\r\n\t}\r\n\t//**********************************************************************************\r\n\tget stream()\r\n\t{\r\n\t\treturn this._stream;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols\r\n\t/**\r\n\t * Get next \"length\" bits from the stream\r\n\t * @param {number} length Number of bits to read\r\n\t * @returns {*}\r\n\t */\r\n\tgetBits(length)\r\n\t{\r\n\t\t//region Check input parameters \r\n\t\tif((this.start + length) > this.stream.bitsCount)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = (this.stream.bitsCount - this.start);\r\n\t\t}\r\n\t\t//endregion \r\n\t\t\r\n\t\t//region Initial variables \r\n\t\tlet result;\r\n\t\t//endregion \r\n\t\t\r\n\t\t//region Copy necessary length of bits\r\n\t\tif(this.backward)\r\n\t\t{\r\n\t\t\tresult = this.stream.copy(this.start - length, length);\r\n\t\t\tthis.start -= result.bitsCount;\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tresult = this.stream.copy(this.start, length);\r\n\t\t\tthis.start += result.bitsCount;\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection FunctionTooLongJS\r\n\t/**\r\n\t * Get string representation for the next \"length\" bits from the stream\r\n\t * @param {number} length Number of bits to read\r\n\t * @returns {string}\r\n\t */\r\n\tgetBitsString(length)\r\n\t{\r\n\t\t//region Check input parameters\r\n\t\tif((this.start + length) > this.stream.bitsCount)\r\n\t\t{\r\n\t\t\t// noinspection AssignmentToFunctionParameterJS\r\n\t\t\tlength = (this.stream.bitsCount - this.start);\r\n\t\t}\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Initial variables\r\n\t\tlet result = [];\r\n\t\t\r\n\t\tlet start;\r\n\t\t\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(this.backward)\r\n\t\t\tstart = this.start - length;\r\n\t\telse\r\n\t\t\tstart = this.start;\r\n\t\t\r\n\t\tlet end = this.start + length - 1;\r\n\t\t\r\n\t\t//region Make ability to pass non-value bits\r\n\t\tlet valueShift = 0;\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(this.stream.bitsCount % 8)\r\n\t\t\tvalueShift = (8 - (this.stream.bitsCount % 8));\r\n\t\t\r\n\t\tstart += valueShift;\r\n\t\tend += valueShift;\r\n\t\t//endregion\r\n\t\t\r\n\t\tconst startIndex = start >> 3;\r\n\t\t// noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\r\n\t\tconst startOffset = start & 0x07;\r\n\t\t\r\n\t\tconst endIndex = end >> 3;\r\n\t\t// noinspection MagicNumberJS, NonShortCircuitBooleanExpressionJS\r\n\t\tconst endOffset = end & 0x07;\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, ConditionalExpressionJS, EqualityComparisonWithCoercionJS\r\n\t\tconst bitsLengthIndex = startIndex + (((endIndex - startIndex) == 0) ? 1 : (endIndex - startIndex + 1));\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Get string representation of bits\r\n\t\tfor(let i = startIndex; i < bitsLengthIndex; i++)\r\n\t\t{\r\n\t\t\tlet value = bitsToStringArray[this.stream.view[i]];\r\n\t\t\t\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\t\tif(i == startIndex)\r\n\t\t\t\tvalue = value.slice(startOffset);\r\n\t\t\t\r\n\t\t\t// noinspection EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\t\tif(i == (bitsLengthIndex - 1))\r\n\t\t\t\tvalue = value.slice(0, endOffset - 7 + value.length);\r\n\t\t\t\r\n\t\t\tresult.push(value);\r\n\t\t}\r\n\t\t\r\n\t\tresult = result.join(\"\");\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Change internal values\r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tif(this.backward)\r\n\t\t\tthis.start -= result.length;\r\n\t\telse\r\n\t\t\tthis.start += result.length;\r\n\t\t//endregion\r\n\t\t\r\n\t\treturn result;\r\n\t}\r\n\t//**********************************************************************************\r\n\t// noinspection JSUnusedGlobalSymbols, FunctionWithMultipleLoopsJS, FunctionWithMultipleReturnPointsJS\r\n\t/**\r\n\t * Get number value representation of the next \"length\" bits from the stream, preliminary reversed\r\n\t * @param {number} length Number of bits to read\r\n\t * @returns {*}\r\n\t */\r\n\tgetBitsReversedValue(length)\r\n\t{\r\n\t\t//region Initial variables \r\n\t\tconst initialValue = this.getBitsString(length);\r\n\t\tconst initialValueLength = initialValue.length;\r\n\t\t\r\n\t\tlet byteIndex;\r\n\t\t\r\n\t\tconst initialOffset = 8 - (initialValueLength % 8);\r\n\t\t\r\n\t\tconst reversedValue = new Array(initialValueLength);\r\n\t\t\r\n\t\tconst value = new Uint32Array(1);\r\n\t\tconst valueView = new Uint8Array(value.buffer, 0, 4);\r\n\t\t\r\n\t\tlet i;\r\n\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, MagicNumberJS, NonBlockStatementBodyJS\r\n\t\tif(initialValueLength > 32)\r\n\t\t\treturn (-1);\r\n\t\t\r\n\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, MagicNumberJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\tif(length == 32)\r\n\t\t\tbyteIndex = 3;\r\n\t\telse\r\n\t\t\tbyteIndex = ((initialValueLength - 1) >> 3);\r\n\t\t//endregion\r\n\t\t\r\n\t\t//region Reverse value \r\n\t\t// noinspection NonBlockStatementBodyJS\r\n\t\tfor(i = 0; i < initialValueLength; i++)\r\n\t\t\treversedValue[initialValueLength - 1 - i] = initialValue[i];\r\n\t\t//endregion \r\n\t\t\r\n\t\t//region Convert byte array to \"Uint32Array\" value \r\n\t\tfor(i = initialOffset; i < (initialOffset + initialValueLength); i++)\r\n\t\t{\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS\r\n\t\t\tif(reversedValue[i - initialOffset] == \"1\")\r\n\t\t\t{\r\n\t\t\t\t// noinspection MagicNumberJS\r\n\t\t\t\tvalueView[byteIndex] |= 0x01 << (7 - (i % 8));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\t// noinspection ConstantOnRightSideOfComparisonJS, ConstantOnLeftSideOfComparisonJS, EqualityComparisonWithCoercionJS, NonBlockStatementBodyJS\r\n\t\t\tif(i && (((i + 1) % 8) == 0))\r\n\t\t\t\tbyteIndex--;\r\n\t\t}\r\n\t\t//endregion \r\n\t\t\r\n\t\treturn value[0];\r\n\t}\r\n\t//**********************************************************************************\r\n\t/**\r\n\t * Represent remaining bits in \"BitStream\" as a string\r\n\t * @return {string}\r\n\t */\r\n\ttoString()\r\n\t{\r\n\t\tconst streamToDisplay = this.stream.copy(this.start, this.length);\r\n\t\treturn streamToDisplay.toString();\r\n\t}\r\n\t//**********************************************************************************\r\n}\r\n//**************************************************************************************\r\n"],"sourceRoot":""}