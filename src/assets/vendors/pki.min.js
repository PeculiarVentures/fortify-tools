"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _slicedToArray=function(){function e(e,t){var r=[],a=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(r.push(s.value),!t||r.length!==t);a=!0);}catch(e){n=!0,i=e}finally{try{!a&&o.return&&o.return()}finally{if(n)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_get=function e(t,r,a){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,r);if(void 0===n){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,a)}if("value"in n)return n.value;var s=n.get;if(void 0!==s)return s.call(a)},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.pkijs=e.pkijs||{})}(this,function(e){function t(e,t,r){return e instanceof Object==!1?r:t in e?e[t]:r}function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.byteLength,a="",n=!0,i=!1,s=void 0;try{for(var o,u=new Uint8Array(e,t,r)[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var l=o.value.toString(16).toUpperCase();a=a+(1===l.length?"0":"")+l}}catch(e){i=!0,s=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw s}}return a}function a(e,t,r,a){return t instanceof ArrayBuffer==!1?(e.error='Wrong parameter: inputBuffer must be "ArrayBuffer"',!1):0===t.byteLength?(e.error="Wrong parameter: inputBuffer has zero length",!1):r<0?(e.error="Wrong parameter: inputOffset less than zero",!1):a<0?(e.error="Wrong parameter: inputLength less than zero",!1):!(t.byteLength-r-a<0)||(e.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1)}function n(e,t){for(var r=0,a=e.length-1;a>=0;a--)r+=e[e.length-1-a]*Math.pow(2,t*a);return r}function i(e,t){for(var r=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0)||-1,a=e,n=0,i=Math.pow(2,t),s=1;s<8;s++){if(e<i){var o=void 0;if(r<0)o=new ArrayBuffer(s),n=s;else{if(r<s)return new ArrayBuffer(0);o=new ArrayBuffer(r),n=r}for(var u=new Uint8Array(o),l=s-1;l>=0;l--){var c=Math.pow(2,l*t);u[n-l-1]=Math.floor(a/c),a-=u[n-l-1]*c}return o}i*=Math.pow(2,t)}return new ArrayBuffer(0)}function s(){for(var e=0,t=0,r=arguments.length,a=Array(r),n=0;n<r;n++)a[n]=arguments[n];var i=!0,s=!1,o=void 0;try{for(var u,l=a[Symbol.iterator]();!(i=(u=l.next()).done);i=!0)e+=u.value.byteLength}catch(e){s=!0,o=e}finally{try{!i&&l.return&&l.return()}finally{if(s)throw o}}var c=new ArrayBuffer(e),h=new Uint8Array(c),m=!0,f=!1,v=void 0;try{for(var d,g=a[Symbol.iterator]();!(m=(d=g.next()).done);m=!0){var y=d.value;h.set(new Uint8Array(y),t),t+=y.byteLength}}catch(e){f=!0,v=e}finally{try{!m&&g.return&&g.return()}finally{if(f)throw v}}return c}function o(){var e=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){var t=255===e[0]&&128&e[1],r=0===e[0]&&0==(128&e[1]);(t||r)&&this.warnings.push("Needlessly long format")}for(var a=new ArrayBuffer(this.valueHex.byteLength),i=new Uint8Array(a),s=0;s<this.valueHex.byteLength;s++)i[s]=0;i[0]=128&e[0];for(var o=n(i,8),u=new ArrayBuffer(this.valueHex.byteLength),l=new Uint8Array(u),c=0;c<this.valueHex.byteLength;c++)l[c]=e[c];return l[0]&=127,n(l,8)-o}function u(e){for(var t=e<0?-1*e:e,r=128,a=1;a<8;a++){if(t<=r){if(e<0){var n=i(r-t,8,a);return new Uint8Array(n)[0]|=128,n}var s=i(t,8,a),o=new Uint8Array(s);if(128&o[0]){var u=s.slice(0),l=new Uint8Array(u);s=new ArrayBuffer(s.byteLength+1),o=new Uint8Array(s);for(var c=0;c<u.byteLength;c++)o[c+1]=l[c];o[0]=0}return s}r*=Math.pow(2,8)}return new ArrayBuffer(0)}function l(e,t){if(e.byteLength!==t.byteLength)return!1;for(var r=new Uint8Array(e),a=new Uint8Array(t),n=0;n<r.length;n++)if(r[n]!==a[n])return!1;return!0}function c(e,t){for(var r=e.toString(10),a=t-r.length,n=new Array(a),i=0;i<a;i++)n[i]="0";return n.join("").concat(r)}function h(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=0,i=0,s=0,o="",u=t?U:H;if(a){for(var l=0,c=0;c<e.length;c++)if(0!==e.charCodeAt(c)){l=c;break}e=e.slice(l)}for(;n<e.length;){var h=e.charCodeAt(n++);n>=e.length&&(i=1);var m=e.charCodeAt(n++);n>=e.length&&(s=1);var f=e.charCodeAt(n++),v=h>>2,d=(3&h)<<4|m>>4,g=(15&m)<<2|f>>6,y=63&f;1===i?g=y=64:1===s&&(y=64),o+=r?64===g?""+u.charAt(v)+u.charAt(d):64===y?""+u.charAt(v)+u.charAt(d)+u.charAt(g):""+u.charAt(v)+u.charAt(d)+u.charAt(g)+u.charAt(y):""+u.charAt(v)+u.charAt(d)+u.charAt(g)+u.charAt(y)}return o}function m(e){function t(e){for(var t=0;t<64;t++)if(i.charAt(t)===e)return t;return 64}function r(e){return 64===e?0:e}for(var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=a?U:H,s=0,o="";s<e.length;){var u=t(e.charAt(s++)),l=s>=e.length?0:t(e.charAt(s++)),c=s>=e.length?0:t(e.charAt(s++)),h=s>=e.length?0:t(e.charAt(s++)),m=r(u)<<2|r(l)>>4,f=(15&r(l))<<4|r(c)>>2,v=(3&r(c))<<6|r(h);o+=String.fromCharCode(m),64!==c&&(o+=String.fromCharCode(f)),64!==h&&(o+=String.fromCharCode(v))}if(n){for(var d=-1,g=o.length-1;g>=0;g--)if(0!==o.charCodeAt(g)){d=g;break}-1!==d&&(o=o.slice(0,d+1))}return o}function f(e){var t="",r=new Uint8Array(e),a=!0,n=!1,i=void 0;try{for(var s,o=r[Symbol.iterator]();!(a=(s=o.next()).done);a=!0){var u=s.value;t+=String.fromCharCode(u)}}catch(e){n=!0,i=e}finally{try{!a&&o.return&&o.return()}finally{if(n)throw i}}return t}function v(e){for(var t=e.length,r=new ArrayBuffer(t),a=new Uint8Array(r),n=0;n<t;n++)a[n]=e.charCodeAt(n);return r}function d(e,t,r){var n=t,i=new F({},Object);if(!1===a(new L,e,t,r))return i.error="Wrong input parameters",{offset:-1,result:i};if(0===new Uint8Array(e,t,r).length)return this.error="Zero buffer length",{offset:-1,result:i};var s=i.idBlock.fromBER(e,t,r);if(i.warnings.concat(i.idBlock.warnings),-1===s)return i.error=i.idBlock.error,{offset:-1,result:i};if(t=s,r-=i.idBlock.blockLength,s=i.lenBlock.fromBER(e,t,r),i.warnings.concat(i.lenBlock.warnings),-1===s)return i.error=i.lenBlock.error,{offset:-1,result:i};if(t=s,r-=i.lenBlock.blockLength,!1===i.idBlock.isConstructed&&!0===i.lenBlock.isIndefiniteForm)return i.error="Indefinite length form used for primitive encoding form",{offset:-1,result:i};var o=F;switch(i.idBlock.tagClass){case 1:if(i.idBlock.tagNumber>=37&&!1===i.idBlock.isHexOnly)return i.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:i};switch(i.idBlock.tagNumber){case 0:if(!0===i.idBlock.isConstructed&&i.lenBlock.length>0)return i.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:i};o=$;break;case 1:o=Y;break;case 2:o=ue;break;case 3:o=se;break;case 4:o=ne;break;case 5:o=re;break;case 6:o=me;break;case 10:o=le;break;case 12:o=ve;break;case 14:o=Re;break;case 15:return i.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:i};case 16:o=ee;break;case 17:o=te;break;case 18:o=we;break;case 19:o=Ce;break;case 20:o=Se;break;case 21:o=Ae;break;case 22:o=Ie;break;case 23:o=xe;break;case 24:o=Oe;break;case 25:o=Be;break;case 26:o=Ne;break;case 27:o=Pe;break;case 28:o=pe;break;case 29:o=Ee;break;case 30:o=ge;break;case 31:o=Ve;break;case 32:o=_e;break;case 33:o=je;break;case 34:o=De;break;default:var u=void 0;(u=!0===i.idBlock.isConstructed?new z:new G).idBlock=i.idBlock,u.lenBlock=i.lenBlock,u.warnings=i.warnings,s=(i=u).fromBER(e,t,r)}break;case 2:case 3:case 4:default:o=!0===i.idBlock.isConstructed?z:G}return i=function(e,t){if(e instanceof t)return e;var r=new t;return r.idBlock=e.idBlock,r.lenBlock=e.lenBlock,r.warnings=e.warnings,r.valueBeforeDecode=e.valueBeforeDecode.slice(0),r}(i,o),s=i.fromBER(e,t,!0===i.lenBlock.isIndefiniteForm?r:i.lenBlock.length),i.valueBeforeDecode=e.slice(n,n+i.blockLength),{offset:s,result:i}}function g(e){if(0===e.byteLength){var t=new F({},Object);return t.error="Input buffer has zero length",{offset:-1,result:t}}return d(e,0,e.byteLength)}function y(e,t,r){if(r instanceof Ke){for(var a=0;a<r.value.length;a++)if(!0===y(e,t,r.value[a]).verified)return{verified:!0,result:e};var n={verified:!1,result:{error:"Wrong values for Choice type"}};return r.hasOwnProperty("name")&&(n.name=r.name),n}if(r instanceof He)return r.hasOwnProperty("name")&&(e[r.name]=t),{verified:!0,result:e};if(e instanceof Object==!1)return{verified:!1,result:{error:"Wrong root object"}};if(t instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(r instanceof Object==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("idBlock"in r==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("fromBER"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if("toBER"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};var i=r.idBlock.toBER(!1);if(0===i.byteLength)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(-1===r.idBlock.fromBER(i,0,i.byteLength))return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(!1===r.idBlock.hasOwnProperty("tagClass"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagClass!==t.idBlock.tagClass)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("tagNumber"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.tagNumber!==t.idBlock.tagNumber)return{verified:!1,result:e};if(!1===r.idBlock.hasOwnProperty("isConstructed"))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isConstructed!==t.idBlock.isConstructed)return{verified:!1,result:e};if("isHexOnly"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(r.idBlock.isHexOnly!==t.idBlock.isHexOnly)return{verified:!1,result:e};if(!0===r.idBlock.isHexOnly){if("valueHex"in r.idBlock==!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};var s=new Uint8Array(r.idBlock.valueHex),o=new Uint8Array(t.idBlock.valueHex);if(s.length!==o.length)return{verified:!1,result:e};for(var u=0;u<s.length;u++)if(s[u]!==o[1])return{verified:!1,result:e}}if(r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(e[r.name]=t)),!0===r.idBlock.isConstructed){var l=0,c={verified:!1},h=r.valueBlock.value.length;if(h>0&&r.valueBlock.value[0]instanceof Ue&&(h=t.valueBlock.value.length),0===h)return{verified:!0,result:e};if(0===t.valueBlock.value.length&&0!==r.valueBlock.value.length){for(var m=!0,f=0;f<r.valueBlock.value.length;f++)m=m&&(r.valueBlock.value[f].optional||!1);return!0===m?{verified:!0,result:e}:(r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&delete e[r.name]),e.error="Inconsistent object length",{verified:!1,result:e})}for(var v=0;v<h;v++)if(v-l>=t.valueBlock.value.length){if(!1===r.valueBlock.value[v].optional){var d={verified:!1,result:e};return e.error="Inconsistent length between ASN.1 data and schema",r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(delete e[r.name],d.name=r.name)),d}}else if(r.valueBlock.value[0]instanceof Ue){if(!1===(c=y(e,t.valueBlock.value[v],r.valueBlock.value[0].value)).verified){if(!0!==r.valueBlock.value[0].optional)return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&delete e[r.name]),c;l++}if("name"in r.valueBlock.value[0]&&r.valueBlock.value[0].name.length>0){var p={};void 0===(p="local"in r.valueBlock.value[0]&&!0===r.valueBlock.value[0].local?t:e)[r.valueBlock.value[0].name]&&(p[r.valueBlock.value[0].name]=[]),p[r.valueBlock.value[0].name].push(t.valueBlock.value[v])}}else if(!1===(c=y(e,t.valueBlock.value[v-l],r.valueBlock.value[v])).verified){if(!0!==r.valueBlock.value[v].optional)return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&delete e[r.name]),c;l++}if(!1===c.verified){var k={verified:!1,result:e};return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(delete e[r.name],k.name=r.name)),k}return{verified:!0,result:e}}if("primitiveSchema"in r&&"valueHex"in t.valueBlock){var b=g(t.valueBlock.valueHex);if(-1===b.offset){var w={verified:!1,result:b.result};return r.hasOwnProperty("name")&&(r.name=r.name.replace(/^\s+|\s+$/g,""),""!==r.name&&(delete e[r.name],w.name=r.name)),w}return y(e,b.result,r.primitiveSchema)}return{verified:!0,result:e}}function p(e,t,r){Xe={name:e,crypto:t,subtle:r}}function k(){return Xe}function b(){if(null!==Xe.subtle)return Xe.subtle}function w(e){if(null!==Xe.crypto)return Xe.crypto.getRandomValues(e);throw new Error("No support for Web Cryptography API")}function C(e){var t="";switch(e.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":switch(e.hash.name.toUpperCase()){case"SHA-1":t="1.2.840.113549.1.1.5";break;case"SHA-256":t="1.2.840.113549.1.1.11";break;case"SHA-384":t="1.2.840.113549.1.1.12";break;case"SHA-512":t="1.2.840.113549.1.1.13"}break;case"RSA-PSS":t="1.2.840.113549.1.1.10";break;case"RSA-OAEP":t="1.2.840.113549.1.1.7";break;case"ECDSA":switch(e.hash.name.toUpperCase()){case"SHA-1":t="1.2.840.10045.4.1";break;case"SHA-256":t="1.2.840.10045.4.3.2";break;case"SHA-384":t="1.2.840.10045.4.3.3";break;case"SHA-512":t="1.2.840.10045.4.3.4"}break;case"ECDH":switch(e.kdf.toUpperCase()){case"SHA-1":t="1.3.133.16.840.63.0.2";break;case"SHA-256":t="1.3.132.1.11.1";break;case"SHA-384":t="1.3.132.1.11.2";break;case"SHA-512":t="1.3.132.1.11.3"}break;case"AES-CTR":break;case"AES-CBC":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.2";break;case 192:t="2.16.840.1.101.3.4.1.22";break;case 256:t="2.16.840.1.101.3.4.1.42"}break;case"AES-CMAC":break;case"AES-GCM":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.6";break;case 192:t="2.16.840.1.101.3.4.1.26";break;case 256:t="2.16.840.1.101.3.4.1.46"}break;case"AES-CFB":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.4";break;case 192:t="2.16.840.1.101.3.4.1.24";break;case 256:t="2.16.840.1.101.3.4.1.44"}break;case"AES-KW":switch(e.length){case 128:t="2.16.840.1.101.3.4.1.5";break;case 192:t="2.16.840.1.101.3.4.1.25";break;case 256:t="2.16.840.1.101.3.4.1.45"}break;case"HMAC":switch(e.hash.name.toUpperCase()){case"SHA-1":t="1.2.840.113549.2.7";break;case"SHA-256":t="1.2.840.113549.2.9";break;case"SHA-384":t="1.2.840.113549.2.10";break;case"SHA-512":t="1.2.840.113549.2.11"}break;case"DH":t="1.2.840.113549.1.9.16.3.5";break;case"SHA-1":t="1.3.14.3.2.26";break;case"SHA-256":t="2.16.840.1.101.3.4.2.1";break;case"SHA-384":t="2.16.840.1.101.3.4.2.2";break;case"SHA-512":t="2.16.840.1.101.3.4.2.3";break;case"CONCAT":case"HKDF":break;case"PBKDF2":t="1.2.840.113549.1.5.12";break;case"P-256":t="1.2.840.10045.3.1.7";break;case"P-384":t="1.3.132.0.34";break;case"P-521":t="1.3.132.0.35"}return t}function S(e,t){var r={algorithm:{},usages:[]};switch(e.toUpperCase()){case"RSASSA-PKCS1-V1_5":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["sign","verify"]};break;case"verify":case"sign":case"importkey":r={algorithm:{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},usages:["verify"]};break;case"exportkey":default:return{algorithm:{name:"RSASSA-PKCS1-v1_5"},usages:[]}}break;case"RSA-PSS":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"},saltLength:20},usages:["sign","verify"]};break;case"generatekey":r={algorithm:{name:"RSA-PSS",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"RSA-PSS",hash:{name:"SHA-1"}},usages:["verify"]};break;case"exportkey":default:return{algorithm:{name:"RSA-PSS"},usages:[]}}break;case"RSA-OAEP":switch(t.toLowerCase()){case"encrypt":case"decrypt":r={algorithm:{name:"RSA-OAEP"},usages:["encrypt","decrypt"]};break;case"generatekey":r={algorithm:{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"importkey":r={algorithm:{name:"RSA-OAEP",hash:{name:"SHA-256"}},usages:["encrypt"]};break;case"exportkey":default:return{algorithm:{name:"RSA-OAEP"},usages:[]}}break;case"ECDSA":switch(t.toLowerCase()){case"generatekey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["sign","verify"]};break;case"importkey":r={algorithm:{name:"ECDSA",namedCurve:"P-256"},usages:["verify"]};break;case"verify":case"sign":r={algorithm:{name:"ECDSA",hash:{name:"SHA-256"}},usages:["sign"]};break;default:return{algorithm:{name:"ECDSA"},usages:[]}}break;case"ECDH":switch(t.toLowerCase()){case"exportkey":case"importkey":case"generatekey":r={algorithm:{name:"ECDH",namedCurve:"P-256"},usages:["deriveKey","deriveBits"]};break;case"derivekey":case"derivebits":r={algorithm:{name:"ECDH",namedCurve:"P-256",public:[]},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"ECDH"},usages:[]}}break;case"AES-CTR":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CTR",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CTR",counter:new Uint8Array(16),length:10},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CTR"},usages:[]}}break;case"AES-CBC":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-CBC",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-CBC",iv:w(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-CBC"},usages:[]}}break;case"AES-GCM":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"AES-GCM",length:256},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;case"decrypt":case"encrypt":r={algorithm:{name:"AES-GCM",iv:w(new Uint8Array(16))},usages:["encrypt","decrypt","wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-GCM"},usages:[]}}break;case"AES-KW":switch(t.toLowerCase()){case"importkey":case"exportkey":case"generatekey":case"wrapkey":case"unwrapkey":r={algorithm:{name:"AES-KW",length:256},usages:["wrapKey","unwrapKey"]};break;default:return{algorithm:{name:"AES-KW"},usages:[]}}break;case"HMAC":switch(t.toLowerCase()){case"sign":case"verify":r={algorithm:{name:"HMAC"},usages:["sign","verify"]};break;case"importkey":case"exportkey":case"generatekey":r={algorithm:{name:"HMAC",length:32,hash:{name:"SHA-256"}},usages:["sign","verify"]};break;default:return{algorithm:{name:"HMAC"},usages:[]}}break;case"HKDF":switch(t.toLowerCase()){case"derivekey":r={algorithm:{name:"HKDF",hash:"SHA-256",salt:new Uint8Array([]),info:new Uint8Array([])},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"HKDF"},usages:[]}}break;case"PBKDF2":switch(t.toLowerCase()){case"derivekey":r={algorithm:{name:"PBKDF2",hash:{name:"SHA-256"},salt:new Uint8Array([]),iterations:1e3},usages:["encrypt","decrypt"]};break;default:return{algorithm:{name:"PBKDF2"},usages:[]}}}return r}function A(e){if(e.byteLength%2!=0)return new ArrayBuffer(0);var t=e.byteLength/2,r=new ArrayBuffer(t);new Uint8Array(r).set(new Uint8Array(e,0,t));var a=new ue({valueHex:r}),n=new ArrayBuffer(t);new Uint8Array(n).set(new Uint8Array(e,t,t));var i=new ue({valueHex:n});return new ee({value:[a.convertToDER(),i.convertToDER()]}).toBER(!1)}function I(e){var t=e.replace(/^\s+|\s+$/g,"");return t=t.replace(/\s+/g," "),t=t.toLowerCase()}function B(e){if(e instanceof ee==!1)return new ArrayBuffer(0);if(2!==e.valueBlock.value.length)return new ArrayBuffer(0);if(e.valueBlock.value[0]instanceof ue==!1)return new ArrayBuffer(0);if(e.valueBlock.value[1]instanceof ue==!1)return new ArrayBuffer(0);var t=e.valueBlock.value[0].convertFromDER(),r=e.valueBlock.value[1].convertFromDER();return s(t.valueBlock.valueHex,r.valueBlock.valueHex)}function N(e){switch(e){case"1.2.840.113549.1.1.1":case"1.2.840.113549.1.1.5":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case"1.2.840.113549.1.1.11":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"1.2.840.113549.1.1.12":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case"1.2.840.113549.1.1.13":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case"1.2.840.113549.1.1.10":return{name:"RSA-PSS"};case"1.2.840.113549.1.1.7":return{name:"RSA-OAEP"};case"1.2.840.10045.2.1":case"1.2.840.10045.4.1":return{name:"ECDSA",hash:{name:"SHA-1"}};case"1.2.840.10045.4.3.2":return{name:"ECDSA",hash:{name:"SHA-256"}};case"1.2.840.10045.4.3.3":return{name:"ECDSA",hash:{name:"SHA-384"}};case"1.2.840.10045.4.3.4":return{name:"ECDSA",hash:{name:"SHA-512"}};case"1.3.133.16.840.63.0.2":return{name:"ECDH",kdf:"SHA-1"};case"1.3.132.1.11.1":return{name:"ECDH",kdf:"SHA-256"};case"1.3.132.1.11.2":return{name:"ECDH",kdf:"SHA-384"};case"1.3.132.1.11.3":return{name:"ECDH",kdf:"SHA-512"};case"2.16.840.1.101.3.4.1.2":return{name:"AES-CBC",length:128};case"2.16.840.1.101.3.4.1.22":return{name:"AES-CBC",length:192};case"2.16.840.1.101.3.4.1.42":return{name:"AES-CBC",length:256};case"2.16.840.1.101.3.4.1.6":return{name:"AES-GCM",length:128};case"2.16.840.1.101.3.4.1.26":return{name:"AES-GCM",length:192};case"2.16.840.1.101.3.4.1.46":return{name:"AES-GCM",length:256};case"2.16.840.1.101.3.4.1.4":return{name:"AES-CFB",length:128};case"2.16.840.1.101.3.4.1.24":return{name:"AES-CFB",length:192};case"2.16.840.1.101.3.4.1.44":return{name:"AES-CFB",length:256};case"2.16.840.1.101.3.4.1.5":return{name:"AES-KW",length:128};case"2.16.840.1.101.3.4.1.25":return{name:"AES-KW",length:192};case"2.16.840.1.101.3.4.1.45":return{name:"AES-KW",length:256};case"1.2.840.113549.2.7":return{name:"HMAC",hash:{name:"SHA-1"}};case"1.2.840.113549.2.9":return{name:"HMAC",hash:{name:"SHA-256"}};case"1.2.840.113549.2.10":return{name:"HMAC",hash:{name:"SHA-384"}};case"1.2.840.113549.2.11":return{name:"HMAC",hash:{name:"SHA-512"}};case"1.2.840.113549.1.9.16.3.5":return{name:"DH"};case"1.3.14.3.2.26":return{name:"SHA-1"};case"2.16.840.1.101.3.4.2.1":return{name:"SHA-256"};case"2.16.840.1.101.3.4.2.2":return{name:"SHA-384"};case"2.16.840.1.101.3.4.2.3":return{name:"SHA-512"};case"1.2.840.113549.1.5.12":return{name:"PBKDF2"};case"1.2.840.10045.3.1.7":return{name:"P-256"};case"1.3.132.0.34":return{name:"P-384"};case"1.3.132.0.35":return{name:"P-521"}}return{}}function P(e){var t="";switch(e.algorithmId){case"1.2.840.10045.4.1":case"1.2.840.113549.1.1.5":t="SHA-1";break;case"1.2.840.10045.4.3.2":case"1.2.840.113549.1.1.11":t="SHA-256";break;case"1.2.840.10045.4.3.3":case"1.2.840.113549.1.1.12":t="SHA-384";break;case"1.2.840.10045.4.3.4":case"1.2.840.113549.1.1.13":t="SHA-512";break;case"1.2.840.113549.1.1.10":try{var r=new Je({schema:e.algorithmParams});if("hashAlgorithm"in r){var a=N(r.hashAlgorithm.algorithmId);if("name"in a==!1)return"";t=a.name}else t="SHA-1"}catch(e){}}return t}function E(e,t,r,a){switch(e.toUpperCase()){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;default:return Promise.reject("Unknown hash function: "+e)}if(t instanceof ArrayBuffer==!1)return Promise.reject('Please set "Zbuffer" as "ArrayBuffer"');if(0===t.byteLength)return Promise.reject('"Zbuffer" has zero length, error');if(a instanceof ArrayBuffer==!1)return Promise.reject('Please set "SharedInfo" as "ArrayBuffer"');if(r>255)return Promise.reject('Please set "Counter" variable to value less or equal to 255');var n=new ArrayBuffer(4),i=new Uint8Array(n);i[0]=0,i[1]=0,i[2]=0,i[3]=r;var o=new ArrayBuffer(0),u=b();return void 0===u?Promise.reject("Unable to create WebCrypto object"):(o=s(o,t),o=s(o,n),o=s(o,a),u.digest({name:e},o).then(function(e){return{counter:r,result:e}}))}function x(e,t,r,a){var n=0,i=1,o=[];switch(e.toUpperCase()){case"SHA-1":n=160;break;case"SHA-256":n=256;break;case"SHA-384":n=384;break;case"SHA-512":n=512;break;default:return Promise.reject("Unknown hash function: "+e)}if(t instanceof ArrayBuffer==!1)return Promise.reject('Please set "Zbuffer" as "ArrayBuffer"');if(0===t.byteLength)return Promise.reject('"Zbuffer" has zero length, error');if(a instanceof ArrayBuffer==!1)return Promise.reject('Please set "SharedInfo" as "ArrayBuffer"');var u=r/n;Math.floor(u)>0&&u-(i=Math.floor(u))>0&&i++;for(var l=1;l<=i;l++)o.push(E(e,t,l,a));return Promise.all(o).then(function(e){for(var t=new ArrayBuffer(0),a=1,n=!0;n;){n=!1;var i=!0,o=!1,u=void 0;try{for(var l,c=e[Symbol.iterator]();!(i=(l=c.next()).done);i=!0){var h=l.value;if(h.counter===a){t=s(t,h.result),n=!0;break}}}catch(e){o=!0,u=e}finally{try{!i&&c.return&&c.return()}finally{if(o)throw u}}a++}if(r>>=3,t.byteLength>r){for(var m=new ArrayBuffer(r),f=new Uint8Array(m),v=new Uint8Array(t),d=0;d<r;d++)f[d]=v[d];return m}return t})}function O(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=t(e,"names",{});return new ee({optional:r,value:[new z({optional:!0,idBlock:{tagClass:2,tagNumber:1},name:a.country_name||"",value:[new Ke({value:[new we,new Ce]})]}),new z({optional:!0,idBlock:{tagClass:2,tagNumber:2},name:a.administration_domain_name||"",value:[new Ke({value:[new we,new Ce]})]}),new G({optional:!0,idBlock:{tagClass:3,tagNumber:0},name:a.network_address||"",isHexOnly:!0}),new G({optional:!0,idBlock:{tagClass:3,tagNumber:1},name:a.terminal_identifier||"",isHexOnly:!0}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:2},name:a.private_domain_name||"",value:[new Ke({value:[new we,new Ce]})]}),new G({optional:!0,idBlock:{tagClass:3,tagNumber:3},name:a.organization_name||"",isHexOnly:!0}),new G({optional:!0,name:a.numeric_user_identifier||"",idBlock:{tagClass:3,tagNumber:4},isHexOnly:!0}),new z({optional:!0,name:a.personal_name||"",idBlock:{tagClass:3,tagNumber:5},value:[new G({idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new G({optional:!0,idBlock:{tagClass:3,tagNumber:1},isHexOnly:!0}),new G({optional:!0,idBlock:{tagClass:3,tagNumber:2},isHexOnly:!0}),new G({optional:!0,idBlock:{tagClass:3,tagNumber:3},isHexOnly:!0})]}),new z({optional:!0,name:a.organizational_unit_names||"",idBlock:{tagClass:3,tagNumber:6},value:[new Ue({value:new Ce})]})]})}function V(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new ee({optional:e,value:[new Ce,new Ce]})}function _(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new te({optional:e,value:[new G({optional:!0,idBlock:{tagClass:3,tagNumber:0},isHexOnly:!0}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new He]})]})}function j(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"tbsCertificate",value:[new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ue({name:e.tbsCertificateVersion||"tbsCertificate.version"})]}),new ue({name:e.tbsCertificateSerialNumber||"tbsCertificate.serialNumber"}),Te.schema(e.signature||{names:{blockName:"tbsCertificate.signature"}}),et.schema(e.issuer||{names:{blockName:"tbsCertificate.issuer"}}),new ee({name:e.tbsCertificateValidity||"tbsCertificate.validity",value:[ht.schema(e.notBefore||{names:{utcTimeName:"tbsCertificate.notBefore",generalTimeName:"tbsCertificate.notBefore"}}),ht.schema(e.notAfter||{names:{utcTimeName:"tbsCertificate.notAfter",generalTimeName:"tbsCertificate.notAfter"}})]}),et.schema(e.subject||{names:{blockName:"tbsCertificate.subject"}}),Fe.schema(e.subjectPublicKeyInfo||{names:{blockName:"tbsCertificate.subjectPublicKeyInfo"}}),new G({name:e.tbsCertificateIssuerUniqueID||"tbsCertificate.issuerUniqueID",optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new G({name:e.tbsCertificateSubjectUniqueID||"tbsCertificate.subjectUniqueID",optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[Ot.schema(e.extensions||{names:{blockName:"tbsCertificate.extensions"}})]})]})}function D(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"tbsCertList",value:[new ue({optional:!0,name:e.tbsCertListVersion||"tbsCertList.version",value:2}),Te.schema(e.signature||{names:{blockName:"tbsCertList.signature"}}),et.schema(e.issuer||{names:{blockName:"tbsCertList.issuer"}}),ht.schema(e.tbsCertListThisUpdate||{names:{utcTimeName:"tbsCertList.thisUpdate",generalTimeName:"tbsCertList.thisUpdate"}}),ht.schema(e.tbsCertListNextUpdate||{names:{utcTimeName:"tbsCertList.nextUpdate",generalTimeName:"tbsCertList.nextUpdate"}},!0),new ee({optional:!0,value:[new Ue({name:e.tbsCertListRevokedCertificates||"tbsCertList.revokedCertificates",value:new ee({value:[new ue,ht.schema(),Ot.schema({},!0)]})})]}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Ot.schema(e.crlExtensions||{names:{blockName:"tbsCertList.extensions"}})]})]})}function R(e){if(!fr(e)){if(!vr(e))throw new Error("Only generator instance of generator function is a valid input");e=e()}return new Promise(function(t,r){var a=function(t){var a=void 0;try{a=e.throw(t)}catch(e){return r(e)}return n(a)},n=function n(i){var s=void 0;try{s=e.next(i)}catch(e){return r(e)}switch(!0){case s.value instanceof Promise:return s.done?t(s.value):s.value.then(n,a);case vr(s.value):case fr(s.value):return s.done?R(s.value).then(function(e){t(e)},a):R(s.value).then(n,a);case"function"==typeof s.value:s.value=s.value();default:return s.done?t(s.value):n(s.value)}};n()})}function K(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.CertificationRequestInfo||"CertificationRequestInfo",value:[new ue({name:e.CertificationRequestInfoVersion||"CertificationRequestInfo.version"}),et.schema(e.subject||{names:{blockName:"CertificationRequestInfo.subject"}}),Fe.schema({names:{blockName:"CertificationRequestInfo.subjectPublicKeyInfo"}}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ue({optional:!0,name:e.CertificationRequestInfoAttributes||"CertificationRequestInfo.attributes",value:Me.schema(e.attributes||{})})]})]})}var H="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",U="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",L=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.blockLength=t(r,"blockLength",0),this.error=t(r,"error",""),this.warnings=t(r,"warnings",[]),this.valueBeforeDecode="valueBeforeDecode"in r?r.valueBeforeDecode.slice(0):new ArrayBuffer(0)}return _createClass(e,[{key:"toJSON",value:function(){return{blockName:this.constructor.blockName(),blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:r(this.valueBeforeDecode,0,this.valueBeforeDecode.byteLength)}}}],[{key:"blockName",value:function(){return"baseBlock"}}]),e}(),T=function(e){return function(e){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,n);var r=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return r.isHexOnly=t(e,"isHexOnly",!1),r.valueHex="valueHex"in e?e.valueHex.slice(0):new ArrayBuffer(0),r}return _inherits(n,e),_createClass(n,[{key:"fromBER",value:function(e,t,r){return!1===a(this,e,t,r)?-1:0===new Uint8Array(e,t,r).length?(this.warnings.push("Zero buffer length"),t):(this.valueHex=e.slice(t,t+r),this.blockLength=r,t+r)}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return!0!==this.isHexOnly?(this.error='Flag "isHexOnly" is not set, abort',new ArrayBuffer(0)):!0===e?new ArrayBuffer(this.valueHex.byteLength):this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"toJSON",this).call(this)}catch(e){}return e.blockName=this.constructor.blockName(),e.isHexOnly=this.isHexOnly,e.valueHex=r(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"hexBlock"}}]),n}(e)},J=function(e){function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,r);var a=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return"idBlock"in e?(a.isHexOnly=t(e.idBlock,"isHexOnly",!1),a.valueHex=t(e.idBlock,"valueHex",new ArrayBuffer(0)),a.tagClass=t(e.idBlock,"tagClass",-1),a.tagNumber=t(e.idBlock,"tagNumber",-1),a.isConstructed=t(e.idBlock,"isConstructed",!1)):(a.tagClass=-1,a.tagNumber=-1,a.isConstructed=!1),a}return _inherits(r,e),_createClass(r,[{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=0,r=void 0,a=void 0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",new ArrayBuffer(0)}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){if(r=new ArrayBuffer(1),a=new Uint8Array(r),!e){var n=this.tagNumber;t|=n&=31,a[0]=t}return r}if(!1===this.isHexOnly){var s=i(this.tagNumber,7),o=new Uint8Array(s),u=s.byteLength;if(r=new ArrayBuffer(u+1),a=new Uint8Array(r),a[0]=31|t,!e){for(var l=0;l<u-1;l++)a[l+1]=128|o[l];a[u]=o[u-1]}return r}if(r=new ArrayBuffer(this.valueHex.byteLength+1),a=new Uint8Array(r),a[0]=31|t,!1===e){for(var c=new Uint8Array(this.valueHex),h=0;h<c.length-1;h++)a[h+1]=128|c[h];a[this.valueHex.byteLength]=c[c.length-1]}return r}},{key:"fromBER",value:function(e,t,r){if(!1===a(this,e,t,r))return-1;var i=new Uint8Array(e,t,r);if(0===i.length)return this.error="Zero buffer length",-1;switch(192&i[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=32==(32&i[0]),this.isHexOnly=!1;var s=31&i[0];if(31!==s)this.tagNumber=s,this.blockLength=1;else{var o=1;this.valueHex=new ArrayBuffer(255);for(var u=255,l=new Uint8Array(this.valueHex);128&i[o];){if(l[o-1]=127&i[o],++o>=i.length)return this.error="End of input reached before message was fully decoded",-1;if(o===u){u+=255;for(var c=new ArrayBuffer(u),h=new Uint8Array(c),m=0;m<l.length;m++)h[m]=l[m];this.valueHex=new ArrayBuffer(u),l=new Uint8Array(this.valueHex)}}this.blockLength=o+1,l[o-1]=127&i[o];for(var f=new ArrayBuffer(o),v=new Uint8Array(f),d=0;d<o;d++)v[d]=l[d];this.valueHex=new ArrayBuffer(o),(l=new Uint8Array(this.valueHex)).set(v),this.blockLength<=9?this.tagNumber=n(l,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}},{key:"toJSON",value:function(){var e={};try{e=_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"toJSON",this).call(this)}catch(e){}return e.blockName=this.constructor.blockName(),e.tagClass=this.tagClass,e.tagNumber=this.tagNumber,e.isConstructed=this.isConstructed,e}}],[{key:"blockName",value:function(){return"identificationBlock"}}]),r}(T(L)),q=function(e){function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,r);var a=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return"lenBlock"in e?(a.isIndefiniteForm=t(e.lenBlock,"isIndefiniteForm",!1),a.longFormUsed=t(e.lenBlock,"longFormUsed",!1),a.length=t(e.lenBlock,"length",0)):(a.isIndefiniteForm=!1,a.longFormUsed=!1,a.length=0),a}return _inherits(r,e),_createClass(r,[{key:"fromBER",value:function(e,t,r){if(!1===a(this,e,t,r))return-1;var i=new Uint8Array(e,t,r);if(0===i.length)return this.error="Zero buffer length",-1;if(255===i[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===i[0],!0===this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&i[0]),!1===this.longFormUsed)return this.length=i[0],this.blockLength=1,t+this.blockLength;var s=127&i[0];if(s>8)return this.error="Too big integer",-1;if(s+1>i.length)return this.error="End of input reached before message was fully decoded",-1;for(var o=new Uint8Array(s),u=0;u<s;u++)o[u]=i[u+1];return 0===o[s-1]&&this.warnings.push("Needlessly long encoded length"),this.length=n(o,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unneccesary usage of long length form"),this.blockLength=s+1,t+this.blockLength}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=void 0,r=void 0;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),!1===e&&((r=new Uint8Array(t))[0]=128),t;if(!0===this.longFormUsed){var a=i(this.length,8);if(a.byteLength>127)return this.error="Too big length",new ArrayBuffer(0);if(t=new ArrayBuffer(a.byteLength+1),!0===e)return t;var n=new Uint8Array(a);(r=new Uint8Array(t))[0]=128|a.byteLength;for(var s=0;s<a.byteLength;s++)r[s+1]=n[s];return t}return t=new ArrayBuffer(1),!1===e&&((r=new Uint8Array(t))[0]=this.length),t}},{key:"toJSON",value:function(){var e={};try{e=_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"toJSON",this).call(this)}catch(e){}return e.blockName=this.constructor.blockName(),e.isIndefiniteForm=this.isIndefiniteForm,e.longFormUsed=this.longFormUsed,e.length=this.length,e}}],[{key:"blockName",value:function(){return"lengthBlock"}}]),r}(L),W=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return _inherits(t,e),_createClass(t,[{key:"fromBER",value:function(e,t,r){throw TypeError('User need to make a specific function in a class which extends "LocalValueBlock"')}},{key:"toBER",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];throw TypeError('User need to make a specific function in a class which extends "LocalValueBlock"')}}],[{key:"blockName",value:function(){return"valueBlock"}}]),t}(L),F=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W;_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return"name"in e&&(a.name=e.name),"optional"in e&&(a.optional=e.optional),"primitiveSchema"in e&&(a.primitiveSchema=e.primitiveSchema),a.idBlock=new J(e),a.lenBlock=new q(e),a.valueBlock=new r(e),a}return _inherits(t,e),_createClass(t,[{key:"fromBER",value:function(e,t,r){var a=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===a?(this.error=this.valueBlock.error,a):(0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),a)}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=void 0,r=this.idBlock.toBER(e),a=this.valueBlock.toBER(!0);this.lenBlock.length=a.byteLength,t=s(r,this.lenBlock.toBER(e));var n=void 0;if(n=!1===e?this.valueBlock.toBER(e):new ArrayBuffer(this.lenBlock.length),t=s(t,n),!0===this.lenBlock.isIndefiniteForm){var i=new ArrayBuffer(2);if(!1===e){var o=new Uint8Array(i);o[0]=0,o[1]=0}t=s(t,i)}return t}},{key:"toJSON",value:function(){var e={};try{e=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this)}catch(e){}return e.idBlock=this.idBlock.toJSON(),e.lenBlock=this.lenBlock.toJSON(),e.valueBlock=this.valueBlock.toJSON(),"name"in this&&(e.name=this.name),"optional"in this&&(e.optional=this.optional),"primitiveSchema"in this&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}}],[{key:"blockName",value:function(){return"BaseBlock"}}]),t}(L),M=function(e){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,n);var r=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return r.valueHex="valueHex"in e?e.valueHex.slice(0):new ArrayBuffer(0),r.isHexOnly=t(e,"isHexOnly",!0),r}return _inherits(n,e),_createClass(n,[{key:"fromBER",value:function(e,t,r){if(!1===a(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);if(0===n.length)return this.warnings.push("Zero buffer length"),t;this.valueHex=new ArrayBuffer(n.length);for(var i=new Uint8Array(this.valueHex),s=0;s<n.length;s++)i[s]=n[s];return this.blockLength=r,t+r}},{key:"toBER",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"toJSON",this).call(this)}catch(e){}return e.valueHex=r(this.valueHex,0,this.valueHex.byteLength),e.isHexOnly=this.isHexOnly,e}}],[{key:"blockName",value:function(){return"PrimitiveValueBlock"}}]),n}(W),G=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,M));return r.idBlock.isConstructed=!1,r}return _inherits(t,e),_createClass(t,null,[{key:"blockName",value:function(){return"PRIMITIVE"}}]),t}(F),Q=function(e){function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,r);var a=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return a.value=t(e,"value",[]),a.isIndefiniteForm=t(e,"isIndefiniteForm",!1),a}return _inherits(r,e),_createClass(r,[{key:"fromBER",value:function(e,t,r){var n=t,i=r;if(!1===a(this,e,t,r))return-1;if(0===new Uint8Array(e,t,r).length)return this.warnings.push("Zero buffer length"),t;for(var s=t;function(e,t){return!0===e?1:t}(this.isIndefiniteForm,r)>0;){var o=d(e,s,r);if(-1===o.offset)return this.error=o.result.error,this.warnings.concat(o.result.warnings),-1;if(s=o.offset,this.blockLength+=o.result.blockLength,r-=o.result.blockLength,this.value.push(o.result),!0===this.isIndefiniteForm&&o.result.constructor.blockName()===$.blockName())break}return!0===this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.blockName()===$.blockName()?this.value.pop():this.warnings.push("No EndOfContent block encoded")),this.valueBeforeDecode=e.slice(n,n+i),s}},{key:"toBER",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new ArrayBuffer(0),r=0;r<this.value.length;r++)t=s(t,this.value[r].toBER(e));return t}},{key:"toJSON",value:function(){var e={};try{e=_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"toJSON",this).call(this)}catch(e){}e.isIndefiniteForm=this.isIndefiniteForm,e.value=[];for(var t=0;t<this.value.length;t++)e.value.push(this.value[t].toJSON());return e}}],[{key:"blockName",value:function(){return"ConstructedValueBlock"}}]),r}(W),z=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,Q));return r.idBlock.isConstructed=!0,r}return _inherits(t,e),_createClass(t,[{key:"fromBER",value:function(e,t,r){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;var a=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===a?(this.error=this.valueBlock.error,a):(0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),a)}}],[{key:"blockName",value:function(){return"CONSTRUCTED"}}]),t}(F),Z=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return _inherits(t,e),_createClass(t,[{key:"fromBER",value:function(e,t,r){return t}},{key:"toBER",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new ArrayBuffer(0)}}],[{key:"blockName",value:function(){return"EndOfContentValueBlock"}}]),t}(W),$=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,Z));return r.idBlock.tagClass=1,r.idBlock.tagNumber=0,r}return _inherits(t,e),_createClass(t,null,[{key:"blockName",value:function(){return"EndOfContent"}}]),t}(F),X=function(e){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,n);var r=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return r.value=t(e,"value",!1),r.isHexOnly=t(e,"isHexOnly",!1),"valueHex"in e?r.valueHex=e.valueHex.slice(0):(r.valueHex=new ArrayBuffer(1),!0===r.value&&(new Uint8Array(r.valueHex)[0]=255)),r}return _inherits(n,e),_createClass(n,[{key:"fromBER",value:function(e,t,r){if(!1===a(this,e,t,r))return-1;var n=new Uint8Array(e,t,r);r>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.value=0!==n[0],this.isHexOnly=!0,this.valueHex=new ArrayBuffer(n.length);for(var i=new Uint8Array(this.valueHex),s=0;s<n.length;s++)i[s]=n[s];return this.blockLength=r,t+r}},{key:"toBER",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.valueHex}},{key:"toJSON",value:function(){var e={};try{e=_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e.isHexOnly=this.isHexOnly,e.valueHex=r(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"BooleanValueBlock"}}]),n}(W),Y=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,X));return r.idBlock.tagClass=1,r.idBlock.tagNumber=1,r}return _inherits(t,e),_createClass(t,null,[{key:"blockName",value:function(){return"Boolean"}}]),t}(F),ee=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=16,r}return _inherits(t,e),_createClass(t,null,[{key:"blockName",value:function(){return"Sequence"}}]),t}(z),te=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=17,r}return _inherits(t,e),_createClass(t,null,[{key:"blockName",value:function(){return"Set"}}]),t}(z),re=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,L));return r.idBlock.tagClass=1,r.idBlock.tagNumber=5,r}return _inherits(t,e),_createClass(t,[{key:"fromBER",value:function(e,t,r){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=r,t+r}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new ArrayBuffer(2);if(!0===e)return t;var r=new Uint8Array(t);return r[0]=5,r[1]=0,t}}],[{key:"blockName",value:function(){return"Null"}}]),t}(F),ae=function(e){function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,a);var r=_possibleConstructorReturn(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e));return r.isConstructed=t(e,"isConstructed",!1),r}return _inherits(a,e),_createClass(a,[{key:"fromBER",value:function(e,t,r){var n=0;if(!0===this.isConstructed){if(this.isHexOnly=!1,-1===(n=Q.prototype.fromBER.call(this,e,t,r)))return n;for(var i=0;i<this.value.length;i++){var s=this.value[i].constructor.blockName();if(s===$.blockName()){if(!0===this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(s!==ne.blockName())return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,n=_get(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"fromBER",this).call(this,e,t,r),this.blockLength=r;return n}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!0===this.isConstructed)return Q.prototype.toBER.call(this,e);var t=new ArrayBuffer(this.valueHex.byteLength);return!0===e?t:0===this.valueHex.byteLength?t:t=this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=_get(a.prototype.__proto__||Object.getPrototypeOf(a.prototype),"toJSON",this).call(this)}catch(e){}return e.isConstructed=this.isConstructed,e.isHexOnly=this.isHexOnly,e.valueHex=r(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"OctetStringValueBlock"}}]),a}(T(Q)),ne=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,ae));return r.idBlock.tagClass=1,r.idBlock.tagNumber=4,r}return _inherits(t,e),_createClass(t,[{key:"fromBER",value:function(e,r,a){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===a?(0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),r):_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"fromBER",this).call(this,e,r,a)}},{key:"isEqual",value:function(e){return e instanceof t!=!1&&JSON.stringify(this)===JSON.stringify(e)}}],[{key:"blockName",value:function(){return"OctetString"}}]),t}(F),ie=function(e){function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,n);var r=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return r.unusedBits=t(e,"unusedBits",0),r.isConstructed=t(e,"isConstructed",!1),r.blockLength=r.valueHex.byteLength+1,r}return _inherits(n,e),_createClass(n,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;var n=-1;if(!0===this.isConstructed){if(-1===(n=Q.prototype.fromBER.call(this,e,t,r)))return n;for(var i=0;i<this.value.length;i++){var s=this.value[i].constructor.blockName();if(s===$.blockName()){if(!0===this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(s!==se.blockName())return this.error="BIT STRING may consists of BIT STRINGs only",-1;if(this.unusedBits>0&&this.value[i].unusedBits>0)return this.error='Usign of "unused bits" inside constructive BIT STRING allowed for least one only',-1;if(this.unusedBits=this.value[i].unusedBits,this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1}return n}if(!1===a(this,e,t,r))return-1;var o=new Uint8Array(e,t,r);if(this.unusedBits=o[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;this.valueHex=new ArrayBuffer(o.length-1);for(var u=new Uint8Array(this.valueHex),l=0;l<r-1;l++)u[l]=o[l+1];return this.blockLength=o.length,t+r}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!0===this.isConstructed)return Q.prototype.toBER.call(this,e);if(!0===e)return new ArrayBuffer(this.valueHex.byteLength+1);if(0===this.valueHex.byteLength)return new ArrayBuffer(0);var t=new Uint8Array(this.valueHex),r=new ArrayBuffer(this.valueHex.byteLength+1),a=new Uint8Array(r);a[0]=this.unusedBits;for(var n=0;n<this.valueHex.byteLength;n++)a[n+1]=t[n];return r}},{key:"toJSON",value:function(){var e={};try{e=_get(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"toJSON",this).call(this)}catch(e){}return e.unusedBits=this.unusedBits,e.isConstructed=this.isConstructed,e.isHexOnly=this.isHexOnly,e.valueHex=r(this.valueHex,0,this.valueHex.byteLength),e}}],[{key:"blockName",value:function(){return"BitStringValueBlock"}}]),n}(T(Q)),se=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,ie));return r.idBlock.tagClass=1,r.idBlock.tagNumber=3,r}return _inherits(t,e),_createClass(t,[{key:"fromBER",value:function(e,r,a){return 0===a?r:(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"fromBER",this).call(this,e,r,a))}},{key:"isEqual",value:function(e){return e instanceof t!=!1&&JSON.stringify(this)===JSON.stringify(e)}}],[{key:"blockName",value:function(){return"BitString"}}]),t}(F),oe=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return"value"in e&&(r.valueDec=e.value),r}return _inherits(t,e),_createClass(t,[{key:"fromDER",value:function(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=this.fromBER(e,t,r);if(-1===n)return n;var i=new Uint8Array(this._valueHex);if(0===i[0]&&0!=(128&i[1])){var s=new ArrayBuffer(this._valueHex.byteLength-1);new Uint8Array(s).set(new Uint8Array(this._valueHex,1,this._valueHex.byteLength-1)),this._valueHex=s.slice(0)}else if(0!==a&&this._valueHex.byteLength<a){a-this._valueHex.byteLength>1&&(a=this._valueHex.byteLength+1);var o=new ArrayBuffer(a);new Uint8Array(o).set(i,a-this._valueHex.byteLength),this._valueHex=o.slice(0)}return n}},{key:"toDER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new Uint8Array(this._valueHex);switch(!0){case 0!=(128&t[0]):var r=new ArrayBuffer(this._valueHex.byteLength+1),a=new Uint8Array(r);a[0]=0,a.set(t,1),this._valueHex=r.slice(0);break;case 0===t[0]&&0==(128&t[1]):var n=new ArrayBuffer(this._valueHex.byteLength-1);new Uint8Array(n).set(new Uint8Array(this._valueHex,1,this._valueHex.byteLength-1)),this._valueHex=n.slice(0)}return this.toBER(e)}},{key:"fromBER",value:function(e,r,a){var n=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"fromBER",this).call(this,e,r,a);return-1===n?n:(this.blockLength=a,r+a)}},{key:"toBER",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.valueHex.slice(0)}},{key:"toJSON",value:function(){var e={};try{e=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this)}catch(e){}return e.valueDec=this.valueDec,e}},{key:"valueHex",set:function(e){this._valueHex=e.slice(0),e.byteLength>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,e.byteLength>0&&(this._valueDec=o.call(this)))},get:function(){return this._valueHex}},{key:"valueDec",set:function(e){this._valueDec=e,this.isHexOnly=!1,this._valueHex=u(e)},get:function(){return this._valueDec}}],[{key:"blockName",value:function(){return"IntegerValueBlock"}}]),t}(T(W)),ue=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,oe));return r.idBlock.tagClass=1,r.idBlock.tagNumber=2,r}return _inherits(t,e),_createClass(t,[{key:"isEqual",value:function(e){return e instanceof t?this.valueBlock.isHexOnly&&e.valueBlock.isHexOnly?l(this.valueBlock.valueHex,e.valueBlock.valueHex):this.valueBlock.isHexOnly===e.valueBlock.isHexOnly&&this.valueBlock.valueDec===e.valueBlock.valueDec:e instanceof ArrayBuffer&&l(this.valueBlock.valueHex,e)}},{key:"convertToDER",value:function(){var e=new t({valueHex:this.valueBlock.valueHex});return e.valueBlock.toDER(),e}},{key:"convertFromDER",value:function(){var e=this.valueBlock.valueHex.byteLength%2?this.valueBlock.valueHex.byteLength+1:this.valueBlock.valueHex.byteLength,r=new t({valueHex:this.valueBlock.valueHex});return r.valueBlock.fromDER(r.valueBlock.valueHex,0,r.valueBlock.valueHex.byteLength,e),r}}],[{key:"blockName",value:function(){return"Integer"}}]),t}(F),le=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=10,r}return _inherits(t,e),_createClass(t,null,[{key:"blockName",value:function(){return"Enumerated"}}]),t}(ue),ce=function(e){function s(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,s);var r=_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e));return r.valueDec=t(e,"valueDec",-1),r.isFirstSid=t(e,"isFirstSid",!1),r}return _inherits(s,e),_createClass(s,[{key:"fromBER",value:function(e,t,r){if(0===r)return t;if(!1===a(this,e,t,r))return-1;var i=new Uint8Array(e,t,r);this.valueHex=new ArrayBuffer(r);for(var s=new Uint8Array(this.valueHex),o=0;o<r&&(s[o]=127&i[o],this.blockLength++,0!=(128&i[o]));o++);for(var u=new ArrayBuffer(this.blockLength),l=new Uint8Array(u),c=0;c<this.blockLength;c++)l[c]=s[c];return this.valueHex=u.slice(0),s=new Uint8Array(this.valueHex),0!=(128&i[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===s[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=n(s,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}},{key:"toBER",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=void 0,r=void 0;if(this.isHexOnly){if(!0===e)return new ArrayBuffer(this.valueHex.byteLength);var a=new Uint8Array(this.valueHex);t=new ArrayBuffer(this.blockLength),r=new Uint8Array(t);for(var n=0;n<this.blockLength-1;n++)r[n]=128|a[n];return r[this.blockLength-1]=a[this.blockLength-1],t}var s=i(this.valueDec,7);if(0===s.byteLength)return this.error="Error during encoding SID value",new ArrayBuffer(0);if(t=new ArrayBuffer(s.byteLength),!1===e){var o=new Uint8Array(s);r=new Uint8Array(t);for(var u=0;u<s.byteLength-1;u++)r[u]=128|o[u];r[s.byteLength-1]=o[s.byteLength-1]}return t}},{key:"toString",value:function(){var e="";if(!0===this.isHexOnly)e=r(this.valueHex,0,this.valueHex.byteLength);else if(this.isFirstSid){var t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}},{key:"toJSON",value:function(){var e={};try{e=_get(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"toJSON",this).call(this)}catch(e){}return e.valueDec=this.valueDec,e.isFirstSid=this.isFirstSid,e}}],[{key:"blockName",value:function(){return"sidBlock"}}]),s}(T(L)),he=function(e){function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,r);var a=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return a.fromString(t(e,"value","")),a}return _inherits(r,e),_createClass(r,[{key:"fromBER",value:function(e,t,r){for(var a=t;r>0;){var n=new ce;if(-1===(a=n.fromBER(e,a,r)))return this.blockLength=0,this.error=n.error,a;0===this.value.length&&(n.isFirstSid=!0),this.blockLength+=n.blockLength,r-=n.blockLength,this.value.push(n)}return a}},{key:"toBER",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new ArrayBuffer(0),r=0;r<this.value.length;r++){var a=this.value[r].toBER(e);if(0===a.byteLength)return this.error=this.value[r].error,new ArrayBuffer(0);t=s(t,a)}return t}},{key:"fromString",value:function(e){this.value=[];var t=0,r=0,a="",n=!1;do{if(r=e.indexOf(".",t),a=-1===r?e.substr(t):e.substr(t,r-t),t=r+1,n){var i=this.value[0],s=0;switch(i.valueDec){case 0:break;case 1:s=40;break;case 2:s=80;break;default:return this.value=[],!1}var o=parseInt(a,10);if(isNaN(o))return!0;i.valueDec=o+s,n=!1}else{var u=new ce;if(u.valueDec=parseInt(a,10),isNaN(u.valueDec))return!0;0===this.value.length&&(u.isFirstSid=!0,n=!0),this.value.push(u)}}while(-1!==r);return!0}},{key:"toString",value:function(){for(var e="",t=!1,r=0;r<this.value.length;r++){t=this.value[r].isHexOnly;var a=this.value[r].toString();0!==r&&(e+="."),t?(a="{"+a+"}",this.value[r].isFirstSid?e="2.{"+a+" - 80}":e+=a):e+=a}return e}},{key:"toJSON",value:function(){var e={};try{e=_get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"toJSON",this).call(this)}catch(e){}e.value=this.toString(),e.sidArray=[];for(var t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}],[{key:"blockName",value:function(){return"ObjectIdentifierValueBlock"}}]),r}(W),me=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,he));return r.idBlock.tagClass=1,r.idBlock.tagNumber=6,r}return _inherits(t,e),_createClass(t,null,[{key:"blockName",value:function(){return"ObjectIdentifier"}}]),t}(F),fe=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.isHexOnly=!0,r.value="",r}return _inherits(t,e),_createClass(t,[{key:"toJSON",value:function(){var e={};try{e=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"Utf8StringValueBlock"}}]),t}(T(L)),ve=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,fe));return"value"in e&&r.fromString(e.value),r.idBlock.tagClass=1,r.idBlock.tagNumber=12,r}return _inherits(t,e),_createClass(t,[{key:"fromBER",value:function(e,t,r){var a=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===a?(this.error=this.valueBlock.error,a):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),a)}},{key:"fromBuffer",value:function(e){this.valueBlock.value=String.fromCharCode.apply(null,new Uint8Array(e));try{this.valueBlock.value=decodeURIComponent(escape(this.valueBlock.value))}catch(e){this.warnings.push('Error during "decodeURIComponent": '+e+", using raw string")}}},{key:"fromString",value:function(e){var t=unescape(encodeURIComponent(e)),r=t.length;this.valueBlock.valueHex=new ArrayBuffer(r);for(var a=new Uint8Array(this.valueBlock.valueHex),n=0;n<r;n++)a[n]=t.charCodeAt(n);this.valueBlock.value=e}}],[{key:"blockName",value:function(){return"Utf8String"}}]),t}(F),de=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.isHexOnly=!0,r.value="",r}return _inherits(t,e),_createClass(t,[{key:"toJSON",value:function(){var e={};try{e=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"BmpStringValueBlock"}}]),t}(T(L)),ge=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,de));return"value"in e&&r.fromString(e.value),r.idBlock.tagClass=1,r.idBlock.tagNumber=30,r}return _inherits(t,e),_createClass(t,[{key:"fromBER",value:function(e,t,r){var a=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===a?(this.error=this.valueBlock.error,a):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),a)}},{key:"fromBuffer",value:function(e){for(var t=e.slice(0),r=new Uint8Array(t),a=0;a<r.length;a+=2){var n=r[a];r[a]=r[a+1],r[a+1]=n}this.valueBlock.value=String.fromCharCode.apply(null,new Uint16Array(t))}},{key:"fromString",value:function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(2*t);for(var r=new Uint8Array(this.valueBlock.valueHex),a=0;a<t;a++){var n=i(e.charCodeAt(a),8),s=new Uint8Array(n);if(!(s.length>2))for(var o=2-s.length,u=s.length-1;u>=0;u--)r[2*a+u+o]=s[u]}this.valueBlock.value=e}}],[{key:"blockName",value:function(){return"BmpString"}}]),t}(F),ye=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.isHexOnly=!0,r.value="",r}return _inherits(t,e),_createClass(t,[{key:"toJSON",value:function(){var e={};try{e=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"UniversalStringValueBlock"}}]),t}(T(L)),pe=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,ye));return"value"in e&&r.fromString(e.value),r.idBlock.tagClass=1,r.idBlock.tagNumber=28,r}return _inherits(t,e),_createClass(t,[{key:"fromBER",value:function(e,t,r){var a=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===a?(this.error=this.valueBlock.error,a):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),a)}},{key:"fromBuffer",value:function(e){for(var t=e.slice(0),r=new Uint8Array(t),a=0;a<r.length;a+=4)r[a]=r[a+3],r[a+1]=r[a+2],r[a+2]=0,r[a+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}},{key:"fromString",value:function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(4*t);for(var r=new Uint8Array(this.valueBlock.valueHex),a=0;a<t;a++){var n=i(e.charCodeAt(a),8),s=new Uint8Array(n);if(!(s.length>4))for(var o=4-s.length,u=s.length-1;u>=0;u--)r[4*a+u+o]=s[u]}this.valueBlock.value=e}}],[{key:"blockName",value:function(){return"UniversalString"}}]),t}(F),ke=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.value="",r.isHexOnly=!0,r}return _inherits(t,e),_createClass(t,[{key:"toJSON",value:function(){var e={};try{e=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this)}catch(e){}return e.value=this.value,e}}],[{key:"blockName",value:function(){return"SimpleStringValueBlock"}}]),t}(T(L)),be=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,ke));return"value"in e&&r.fromString(e.value),r}return _inherits(t,e),_createClass(t,[{key:"fromBER",value:function(e,t,r){var a=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===a?(this.error=this.valueBlock.error,a):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),a)}},{key:"fromBuffer",value:function(e){this.valueBlock.value=String.fromCharCode.apply(null,new Uint8Array(e))}},{key:"fromString",value:function(e){var t=e.length;this.valueBlock.valueHex=new ArrayBuffer(t);for(var r=new Uint8Array(this.valueBlock.valueHex),a=0;a<t;a++)r[a]=e.charCodeAt(a);this.valueBlock.value=e}}],[{key:"blockName",value:function(){return"SIMPLESTRING"}}]),t}(F),we=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=18,r}return _inherits(t,e),_createClass(t,null,[{key:"blockName",value:function(){return"NumericString"}}]),t}(be),Ce=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=19,r}return _inherits(t,e),_createClass(t,null,[{key:"blockName",value:function(){return"PrintableString"}}]),t}(be),Se=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=20,r}return _inherits(t,e),_createClass(t,null,[{key:"blockName",value:function(){return"TeletexString"}}]),t}(be),Ae=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=21,r}return _inherits(t,e),_createClass(t,null,[{key:"blockName",value:function(){return"VideotexString"}}]),t}(be),Ie=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=22,r}return _inherits(t,e),_createClass(t,null,[{key:"blockName",value:function(){return"IA5String"}}]),t}(be),Be=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=25,r}return _inherits(t,e),_createClass(t,null,[{key:"blockName",value:function(){return"GraphicString"}}]),t}(be),Ne=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=26,r}return _inherits(t,e),_createClass(t,null,[{key:"blockName",value:function(){return"VisibleString"}}]),t}(be),Pe=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=27,r}return _inherits(t,e),_createClass(t,null,[{key:"blockName",value:function(){return"GeneralString"}}]),t}(be),Ee=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=29,r}return _inherits(t,e),_createClass(t,null,[{key:"blockName",value:function(){return"CharacterString"}}]),t}(be),xe=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(r.year=0,r.month=0,r.day=0,r.hour=0,r.minute=0,r.second=0,"value"in e){r.fromString(e.value),r.valueBlock.valueHex=new ArrayBuffer(e.value.length);for(var a=new Uint8Array(r.valueBlock.valueHex),n=0;n<e.value.length;n++)a[n]=e.value.charCodeAt(n)}return"valueDate"in e&&(r.fromDate(e.valueDate),r.valueBlock.valueHex=r.toBuffer()),r.idBlock.tagClass=1,r.idBlock.tagNumber=23,r}return _inherits(t,e),_createClass(t,[{key:"fromBER",value:function(e,t,r){var a=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===a?(this.error=this.valueBlock.error,a):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),a)}},{key:"fromBuffer",value:function(e){this.fromString(String.fromCharCode.apply(null,new Uint8Array(e)))}},{key:"toBuffer",value:function(){for(var e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),a=0;a<e.length;a++)r[a]=e.charCodeAt(a);return t}},{key:"fromDate",value:function(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}},{key:"fromString",value:function(e){var t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/gi.exec(e);if(null!==t){var r=parseInt(t[1],10);this.year=r>=50?1900+r:2e3+r,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}else this.error="Wrong input string for convertion"}},{key:"toString",value:function(){var e=new Array(7);return e[0]=c(this.year<2e3?this.year-1900:this.year-2e3,2),e[1]=c(this.month,2),e[2]=c(this.day,2),e[3]=c(this.hour,2),e[4]=c(this.minute,2),e[5]=c(this.second,2),e[6]="Z",e.join("")}},{key:"toJSON",value:function(){var e={};try{e=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this)}catch(e){}return e.year=this.year,e.month=this.month,e.day=this.day,e.hour=this.hour,e.minute=this.minute,e.second=this.second,e}}],[{key:"blockName",value:function(){return"UTCTime"}}]),t}(Ne),Oe=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));if(r.year=0,r.month=0,r.day=0,r.hour=0,r.minute=0,r.second=0,r.millisecond=0,"value"in e){r.fromString(e.value),r.valueBlock.valueHex=new ArrayBuffer(e.value.length);for(var a=new Uint8Array(r.valueBlock.valueHex),n=0;n<e.value.length;n++)a[n]=e.value.charCodeAt(n)}return"valueDate"in e&&(r.fromDate(e.valueDate),r.valueBlock.valueHex=r.toBuffer()),r.idBlock.tagClass=1,r.idBlock.tagNumber=24,r}return _inherits(t,e),_createClass(t,[{key:"fromBER",value:function(e,t,r){var a=this.valueBlock.fromBER(e,t,!0===this.lenBlock.isIndefiniteForm?r:this.lenBlock.length);return-1===a?(this.error=this.valueBlock.error,a):(this.fromBuffer(this.valueBlock.valueHex),0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),0===this.valueBlock.error.length&&(this.blockLength+=this.valueBlock.blockLength),a)}},{key:"fromBuffer",value:function(e){this.fromString(String.fromCharCode.apply(null,new Uint8Array(e)))}},{key:"toBuffer",value:function(){for(var e=this.toString(),t=new ArrayBuffer(e.length),r=new Uint8Array(t),a=0;a<e.length;a++)r[a]=e.charCodeAt(a);return t}},{key:"fromDate",value:function(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds(),this.millisecond=e.getUTCMilliseconds()}},{key:"toDate",value:function(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}},{key:"fromString",value:function(e){var t=!1,r="",a="",n=0,i=void 0,s=0,o=0;if("Z"===e[e.length-1])r=e.substr(0,e.length-1),t=!0;else{var u=new Number(e[e.length-1]);if(isNaN(u.valueOf()))throw new Error("Wrong input string for convertion");r=e}if(t){if(-1!==r.indexOf("+"))throw new Error("Wrong input string for convertion");if(-1!==r.indexOf("-"))throw new Error("Wrong input string for convertion")}else{var l=1,c=r.indexOf("+"),h="";if(-1===c&&(c=r.indexOf("-"),l=-1),-1!==c){if(h=r.substr(c+1),r=r.substr(0,c),2!==h.length&&4!==h.length)throw new Error("Wrong input string for convertion");var m=new Number(h.substr(0,2));if(isNaN(m.valueOf()))throw new Error("Wrong input string for convertion");if(s=l*m,4===h.length){if(m=new Number(h.substr(2,2)),isNaN(m.valueOf()))throw new Error("Wrong input string for convertion");o=l*m}}}var f=r.indexOf(".");if(-1===f&&(f=r.indexOf(",")),-1!==f){var v=new Number("0"+r.substr(f));if(isNaN(v.valueOf()))throw new Error("Wrong input string for convertion");n=v.valueOf(),a=r.substr(0,f)}else a=r;switch(!0){case 8===a.length:if(i=/(\d{4})(\d{2})(\d{2})/gi,-1!==f)throw new Error("Wrong input string for convertion");break;case 10===a.length:if(i=/(\d{4})(\d{2})(\d{2})(\d{2})/gi,-1!==f){var d=60*n;this.minute=Math.floor(d),d=60*(d-this.minute),this.second=Math.floor(d),d=1e3*(d-this.second),this.millisecond=Math.floor(d)}break;case 12===a.length:if(i=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==f){var g=60*n;this.second=Math.floor(g),g=1e3*(g-this.second),this.millisecond=Math.floor(g)}break;case 14===a.length:if(i=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==f){var y=1e3*n;this.millisecond=Math.floor(y)}break;default:throw new Error("Wrong input string for convertion")}var p=i.exec(a);if(null===p)throw new Error("Wrong input string for convertion");for(var k=1;k<p.length;k++)switch(k){case 1:this.year=parseInt(p[k],10);break;case 2:this.month=parseInt(p[k],10);break;case 3:this.day=parseInt(p[k],10);break;case 4:this.hour=parseInt(p[k],10)+s;break;case 5:this.minute=parseInt(p[k],10)+o;break;case 6:this.second=parseInt(p[k],10);break;default:throw new Error("Wrong input string for convertion")}if(!1===t){var b=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=b.getUTCFullYear(),this.month=b.getUTCMonth(),this.day=b.getUTCDay(),this.hour=b.getUTCHours(),this.minute=b.getUTCMinutes(),this.second=b.getUTCSeconds(),this.millisecond=b.getUTCMilliseconds()}}},{key:"toString",value:function(){var e=[];return e.push(c(this.year,4)),e.push(c(this.month,2)),e.push(c(this.day,2)),e.push(c(this.hour,2)),e.push(c(this.minute,2)),e.push(c(this.second,2)),0!==this.millisecond&&(e.push("."),e.push(c(this.millisecond,3))),e.push("Z"),e.join("")}},{key:"toJSON",value:function(){var e={};try{e=_get(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toJSON",this).call(this)}catch(e){}return e.year=this.year,e.month=this.month,e.day=this.day,e.hour=this.hour,e.minute=this.minute,e.second=this.second,e.millisecond=this.millisecond,e}}],[{key:"blockName",value:function(){return"GeneralizedTime"}}]),t}(Ne),Ve=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=31,r}return _inherits(t,e),_createClass(t,null,[{key:"blockName",value:function(){return"DATE"}}]),t}(ve),_e=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=32,r}return _inherits(t,e),_createClass(t,null,[{key:"blockName",value:function(){return"TimeOfDay"}}]),t}(ve),je=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=33,r}return _inherits(t,e),_createClass(t,null,[{key:"blockName",value:function(){return"DateTime"}}]),t}(ve),De=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=34,r}return _inherits(t,e),_createClass(t,null,[{key:"blockName",value:function(){return"Duration"}}]),t}(ve),Re=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.idBlock.tagClass=1,r.idBlock.tagNumber=14,r}return _inherits(t,e),_createClass(t,null,[{key:"blockName",value:function(){return"TIME"}}]),t}(ve),Ke=function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.value=t(r,"value",[]),this.optional=t(r,"optional",!1)},He=function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.name=t(r,"name",""),this.optional=t(r,"optional",!1)},Ue=function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.name=t(r,"name",""),this.optional=t(r,"optional",!1),this.value=t(r,"value",new He),this.local=t(r,"local",!1)},Le=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.data=t(r,"data",new ArrayBuffer(0))}return _createClass(e,[{key:"fromBER",value:function(e,t,r){this.data=e.slice(t,r)}},{key:"toBER",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.data}}]),e}(),Te=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.algorithmId=t(r,"algorithmId",e.defaultValues("algorithmId")),"algorithmParams"in r&&(this.algorithmParams=t(r,"algorithmParams",e.defaultValues("algorithmParams"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{algorithmIdentifier:"algorithm",algorithmParams:"params"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for AlgorithmIdentifier");this.algorithmId=r.result.algorithm.valueBlock.toString(),"params"in r.result&&(this.algorithmParams=r.result.params)}},{key:"toSchema",value:function(){var e=[];return e.push(new me({value:this.algorithmId})),"algorithmParams"in this&&this.algorithmParams instanceof He==!1&&e.push(this.algorithmParams),new ee({value:e})}},{key:"toJSON",value:function(){var e={algorithmId:this.algorithmId};return"algorithmParams"in this&&this.algorithmParams instanceof He==!1&&(e.algorithmParams=this.algorithmParams.toJSON()),e}},{key:"isEqual",value:function(t){return t instanceof e!=!1&&(this.algorithmId===t.algorithmId&&("algorithmParams"in this?"algorithmParams"in t&&JSON.stringify(this.algorithmParams)===JSON.stringify(t.algorithmParams):!("algorithmParams"in t)))}}],[{key:"defaultValues",value:function(e){switch(e){case"algorithmId":return"";case"algorithmParams":return new He;default:throw new Error("Invalid member name for AlgorithmIdentifier class: "+e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"algorithmId":return""===t;case"algorithmParams":return t instanceof He;default:throw new Error("Invalid member name for AlgorithmIdentifier class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",optional:e.optional||!1,value:[new me({name:e.algorithmIdentifier||""}),new He({name:e.algorithmParams||"",optional:!0})]})}}]),e}(),Je=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.hashAlgorithm=t(r,"hashAlgorithm",e.defaultValues("hashAlgorithm")),this.maskGenAlgorithm=t(r,"maskGenAlgorithm",e.defaultValues("maskGenAlgorithm")),this.saltLength=t(r,"saltLength",e.defaultValues("saltLength")),this.trailerField=t(r,"trailerField",e.defaultValues("trailerField")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{hashAlgorithm:{names:{blockName:"hashAlgorithm"}},maskGenAlgorithm:{names:{blockName:"maskGenAlgorithm"}},saltLength:"saltLength",trailerField:"trailerField"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for RSASSA_PSS_params");"hashAlgorithm"in r.result&&(this.hashAlgorithm=new Te({schema:r.result.hashAlgorithm})),"maskGenAlgorithm"in r.result&&(this.maskGenAlgorithm=new Te({schema:r.result.maskGenAlgorithm})),"saltLength"in r.result&&(this.saltLength=r.result.saltLength.valueBlock.valueDec),"trailerField"in r.result&&(this.trailerField=r.result.trailerField.valueBlock.valueDec)}},{key:"toSchema",value:function(){var t=[];return this.hashAlgorithm.isEqual(e.defaultValues("hashAlgorithm"))||t.push(new z({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(e.defaultValues("maskGenAlgorithm"))||t.push(new z({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.saltLength!==e.defaultValues("saltLength")&&t.push(new z({idBlock:{tagClass:3,tagNumber:2},value:[new ue({value:this.saltLength})]})),this.trailerField!==e.defaultValues("trailerField")&&t.push(new z({idBlock:{tagClass:3,tagNumber:3},value:[new ue({value:this.trailerField})]})),new ee({value:t})}},{key:"toJSON",value:function(){var t={};return this.hashAlgorithm.isEqual(e.defaultValues("hashAlgorithm"))||(t.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(e.defaultValues("maskGenAlgorithm"))||(t.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.saltLength!==e.defaultValues("saltLength")&&(t.saltLength=this.saltLength),this.trailerField!==e.defaultValues("trailerField")&&(t.trailerField=this.trailerField),t}}],[{key:"defaultValues",value:function(e){switch(e){case"hashAlgorithm":return new Te({algorithmId:"1.3.14.3.2.26",algorithmParams:new re});case"maskGenAlgorithm":return new Te({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new Te({algorithmId:"1.3.14.3.2.26",algorithmParams:new re}).toSchema()});case"saltLength":return 20;case"trailerField":return 1;default:throw new Error("Invalid member name for RSASSAPSSParams class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new z({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[Te.schema(e.hashAlgorithm||{})]}),new z({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[Te.schema(e.maskGenAlgorithm||{})]}),new z({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[new ue({name:e.saltLength||""})]}),new z({idBlock:{tagClass:3,tagNumber:3},optional:!0,value:[new ue({name:e.trailerField||""})]})]})}}]),e}(),qe=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.x=t(r,"x",e.defaultValues("x")),this.y=t(r,"y",e.defaultValues("y")),this.namedCurve=t(r,"namedCurve",e.defaultValues("namedCurve")),"schema"in r&&this.fromSchema(r.schema),"json"in r&&this.fromJSON(r.json)}return _createClass(e,[{key:"fromSchema",value:function(e){if(e instanceof ArrayBuffer==!1)throw new Error("Object's schema was not verified against input data for ECPublicKey");if(4!==new Uint8Array(e)[0])throw new Error("Object's schema was not verified against input data for ECPublicKey");var t=void 0;switch(this.namedCurve){case"1.2.840.10045.3.1.7":t=32;break;case"1.3.132.0.34":t=48;break;case"1.3.132.0.35":t=66;break;default:throw new Error("Incorrect curve OID: "+this.namedCurve)}if(e.byteLength!==2*t+1)throw new Error("Object's schema was not verified against input data for ECPublicKey");this.x=e.slice(1,t+1),this.y=e.slice(1+t,2*t+1)}},{key:"toSchema",value:function(){return new Le({data:s(new Uint8Array([4]).buffer,this.x,this.y)})}},{key:"toJSON",value:function(){var e="";switch(this.namedCurve){case"1.2.840.10045.3.1.7":e="P-256";break;case"1.3.132.0.34":e="P-384";break;case"1.3.132.0.35":e="P-521"}return{crv:e,x:h(f(this.x),!0,!0,!0),y:h(f(this.y),!0,!0,!0)}}},{key:"fromJSON",value:function(e){var t=0;if(!("crv"in e))throw new Error('Absent mandatory parameter "crv"');switch(e.crv.toUpperCase()){case"P-256":this.namedCurve="1.2.840.10045.3.1.7",t=32;break;case"P-384":this.namedCurve="1.3.132.0.34",t=48;break;case"P-521":this.namedCurve="1.3.132.0.35",t=66}if(!("x"in e))throw new Error('Absent mandatory parameter "x"');if(this.x=v(m(e.x,!0)).slice(0,t),!("y"in e))throw new Error('Absent mandatory parameter "y"');this.y=v(m(e.y,!0)).slice(0,t)}}],[{key:"defaultValues",value:function(e){switch(e){case"x":case"y":return new ArrayBuffer(0);case"namedCurve":return"";default:throw new Error("Invalid member name for ECCPublicKey class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"x":case"y":return l(r,e.defaultValues(t));case"namedCurve":return""===r;default:throw new Error("Invalid member name for ECCPublicKey class: "+t)}}},{key:"schema",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Le}}]),e}(),We=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.modulus=t(r,"modulus",e.defaultValues("modulus")),this.publicExponent=t(r,"publicExponent",e.defaultValues("publicExponent")),"schema"in r&&this.fromSchema(r.schema),"json"in r&&this.fromJSON(r.json)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{modulus:"modulus",publicExponent:"publicExponent"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for RSAPublicKey");this.modulus=r.result.modulus.convertFromDER(256),this.publicExponent=r.result.publicExponent}},{key:"toSchema",value:function(){return new ee({value:[this.modulus.convertToDER(),this.publicExponent]})}},{key:"toJSON",value:function(){return{n:h(f(this.modulus.valueBlock.valueHex),!0,!0,!0),e:h(f(this.publicExponent.valueBlock.valueHex),!0,!0,!0)}}},{key:"fromJSON",value:function(e){if(!("n"in e))throw new Error('Absent mandatory parameter "n"');if(this.modulus=new ue({valueHex:v(m(e.n,!0)).slice(0,256)}),!("e"in e))throw new Error('Absent mandatory parameter "e"');this.publicExponent=new ue({valueHex:v(m(e.e,!0)).slice(0,3)})}}],[{key:"defaultValues",value:function(e){switch(e){case"modulus":case"publicExponent":return new ue;default:throw new Error("Invalid member name for RSAPublicKey class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new ue({name:e.modulus||""}),new ue({name:e.publicExponent||""})]})}}]),e}(),Fe=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.algorithm=t(r,"algorithm",e.defaultValues("algorithm")),this.subjectPublicKey=t(r,"subjectPublicKey",e.defaultValues("subjectPublicKey")),"parsedKey"in r&&(this.parsedKey=t(r,"parsedKey",e.defaultValues("parsedKey"))),"schema"in r&&this.fromSchema(r.schema),"json"in r&&this.fromJSON(r.json)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{algorithm:{names:{blockName:"algorithm"}},subjectPublicKey:"subjectPublicKey"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PUBLIC_KEY_INFO");switch(this.algorithm=new Te({schema:r.result.algorithm}),this.subjectPublicKey=r.result.subjectPublicKey,this.algorithm.algorithmId){case"1.2.840.10045.2.1":"algorithmParams"in this.algorithm&&this.algorithm.algorithmParams instanceof me&&(this.parsedKey=new qe({namedCurve:this.algorithm.algorithmParams.valueBlock.toString(),schema:this.subjectPublicKey.valueBlock.valueHex}));break;case"1.2.840.113549.1.1.1":var a=g(this.subjectPublicKey.valueBlock.valueHex);-1!==a.offset&&(this.parsedKey=new We({schema:a.result}))}}},{key:"toSchema",value:function(){return new ee({value:[this.algorithm.toSchema(),this.subjectPublicKey]})}},{key:"toJSON",value:function(){if("parsedKey"in this==!1)return{algorithm:this.algorithm.toJSON(),subjectPublicKey:this.subjectPublicKey.toJSON()};var e={};switch(this.algorithm.algorithmId){case"1.2.840.10045.2.1":e.kty="EC";break;case"1.2.840.113549.1.1.1":e.kty="RSA"}var t=this.parsedKey.toJSON(),r=!0,a=!1,n=void 0;try{for(var i,s=Object.keys(t)[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var o=i.value;e[o]=t[o]}}catch(e){a=!0,n=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw n}}return e}},{key:"fromJSON",value:function(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new qe({json:e}),this.algorithm=new Te({algorithmId:"1.2.840.10045.2.1",algorithmParams:new me({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new We({json:e}),this.algorithm=new Te({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new re});break;default:throw new Error('Invalid value for "kty" parameter: '+e.kty)}this.subjectPublicKey=new se({valueHex:this.parsedKey.toSchema().toBER(!1)})}}},{key:"importKey",value:function(e){var t=Promise.resolve(),r=this;if(void 0===e)return Promise.reject("Need to provide publicKey input parameter");var a=b();return void 0===a?Promise.reject("Unable to create WebCrypto object"):(t=t.then(function(){return a.exportKey("spki",e)}),t=t.then(function(e){var t=g(e);try{r.fromSchema(t.result)}catch(e){return Promise.reject("Error during initializing object from schema")}},function(e){return Promise.reject("Error during exporting public key: "+e)}))}}],[{key:"defaultValues",value:function(e){switch(e){case"algorithm":return new Te;case"subjectPublicKey":return new se;default:throw new Error("Invalid member name for PublicKeyInfo class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[Te.schema(e.algorithm||{}),new se({name:e.subjectPublicKey||""})]})}}]),e}(),Me=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.type=t(r,"type",e.defaultValues("type")),this.values=t(r,"values",e.defaultValues("values")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{type:"type",values:"values"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for ATTRIBUTE");this.type=r.result.type.valueBlock.toString(),this.values=r.result.values}},{key:"toSchema",value:function(){return new ee({value:[new me({value:this.type}),new te({value:this.values})]})}},{key:"toJSON",value:function(){return{type:this.type,values:Array.from(this.values,function(e){return e.toJSON()})}}}],[{key:"defaultValues",value:function(e){switch(e){case"type":return"";case"values":return[];default:throw new Error("Invalid member name for Attribute class: "+e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"type":return""===t;case"values":return 0===t.length;default:throw new Error("Invalid member name for Attribute class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new me({name:e.type||""}),new te({name:e.setName||"",value:[new Ue({name:e.values||"",value:new He})]})]})}}]),e}(),Ge=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.version=t(r,"version",e.defaultValues("version")),this.privateKey=t(r,"privateKey",e.defaultValues("privateKey")),"namedCurve"in r&&(this.namedCurve=t(r,"namedCurve",e.defaultValues("namedCurve"))),"publicKey"in r&&(this.publicKey=t(r,"publicKey",e.defaultValues("publicKey"))),"schema"in r&&this.fromSchema(r.schema),"json"in r&&this.fromJSON(r.json)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{version:"version",privateKey:"privateKey",namedCurve:"namedCurve",publicKey:"publicKey"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for ECPrivateKey");if(this.version=r.result.version.valueBlock.valueDec,this.privateKey=r.result.privateKey,"namedCurve"in r.result&&(this.namedCurve=r.result.namedCurve.valueBlock.toString()),"publicKey"in r.result){var a={schema:r.result.publicKey.valueBlock.valueHex};"namedCurve"in this&&(a.namedCurve=this.namedCurve),this.publicKey=new qe(a)}}},{key:"toSchema",value:function(){var e=[new ue({value:this.version}),this.privateKey];return"namedCurve"in this&&e.push(new z({idBlock:{tagClass:3,tagNumber:0},value:[new me({value:this.namedCurve})]})),"publicKey"in this&&e.push(new z({idBlock:{tagClass:3,tagNumber:1},value:[new se({valueHex:this.publicKey.toSchema().toBER(!1)})]})),new ee({value:e})}},{key:"toJSON",value:function(){if("namedCurve"in this==!1||e.compareWithDefault("namedCurve",this.namedCurve))throw new Error('Not enough information for making JSON: absent "namedCurve" value');var t="";switch(this.namedCurve){case"1.2.840.10045.3.1.7":t="P-256";break;case"1.3.132.0.34":t="P-384";break;case"1.3.132.0.35":t="P-521"}var r={crv:t,d:h(f(this.privateKey.valueBlock.valueHex),!0,!0,!0)};if("publicKey"in this){var a=this.publicKey.toJSON();r.x=a.x,r.y=a.y}return r}},{key:"fromJSON",value:function(e){var t=0;if(!("crv"in e))throw new Error('Absent mandatory parameter "crv"');switch(e.crv.toUpperCase()){case"P-256":this.namedCurve="1.2.840.10045.3.1.7",t=32;break;case"P-384":this.namedCurve="1.3.132.0.34",t=48;break;case"P-521":this.namedCurve="1.3.132.0.35",t=66}if(!("d"in e))throw new Error('Absent mandatory parameter "d"');this.privateKey=new ne({valueHex:v(m(e.d,!0)).slice(0,t)}),"x"in e&&"y"in e&&(this.publicKey=new qe({json:e}))}}],[{key:"defaultValues",value:function(e){switch(e){case"version":return 1;case"privateKey":return new ne;case"namedCurve":return"";case"publicKey":return new qe;default:throw new Error("Invalid member name for ECCPrivateKey class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"version":return r===e.defaultValues(t);case"privateKey":return r.isEqual(e.defaultValues(t));case"namedCurve":return""===r;case"publicKey":return qe.compareWithDefault("namedCurve",r.namedCurve)&&qe.compareWithDefault("x",r.x)&&qe.compareWithDefault("y",r.y);default:throw new Error("Invalid member name for ECCPrivateKey class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new ue({name:e.version||""}),new ne({name:e.privateKey||""}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new me({name:e.namedCurve||""})]}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new se({name:e.publicKey||""})]})]})}}]),e}(),Qe=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.prime=t(r,"prime",e.defaultValues("prime")),this.exponent=t(r,"exponent",e.defaultValues("exponent")),this.coefficient=t(r,"coefficient",e.defaultValues("coefficient")),"schema"in r&&this.fromSchema(r.schema),"json"in r&&this.fromJSON(r.json)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{prime:"prime",exponent:"exponent",coefficient:"coefficient"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for OtherPrimeInfo");this.prime=r.result.prime.convertFromDER(),this.exponent=r.result.exponent.convertFromDER(),this.coefficient=r.result.coefficient.convertFromDER()}},{key:"toSchema",value:function(){return new ee({value:[this.prime.convertToDER(),this.exponent.convertToDER(),this.coefficient.convertToDER()]})}},{key:"toJSON",value:function(){return{r:h(f(this.prime.valueBlock.valueHex),!0,!0),d:h(f(this.exponent.valueBlock.valueHex),!0,!0),t:h(f(this.coefficient.valueBlock.valueHex),!0,!0)}}},{key:"fromJSON",value:function(e){if(!("r"in e))throw new Error('Absent mandatory parameter "r"');if(this.prime=new ue({valueHex:v(m(e.r,!0))}),!("d"in e))throw new Error('Absent mandatory parameter "d"');if(this.exponent=new ue({valueHex:v(m(e.d,!0))}),!("t"in e))throw new Error('Absent mandatory parameter "t"');this.coefficient=new ue({valueHex:v(m(e.t,!0))})}}],[{key:"defaultValues",value:function(e){switch(e){case"prime":case"exponent":case"coefficient":return new ue;default:throw new Error("Invalid member name for OtherPrimeInfo class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new ue({name:e.prime||""}),new ue({name:e.exponent||""}),new ue({name:e.coefficient||""})]})}}]),e}(),ze=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.version=t(r,"version",e.defaultValues("version")),this.modulus=t(r,"modulus",e.defaultValues("modulus")),this.publicExponent=t(r,"publicExponent",e.defaultValues("publicExponent")),this.privateExponent=t(r,"privateExponent",e.defaultValues("privateExponent")),this.prime1=t(r,"prime1",e.defaultValues("prime1")),this.prime2=t(r,"prime2",e.defaultValues("prime2")),this.exponent1=t(r,"exponent1",e.defaultValues("exponent1")),this.exponent2=t(r,"exponent2",e.defaultValues("exponent2")),this.coefficient=t(r,"coefficient",e.defaultValues("coefficient")),"otherPrimeInfos"in r&&(this.otherPrimeInfos=t(r,"otherPrimeInfos",e.defaultValues("otherPrimeInfos"))),"schema"in r&&this.fromSchema(r.schema),"json"in r&&this.fromJSON(r.json)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{version:"version",modulus:"modulus",publicExponent:"publicExponent",privateExponent:"privateExponent",prime1:"prime1",prime2:"prime2",exponent1:"exponent1",exponent2:"exponent2",coefficient:"coefficient",otherPrimeInfo:{names:{blockName:"otherPrimeInfos"}}}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for RSAPrivateKey");this.version=r.result.version.valueBlock.valueDec,this.modulus=r.result.modulus.convertFromDER(256),this.publicExponent=r.result.publicExponent,this.privateExponent=r.result.privateExponent.convertFromDER(256),this.prime1=r.result.prime1.convertFromDER(128),this.prime2=r.result.prime2.convertFromDER(128),this.exponent1=r.result.exponent1.convertFromDER(128),this.exponent2=r.result.exponent2.convertFromDER(128),this.coefficient=r.result.coefficient.convertFromDER(128),"otherPrimeInfos"in r.result&&(this.otherPrimeInfos=Array.from(r.result.otherPrimeInfos,function(e){return new Qe({schema:e})}))}},{key:"toSchema",value:function(){var e=[];return e.push(new ue({value:this.version})),e.push(this.modulus.convertToDER()),e.push(this.publicExponent),e.push(this.privateExponent.convertToDER()),e.push(this.prime1.convertToDER()),e.push(this.prime2.convertToDER()),e.push(this.exponent1.convertToDER()),e.push(this.exponent2.convertToDER()),e.push(this.coefficient.convertToDER()),"otherPrimeInfos"in this&&e.push(new ee({value:Array.from(this.otherPrimeInfos,function(e){return e.toSchema()})})),new ee({value:e})}},{key:"toJSON",value:function(){var e={n:h(f(this.modulus.valueBlock.valueHex),!0,!0,!0),e:h(f(this.publicExponent.valueBlock.valueHex),!0,!0,!0),d:h(f(this.privateExponent.valueBlock.valueHex),!0,!0,!0),p:h(f(this.prime1.valueBlock.valueHex),!0,!0,!0),q:h(f(this.prime2.valueBlock.valueHex),!0,!0,!0),dp:h(f(this.exponent1.valueBlock.valueHex),!0,!0,!0),dq:h(f(this.exponent2.valueBlock.valueHex),!0,!0,!0),qi:h(f(this.coefficient.valueBlock.valueHex),!0,!0,!0)};return"otherPrimeInfos"in this&&(e.oth=Array.from(this.otherPrimeInfos,function(e){return e.toJSON()})),e}},{key:"fromJSON",value:function(e){if(!("n"in e))throw new Error('Absent mandatory parameter "n"');if(this.modulus=new ue({valueHex:v(m(e.n,!0,!0))}),!("e"in e))throw new Error('Absent mandatory parameter "e"');if(this.publicExponent=new ue({valueHex:v(m(e.e,!0,!0))}),!("d"in e))throw new Error('Absent mandatory parameter "d"');if(this.privateExponent=new ue({valueHex:v(m(e.d,!0,!0))}),!("p"in e))throw new Error('Absent mandatory parameter "p"');if(this.prime1=new ue({valueHex:v(m(e.p,!0,!0))}),!("q"in e))throw new Error('Absent mandatory parameter "q"');if(this.prime2=new ue({valueHex:v(m(e.q,!0,!0))}),!("dp"in e))throw new Error('Absent mandatory parameter "dp"');if(this.exponent1=new ue({valueHex:v(m(e.dp,!0,!0))}),!("dq"in e))throw new Error('Absent mandatory parameter "dq"');if(this.exponent2=new ue({valueHex:v(m(e.dq,!0,!0))}),!("qi"in e))throw new Error('Absent mandatory parameter "qi"');this.coefficient=new ue({valueHex:v(m(e.qi,!0,!0))}),"oth"in e&&(this.otherPrimeInfos=Array.from(e.oth,function(e){return new Qe({json:e})}))}}],[{key:"defaultValues",value:function(e){switch(e){case"version":return 0;case"modulus":case"publicExponent":case"privateExponent":case"prime1":case"prime2":case"exponent1":case"exponent2":case"coefficient":return new ue;case"otherPrimeInfos":return[];default:throw new Error("Invalid member name for RSAPrivateKey class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new ue({name:e.version||""}),new ue({name:e.modulus||""}),new ue({name:e.publicExponent||""}),new ue({name:e.privateExponent||""}),new ue({name:e.prime1||""}),new ue({name:e.prime2||""}),new ue({name:e.exponent1||""}),new ue({name:e.exponent2||""}),new ue({name:e.coefficient||""}),new ee({optional:!0,value:[new Ue({name:e.otherPrimeInfosName||"",value:Qe.schema(e.otherPrimeInfo||{})})]})]})}}]),e}(),Ze=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.version=t(r,"version",e.defaultValues("version")),this.privateKeyAlgorithm=t(r,"privateKeyAlgorithm",e.defaultValues("privateKeyAlgorithm")),this.privateKey=t(r,"privateKey",e.defaultValues("privateKey")),"attributes"in r&&(this.attributes=t(r,"attributes",e.defaultValues("attributes"))),"parsedKey"in r&&(this.parsedKey=t(r,"parsedKey",e.defaultValues("parsedKey"))),"schema"in r&&this.fromSchema(r.schema),"json"in r&&this.fromJSON(r.json)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{version:"version",privateKeyAlgorithm:{names:{blockName:"privateKeyAlgorithm"}},privateKey:"privateKey",attributes:"attributes"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PKCS8");switch(this.version=r.result.version.valueBlock.valueDec,this.privateKeyAlgorithm=new Te({schema:r.result.privateKeyAlgorithm}),this.privateKey=r.result.privateKey,"attributes"in r.result&&(this.attributes=Array.from(r.result.attributes,function(e){return new Me({schema:e})})),this.privateKeyAlgorithm.algorithmId){case"1.2.840.113549.1.1.1":var a=g(this.privateKey.valueBlock.valueHex);-1!==a.offset&&(this.parsedKey=new ze({schema:a.result}));break;case"1.2.840.10045.2.1":if("algorithmParams"in this.privateKeyAlgorithm&&this.privateKeyAlgorithm.algorithmParams instanceof me){var n=g(this.privateKey.valueBlock.valueHex);-1!==n.offset&&(this.parsedKey=new Ge({namedCurve:this.privateKeyAlgorithm.algorithmParams.valueBlock.toString(),schema:n.result}))}}}},{key:"toSchema",value:function(){var e=[new ue({value:this.version}),this.privateKeyAlgorithm.toSchema(),this.privateKey];return"attributes"in this&&e.push(new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes,function(e){return e.toSchema()})})),new ee({value:e})}},{key:"toJSON",value:function(){if("parsedKey"in this==!1){var e={version:this.version,privateKeyAlgorithm:this.privateKeyAlgorithm.toJSON(),privateKey:this.privateKey.toJSON()};return"attributes"in this&&(e.attributes=Array.from(this.attributes,function(e){return e.toJSON()})),e}var t={};switch(this.privateKeyAlgorithm.algorithmId){case"1.2.840.10045.2.1":t.kty="EC";break;case"1.2.840.113549.1.1.1":t.kty="RSA"}var r=this.parsedKey.toJSON(),a=!0,n=!1,i=void 0;try{for(var s,o=Object.keys(r)[Symbol.iterator]();!(a=(s=o.next()).done);a=!0){var u=s.value;t[u]=r[u]}}catch(e){n=!0,i=e}finally{try{!a&&o.return&&o.return()}finally{if(n)throw i}}return t}},{key:"fromJSON",value:function(e){if("kty"in e){switch(e.kty.toUpperCase()){case"EC":this.parsedKey=new Ge({json:e}),this.privateKeyAlgorithm=new Te({algorithmId:"1.2.840.10045.2.1",algorithmParams:new me({value:this.parsedKey.namedCurve})});break;case"RSA":this.parsedKey=new ze({json:e}),this.privateKeyAlgorithm=new Te({algorithmId:"1.2.840.113549.1.1.1",algorithmParams:new re});break;default:throw new Error('Invalid value for "kty" parameter: '+e.kty)}this.privateKey=new ne({valueHex:this.parsedKey.toSchema().toBER(!1)})}}}],[{key:"defaultValues",value:function(e){switch(e){case"version":return 0;case"privateKeyAlgorithm":return new Te;case"privateKey":return new ne;case"attributes":return[];default:throw new Error("Invalid member name for PrivateKeyInfo class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new ue({name:e.version||""}),Te.schema(e.privateKeyAlgorithm||{}),new ne({name:e.privateKey||""}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ue({name:e.attributes||"",value:Me.schema()})]})]})}}]),e}(),$e=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.crypto=t(r,"crypto",{}),this.name=t(r,"name","")}return _createClass(e,[{key:"importKey",value:function(e,t,r,a,n){var i=this,s={};switch(t instanceof Uint8Array&&(t=t.buffer),e.toLowerCase()){case"raw":return this.crypto.importKey("raw",t,r,a,n);case"spki":var o=g(t);if(-1===o.offset)return Promise.reject("Incorrect keyData");var u=new Fe;try{u.fromSchema(o.result)}catch(e){return Promise.reject("Incorrect keyData")}switch(r.name.toUpperCase()){case"RSA-PSS":switch(r.hash.name.toUpperCase()){case"SHA-1":s.alg="PS1";break;case"SHA-256":s.alg="PS256";break;case"SHA-384":s.alg="PS384";break;case"SHA-512":s.alg="PS512";break;default:return Promise.reject("Incorrect hash algorithm: "+r.hash.name.toUpperCase())}case"RSASSA-PKCS1-V1_5":if(n=["verify"],s.kty="RSA",s.ext=a,s.key_ops=n,"1.2.840.113549.1.1.1"!==u.algorithm.algorithmId)return Promise.reject("Incorrect public key algorithm: "+u.algorithm.algorithmId);if("alg"in s==!1)switch(r.hash.name.toUpperCase()){case"SHA-1":s.alg="RS1";break;case"SHA-256":s.alg="RS256";break;case"SHA-384":s.alg="RS384";break;case"SHA-512":s.alg="RS512";break;default:return Promise.reject("Incorrect public key algorithm: "+u.algorithm.algorithmId)}var l=u.toJSON(),c=!0,h=!1,m=void 0;try{for(var f,d=Object.keys(l)[Symbol.iterator]();!(c=(f=d.next()).done);c=!0){var y=f.value;s[y]=l[y]}}catch(e){h=!0,m=e}finally{try{!c&&d.return&&d.return()}finally{if(h)throw m}}break;case"ECDSA":n=["verify"];case"ECDH":if(s={kty:"EC",ext:a,key_ops:n},"1.2.840.10045.2.1"!==u.algorithm.algorithmId)return Promise.reject("Incorrect public key algorithm: "+u.algorithm.algorithmId);var p=u.toJSON(),k=!0,b=!1,w=void 0;try{for(var C,S=Object.keys(p)[Symbol.iterator]();!(k=(C=S.next()).done);k=!0){var A=C.value;s[A]=p[A]}}catch(e){b=!0,w=e}finally{try{!k&&S.return&&S.return()}finally{if(b)throw w}}break;case"RSA-OAEP":if(s.kty="RSA",s.ext=a,s.key_ops=n,"safari"===this.name.toLowerCase())s.alg="RSA-OAEP";else switch(r.hash.name.toUpperCase()){case"SHA-1":s.alg="RSA-OAEP-1";break;case"SHA-256":s.alg="RSA-OAEP-256";break;case"SHA-384":s.alg="RSA-OAEP-384";break;case"SHA-512":s.alg="RSA-OAEP-512";break;default:return Promise.reject("Incorrect public key algorithm: "+u.algorithm.algorithmId)}var I=u.toJSON(),B=!0,N=!1,P=void 0;try{for(var E,x=Object.keys(I)[Symbol.iterator]();!(B=(E=x.next()).done);B=!0){var O=E.value;s[O]=I[O]}}catch(e){N=!0,P=e}finally{try{!B&&x.return&&x.return()}finally{if(N)throw P}}break;default:return Promise.reject("Incorrect algorithm name: "+r.name.toUpperCase())}break;case"pkcs8":var V=new Ze,_=g(t);if(-1===_.offset)return Promise.reject("Incorrect keyData");try{V.fromSchema(_.result)}catch(e){return Promise.reject("Incorrect keyData")}switch(r.name.toUpperCase()){case"RSA-PSS":switch(r.hash.name.toUpperCase()){case"SHA-1":s.alg="PS1";break;case"SHA-256":s.alg="PS256";break;case"SHA-384":s.alg="PS384";break;case"SHA-512":s.alg="PS512";break;default:return Promise.reject("Incorrect hash algorithm: "+r.hash.name.toUpperCase())}case"RSASSA-PKCS1-V1_5":if(n=["sign"],s.kty="RSA",s.ext=a,s.key_ops=n,"1.2.840.113549.1.1.1"!==V.privateKeyAlgorithm.algorithmId)return Promise.reject("Incorrect private key algorithm: "+V.privateKeyAlgorithm.algorithmId);if("alg"in s==!1)switch(r.hash.name.toUpperCase()){case"SHA-1":s.alg="RS1";break;case"SHA-256":s.alg="RS256";break;case"SHA-384":s.alg="RS384";break;case"SHA-512":s.alg="RS512";break;default:return Promise.reject("Incorrect hash algorithm: "+r.hash.name.toUpperCase())}var j=V.toJSON(),D=!0,R=!1,K=void 0;try{for(var H,U=Object.keys(j)[Symbol.iterator]();!(D=(H=U.next()).done);D=!0){var L=H.value;s[L]=j[L]}}catch(e){R=!0,K=e}finally{try{!D&&U.return&&U.return()}finally{if(R)throw K}}break;case"ECDSA":n=["sign"];case"ECDH":if(s={kty:"EC",ext:a,key_ops:n},"1.2.840.10045.2.1"!==V.privateKeyAlgorithm.algorithmId)return Promise.reject("Incorrect algorithm: "+V.privateKeyAlgorithm.algorithmId);var T=V.toJSON(),J=!0,q=!1,W=void 0;try{for(var F,M=Object.keys(T)[Symbol.iterator]();!(J=(F=M.next()).done);J=!0){var G=F.value;s[G]=T[G]}}catch(e){q=!0,W=e}finally{try{!J&&M.return&&M.return()}finally{if(q)throw W}}break;case"RSA-OAEP":if(s.kty="RSA",s.ext=a,s.key_ops=n,"safari"===this.name.toLowerCase())s.alg="RSA-OAEP";else switch(r.hash.name.toUpperCase()){case"SHA-1":s.alg="RSA-OAEP-1";break;case"SHA-256":s.alg="RSA-OAEP-256";break;case"SHA-384":s.alg="RSA-OAEP-384";break;case"SHA-512":s.alg="RSA-OAEP-512";break;default:return Promise.reject("Incorrect hash algorithm: "+r.hash.name.toUpperCase())}var Q=V.toJSON(),z=!0,Z=!1,$=void 0;try{for(var X,Y=Object.keys(Q)[Symbol.iterator]();!(z=(X=Y.next()).done);z=!0){var ee=X.value;s[ee]=Q[ee]}}catch(e){Z=!0,$=e}finally{try{!z&&Y.return&&Y.return()}finally{if(Z)throw $}}break;default:return Promise.reject("Incorrect algorithm name: "+r.name.toUpperCase())}break;case"jwk":s=t;break;default:return Promise.reject("Incorrect format: "+e)}return"safari"===this.name.toLowerCase()?Promise.resolve().then(function(){return i.crypto.importKey("jwk",v(JSON.stringify(s)),r,a,n)}).then(function(e){return e},function(e){return i.crypto.importKey("jwk",s,r,a,n)}):this.crypto.importKey("jwk",s,r,a,n)}},{key:"exportKey",value:function(e,t){var r=this.crypto.exportKey("jwk",t);switch("safari"===this.name.toLowerCase()&&(r=r.then(function(e){return e instanceof ArrayBuffer?JSON.parse(f(e)):e})),e.toLowerCase()){case"raw":return this.crypto.exportKey("raw",t);case"spki":r=r.then(function(e){var t=new Fe;try{t.fromJSON(e)}catch(e){return Promise.reject("Incorrect key data")}return t.toSchema().toBER(!1)});break;case"pkcs8":r=r.then(function(e){var t=new Ze;try{t.fromJSON(e)}catch(e){return Promise.reject("Incorrect key data")}return t.toSchema().toBER(!1)});break;case"jwk":break;default:return Promise.reject("Incorrect format: "+e)}return r}},{key:"convert",value:function(e,t,r,a,n,i){var s=this;switch(e.toLowerCase()){case"raw":switch(t.toLowerCase()){case"raw":return Promise.resolve(r);case"spki":return Promise.resolve().then(function(){return s.importKey("raw",r,a,n,i)}).then(function(e){return s.exportKey("spki",e)});case"pkcs8":return Promise.resolve().then(function(){return s.importKey("raw",r,a,n,i)}).then(function(e){return s.exportKey("pkcs8",e)});case"jwk":return Promise.resolve().then(function(){return s.importKey("raw",r,a,n,i)}).then(function(e){return s.exportKey("jwk",e)});default:return Promise.reject("Incorrect outputFormat: "+t)}case"spki":switch(t.toLowerCase()){case"raw":return Promise.resolve().then(function(){return s.importKey("spki",r,a,n,i)}).then(function(e){return s.exportKey("raw",e)});case"spki":return Promise.resolve(r);case"pkcs8":return Promise.reject("Impossible to convert between SPKI/PKCS8");case"jwk":return Promise.resolve().then(function(){return s.importKey("spki",r,a,n,i)}).then(function(e){return s.exportKey("jwk",e)});default:return Promise.reject("Incorrect outputFormat: "+t)}case"pkcs8":switch(t.toLowerCase()){case"raw":return Promise.resolve().then(function(){return s.importKey("pkcs8",r,a,n,i)}).then(function(e){return s.exportKey("raw",e)});case"spki":return Promise.reject("Impossible to convert between SPKI/PKCS8");case"pkcs8":return Promise.resolve(r);case"jwk":return Promise.resolve().then(function(){return s.importKey("pkcs8",r,a,n,i)}).then(function(e){return s.exportKey("jwk",e)});default:return Promise.reject("Incorrect outputFormat: "+t)}case"jwk":switch(t.toLowerCase()){case"raw":return Promise.resolve().then(function(){return s.importKey("jwk",r,a,n,i)}).then(function(e){return s.exportKey("raw",e)});case"spki":return Promise.resolve().then(function(){return s.importKey("jwk",r,a,n,i)}).then(function(e){return s.exportKey("spki",e)});case"pkcs8":return Promise.resolve().then(function(){return s.importKey("jwk",r,a,n,i)}).then(function(e){return s.exportKey("pkcs8",e)});case"jwk":return Promise.resolve(r);default:return Promise.reject("Incorrect outputFormat: "+t)}default:return Promise.reject("Incorrect inputFormat: "+e)}}},{key:"encrypt",value:function(){var e;return(e=this.crypto).encrypt.apply(e,arguments)}},{key:"decrypt",value:function(){var e;return(e=this.crypto).decrypt.apply(e,arguments)}},{key:"sign",value:function(){var e;return(e=this.crypto).sign.apply(e,arguments)}},{key:"verify",value:function(){var e;return(e=this.crypto).verify.apply(e,arguments)}},{key:"digest",value:function(){var e;return(e=this.crypto).digest.apply(e,arguments)}},{key:"generateKey",value:function(){var e;return(e=this.crypto).generateKey.apply(e,arguments)}},{key:"deriveKey",value:function(){var e;return(e=this.crypto).deriveKey.apply(e,arguments)}},{key:"deriveBits",value:function(){var e;return(e=this.crypto).deriveBits.apply(e,arguments)}},{key:"wrapKey",value:function(){var e;return(e=this.crypto).wrapKey.apply(e,arguments)}},{key:"unwrapKey",value:function(){var e;return(e=this.crypto).unwrapKey.apply(e,arguments)}}]),e}(),Xe={name:"none",crypto:null,subtle:null};!function(){if("undefined"!=typeof self&&"crypto"in self){var e="webcrypto",t=self.crypto,r=null;if("webkitSubtle"in self.crypto){try{r=self.crypto.webkitSubtle}catch(e){r=self.crypto.subtle}e="safari"}"subtle"in self.crypto&&(r=self.crypto.subtle),Xe={name:e,crypto:t,subtle:new $e({name:e,crypto:r})}}}();var Ye=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.type=t(r,"type",e.defaultValues("type")),this.value=t(r,"value",e.defaultValues("value")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{type:"type",value:"typeValue"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for ATTR_TYPE_AND_VALUE");this.type=r.result.type.valueBlock.toString(),this.value=r.result.typeValue}},{key:"toSchema",value:function(){return new ee({value:[new me({value:this.type}),this.value]})}},{key:"toJSON",value:function(){var e={type:this.type};return 0!==Object.keys(this.value).length?e.value=this.value.toJSON():e.value=this.value,e}},{key:"isEqual",value:function(t){if(t instanceof e){if(this.type!==t.type)return!1;if(this.value instanceof ve&&t.value instanceof ve||this.value instanceof ge&&t.value instanceof ge||this.value instanceof pe&&t.value instanceof pe||this.value instanceof we&&t.value instanceof we||this.value instanceof Ce&&t.value instanceof Ce||this.value instanceof Se&&t.value instanceof Se||this.value instanceof Ae&&t.value instanceof Ae||this.value instanceof Ie&&t.value instanceof Ie||this.value instanceof Be&&t.value instanceof Be||this.value instanceof Ne&&t.value instanceof Ne||this.value instanceof Pe&&t.value instanceof Pe||this.value instanceof Ee&&t.value instanceof Ee){var r=I(this.value.valueBlock.value),a=I(t.value.valueBlock.value);if(0!==r.localeCompare(a))return!1}else if(!1===l(this.value.valueBeforeDecode,t.value.valueBeforeDecode))return!1;return!0}return t instanceof ArrayBuffer&&l(this.value.valueBeforeDecode,t)}}],[{key:"defaultValues",value:function(e){switch(e){case"type":return"";case"value":return{};default:throw new Error("Invalid member name for AttributeTypeAndValue class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new me({name:e.type||""}),new He({name:e.value||""})]})}}]),e}(),et=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.typesAndValues=t(r,"typesAndValues",e.defaultValues("typesAndValues")),this.valueBeforeDecode=t(r,"valueBeforeDecode",e.defaultValues("valueBeforeDecode")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{blockName:"RDN",repeatedSet:"typesAndValues"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for RDN");"typesAndValues"in r.result&&(this.typesAndValues=Array.from(r.result.typesAndValues,function(e){return new Ye({schema:e})})),this.valueBeforeDecode=r.result.RDN.valueBeforeDecode}},{key:"toSchema",value:function(){return 0===this.valueBeforeDecode.byteLength?new ee({value:[new te({value:Array.from(this.typesAndValues,function(e){return e.toSchema()})})]}):g(this.valueBeforeDecode).result}},{key:"toJSON",value:function(){return{typesAndValues:Array.from(this.typesAndValues,function(e){return e.toJSON()})}}},{key:"isEqual",value:function(t){if(t instanceof e){if(this.typesAndValues.length!==t.typesAndValues.length)return!1;var r=!0,a=!1,n=void 0;try{for(var i,s=this.typesAndValues.entries()[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var o=_slicedToArray(i.value,2),u=o[0];if(!1===o[1].isEqual(t.typesAndValues[u]))return!1}}catch(e){a=!0,n=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw n}}return!0}return t instanceof ArrayBuffer&&l(this.valueBeforeDecode,t)}}],[{key:"defaultValues",value:function(e){switch(e){case"typesAndValues":return[];case"valueBeforeDecode":return new ArrayBuffer(0);default:throw new Error("Invalid member name for RelativeDistinguishedNames class: "+e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"typesAndValues":return 0===t.length;case"valueBeforeDecode":return 0===t.byteLength;default:throw new Error("Invalid member name for RelativeDistinguishedNames class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new Ue({name:e.repeatedSequence||"",value:new te({value:[new Ue({name:e.repeatedSet||"",value:Ye.schema(e.typeAndValue||{})})]})})]})}}]),e}(),tt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.type=t(r,"type",e.defaultValues("type")),this.value=t(r,"value",e.defaultValues("value")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{blockName:"blockName",otherName:"otherName",rfc822Name:"rfc822Name",dNSName:"dNSName",x400Address:"x400Address",directoryName:{names:{blockName:"directoryName"}},ediPartyName:"ediPartyName",uniformResourceIdentifier:"uniformResourceIdentifier",iPAddress:"iPAddress",registeredID:"registeredID"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for GENERAL_NAME");switch(this.type=r.result.blockName.idBlock.tagNumber,this.type){case 0:this.value=r.result.blockName;break;case 1:case 2:case 6:var a=r.result.blockName;a.idBlock.tagClass=1,a.idBlock.tagNumber=22;var n=a.toBER(!1);this.value=g(n).result.valueBlock.value;break;case 3:this.value=r.result.blockName;break;case 4:this.value=new et({schema:r.result.directoryName});break;case 5:this.value=r.result.ediPartyName;break;case 7:this.value=new ne({valueHex:r.result.blockName.valueBlock.valueHex});break;case 8:var i=r.result.blockName;i.idBlock.tagClass=1,i.idBlock.tagNumber=6;var s=i.toBER(!1);this.value=g(s).result.valueBlock.toString()}}},{key:"toSchema",value:function(){switch(this.type){case 0:case 3:case 5:return new z({idBlock:{tagClass:3,tagNumber:this.type},value:[this.value]});case 1:case 2:case 6:var t=new Ie({value:this.value});return t.idBlock.tagClass=3,t.idBlock.tagNumber=this.type,t;case 4:return new z({idBlock:{tagClass:3,tagNumber:4},value:[this.value.toSchema()]});case 7:var r=this.value;return r.idBlock.tagClass=3,r.idBlock.tagNumber=this.type,r;case 8:var a=new me({value:this.value});return a.idBlock.tagClass=3,a.idBlock.tagNumber=this.type,a;default:return e.schema()}}},{key:"toJSON",value:function(){var e={type:this.type};return"string"==typeof this.value?e.value=this.value:e.value=this.value.toJSON(),e}}],[{key:"defaultValues",value:function(e){switch(e){case"type":return 9;case"value":return{};default:throw new Error("Invalid member name for GeneralName class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"type":return r===e.defaultValues(t);case"value":return 0===Object.keys(r).length;default:throw new Error("Invalid member name for GeneralName class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Ke({value:[new z({idBlock:{tagClass:3,tagNumber:0},name:e.blockName||"",value:[new me,new z({idBlock:{tagClass:3,tagNumber:0},value:[new He]})]}),new G({name:e.blockName||"",idBlock:{tagClass:3,tagNumber:1}}),new G({name:e.blockName||"",idBlock:{tagClass:3,tagNumber:2}}),new z({idBlock:{tagClass:3,tagNumber:3},name:e.blockName||"",value:[O(e.builtInStandardAttributes||{},!1),V(!0),_(!0)]}),new z({idBlock:{tagClass:3,tagNumber:4},name:e.blockName||"",value:[et.schema(e.directoryName||{})]}),new z({idBlock:{tagClass:3,tagNumber:5},name:e.blockName||"",value:[new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ke({value:[new Se,new Ce,new pe,new ve,new ge]})]}),new z({idBlock:{tagClass:3,tagNumber:1},value:[new Ke({value:[new Se,new Ce,new pe,new ve,new ge]})]})]}),new G({name:e.blockName||"",idBlock:{tagClass:3,tagNumber:6}}),new G({name:e.blockName||"",idBlock:{tagClass:3,tagNumber:7}}),new G({name:e.blockName||"",idBlock:{tagClass:3,tagNumber:8}})]})}}]),e}(),rt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.accessMethod=t(r,"accessMethod",e.defaultValues("accessMethod")),this.accessLocation=t(r,"accessLocation",e.defaultValues("accessLocation")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{accessMethod:"accessMethod",accessLocation:{names:{blockName:"accessLocation"}}}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for AccessDescription");this.accessMethod=r.result.accessMethod.valueBlock.toString(),this.accessLocation=new tt({schema:r.result.accessLocation})}},{key:"toSchema",value:function(){return new ee({value:[new me({value:this.accessMethod}),this.accessLocation.toSchema()]})}},{key:"toJSON",value:function(){return{accessMethod:this.accessMethod,accessLocation:this.accessLocation.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case"accessMethod":return"";case"accessLocation":return new tt;default:throw new Error("Invalid member name for AccessDescription class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new me({name:e.accessMethod||""}),tt.schema(e.accessLocation||{})]})}}]),e}(),at=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),"seconds"in r&&(this.seconds=t(r,"seconds",e.defaultValues("seconds"))),"millis"in r&&(this.millis=t(r,"millis",e.defaultValues("millis"))),"micros"in r&&(this.micros=t(r,"micros",e.defaultValues("micros"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{seconds:"seconds",millis:"millis",micros:"micros"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for tsp.Accuracy");if("seconds"in r.result&&(this.seconds=r.result.seconds.valueBlock.valueDec),"millis"in r.result){var a=new ue({valueHex:r.result.millis.valueBlock.valueHex});this.millis=a.valueBlock.valueDec}if("micros"in r.result){var n=new ue({valueHex:r.result.micros.valueBlock.valueHex});this.micros=n.valueBlock.valueDec}}},{key:"toSchema",value:function(){var e=[];if("seconds"in this&&e.push(new ue({value:this.seconds})),"millis"in this){var t=new ue({value:this.millis});e.push(new G({idBlock:{tagClass:3,tagNumber:0},valueHex:t.valueBlock.valueHex}))}if("micros"in this){var r=new ue({value:this.micros});e.push(new G({idBlock:{tagClass:3,tagNumber:1},valueHex:r.valueBlock.valueHex}))}return new ee({value:e})}},{key:"toJSON",value:function(){var e={};return"seconds"in this&&(e.seconds=this.seconds),"millis"in this&&(e.millis=this.millis),"micros"in this&&(e.micros=this.micros),e}}],[{key:"defaultValues",value:function(e){switch(e){case"seconds":case"millis":case"micros":return 0;default:throw new Error("Invalid member name for Accuracy class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"seconds":case"millis":case"micros":return r===e.defaultValues(t);default:throw new Error("Invalid member name for Accuracy class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",optional:!0,value:[new ue({optional:!0,name:e.seconds||""}),new G({name:e.millis||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new G({name:e.micros||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}}]),e}(),nt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.altNames=t(r,"altNames",e.defaultValues("altNames")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{altNames:"altNames"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for AltName");"altNames"in r.result&&(this.altNames=Array.from(r.result.altNames,function(e){return new tt({schema:e})}))}},{key:"toSchema",value:function(){return new ee({value:Array.from(this.altNames,function(e){return e.toSchema()})})}},{key:"toJSON",value:function(){return{altNames:Array.from(this.altNames,function(e){return e.toJSON()})}}}],[{key:"defaultValues",value:function(e){switch(e){case"altNames":return[];default:throw new Error("Invalid member name for AltName class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new Ue({name:e.altNames||"",value:tt.schema()})]})}}]),e}(),it=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.contentType=t(r,"contentType",e.defaultValues("contentType")),this.content=t(r,"content",e.defaultValues("content")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema());if(!1===r.verified)throw new Error("Object's schema was not verified against input data for CMS_CONTENT_INFO");this.contentType=r.result.contentType.valueBlock.toString(),this.content=r.result.content}},{key:"toSchema",value:function(){return new ee({value:[new me({value:this.contentType}),new z({idBlock:{tagClass:3,tagNumber:0},value:[this.content]})]})}},{key:"toJSON",value:function(){var e={contentType:this.contentType};return this.content instanceof He||(e.content=this.content.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case"contentType":return"";case"content":return new He;default:throw new Error("Invalid member name for ContentInfo class: "+e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"contentType":return""===t;case"content":return t instanceof He;default:throw new Error("Invalid member name for ContentInfo class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return"optional"in e==!1&&(e.optional=!1),new ee({name:e.blockName||"ContentInfo",optional:e.optional,value:[new me({name:e.contentType||"contentType"}),new z({idBlock:{tagClass:3,tagNumber:0},value:[new He({name:e.content||"content"})]})]})}}]),e}(),st=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(_classCallCheck(this,e),this.contentType=t(r,"contentType",e.defaultValues("contentType")),this.contentEncryptionAlgorithm=t(r,"contentEncryptionAlgorithm",e.defaultValues("contentEncryptionAlgorithm")),"encryptedContent"in r&&(this.encryptedContent=r.encryptedContent,1===this.encryptedContent.idBlock.tagClass&&4===this.encryptedContent.idBlock.tagNumber&&!1===this.encryptedContent.idBlock.isConstructed)){for(var a=new ne({idBlock:{isConstructed:!0},isConstructed:!0}),n=0,i=this.encryptedContent.valueBlock.valueHex.byteLength;i>0;){for(var s=new Uint8Array(this.encryptedContent.valueBlock.valueHex,n,n+1024>this.encryptedContent.valueBlock.valueHex.byteLength?this.encryptedContent.valueBlock.valueHex.byteLength-n:1024),o=new ArrayBuffer(s.length),u=new Uint8Array(o),l=0;l<u.length;l++)u[l]=s[l];a.valueBlock.value.push(new ne({valueHex:o})),i-=s.length,n+=s.length}this.encryptedContent=a}"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{contentType:"contentType",contentEncryptionAlgorithm:{names:{blockName:"contentEncryptionAlgorithm"}},encryptedContent:"encryptedContent"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for EncryptedContentInfo");this.contentType=r.result.contentType.valueBlock.toString(),this.contentEncryptionAlgorithm=new Te({schema:r.result.contentEncryptionAlgorithm}),"encryptedContent"in r.result&&(this.encryptedContent=r.result.encryptedContent,this.encryptedContent.idBlock.tagClass=1,this.encryptedContent.idBlock.tagNumber=4)}},{key:"toSchema",value:function(){var e={isIndefiniteForm:!1},t=[];if(t.push(new me({value:this.contentType})),t.push(this.contentEncryptionAlgorithm.toSchema()),"encryptedContent"in this){e.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed;var r=this.encryptedContent;r.idBlock.tagClass=3,r.idBlock.tagNumber=0,r.lenBlock.isIndefiniteForm=this.encryptedContent.idBlock.isConstructed,t.push(r)}return new ee({lenBlock:e,value:t})}},{key:"toJSON",value:function(){var e={contentType:this.contentType,contentEncryptionAlgorithm:this.contentEncryptionAlgorithm.toJSON()};return"encryptedContent"in this&&(e.encryptedContent=this.encryptedContent.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case"contentType":return"";case"contentEncryptionAlgorithm":return new Te;case"encryptedContent":return new ne;default:throw new Error("Invalid member name for EncryptedContentInfo class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"contentType":return""===r;case"contentEncryptionAlgorithm":return""===r.algorithmId&&"algorithmParams"in r==!1;case"encryptedContent":return r.isEqual(e.defaultValues(t));default:throw new Error("Invalid member name for EncryptedContentInfo class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new me({name:e.contentType||""}),Te.schema(e.contentEncryptionAlgorithm||{}),new Ke({value:[new z({name:e.encryptedContent||"",idBlock:{tagClass:3,tagNumber:0},value:[new Ue({value:new ne})]}),new G({name:e.encryptedContent||"",idBlock:{tagClass:3,tagNumber:0}})]})]})}}]),e}(),ot=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.salt=t(r,"salt",e.defaultValues("salt")),this.iterationCount=t(r,"iterationCount",e.defaultValues("iterationCount")),this.keyLength=t(r,"keyLength",e.defaultValues("keyLength")),this.prf=t(r,"prf",e.defaultValues("prf")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{saltPrimitive:"salt",saltConstructed:{names:{blockName:"salt"}},iterationCount:"iterationCount",keyLength:"keyLength",prf:{names:{blockName:"prf",optional:!0}}}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PBKDF2_params");this.salt=r.result.salt,this.iterationCount=r.result.iterationCount.valueBlock.valueDec,"keyLength"in r.result&&(this.keyLength=r.result.keyLength.valueBlock.valueDec),"prf"in r.result&&(this.prf=new Te({schema:r.result.prf}))}},{key:"toSchema",value:function(){var t=[];return t.push(this.salt),t.push(new ue({value:this.iterationCount})),e.defaultValues("keyLength")!==this.keyLength&&t.push(new ue({value:this.keyLength})),!1===e.defaultValues("prf").isEqual(this.prf)&&t.push(this.prf.toSchema()),new ee({value:t})}},{key:"toJSON",value:function(){var t={salt:this.salt.toJSON(),iterationCount:this.iterationCount};return e.defaultValues("keyLength")!==this.keyLength&&(t.keyLength=this.keyLength),!1===e.defaultValues("prf").isEqual(this.prf)&&(t.prf=this.prf.toJSON()),t}}],[{key:"defaultValues",value:function(e){switch(e){case"salt":return{};case"iterationCount":return-1;case"keyLength":return 0;case"prf":return new Te;default:throw new Error("Invalid member name for PBKDF2Params class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new Ke({value:[new ne({name:e.saltPrimitive||""}),Te.schema(e.saltConstructed||{})]}),new ue({name:e.iterationCount||""}),new ue({name:e.keyLength||"",optional:!0}),Te.schema(e.prf||{names:{optional:!0}})]})}}]),e}(),ut=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.keyDerivationFunc=t(r,"keyDerivationFunc",e.defaultValues("keyDerivationFunc")),this.encryptionScheme=t(r,"encryptionScheme",e.defaultValues("encryptionScheme")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{keyDerivationFunc:{names:{blockName:"keyDerivationFunc"}},encryptionScheme:{names:{blockName:"encryptionScheme"}}}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PBES2_params");this.keyDerivationFunc=new Te({schema:r.result.keyDerivationFunc}),this.encryptionScheme=new Te({schema:r.result.encryptionScheme})}},{key:"toSchema",value:function(){return new ee({value:[this.keyDerivationFunc.toSchema(),this.encryptionScheme.toSchema()]})}},{key:"toJSON",value:function(){return{keyDerivationFunc:this.keyDerivationFunc.toJSON(),encryptionScheme:this.encryptionScheme.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case"keyDerivationFunc":case"encryptionScheme":return new Te;default:throw new Error("Invalid member name for PBES2Params class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[Te.schema(e.keyDerivationFunc||{}),Te.schema(e.encryptionScheme||{})]})}}]),e}(),lt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.version=t(r,"version",e.defaultValues("version")),this.encryptedContentInfo=t(r,"encryptedContentInfo",e.defaultValues("encryptedContentInfo")),"unprotectedAttrs"in r&&(this.unprotectedAttrs=t(r,"unprotectedAttrs",e.defaultValues("unprotectedAttrs"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{version:"version",encryptedContentInfo:{names:{blockName:"encryptedContentInfo"}},unprotectedAttrs:"unprotectedAttrs"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for CMS_ENCRYPTED_DATA");this.version=r.result.version.valueBlock.valueDec,this.encryptedContentInfo=new st({schema:r.result.encryptedContentInfo}),"unprotectedAttrs"in r.result&&(this.unprotectedAttrs=Array.from(r.result.unprotectedAttrs,function(e){return new Me({schema:e})}))}},{key:"toSchema",value:function(){var e=[];return e.push(new ue({value:this.version})),e.push(this.encryptedContentInfo.toSchema()),"unprotectedAttrs"in this&&e.push(new z({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,function(e){return e.toSchema()})})),new ee({value:e})}},{key:"toJSON",value:function(){var e={version:this.version,encryptedContentInfo:this.encryptedContentInfo.toJSON()};return"unprotectedAttrs"in this&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,function(e){return e.toJSON()})),e}},{key:"encrypt",value:function(e){var t=this;if(e instanceof Object==!1)return Promise.reject('Parameters must have type "Object"');if("password"in e==!1)return Promise.reject('Absent mandatory parameter "password"');if("contentEncryptionAlgorithm"in e==!1)return Promise.reject('Absent mandatory parameter "contentEncryptionAlgorithm"');if("hmacHashAlgorithm"in e==!1)return Promise.reject('Absent mandatory parameter "hmacHashAlgorithm"');if("iterationCount"in e==!1)return Promise.reject('Absent mandatory parameter "iterationCount"');if("contentToEncrypt"in e==!1)return Promise.reject('Absent mandatory parameter "contentToEncrypt"');var r=C(e.contentEncryptionAlgorithm);if(""===r)return Promise.reject('Wrong "contentEncryptionAlgorithm" value');var a=C({name:"PBKDF2"});if(""===a)return Promise.reject("Can not find OID for PBKDF2");var n=C({name:"HMAC",hash:{name:e.hmacHashAlgorithm}});if(""===n)return Promise.reject('Incorrect value for "hmacHashAlgorithm": '+e.hmacHashAlgorithm);var i=b();if(void 0===i)return Promise.reject("Unable to create WebCrypto object");var s=Promise.resolve(),o=new ArrayBuffer(16),u=new Uint8Array(o);w(u);var l=new ArrayBuffer(64),c=new Uint8Array(l);w(c);var h=new Uint8Array(e.contentToEncrypt),m=new ot({salt:new ne({valueHex:l}),iterationCount:e.iterationCount,prf:new Te({algorithmId:n,algorithmParams:new re})});return s=s.then(function(){var t=new Uint8Array(e.password);return i.importKey("raw",t,"PBKDF2",!1,["deriveKey"])},function(e){return Promise.reject(e)}),s=s.then(function(t){return i.deriveKey({name:"PBKDF2",hash:{name:e.hmacHashAlgorithm},salt:c,iterations:e.iterationCount},t,e.contentEncryptionAlgorithm,!1,["encrypt"])},function(e){return Promise.reject(e)}),s=s.then(function(t){return i.encrypt({name:e.contentEncryptionAlgorithm.name,iv:u},t,h)},function(e){return Promise.reject(e)}),s=s.then(function(e){var n=new ut({keyDerivationFunc:new Te({algorithmId:a,algorithmParams:m.toSchema()}),encryptionScheme:new Te({algorithmId:r,algorithmParams:new ne({valueHex:o})})});t.encryptedContentInfo=new st({contentType:"1.2.840.113549.1.7.1",contentEncryptionAlgorithm:new Te({algorithmId:"1.2.840.113549.1.5.13",algorithmParams:n.toSchema()}),encryptedContent:new ne({valueHex:e})})},function(e){return Promise.reject(e)})}},{key:"decrypt",value:function(e){var t=this;if(e instanceof Object==!1)return Promise.reject('Parameters must have type "Object"');if("password"in e==!1)return Promise.reject('Absent mandatory parameter "password"');if("1.2.840.113549.1.5.13"!==this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId)return Promise.reject('Unknown "contentEncryptionAlgorithm": '+this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId);var r=b();if(void 0===r)return Promise.reject("Unable to create WebCrypto object");var a=Promise.resolve(),n=void 0;try{n=new ut({schema:this.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams})}catch(e){return Promise.reject('Incorrectly encoded "pbes2Parameters"')}var i=void 0;try{i=new ot({schema:n.keyDerivationFunc.algorithmParams})}catch(e){return Promise.reject('Incorrectly encoded "pbkdf2Params"')}var o=N(n.encryptionScheme.algorithmId);if("name"in o==!1)return Promise.reject('Incorrect OID for "contentEncryptionAlgorithm": '+n.encryptionScheme.algorithmId);var u=n.encryptionScheme.algorithmParams.valueBlock.valueHex,l=new Uint8Array(u),c=i.salt.valueBlock.valueHex,h=new Uint8Array(c),m=i.iterationCount,f="SHA-1";if("prf"in i){var v=N(i.prf.algorithmId);if("name"in v==!1)return Promise.reject("Incorrect OID for HMAC hash algorithm");f=v.hash.name}return a=a.then(function(){return r.importKey("raw",e.password,"PBKDF2",!1,["deriveKey"])},function(e){return Promise.reject(e)}),a=a.then(function(e){return r.deriveKey({name:"PBKDF2",hash:{name:f},salt:h,iterations:m},e,o,!1,["decrypt"])},function(e){return Promise.reject(e)}),a=a.then(function(e){var a=new ArrayBuffer(0);if(!1===t.encryptedContentInfo.encryptedContent.idBlock.isConstructed)a=t.encryptedContentInfo.encryptedContent.valueBlock.valueHex;else{var n=!0,i=!1,u=void 0;try{for(var c,h=t.encryptedContentInfo.encryptedContent.valueBlock.value[Symbol.iterator]();!(n=(c=h.next()).done);n=!0)a=s(a,c.value.valueBlock.valueHex)}catch(e){i=!0,u=e}finally{try{!n&&h.return&&h.return()}finally{if(i)throw u}}}return r.decrypt({name:o.name,iv:l},e,a)},function(e){return Promise.reject(e)})}}],[{key:"defaultValues",value:function(e){switch(e){case"version":return 0;case"encryptedContentInfo":return new st;case"unprotectedAttrs":return[];default:throw new Error("Invalid member name for EncryptedData class: "+e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"version":return 0===t;case"encryptedContentInfo":return st.compareWithDefault("contentType",t.contentType)&&st.compareWithDefault("contentEncryptionAlgorithm",t.contentEncryptionAlgorithm)&&st.compareWithDefault("encryptedContent",t.encryptedContent);case"unprotectedAttrs":return 0===t.length;default:throw new Error("Invalid member name for EncryptedData class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new ue({name:e.version||""}),st.schema(e.encryptedContentInfo||{}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Ue({name:e.unprotectedAttrs||"",value:Me.schema()})]})]})}}]),e}(),ct=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.encryptionAlgorithm=t(r,"encryptionAlgorithm",e.defaultValues("encryptionAlgorithm")),this.encryptedData=t(r,"encryptedData",e.defaultValues("encryptedData")),"parsedValue"in r&&(this.parsedValue=t(r,"parsedValue",e.defaultValues("parsedValue"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{encryptionAlgorithm:{names:{blockName:"encryptionAlgorithm"}},encryptedData:"encryptedData"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PKCS8ShroudedKeyBag");this.encryptionAlgorithm=new Te({schema:r.result.encryptionAlgorithm}),this.encryptedData=r.result.encryptedData}},{key:"toSchema",value:function(){return new ee({value:[this.encryptionAlgorithm.toSchema(),this.encryptedData]})}},{key:"toJSON",value:function(){return{encryptionAlgorithm:this.encryptionAlgorithm.toJSON(),encryptedData:this.encryptedData.toJSON()}}},{key:"parseInternalValues",value:function(e){var t=this,r=Promise.resolve(),a=new lt({encryptedContentInfo:new st({contentEncryptionAlgorithm:this.encryptionAlgorithm,encryptedContent:this.encryptedData})});return r=r.then(function(){return a.decrypt(e)},function(e){return Promise.reject(e)}),r=r.then(function(e){var r=g(e);if(-1===r.offset)return Promise.reject("Error during parsing ASN.1 data");t.parsedValue=new Ze({schema:r.result})},function(e){return Promise.reject(e)})}},{key:"makeInternalValues",value:function(e){var t=this;if("parsedValue"in this==!1)return Promise.reject('Please initialize "parsedValue" first');var r=Promise.resolve(),a=new lt;return r=r.then(function(){return e.contentToEncrypt=t.parsedValue.toSchema().toBER(!1),a.encrypt(e)},function(e){return Promise.reject(e)}),r=r.then(function(){t.encryptionAlgorithm=a.encryptedContentInfo.contentEncryptionAlgorithm,t.encryptedData=a.encryptedContentInfo.encryptedContent})}}],[{key:"defaultValues",value:function(e){switch(e){case"encryptionAlgorithm":return new Te;case"encryptedData":return new ne;case"parsedValue":return{};default:throw new Error("Invalid member name for PKCS8ShroudedKeyBag class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"encryptionAlgorithm":return Te.compareWithDefault("algorithmId",r.algorithmId)&&"algorithmParams"in r==!1;case"encryptedData":return r.isEqual(e.defaultValues(t));case"parsedValue":return r instanceof Object&&0===Object.keys(r).length;default:throw new Error("Invalid member name for PKCS8ShroudedKeyBag class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[Te.schema(e.encryptionAlgorithm||{names:{blockName:"encryptionAlgorithm"}}),new Ke({value:[new ne({name:e.encryptedData||"encryptedData"}),new ne({idBlock:{isConstructed:!0},name:e.encryptedData||"encryptedData"})]})]})}}]),e}(),ht=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.type=t(r,"type",e.defaultValues("type")),this.value=t(r,"value",e.defaultValues("value")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{utcTimeName:"utcTimeName",generalTimeName:"generalTimeName"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for TIME");"utcTimeName"in r.result&&(this.type=0,this.value=r.result.utcTimeName.toDate()),"generalTimeName"in r.result&&(this.type=1,this.value=r.result.generalTimeName.toDate())}},{key:"toSchema",value:function(){var e={};return 0===this.type&&(e=new xe({valueDate:this.value})),1===this.type&&(e=new Oe({valueDate:this.value})),e}},{key:"toJSON",value:function(){return{type:this.type,value:this.value}}}],[{key:"defaultValues",value:function(e){switch(e){case"type":return 0;case"value":return new Date(0,0,0);default:throw new Error("Invalid member name for Time class: "+e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=t(e,"names",{});return new Ke({optional:r,value:[new xe({name:a.utcTimeName||""}),new Oe({name:a.generalTimeName||""})]})}}]),e}(),mt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.attributes=t(r,"attributes",e.defaultValues("attributes")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{attributes:"attributes"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for SubjectDirectoryAttributes");this.attributes=Array.from(r.result.attributes,function(e){return new Me({schema:e})})}},{key:"toSchema",value:function(){return new ee({value:Array.from(this.attributes,function(e){return e.toSchema()})})}},{key:"toJSON",value:function(){return{attributes:Array.from(this.attributes,function(e){return e.toJSON()})}}}],[{key:"defaultValues",value:function(e){switch(e){case"attributes":return[];default:throw new Error("Invalid member name for SubjectDirectoryAttributes class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new Ue({name:e.attributes||"",value:Me.schema()})]})}}]),e}(),ft=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),"notBefore"in r&&(this.notBefore=t(r,"notBefore",e.defaultValues("notBefore"))),"notAfter"in r&&(this.notAfter=t(r,"notAfter",e.defaultValues("notAfter"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{notBefore:"notBefore",notAfter:"notAfter"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PrivateKeyUsagePeriod");if("notBefore"in r.result){var a=new Oe;a.fromBuffer(r.result.notBefore.valueBlock.valueHex),this.notBefore=a.toDate()}if("notAfter"in r.result){var n=new Oe({valueHex:r.result.notAfter.valueBlock.valueHex});n.fromBuffer(r.result.notAfter.valueBlock.valueHex),this.notAfter=n.toDate()}}},{key:"toSchema",value:function(){var e=[];return"notBefore"in this&&e.push(new G({idBlock:{tagClass:3,tagNumber:0},valueHex:new Oe({valueDate:this.notBefore}).valueBlock.valueHex})),"notAfter"in this&&e.push(new G({idBlock:{tagClass:3,tagNumber:1},valueHex:new Oe({valueDate:this.notAfter}).valueBlock.valueHex})),new ee({value:e})}},{key:"toJSON",value:function(){var e={};return"notBefore"in this&&(e.notBefore=this.notBefore),"notAfter"in this&&(e.notAfter=this.notAfter),e}}],[{key:"defaultValues",value:function(e){switch(e){case"notBefore":case"notAfter":return new Date;default:throw new Error("Invalid member name for PrivateKeyUsagePeriod class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new G({name:e.notBefore||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new G({name:e.notAfter||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}}]),e}(),vt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.cA=t(r,"cA",!1),"pathLenConstraint"in r&&(this.pathLenConstraint=t(r,"pathLenConstraint",0)),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{cA:"cA",pathLenConstraint:"pathLenConstraint"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for BasicConstraints");"cA"in r.result&&(this.cA=r.result.cA.valueBlock.value),"pathLenConstraint"in r.result&&(r.result.pathLenConstraint.valueBlock.isHexOnly?this.pathLenConstraint=r.result.pathLenConstraint:this.pathLenConstraint=r.result.pathLenConstraint.valueBlock.valueDec)}},{key:"toSchema",value:function(){var t=[];return this.cA!==e.defaultValues("cA")&&t.push(new Y({value:this.cA})),"pathLenConstraint"in this&&(this.pathLenConstraint instanceof ue?t.push(this.pathLenConstraint):t.push(new ue({value:this.pathLenConstraint}))),new ee({value:t})}},{key:"toJSON",value:function(){var t={};return this.cA!==e.defaultValues("cA")&&(t.cA=this.cA),"pathLenConstraint"in this&&(this.pathLenConstraint instanceof ue?t.pathLenConstraint=this.pathLenConstraint.toJSON():t.pathLenConstraint=this.pathLenConstraint),t}}],[{key:"defaultValues",value:function(e){switch(e){case"cA":return!1;default:throw new Error("Invalid member name for BasicConstraints class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new Y({optional:!0,name:e.cA||""}),new ue({optional:!0,name:e.pathLenConstraint||""})]})}}]),e}(),dt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),"distributionPoint"in r&&(this.distributionPoint=t(r,"distributionPoint",e.defaultValues("distributionPoint"))),this.onlyContainsUserCerts=t(r,"onlyContainsUserCerts",e.defaultValues("onlyContainsUserCerts")),this.onlyContainsCACerts=t(r,"onlyContainsCACerts",e.defaultValues("onlyContainsCACerts")),"onlySomeReasons"in r&&(this.onlySomeReasons=t(r,"onlySomeReasons",e.defaultValues("onlySomeReasons"))),this.indirectCRL=t(r,"indirectCRL",e.defaultValues("indirectCRL")),this.onlyContainsAttributeCerts=t(r,"onlyContainsAttributeCerts",e.defaultValues("onlyContainsAttributeCerts")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{distributionPoint:"distributionPoint",distributionPointNames:"distributionPointNames",onlyContainsUserCerts:"onlyContainsUserCerts",onlyContainsCACerts:"onlyContainsCACerts",onlySomeReasons:"onlySomeReasons",indirectCRL:"indirectCRL",onlyContainsAttributeCerts:"onlyContainsAttributeCerts"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for IssuingDistributionPoint");if("distributionPoint"in r.result)switch(!0){case 0===r.result.distributionPoint.idBlock.tagNumber:this.distributionPoint=Array.from(r.result.distributionPointNames,function(e){return new tt({schema:e})});break;case 1===r.result.distributionPoint.idBlock.tagNumber:r.result.distributionPoint.idBlock.tagClass=1,r.result.distributionPoint.idBlock.tagNumber=16,this.distributionPoint=new et({schema:r.result.distributionPoint});break;default:throw new Error("Unknown tagNumber for distributionPoint: {$asn1.result.distributionPoint.idBlock.tagNumber}")}if("onlyContainsUserCerts"in r.result){var a=new Uint8Array(r.result.onlyContainsUserCerts.valueBlock.valueHex);this.onlyContainsUserCerts=0!==a[0]}if("onlyContainsCACerts"in r.result){var n=new Uint8Array(r.result.onlyContainsCACerts.valueBlock.valueHex);this.onlyContainsCACerts=0!==n[0]}if("onlySomeReasons"in r.result){var i=new Uint8Array(r.result.onlySomeReasons.valueBlock.valueHex);this.onlySomeReasons=i[0]}if("indirectCRL"in r.result){var s=new Uint8Array(r.result.indirectCRL.valueBlock.valueHex);this.indirectCRL=0!==s[0]}if("onlyContainsAttributeCerts"in r.result){var o=new Uint8Array(r.result.onlyContainsAttributeCerts.valueBlock.valueHex);this.onlyContainsAttributeCerts=0!==o[0]}}},{key:"toSchema",value:function(){var t=[];if("distributionPoint"in this){var r=void 0;this.distributionPoint instanceof Array?r=new z({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,function(e){return e.toSchema()})}):((r=this.distributionPoint.toSchema()).idBlock.tagClass=3,r.idBlock.tagNumber=1),t.push(r)}if(this.onlyContainsUserCerts!==e.defaultValues("onlyContainsUserCerts")&&t.push(new G({idBlock:{tagClass:3,tagNumber:1},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsCACerts!==e.defaultValues("onlyContainsCACerts")&&t.push(new G({idBlock:{tagClass:3,tagNumber:2},valueHex:new Uint8Array([255]).buffer})),"onlySomeReasons"in this){var a=new ArrayBuffer(1);new Uint8Array(a)[0]=this.onlySomeReasons,t.push(new G({idBlock:{tagClass:3,tagNumber:3},valueHex:a}))}return this.indirectCRL!==e.defaultValues("indirectCRL")&&t.push(new G({idBlock:{tagClass:3,tagNumber:4},valueHex:new Uint8Array([255]).buffer})),this.onlyContainsAttributeCerts!==e.defaultValues("onlyContainsAttributeCerts")&&t.push(new G({idBlock:{tagClass:3,tagNumber:5},valueHex:new Uint8Array([255]).buffer})),new ee({value:t})}},{key:"toJSON",value:function(){var t={};return"distributionPoint"in this&&(this.distributionPoint instanceof Array?t.distributionPoint=Array.from(this.distributionPoint,function(e){return e.toJSON()}):t.distributionPoint=this.distributionPoint.toJSON()),this.onlyContainsUserCerts!==e.defaultValues("onlyContainsUserCerts")&&(t.onlyContainsUserCerts=this.onlyContainsUserCerts),this.onlyContainsCACerts!==e.defaultValues("onlyContainsCACerts")&&(t.onlyContainsCACerts=this.onlyContainsCACerts),"onlySomeReasons"in this&&(t.onlySomeReasons=this.onlySomeReasons),this.indirectCRL!==e.defaultValues("indirectCRL")&&(t.indirectCRL=this.indirectCRL),this.onlyContainsAttributeCerts!==e.defaultValues("onlyContainsAttributeCerts")&&(t.onlyContainsAttributeCerts=this.onlyContainsAttributeCerts),t}}],[{key:"defaultValues",value:function(e){switch(e){case"distributionPoint":return[];case"onlyContainsUserCerts":case"onlyContainsCACerts":return!1;case"onlySomeReasons":return 0;case"indirectCRL":case"onlyContainsAttributeCerts":return!1;default:throw new Error("Invalid member name for IssuingDistributionPoint class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ke({value:[new z({name:e.distributionPoint||"",idBlock:{tagClass:3,tagNumber:0},value:[new Ue({name:e.distributionPointNames||"",value:tt.schema()})]}),new z({name:e.distributionPoint||"",idBlock:{tagClass:3,tagNumber:1},value:et.schema().valueBlock.value})]})]}),new G({name:e.onlyContainsUserCerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new G({name:e.onlyContainsCACerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:2}}),new G({name:e.onlySomeReasons||"",optional:!0,idBlock:{tagClass:3,tagNumber:3}}),new G({name:e.indirectCRL||"",optional:!0,idBlock:{tagClass:3,tagNumber:4}}),new G({name:e.onlyContainsAttributeCerts||"",optional:!0,idBlock:{tagClass:3,tagNumber:5}})]})}}]),e}(),gt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.names=t(r,"names",e.defaultValues("names")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema());if(!1===r.verified)throw new Error("Object's schema was not verified against input data for GeneralNames");this.names=Array.from(r.result.names,function(e){return new tt({schema:e})})}},{key:"toSchema",value:function(){return new ee({value:Array.from(this.names,function(e){return e.toSchema()})})}},{key:"toJSON",value:function(){return{names:Array.from(this.names,function(e){return e.toJSON()})}}}],[{key:"defaultValues",value:function(e){switch(e){case"names":return[];default:throw new Error("Invalid member name for GeneralNames class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({value:[new Ue({name:e.blockName||"names",value:tt.schema()})]})}}]),e}(),yt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.base=t(r,"base",e.defaultValues("base")),this.minimum=t(r,"minimum",e.defaultValues("minimum")),"maximum"in r&&(this.maximum=t(r,"maximum",e.defaultValues("maximum"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{base:{names:{blockName:"base"}},minimum:"minimum",maximum:"maximum"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for ");this.base=new tt({schema:r.result.base}),"minimum"in r.result&&(r.result.minimum.valueBlock.isHexOnly?this.minimum=r.result.minimum:this.minimum=r.result.minimum.valueBlock.valueDec),"maximum"in r.result&&(r.result.maximum.valueBlock.isHexOnly?this.maximum=r.result.maximum:this.maximum=r.result.maximum.valueBlock.valueDec)}},{key:"toSchema",value:function(){var e=[];if(e.push(this.base.toSchema()),0!==this.minimum){var t=0;t=this.minimum instanceof ue?this.minimum:new ue({value:this.minimum}),e.push(new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[t]}))}if("maximum"in this){var r=0;r=this.maximum instanceof ue?this.maximum:new ue({value:this.maximum}),e.push(new z({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[r]}))}return new ee({value:e})}},{key:"toJSON",value:function(){var e={base:this.base.toJSON()};return 0!==this.minimum&&("number"==typeof this.minimum?e.minimum=this.minimum:e.minimum=this.minimum.toJSON()),"maximum"in this&&("number"==typeof this.maximum?e.maximum=this.maximum:e.maximum=this.maximum.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case"base":return new tt;case"minimum":case"maximum":return 0;default:throw new Error("Invalid member name for GeneralSubtree class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[tt.schema(e.base||{}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ue({name:e.minimum||""})]}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ue({name:e.maximum||""})]})]})}}]),e}(),pt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),"permittedSubtrees"in r&&(this.permittedSubtrees=t(r,"permittedSubtrees",e.defaultValues("permittedSubtrees"))),"excludedSubtrees"in r&&(this.excludedSubtrees=t(r,"excludedSubtrees",e.defaultValues("excludedSubtrees"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{permittedSubtrees:"permittedSubtrees",excludedSubtrees:"excludedSubtrees"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for NameConstraints");"permittedSubtrees"in r.result&&(this.permittedSubtrees=Array.from(r.result.permittedSubtrees,function(e){return new yt({schema:e})})),"excludedSubtrees"in r.result&&(this.excludedSubtrees=Array.from(r.result.excludedSubtrees,function(e){return new yt({schema:e})}))}},{key:"toSchema",value:function(){var e=[];return"permittedSubtrees"in this&&e.push(new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ee({value:Array.from(this.permittedSubtrees,function(e){return e.toSchema()})})]})),"excludedSubtrees"in this&&e.push(new z({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ee({value:Array.from(this.excludedSubtrees,function(e){return e.toSchema()})})]})),new ee({value:e})}},{key:"toJSON",value:function(){var e={};return"permittedSubtrees"in this&&(e.permittedSubtrees=Array.from(this.permittedSubtrees,function(e){return e.toJSON()})),"excludedSubtrees"in this&&(e.excludedSubtrees=Array.from(this.excludedSubtrees,function(e){return e.toJSON()})),e}}],[{key:"defaultValues",value:function(e){switch(e){case"permittedSubtrees":case"excludedSubtrees":return[];default:throw new Error("Invalid member name for NameConstraints class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ue({name:e.permittedSubtrees||"",value:yt.schema()})]}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Ue({name:e.excludedSubtrees||"",value:yt.schema()})]})]})}}]),e}(),kt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),"distributionPoint"in r&&(this.distributionPoint=t(r,"distributionPoint",e.defaultValues("distributionPoint"))),"reasons"in r&&(this.reasons=t(r,"reasons",e.defaultValues("reasons"))),"cRLIssuer"in r&&(this.cRLIssuer=t(r,"cRLIssuer",e.defaultValues("cRLIssuer"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{distributionPoint:"distributionPoint",distributionPointNames:"distributionPointNames",reasons:"reasons",cRLIssuer:"cRLIssuer",cRLIssuerNames:"cRLIssuerNames"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for DistributionPoint");"distributionPoint"in r.result&&(0===r.result.distributionPoint.idBlock.tagNumber&&(this.distributionPoint=Array.from(r.result.distributionPointNames,function(e){return new tt({schema:e})})),1===r.result.distributionPoint.idBlock.tagNumber&&(r.result.distributionPoint.idBlock.tagClass=1,r.result.distributionPoint.idBlock.tagNumber=16,this.distributionPoint=new et({schema:r.result.distributionPoint}))),"reasons"in r.result&&(this.reasons=new se({valueHex:r.result.reasons.valueBlock.valueHex})),"cRLIssuer"in r.result&&(this.cRLIssuer=Array.from(r.result.cRLIssuerNames,function(e){return new tt({schema:e})}))}},{key:"toSchema",value:function(){var e=[];if("distributionPoint"in this){var t=void 0;t=new z(this.distributionPoint instanceof Array?{idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.distributionPoint,function(e){return e.toSchema()})}:{idBlock:{tagClass:3,tagNumber:1},value:[this.distributionPoint.toSchema()]}),e.push(new z({idBlock:{tagClass:3,tagNumber:0},value:[t]}))}return"reasons"in this&&e.push(new G({idBlock:{tagClass:3,tagNumber:1},valueHex:this.reasons.valueBlock.valueHex})),"cRLIssuer"in this&&e.push(new z({idBlock:{tagClass:3,tagNumber:2},value:Array.from(this.cRLIssuer,function(e){return e.toSchema()})})),new ee({value:e})}},{key:"toJSON",value:function(){var e={};return"distributionPoint"in this&&(this.distributionPoint instanceof Array?e.distributionPoint=Array.from(this.distributionPoint,function(e){return e.toJSON()}):e.distributionPoint=this.distributionPoint.toJSON()),"reasons"in this&&(e.reasons=this.reasons.toJSON()),"cRLIssuer"in this&&(e.cRLIssuer=Array.from(this.cRLIssuer,function(e){return e.toJSON()})),e}}],[{key:"defaultValues",value:function(e){switch(e){case"distributionPoint":return[];case"reasons":return new se;case"cRLIssuer":return[];default:throw new Error("Invalid member name for DistributionPoint class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ke({value:[new z({name:e.distributionPoint||"",optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ue({name:e.distributionPointNames||"",value:tt.schema()})]}),new z({name:e.distributionPoint||"",optional:!0,idBlock:{tagClass:3,tagNumber:1},value:et.schema().valueBlock.value})]})]}),new G({name:e.reasons||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}}),new z({name:e.cRLIssuer||"",optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[new Ue({name:e.cRLIssuerNames||"",value:tt.schema()})]})]})}}]),e}(),bt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.distributionPoints=t(r,"distributionPoints",e.defaultValues("distributionPoints")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{distributionPoints:"distributionPoints"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for CRLDistributionPoints");this.distributionPoints=Array.from(r.result.distributionPoints,function(e){return new kt({schema:e})})}},{key:"toSchema",value:function(){return new ee({value:Array.from(this.distributionPoints,function(e){return e.toSchema()})})}},{key:"toJSON",value:function(){return{distributionPoints:Array.from(this.distributionPoints,function(e){return e.toJSON()})}}}],[{key:"defaultValues",value:function(e){switch(e){case"distributionPoints":return[];default:throw new Error("Invalid member name for CRLDistributionPoints class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new Ue({name:e.distributionPoints||"",value:kt.schema()})]})}}]),e}(),wt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.policyQualifierId=t(r,"policyQualifierId",e.defaultValues("policyQualifierId")),this.qualifier=t(r,"qualifier",e.defaultValues("qualifier")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{policyQualifierId:"policyQualifierId",qualifier:"qualifier"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PolicyQualifierInfo");this.policyQualifierId=r.result.policyQualifierId.valueBlock.toString(),this.qualifier=r.result.qualifier}},{key:"toSchema",value:function(){return new ee({value:[new me({value:this.policyQualifierId}),this.qualifier]})}},{key:"toJSON",value:function(){return{policyQualifierId:this.policyQualifierId,qualifier:this.qualifier.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case"policyQualifierId":return"";case"qualifier":return new He;default:throw new Error("Invalid member name for PolicyQualifierInfo class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new me({name:e.policyQualifierId||""}),new He({name:e.qualifier||""})]})}}]),e}(),Ct=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.policyIdentifier=t(r,"policyIdentifier",e.defaultValues("policyIdentifier")),"policyQualifiers"in r&&(this.policyQualifiers=t(r,"policyQualifiers",e.defaultValues("policyQualifiers"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{policyIdentifier:"policyIdentifier",policyQualifiers:"policyQualifiers"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PolicyInformation");this.policyIdentifier=r.result.policyIdentifier.valueBlock.toString(),"policyQualifiers"in r.result&&(this.policyQualifiers=Array.from(r.result.policyQualifiers,function(e){return new wt({schema:e})}))}},{key:"toSchema",value:function(){var e=[];return e.push(new me({value:this.policyIdentifier})),"policyQualifiers"in this&&e.push(new ee({value:Array.from(this.policyQualifiers,function(e){return e.toSchema()})})),new ee({value:e})}},{key:"toJSON",value:function(){var e={policyIdentifier:this.policyIdentifier};return"policyQualifiers"in this&&(e.policyQualifiers=Array.from(this.policyQualifiers,function(e){return e.toJSON()})),e}}],[{key:"defaultValues",value:function(e){switch(e){case"policyIdentifier":return"";case"policyQualifiers":return[];default:throw new Error("Invalid member name for PolicyInformation class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new me({name:e.policyIdentifier||""}),new ee({optional:!0,value:[new Ue({name:e.policyQualifiers||"",value:wt.schema()})]})]})}}]),e}(),St=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.certificatePolicies=t(r,"certificatePolicies",e.defaultValues("certificatePolicies")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{certificatePolicies:"certificatePolicies"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for CertificatePolicies");this.certificatePolicies=Array.from(r.result.certificatePolicies,function(e){return new Ct({schema:e})})}},{key:"toSchema",value:function(){return new ee({value:Array.from(this.certificatePolicies,function(e){return e.toSchema()})})}},{key:"toJSON",value:function(){return{certificatePolicies:Array.from(this.certificatePolicies,function(e){return e.toJSON()})}}}],[{key:"defaultValues",value:function(e){switch(e){case"certificatePolicies":return[];default:throw new Error("Invalid member name for CertificatePolicies class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new Ue({name:e.certificatePolicies||"",value:Ct.schema()})]})}}]),e}(),At=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.issuerDomainPolicy=t(r,"issuerDomainPolicy",e.defaultValues("issuerDomainPolicy")),this.subjectDomainPolicy=t(r,"subjectDomainPolicy",e.defaultValues("subjectDomainPolicy")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{issuerDomainPolicy:"issuerDomainPolicy",subjectDomainPolicy:"subjectDomainPolicy"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PolicyMapping");this.issuerDomainPolicy=r.result.issuerDomainPolicy.valueBlock.toString(),this.subjectDomainPolicy=r.result.subjectDomainPolicy.valueBlock.toString()}},{key:"toSchema",value:function(){return new ee({value:[new me({value:this.issuerDomainPolicy}),new me({value:this.subjectDomainPolicy})]})}},{key:"toJSON",value:function(){return{issuerDomainPolicy:this.issuerDomainPolicy,subjectDomainPolicy:this.subjectDomainPolicy}}}],[{key:"defaultValues",value:function(e){switch(e){case"issuerDomainPolicy":case"subjectDomainPolicy":return"";default:throw new Error("Invalid member name for PolicyMapping class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new me({name:e.issuerDomainPolicy||""}),new me({name:e.subjectDomainPolicy||""})]})}}]),e}(),It=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.mappings=t(r,"mappings",e.defaultValues("mappings")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{mappings:"mappings"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PolicyMappings");this.mappings=Array.from(r.result.mappings,function(e){return new At({schema:e})})}},{key:"toSchema",value:function(){return new ee({value:Array.from(this.mappings,function(e){return e.toSchema()})})}},{key:"toJSON",value:function(){return{mappings:Array.from(this.mappings,function(e){return e.toJSON()})}}}],[{key:"defaultValues",value:function(e){switch(e){case"mappings":return[];default:throw new Error("Invalid member name for PolicyMappings class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new Ue({name:e.mappings||"",value:At.schema()})]})}}]),e}(),Bt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),"keyIdentifier"in r&&(this.keyIdentifier=t(r,"keyIdentifier",e.defaultValues("keyIdentifier"))),"authorityCertIssuer"in r&&(this.authorityCertIssuer=t(r,"authorityCertIssuer",e.defaultValues("authorityCertIssuer"))),"authorityCertSerialNumber"in r&&(this.authorityCertSerialNumber=t(r,"authorityCertSerialNumber",e.defaultValues("authorityCertSerialNumber"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{keyIdentifier:"keyIdentifier",authorityCertIssuer:"authorityCertIssuer",authorityCertSerialNumber:"authorityCertSerialNumber"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for AuthorityKeyIdentifier");"keyIdentifier"in r.result&&(r.result.keyIdentifier.idBlock.tagClass=1,r.result.keyIdentifier.idBlock.tagNumber=4,this.keyIdentifier=r.result.keyIdentifier),"authorityCertIssuer"in r.result&&(this.authorityCertIssuer=Array.from(r.result.authorityCertIssuer,function(e){return new tt({schema:e})})),"authorityCertSerialNumber"in r.result&&(r.result.authorityCertSerialNumber.idBlock.tagClass=1,r.result.authorityCertSerialNumber.idBlock.tagNumber=2,this.authorityCertSerialNumber=r.result.authorityCertSerialNumber)}},{key:"toSchema",value:function(){var e=[];if("keyIdentifier"in this){var t=this.keyIdentifier;t.idBlock.tagClass=3,t.idBlock.tagNumber=0,e.push(t)}if("authorityCertIssuer"in this&&e.push(new z({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ee({value:Array.from(this.authorityCertIssuer,function(e){return e.toSchema()})})]})),"authorityCertSerialNumber"in this){var r=this.authorityCertSerialNumber;r.idBlock.tagClass=3,r.idBlock.tagNumber=2,e.push(r)}return new ee({value:e})}},{key:"toJSON",value:function(){var e={};return"keyIdentifier"in this&&(e.keyIdentifier=this.keyIdentifier.toJSON()),"authorityCertIssuer"in this&&(e.authorityCertIssuer=Array.from(this.authorityCertIssuer,function(e){return e.toJSON()})),"authorityCertSerialNumber"in this&&(e.authorityCertSerialNumber=this.authorityCertSerialNumber.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case"keyIdentifier":return new ne;case"authorityCertIssuer":return[];case"authorityCertSerialNumber":return new ue;default:throw new Error("Invalid member name for AuthorityKeyIdentifier class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new G({name:e.keyIdentifier||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Ue({name:e.authorityCertIssuer||"",value:tt.schema()})]}),new G({name:e.authorityCertSerialNumber||"",optional:!0,idBlock:{tagClass:3,tagNumber:2}})]})}}]),e}(),Nt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),"requireExplicitPolicy"in r&&(this.requireExplicitPolicy=t(r,"requireExplicitPolicy",e.defaultValues("requireExplicitPolicy"))),"inhibitPolicyMapping"in r&&(this.inhibitPolicyMapping=t(r,"inhibitPolicyMapping",e.defaultValues("inhibitPolicyMapping"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{requireExplicitPolicy:"requireExplicitPolicy",inhibitPolicyMapping:"inhibitPolicyMapping"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PolicyConstraints");if("requireExplicitPolicy"in r.result){var a=r.result.requireExplicitPolicy;a.idBlock.tagClass=1,a.idBlock.tagNumber=2;var n=g(a.toBER(!1));this.requireExplicitPolicy=n.result.valueBlock.valueDec}if("inhibitPolicyMapping"in r.result){var i=r.result.inhibitPolicyMapping;i.idBlock.tagClass=1,i.idBlock.tagNumber=2;var s=g(i.toBER(!1));this.inhibitPolicyMapping=s.result.valueBlock.valueDec}}},{key:"toSchema",value:function(){var e=[];if("requireExplicitPolicy"in this){var t=new ue({value:this.requireExplicitPolicy});t.idBlock.tagClass=3,t.idBlock.tagNumber=0,e.push(t)}if("inhibitPolicyMapping"in this){var r=new ue({value:this.inhibitPolicyMapping});r.idBlock.tagClass=3,r.idBlock.tagNumber=1,e.push(r)}return new ee({value:e})}},{key:"toJSON",value:function(){var e={};return"requireExplicitPolicy"in this&&(e.requireExplicitPolicy=this.requireExplicitPolicy),"inhibitPolicyMapping"in this&&(e.inhibitPolicyMapping=this.inhibitPolicyMapping),e}}],[{key:"defaultValues",value:function(e){switch(e){case"requireExplicitPolicy":case"inhibitPolicyMapping":return 0;default:throw new Error("Invalid member name for PolicyConstraints class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new G({name:e.requireExplicitPolicy||"",optional:!0,idBlock:{tagClass:3,tagNumber:0}}),new G({name:e.inhibitPolicyMapping||"",optional:!0,idBlock:{tagClass:3,tagNumber:1}})]})}}]),e}(),Pt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.keyPurposes=t(r,"keyPurposes",e.defaultValues("keyPurposes")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{keyPurposes:"keyPurposes"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for ExtKeyUsage");this.keyPurposes=Array.from(r.result.keyPurposes,function(e){return e.valueBlock.toString()})}},{key:"toSchema",value:function(){return new ee({value:Array.from(this.keyPurposes,function(e){return new me({value:e})})})}},{key:"toJSON",value:function(){return{keyPurposes:Array.from(this.keyPurposes)}}}],[{key:"defaultValues",value:function(e){switch(e){case"keyPurposes":return[];default:throw new Error("Invalid member name for ExtKeyUsage class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new Ue({name:e.keyPurposes||"",value:new me})]})}}]),e}(),Et=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.accessDescriptions=t(r,"accessDescriptions",e.defaultValues("accessDescriptions")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{accessDescriptions:"accessDescriptions"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for InfoAccess");this.accessDescriptions=Array.from(r.result.accessDescriptions,function(e){return new rt({schema:e})})}},{key:"toSchema",value:function(){return new ee({value:Array.from(this.accessDescriptions,function(e){return e.toSchema()})})}},{key:"toJSON",value:function(){return{accessDescriptions:Array.from(this.accessDescriptions,function(e){return e.toJSON()})}}}],[{key:"defaultValues",value:function(e){switch(e){case"accessDescriptions":return[];default:throw new Error("Invalid member name for InfoAccess class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new Ue({name:e.accessDescriptions||"",value:rt.schema()})]})}}]),e}(),xt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.extnID=t(r,"extnID",e.defaultValues("extnID")),this.critical=t(r,"critical",e.defaultValues("critical")),this.extnValue="extnValue"in r?new ne({valueHex:r.extnValue}):e.defaultValues("extnValue"),"parsedValue"in r&&(this.parsedValue=t(r,"parsedValue",e.defaultValues("parsedValue"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{extnID:"extnID",critical:"critical",extnValue:"extnValue"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for EXTENSION");if(this.extnID=r.result.extnID.valueBlock.toString(),"critical"in r.result&&(this.critical=r.result.critical.valueBlock.value),this.extnValue=r.result.extnValue,-1!==(r=g(this.extnValue.valueBlock.valueHex)).offset)switch(this.extnID){case"2.5.29.9":this.parsedValue=new mt({schema:r.result});break;case"2.5.29.14":case"2.5.29.15":this.parsedValue=r.result;break;case"2.5.29.16":this.parsedValue=new ft({schema:r.result});break;case"2.5.29.17":case"2.5.29.18":this.parsedValue=new nt({schema:r.result});break;case"2.5.29.19":this.parsedValue=new vt({schema:r.result});break;case"2.5.29.20":case"2.5.29.27":case"2.5.29.21":case"2.5.29.24":this.parsedValue=r.result;break;case"2.5.29.28":this.parsedValue=new dt({schema:r.result});break;case"2.5.29.29":this.parsedValue=new gt({schema:r.result});break;case"2.5.29.30":this.parsedValue=new pt({schema:r.result});break;case"2.5.29.31":case"2.5.29.46":this.parsedValue=new bt({schema:r.result});break;case"2.5.29.32":this.parsedValue=new St({schema:r.result});break;case"2.5.29.33":this.parsedValue=new It({schema:r.result});break;case"2.5.29.35":this.parsedValue=new Bt({schema:r.result});break;case"2.5.29.36":this.parsedValue=new Nt({schema:r.result});break;case"2.5.29.37":this.parsedValue=new Pt({schema:r.result});break;case"2.5.29.54":this.parsedValue=r.result;break;case"1.3.6.1.5.5.7.1.1":case"1.3.6.1.5.5.7.1.11":this.parsedValue=new Et({schema:r.result})}}},{key:"toSchema",value:function(){var t=[];return t.push(new me({value:this.extnID})),this.critical!==e.defaultValues("critical")&&t.push(new Y({value:this.critical})),t.push(this.extnValue),new ee({value:t})}},{key:"toJSON",value:function(){var t={extnID:this.extnID,extnValue:this.extnValue.toJSON()};return this.critical!==e.defaultValues("critical")&&(t.critical=this.critical),"parsedValue"in this&&(t.parsedValue=this.parsedValue.toJSON()),t}}],[{key:"defaultValues",value:function(e){switch(e){case"extnID":return"";case"critical":return!1;case"extnValue":return new ne;case"parsedValue":return{};default:throw new Error("Invalid member name for Extension class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new me({name:e.extnID||""}),new Y({name:e.critical||"",optional:!0}),new ne({name:e.extnValue||""})]})}}]),e}(),Ot=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.extensions=t(r,"extensions",e.defaultValues("extensions")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{extensions:"extensions"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for EXTENSIONS");this.extensions=Array.from(r.result.extensions,function(e){return new xt({schema:e})})}},{key:"toSchema",value:function(){return new ee({value:Array.from(this.extensions,function(e){return e.toSchema()})})}},{key:"toJSON",value:function(){return{extensions:Array.from(this.extensions,function(e){return e.toJSON()})}}}],[{key:"defaultValues",value:function(e){switch(e){case"extensions":return[];default:throw new Error("Invalid member name for Extensions class: "+e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=t(e,"names",{});return new ee({optional:r,name:a.blockName||"",value:[new Ue({name:a.extensions||"",value:xt.schema(a.extension||{})})]})}}]),e}(),Vt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.tbs=t(r,"tbs",e.defaultValues("tbs")),this.version=t(r,"version",e.defaultValues("version")),this.serialNumber=t(r,"serialNumber",e.defaultValues("serialNumber")),this.signature=t(r,"signature",e.defaultValues("signature")),this.issuer=t(r,"issuer",e.defaultValues("issuer")),this.notBefore=t(r,"notBefore",e.defaultValues("notBefore")),this.notAfter=t(r,"notAfter",e.defaultValues("notAfter")),this.subject=t(r,"subject",e.defaultValues("subject")),this.subjectPublicKeyInfo=t(r,"subjectPublicKeyInfo",e.defaultValues("subjectPublicKeyInfo")),"issuerUniqueID"in r&&(this.issuerUniqueID=t(r,"issuerUniqueID",e.defaultValues("issuerUniqueID"))),"subjectUniqueID"in r&&(this.subjectUniqueID=t(r,"subjectUniqueID",e.defaultValues("subjectUniqueID"))),"extensions"in r&&(this.extensions=t(r,"extensions",e.defaultValues("extensions"))),this.signatureAlgorithm=t(r,"signatureAlgorithm",e.defaultValues("signatureAlgorithm")),this.signatureValue=t(r,"signatureValue",e.defaultValues("signatureValue")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{tbsCertificate:{names:{extensions:{names:{extensions:"tbsCertificate.extensions"}}}}}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for CERT");this.tbs=r.result.tbsCertificate.valueBeforeDecode,"tbsCertificate.version"in r.result&&(this.version=r.result["tbsCertificate.version"].valueBlock.valueDec),this.serialNumber=r.result["tbsCertificate.serialNumber"],this.signature=new Te({schema:r.result["tbsCertificate.signature"]}),this.issuer=new et({schema:r.result["tbsCertificate.issuer"]}),this.notBefore=new ht({schema:r.result["tbsCertificate.notBefore"]}),this.notAfter=new ht({schema:r.result["tbsCertificate.notAfter"]}),this.subject=new et({schema:r.result["tbsCertificate.subject"]}),this.subjectPublicKeyInfo=new Fe({schema:r.result["tbsCertificate.subjectPublicKeyInfo"]}),"tbsCertificate.issuerUniqueID"in r.result&&(this.issuerUniqueID=r.result["tbsCertificate.issuerUniqueID"].valueBlock.valueHex),"tbsCertificate.subjectUniqueID"in r.result&&(this.issuerUniqueID=r.result["tbsCertificate.subjectUniqueID"].valueBlock.valueHex),"tbsCertificate.extensions"in r.result&&(this.extensions=Array.from(r.result["tbsCertificate.extensions"],function(e){return new xt({schema:e})})),this.signatureAlgorithm=new Te({schema:r.result.signatureAlgorithm}),this.signatureValue=r.result.signatureValue}},{key:"encodeTBS",value:function(){var t=[];return"version"in this&&this.version!==e.defaultValues("version")&&t.push(new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ue({value:this.version})]})),t.push(this.serialNumber),t.push(this.signature.toSchema()),t.push(this.issuer.toSchema()),t.push(new ee({value:[this.notBefore.toSchema(),this.notAfter.toSchema()]})),t.push(this.subject.toSchema()),t.push(this.subjectPublicKeyInfo.toSchema()),"issuerUniqueID"in this&&t.push(new G({optional:!0,idBlock:{tagClass:3,tagNumber:1},valueHex:this.issuerUniqueID})),"subjectUniqueID"in this&&t.push(new G({optional:!0,idBlock:{tagClass:3,tagNumber:2},valueHex:this.subjectUniqueID})),"subjectUniqueID"in this&&t.push(new G({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[this.extensions.toSchema()]})),"extensions"in this&&t.push(new z({optional:!0,idBlock:{tagClass:3,tagNumber:3},value:[new ee({value:Array.from(this.extensions,function(e){return e.toSchema()})})]})),new ee({value:t})}},{key:"toSchema",value:function(){var t={};if(!1===(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){if(0===this.tbs.length)return e.schema().value[0];t=g(this.tbs).result}else t=this.encodeTBS();return new ee({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}},{key:"toJSON",value:function(){var t={tbs:r(this.tbs,0,this.tbs.byteLength),serialNumber:this.serialNumber.toJSON(),signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),notBefore:this.notBefore.toJSON(),notAfter:this.notAfter.toJSON(),subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return"version"in this&&this.version!==e.defaultValues("version")&&(t.version=this.version),"issuerUniqueID"in this&&(t.issuerUniqueID=r(this.issuerUniqueID,0,this.issuerUniqueID.byteLength)),"subjectUniqueID"in this&&(t.subjectUniqueID=r(this.subjectUniqueID,0,this.subjectUniqueID.byteLength)),"extensions"in this&&(t.extensions=Array.from(this.extensions,function(e){return e.toJSON()})),t}},{key:"getPublicKey",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=b();if(void 0===t)return Promise.reject("Unable to create WebCrypto object");if(null===e){e={};var r=P(this.signatureAlgorithm);if(""===r)return Promise.reject("Unsupported signature algorithm: "+this.signatureAlgorithm.algorithmId);var a=N(this.subjectPublicKeyInfo.algorithm.algorithmId);if("name"in a==!1)return Promise.reject("Unsupported public key algorithm: "+this.subjectPublicKeyInfo.algorithm.algorithmId);if(e.algorithm=S(a.name,"importkey"),"hash"in e.algorithm.algorithm&&(e.algorithm.algorithm.hash.name=r),"ECDSA"===a.name){var n=!1;if("algorithmParams"in this.subjectPublicKeyInfo.algorithm==!0&&"idBlock"in this.subjectPublicKeyInfo.algorithm.algorithmParams&&1===this.subjectPublicKeyInfo.algorithm.algorithmParams.idBlock.tagClass&&6===this.subjectPublicKeyInfo.algorithm.algorithmParams.idBlock.tagNumber&&(n=!0),!1===n)return Promise.reject("Incorrect type for ECDSA public key parameters");var i=N(this.subjectPublicKeyInfo.algorithm.algorithmParams.valueBlock.toString());if("name"in i==!1)return Promise.reject("Unsupported named curve algorithm: "+this.subjectPublicKeyInfo.algorithm.algorithmParams.valueBlock.toString());e.algorithm.algorithm.namedCurve=i.name}}var s=this.subjectPublicKeyInfo.toSchema().toBER(!1),o=new Uint8Array(s);return t.importKey("spki",o,e.algorithm.algorithm,!0,e.algorithm.usages)}},{key:"getKeyHash",value:function(){var e=b();return void 0===e?Promise.reject("Unable to create WebCrypto object"):e.digest({name:"sha-1"},new Uint8Array(this.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHex))}},{key:"sign",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"SHA-1";if(""===C({name:r}))return Promise.reject("Unsupported hash algorithm: "+r);var a=S(e.algorithm.name,"sign");switch(a.algorithm.hash.name=r,e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":this.signature.algorithmId=C(a.algorithm),this.signatureAlgorithm.algorithmId=this.signature.algorithmId;break;case"RSA-PSS":switch(r.toUpperCase()){case"SHA-256":a.algorithm.saltLength=32;break;case"SHA-384":a.algorithm.saltLength=48;break;case"SHA-512":a.algorithm.saltLength=64}var n={};if("SHA-1"!==r.toUpperCase()){var i=C({name:r});if(""===i)return Promise.reject("Unsupported hash algorithm: "+r);n.hashAlgorithm=new Te({algorithmId:i,algorithmParams:new re}),n.maskGenAlgorithm=new Te({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:n.hashAlgorithm.toSchema()})}20!==a.algorithm.saltLength&&(n.saltLength=a.algorithm.saltLength);var s=new Je(n);this.signature=new Te({algorithmId:"1.2.840.113549.1.1.10",algorithmParams:s.toSchema()}),this.signatureAlgorithm=this.signature;break;default:return Promise.reject("Unsupported signature algorithm: "+e.algorithm.name)}this.tbs=this.encodeTBS().toBER(!1);var o=b();return void 0===o?Promise.reject("Unable to create WebCrypto object"):o.sign(a.algorithm,e,new Uint8Array(this.tbs)).then(function(e){"ECDSA"===a.algorithm.name&&(e=A(e)),t.signatureValue=new se({valueHex:e})},function(e){return Promise.reject("Signing error: "+e)})}},{key:"verify",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=Promise.resolve(),a={},n=this.signatureValue,i=this.tbs;if(null!==t?a=t.subjectPublicKeyInfo:this.issuer.isEqual(this.subject)&&(a=this.subjectPublicKeyInfo),a instanceof Fe==!1)return Promise.reject("Please provide issuer certificate as a parameter");var s=b();if(void 0===s)return Promise.reject("Unable to create WebCrypto object");var o=P(this.signatureAlgorithm);return""===o?Promise.reject("Unsupported signature algorithm: "+this.signatureAlgorithm.algorithmId):(r=r.then(function(){var t=void 0,r=N(t="1.2.840.113549.1.1.10"===e.signatureAlgorithm.algorithmId?e.signatureAlgorithm.algorithmId:a.algorithm.algorithmId);if("name"in r==!1)return Promise.reject("Unsupported public key algorithm: "+t);var n=S(r.name,"importkey");if("hash"in n.algorithm&&(n.algorithm.hash.name=o),"ECDSA"===r.name){var i=!1;if("algorithmParams"in a.algorithm==!0&&"idBlock"in a.algorithm.algorithmParams&&1===a.algorithm.algorithmParams.idBlock.tagClass&&6===a.algorithm.algorithmParams.idBlock.tagNumber&&(i=!0),!1===i)return Promise.reject("Incorrect type for ECDSA public key parameters");var u=N(a.algorithm.algorithmParams.valueBlock.toString());if("name"in u==!1)return Promise.reject("Unsupported named curve algorithm: "+a.algorithm.algorithmParams.valueBlock.toString());n.algorithm.namedCurve=u.name}var l=a.toSchema().toBER(!1),c=new Uint8Array(l);return s.importKey("spki",c,n.algorithm,!0,n.usages)}),r=r.then(function(t){var r=S(t.algorithm.name,"verify");"hash"in r.algorithm&&(r.algorithm.hash.name=o);var a=n.valueBlock.valueHex;if("ECDSA"===t.algorithm.name&&(a=B(g(a).result)),"RSA-PSS"===t.algorithm.name){var u=void 0;try{u=new Je({schema:e.signatureAlgorithm.algorithmParams})}catch(e){return Promise.reject(e)}r.algorithm.saltLength="saltLength"in u?u.saltLength:20;var l="SHA-1";if("hashAlgorithm"in u){var c=N(u.hashAlgorithm.algorithmId);if("name"in c==!1)return Promise.reject("Unrecognized hash algorithm: "+u.hashAlgorithm.algorithmId);l=c.name}r.algorithm.hash.name=l}return s.verify(r.algorithm,t,new Uint8Array(a),new Uint8Array(i))}))}}],[{key:"defaultValues",value:function(e){switch(e){case"tbs":return new ArrayBuffer(0);case"version":return 0;case"serialNumber":return new ue;case"signature":return new Te;case"issuer":return new et;case"notBefore":case"notAfter":return new ht;case"subject":return new et;case"subjectPublicKeyInfo":return new Fe;case"issuerUniqueID":case"subjectUniqueID":return new ArrayBuffer(0);case"extensions":return[];case"signatureAlgorithm":return new Te;case"signatureValue":return new se;default:throw new Error("Invalid member name for Certificate class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[j(e.tbsCertificate),Te.schema(e.signatureAlgorithm||{names:{blockName:"signatureAlgorithm"}}),new se({name:e.signatureValue||"signatureValue"})]})}}]),e}(),_t=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.certId=t(r,"certId",e.defaultValues("certId")),this.certValue=t(r,"certValue",e.defaultValues("certValue")),"parsedValue"in r&&(this.parsedValue=t(r,"parsedValue",e.defaultValues("parsedValue"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{id:"certId",value:"certValue"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for CertBag");switch(this.certId=r.result.certId.valueBlock.toString(),this.certValue=r.result.certValue,this.certId){case"1.2.840.113549.1.9.22.1":var a=g(this.certValue.valueBlock.valueHex);this.parsedValue=new Vt({schema:a.result});break;case"1.2.840.113549.1.9.22.2":default:throw new Error('Incorrect "certId" value in CertBag: '+this.certId)}}},{key:"toSchema",value:function(){return"parsedValue"in this&&(this.certId="1.2.840.113549.1.9.22.1",this.certValue=new ne({valueHex:this.parsedValue.toSchema().toBER(!1)})),new ee({value:[new me({value:this.certId}),new z({idBlock:{tagClass:3,tagNumber:0},value:["toSchema"in this.certValue?this.certValue.toSchema():this.certValue]})]})}},{key:"toJSON",value:function(){return{certId:this.certId,certValue:this.certValue.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case"certId":return"";case"certValue":return new He;case"parsedValue":return{};default:throw new Error("Invalid member name for CertBag class: "+e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"certId":return""===t;case"certValue":return t instanceof He;case"parsedValue":return t instanceof Object&&0===Object.keys(t).length;default:throw new Error("Invalid member name for CertBag class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new me({name:e.id||"id"}),new z({idBlock:{tagClass:3,tagNumber:0},value:[new He({name:e.value||"value"})]})]})}}]),e}(),jt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.userCertificate=t(r,"userCertificate",e.defaultValues("userCertificate")),this.revocationDate=t(r,"revocationDate",e.defaultValues("revocationDate")),"crlEntryExtensions"in r&&(this.crlEntryExtensions=t(r,"crlEntryExtensions",e.defaultValues("crlEntryExtensions"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema());if(!1===r.verified)throw new Error("Object's schema was not verified against input data for REV_CERT");this.userCertificate=r.result.userCertificate,this.revocationDate=new ht({schema:r.result.revocationDate}),"crlEntryExtensions"in r.result&&(this.crlEntryExtensions=new Ot({schema:r.result.crlEntryExtensions}))}},{key:"toSchema",value:function(){var e=[this.userCertificate,this.revocationDate.toSchema()];return"crlEntryExtensions"in this&&e.push(this.crlEntryExtensions.toSchema()),new ee({value:e})}},{key:"toJSON",value:function(){var e={userCertificate:this.userCertificate.toJSON(),revocationDate:this.revocationDate.toJSON};return"crlEntryExtensions"in this&&(e.crlEntryExtensions=this.crlEntryExtensions.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case"userCertificate":return new ue;case"revocationDate":return new ht;case"crlEntryExtensions":return new Ot;default:throw new Error("Invalid member name for RevokedCertificate class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new ue({name:e.userCertificate||"userCertificate"}),ht.schema({names:{utcTimeName:e.revocationDate||"revocationDate",generalTimeName:e.revocationDate||"revocationDate"}}),Ot.schema({names:{blockName:e.crlEntryExtensions||"crlEntryExtensions"}},!0)]})}}]),e}(),Dt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.tbs=t(r,"tbs",e.defaultValues("tbs")),this.version=t(r,"version",e.defaultValues("version")),this.signature=t(r,"signature",e.defaultValues("signature")),this.issuer=t(r,"issuer",e.defaultValues("issuer")),this.thisUpdate=t(r,"thisUpdate",e.defaultValues("thisUpdate")),"nextUpdate"in r&&(this.nextUpdate=t(r,"nextUpdate",e.defaultValues("nextUpdate"))),"revokedCertificates"in r&&(this.revokedCertificates=t(r,"revokedCertificates",e.defaultValues("revokedCertificates"))),"crlExtensions"in r&&(this.crlExtensions=t(r,"crlExtensions",e.defaultValues("crlExtensions"))),this.signatureAlgorithm=t(r,"signatureAlgorithm",e.defaultValues("signatureAlgorithm")),this.signatureValue=t(r,"signatureValue",e.defaultValues("signatureValue")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema());if(!1===r.verified)throw new Error("Object's schema was not verified against input data for CRL");this.tbs=r.result.tbsCertList.valueBeforeDecode,"tbsCertList.version"in r.result&&(this.version=r.result["tbsCertList.version"].valueBlock.valueDec),this.signature=new Te({schema:r.result["tbsCertList.signature"]}),this.issuer=new et({schema:r.result["tbsCertList.issuer"]}),this.thisUpdate=new ht({schema:r.result["tbsCertList.thisUpdate"]}),"tbsCertList.nextUpdate"in r.result&&(this.nextUpdate=new ht({schema:r.result["tbsCertList.nextUpdate"]})),"tbsCertList.revokedCertificates"in r.result&&(this.revokedCertificates=Array.from(r.result["tbsCertList.revokedCertificates"],function(e){return new jt({schema:e})})),"tbsCertList.extensions"in r.result&&(this.crlExtensions=new Ot({schema:r.result["tbsCertList.extensions"]})),this.signatureAlgorithm=new Te({schema:r.result.signatureAlgorithm}),this.signatureValue=r.result.signatureValue}},{key:"encodeTBS",value:function(){var t=[];return this.version!==e.defaultValues("version")&&t.push(new ue({value:this.version})),t.push(this.signature.toSchema()),t.push(this.issuer.toSchema()),t.push(this.thisUpdate.toSchema()),"nextUpdate"in this&&t.push(this.nextUpdate.toSchema()),"revokedCertificates"in this&&t.push(new ee({value:Array.from(this.revokedCertificates,function(e){return e.toSchema()})})),"crlExtensions"in this&&t.push(new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.crlExtensions.toSchema()]})),new ee({value:t})}},{key:"toSchema",value:function(){var t=void 0;if(!1===(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){if(0===this.tbs.length)return e.schema();t=g(this.tbs).result}else t=this.encodeTBS();return new ee({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}},{key:"toJSON",value:function(){var t={tbs:r(this.tbs,0,this.tbs.byteLength),signature:this.signature.toJSON(),issuer:this.issuer.toJSON(),thisUpdate:this.thisUpdate.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return this.version!==e.defaultValues("version")&&(t.version=this.version),"nextUpdate"in this&&(t.nextUpdate=this.nextUpdate.toJSON()),"revokedCertificates"in this&&(t.revokedCertificates=Array.from(this.revokedCertificates,function(e){return e.toJSON()})),"crlExtensions"in this&&(t.crlExtensions=this.crlExtensions.toJSON()),t}},{key:"isCertificateRevoked",value:function(e){if(!1===this.issuer.isEqual(e.issuer))return!1;if("revokedCertificates"in this==!1)return!1;var t=!0,r=!1,a=void 0;try{for(var n,i=this.revokedCertificates[Symbol.iterator]();!(t=(n=i.next()).done);t=!0)if(n.value.userCertificate.isEqual(e.serialNumber))return!0}catch(e){r=!0,a=e}finally{try{!t&&i.return&&i.return()}finally{if(r)throw a}}return!1}},{key:"sign",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"SHA-1";if(void 0===e)return Promise.reject("Need to provide a private key for signing");if(""===C({name:r}))return Promise.reject("Unsupported hash algorithm: "+r);var a=S(e.algorithm.name,"sign");switch(a.algorithm.hash.name=r,e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":this.signature.algorithmId=C(a.algorithm),this.signatureAlgorithm.algorithmId=this.signature.algorithmId;break;case"RSA-PSS":switch(r.toUpperCase()){case"SHA-256":a.algorithm.saltLength=32;break;case"SHA-384":a.algorithm.saltLength=48;break;case"SHA-512":a.algorithm.saltLength=64}var n={};if("SHA-1"!==r.toUpperCase()){var i=C({name:r});if(""===i)return Promise.reject("Unsupported hash algorithm: "+r);n.hashAlgorithm=new Te({algorithmId:i,algorithmParams:new re}),n.maskGenAlgorithm=new Te({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:n.hashAlgorithm.toSchema()})}20!==a.algorithm.saltLength&&(n.saltLength=a.algorithm.saltLength);var s=new Je(n);this.signature=new Te({algorithmId:"1.2.840.113549.1.1.10",algorithmParams:s.toSchema()}),this.signatureAlgorithm=this.signature;break;default:return Promise.reject("Unsupported signature algorithm: "+e.algorithm.name)}this.tbs=this.encodeTBS().toBER(!1);var o=b();return void 0===o?Promise.reject("Unable to create WebCrypto object"):o.sign(a.algorithm,e,new Uint8Array(this.tbs)).then(function(e){"ECDSA"===a.algorithm.name&&(e=A(e)),t.signatureValue=new se({valueHex:e})},function(e){return Promise.reject("Signing error: "+e)})}},{key:"verify",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=Promise.resolve(),a=this.signatureValue,n=this.tbs,i=-1;if("issuerCertificate"in t&&(i=t.issuerCertificate.subjectPublicKeyInfo,!1===this.issuer.isEqual(t.issuerCertificate.subject)))return Promise.resolve(!1);if("publicKeyInfo"in t&&(i=t.publicKeyInfo),i instanceof Fe==!1)return Promise.reject("Issuer's certificate must be provided as an input parameter");if("crlExtensions"in this){var s=!0,o=!1,u=void 0;try{for(var l,c=this.crlExtensions.extensions[Symbol.iterator]();!(s=(l=c.next()).done);s=!0){var h=l.value;if(h.critical&&"parsedValue"in h==!1)return Promise.resolve(!1)}}catch(e){o=!0,u=e}finally{try{!s&&c.return&&c.return()}finally{if(o)throw u}}}var m=b();if(void 0===m)return Promise.reject("Unable to create WebCrypto object");var f=P(this.signatureAlgorithm);return""===f?Promise.reject("Unsupported signature algorithm: "+this.signatureAlgorithm.algorithmId):(r=r.then(function(){var t=N(e.signature.algorithmId);if("name"in t==="")return Promise.reject("Unsupported public key algorithm: "+e.signature.algorithmId);var r=S(t.name,"importkey");if("hash"in r.algorithm&&(r.algorithm.hash.name=f),"ECDSA"===t.name){var a=!1;if("algorithmParams"in i.algorithm==!0&&"idBlock"in i.algorithm.algorithmParams&&1===i.algorithm.algorithmParams.idBlock.tagClass&&6===i.algorithm.algorithmParams.idBlock.tagNumber&&(a=!0),!1===a)return Promise.reject("Incorrect type for ECDSA public key parameters");var n=N(i.algorithm.algorithmParams.valueBlock.toString());if("name"in n==!1)return Promise.reject("Unsupported named curve algorithm: "+i.algorithm.algorithmParams.valueBlock.toString());r.algorithm.namedCurve=n.name}var s=i.toSchema().toBER(!1),o=new Uint8Array(s);return m.importKey("spki",o,r.algorithm,!0,r.usages)}),r=r.then(function(t){var r=S(t.algorithm.name,"verify");"hash"in r.algorithm&&(r.algorithm.hash.name=f);var i=a.valueBlock.valueHex;if("ECDSA"===t.algorithm.name&&(i=B(g(i).result)),"RSA-PSS"===t.algorithm.name){var s=void 0;try{s=new Je({schema:e.signatureAlgorithm.algorithmParams})}catch(e){return Promise.reject(e)}r.algorithm.saltLength="saltLength"in s?s.saltLength:20;var o="SHA-1";if("hashAlgorithm"in s){var u=N(s.hashAlgorithm.algorithmId);if("name"in u==!1)return Promise.reject("Unrecognized hash algorithm: "+s.hashAlgorithm.algorithmId);o=u.name}r.algorithm.hash.name=o}return m.verify(r.algorithm,t,new Uint8Array(i),new Uint8Array(n))}))}}],[{key:"defaultValues",value:function(e){switch(e){case"tbs":return new ArrayBuffer(0);case"version":return 1;case"signature":return new Te;case"issuer":return new et;case"thisUpdate":case"nextUpdate":return new ht;case"revokedCertificates":return[];case"crlExtensions":return new Ot;case"signatureAlgorithm":return new Te;case"signatureValue":return new se;default:throw new Error("Invalid member name for CertificateRevocationList class: "+e)}}},{key:"schema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t(e,"names",{});return new ee({name:r.blockName||"CertificateList",value:[D(e),Te.schema(r.signatureAlgorithm||{names:{blockName:"signatureAlgorithm"}}),new se({name:r.signatureValue||"signatureValue"})]})}}]),e}(),Rt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.crlId=t(r,"crlId",e.defaultValues("crlId")),this.crlValue=t(r,"crlValue",e.defaultValues("crlValue")),"parsedValue"in r&&(this.parsedValue=t(r,"parsedValue",e.defaultValues("parsedValue"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{id:"crlId",value:"crlValue"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for CRLBag");switch(this.crlId=r.result.crlId.valueBlock.toString(),this.crlValue=r.result.crlValue,this.crlId){case"1.2.840.113549.1.9.23.1":var a=g(this.certValue.valueBlock.valueHex);this.parsedValue=new Dt({schema:a.result});break;default:throw new Error('Incorrect "crlId" value in CertBag: '+this.crlId)}}},{key:"toSchema",value:function(){return"parsedValue"in this&&(this.certId="1.2.840.113549.1.9.23.1",this.certValue=new ne({valueHex:this.parsedValue.toSchema().toBER(!1)})),new ee({value:[new me({value:this.crlId}),new z({idBlock:{tagClass:3,tagNumber:0},value:[this.crlValue.toSchema()]})]})}},{key:"toJSON",value:function(){return{crlId:this.crlId,crlValue:this.crlValue.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case"crlId":return"";case"crlValue":return new He;case"parsedValue":return{};default:throw new Error("Invalid member name for CRLBag class: "+e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"crlId":return""===t;case"crlValue":return t instanceof He;case"parsedValue":return t instanceof Object&&0===Object.keys(t).length;default:throw new Error("Invalid member name for CRLBag class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new me({name:e.id||"id"}),new z({idBlock:{tagClass:3,tagNumber:0},value:[new He({name:e.value||"value"})]})]})}}]),e}(),Kt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.secretTypeId=t(r,"secretTypeId",e.defaultValues("secretTypeId")),this.secretValue=t(r,"secretValue",e.defaultValues("secretValue")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{id:"secretTypeId",value:"secretValue"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for SecretBag");this.secretTypeId=r.result.secretTypeId.valueBlock.toString(),this.secretValue=r.result.secretValue}},{key:"toSchema",value:function(){return new ee({value:[new me({value:this.secretTypeId}),new z({idBlock:{tagClass:3,tagNumber:0},value:[this.secretValue.toSchema()]})]})}},{key:"toJSON",value:function(){return{secretTypeId:this.secretTypeId,secretValue:this.secretValue.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case"secretTypeId":return"";case"secretValue":return new He;default:throw new Error("Invalid member name for SecretBag class: "+e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"secretTypeId":return""===t;case"secretValue":return t instanceof He;default:throw new Error("Invalid member name for SecretBag class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new me({name:e.id||"id"}),new z({idBlock:{tagClass:3,tagNumber:0},value:[new He({name:e.value||"value"})]})]})}}]),e}(),Ht=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.bagId=t(r,"bagId",e.defaultValues("bagId")),this.bagValue=t(r,"bagValue",e.defaultValues("bagValue")),"bagAttributes"in r&&(this.bagAttributes=t(r,"bagAttributes",e.defaultValues("bagAttributes"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{bagId:"bagId",bagValue:"bagValue",bagAttributes:"bagAttributes"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for SafeBag");switch(this.bagId=r.result.bagId.valueBlock.toString(),this.bagId){case"1.2.840.113549.1.12.10.1.1":this.bagValue=new Ze({schema:r.result.bagValue});break;case"1.2.840.113549.1.12.10.1.2":this.bagValue=new ct({schema:r.result.bagValue});break;case"1.2.840.113549.1.12.10.1.3":this.bagValue=new _t({schema:r.result.bagValue});break;case"1.2.840.113549.1.12.10.1.4":this.bagValue=new Rt({schema:r.result.bagValue});break;case"1.2.840.113549.1.12.10.1.5":this.bagValue=new Kt({schema:r.result.bagValue});break;case"1.2.840.113549.1.12.10.1.6":this.bagValue=new Ut({schema:r.result.bagValue});break;default:throw new Error('Invalid "bagId" for SafeBag: '+this.bagId)}"bagAttributes"in r.result&&(this.bagAttributes=Array.from(r.result.bagAttributes,function(e){return new Me({schema:e})}))}},{key:"toSchema",value:function(){var e=[new me({value:this.bagId}),new z({idBlock:{tagClass:3,tagNumber:0},value:[this.bagValue.toSchema()]})];return"bagAttributes"in this&&e.push(new te({value:Array.from(this.bagAttributes,function(e){return e.toSchema()})})),new ee({value:e})}},{key:"toJSON",value:function(){var e={bagId:this.bagId,bagValue:this.bagValue.toJSON()};return"bagAttributes"in this&&(e.bagAttributes=Array.from(this.bagAttributes,function(e){return e.toJSON()})),e}}],[{key:"defaultValues",value:function(e){switch(e){case"bagId":return"";case"bagValue":return new He;case"bagAttributes":return[];default:throw new Error("Invalid member name for SafeBag class: "+e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"bagId":return""===t;case"bagValue":return t instanceof He;case"bagAttributes":return 0===t.length;default:throw new Error("Invalid member name for SafeBag class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new me({name:e.bagId||"bagId"}),new z({idBlock:{tagClass:3,tagNumber:0},value:[new He({name:e.bagValue||"bagValue"})]}),new te({optional:!0,value:[new Ue({name:e.bagAttributes||"bagAttributes",value:Me.schema()})]})]})}}]),e}(),Ut=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.safeBags=t(r,"safeBags",e.defaultValues("safeBags")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{safeBags:"safeBags"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for SafeContents");this.safeBags=Array.from(r.result.safeBags,function(e){return new Ht({schema:e})})}},{key:"toSchema",value:function(){return new ee({value:Array.from(this.safeBags,function(e){return e.toSchema()})})}},{key:"toJSON",value:function(){return{safeBags:Array.from(this.safeBags,function(e){return e.toJSON()})}}}],[{key:"defaultValues",value:function(e){switch(e){case"safeBags":return[];default:throw new Error("Invalid member name for SafeContents class: "+e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"safeBags":return 0===t.length;default:throw new Error("Invalid member name for SafeContents class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new Ue({name:e.safeBags||"",value:Ht.schema()})]})}}]),e}(),Lt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.certificates=t(r,"certificates",e.defaultValues("certificates")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema());if(!1===r.verified)throw new Error("Object's schema was not verified against input data for CMS_CERTIFICATE_SET");this.certificates=Array.from(r.result.certificates,function(e){return 1===e.idBlock.tagClass?new Vt({schema:e}):e})}},{key:"toSchema",value:function(){return new te({value:Array.from(this.certificates,function(e){return e instanceof Vt?e.toSchema():e})})}},{key:"toJSON",value:function(){return{certificates:Array.from(this.certificates,function(e){return e.toJSON()})}}}],[{key:"defaultValues",value:function(e){switch(e){case"certificates":return[];default:throw new Error("Invalid member name for Attribute class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new te({name:e.blockName||"",value:[new Ue({name:e.certificates||"",value:new Ke({value:[Vt.schema(),new z({idBlock:{tagClass:3,tagNumber:1},value:[new He]}),new z({idBlock:{tagClass:3,tagNumber:2},value:[new He]}),new z({idBlock:{tagClass:3,tagNumber:3},value:[new me,new He]})]})})]})}}]),e}(),Tt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.otherRevInfoFormat=t(r,"otherRevInfoFormat",e.defaultValues("otherRevInfoFormat")),this.otherRevInfo=t(r,"otherRevInfo",e.defaultValues("otherRevInfo")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema());if(!1===r.verified)throw new Error("Object's schema was not verified against input data for OtherRevocationInfoFormat");this.otherRevInfoFormat=r.result.otherRevInfoFormat.valueBlock.toString(),this.otherRevInfo=r.result.otherRevInfo}},{key:"toSchema",value:function(){return new ee({value:[new me({value:this.otherRevInfoFormat}),this.otherRevInfo]})}},{key:"toJSON",value:function(){var e={otherRevInfoFormat:this.otherRevInfoFormat};return this.otherRevInfo instanceof He||(e.otherRevInfo=this.otherRevInfo.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case"otherRevInfoFormat":return"";case"otherRevInfo":return new He;default:throw new Error("Invalid member name for OtherRevocationInfoFormat class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new me({name:e.otherRevInfoFormat||"otherRevInfoFormat"}),new He({name:e.otherRevInfo||"otherRevInfo"})]})}}]),e}(),Jt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.crls=t(r,"crls",e.defaultValues("crls")),this.otherRevocationInfos=t(r,"otherRevocationInfos",e.defaultValues("otherRevocationInfos")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{crls:"crls"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for CSM_REVOCATION_INFO_CHOICES");var a=!0,n=!1,i=void 0;try{for(var s,o=r.result.crls[Symbol.iterator]();!(a=(s=o.next()).done);a=!0){var u=s.value;1===u.idBlock.tagClass?this.crls.push(new Dt({schema:u})):this.otherRevocationInfos.push(new Tt({schema:u}))}}catch(e){n=!0,i=e}finally{try{!a&&o.return&&o.return()}finally{if(n)throw i}}}},{key:"toSchema",value:function(){var e=[];return e.push.apply(e,_toConsumableArray(Array.from(this.crls,function(e){return e.toSchema()}))),e.push.apply(e,_toConsumableArray(Array.from(this.otherRevocationInfos,function(e){var t=e.toSchema();return t.idBlock.tagClass=3,t.idBlock.tagNumber=1,t}))),new te({value:e})}},{key:"toJSON",value:function(){return{crls:Array.from(this.crls,function(e){return e.toJSON()}),otherRevocationInfos:Array.from(this.otherRevocationInfos,function(e){return e.toJSON()})}}}],[{key:"defaultValues",value:function(e){switch(e){case"crls":case"otherRevocationInfos":return[];default:throw new Error("Invalid member name for RevocationInfoChoices class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new te({name:e.blockName||"",value:[new Ue({name:e.crls||"",value:new Ke({value:[Dt.schema(),new z({idBlock:{tagClass:3,tagNumber:1},value:[new me,new He]})]})})]})}}]),e}(),qt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.certs=t(r,"certs",e.defaultValues("certs")),this.crls=t(r,"crls",e.defaultValues("crls")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{certs:"certs",crls:"crls"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for OriginatorInfo");r.result.certs.idBlock.tagClass=1,r.result.certs.idBlock.tagNumber=17,this.certs=new Lt({schema:r.result.certs}),r.result.crls.idBlock.tagClass=1,r.result.crls.idBlock.tagNumber=17,this.crls=new Jt({schema:r.result.crls})}},{key:"toSchema",value:function(){return new ee({value:[new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:this.certs.toSchema().valueBlock.value}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:this.crls.toSchema().valueBlock.value})]})}},{key:"toJSON",value:function(){return{certs:this.certs.toJSON(),crls:this.crls.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case"certs":return new Lt;case"crls":return new Jt;default:throw new Error("Invalid member name for OriginatorInfo class: "+e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"certs":return 0===t.certificates.length;case"crls":return 0===t.crls.length&&0===t.otherRevocationInfos.length;default:throw new Error("Invalid member name for OriginatorInfo class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new z({name:e.certs||"",optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Lt.schema().valueBlock.value}),new z({name:e.crls||"",optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Jt.schema().valueBlock.value})]})}}]),e}(),Wt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.issuer=t(r,"issuer",e.defaultValues("issuer")),this.serialNumber=t(r,"serialNumber",e.defaultValues("serialNumber")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{issuer:{names:{blockName:"issuer"}},serialNumber:"serialNumber"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for IssuerAndSerialNumber");this.issuer=new et({schema:r.result.issuer}),this.serialNumber=r.result.serialNumber}},{key:"toSchema",value:function(){return new ee({value:[this.issuer.toSchema(),this.serialNumber]})}},{key:"toJSON",value:function(){return{issuer:this.issuer.toJSON(),serialNumber:this.serialNumber.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case"issuer":return new et;case"serialNumber":return new ue;default:throw new Error("Invalid member name for IssuerAndSerialNumber class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[et.schema(e.issuer||{}),new ue({name:e.serialNumber||""})]})}}]),e}(),Ft=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.variant=t(r,"variant",e.defaultValues("variant")),"value"in r&&(this.value=t(r,"value",e.defaultValues("value"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{blockName:"blockName"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for RecipientIdentifier");1===r.result.blockName.idBlock.tagClass?(this.variant=1,this.value=new Wt({schema:r.result.blockName})):(this.variant=2,this.value=r.result.blockName.valueBlock.value[0])}},{key:"toSchema",value:function(){switch(this.variant){case 1:return this.value.toSchema();case 2:return new z({idBlock:{tagClass:3,tagNumber:0},value:[this.value]});default:return new He}}},{key:"toJSON",value:function(){var e={variant:this.variant};return 1!==this.variant&&2!==this.variant||(e.value=this.value.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case"variant":return-1;case"value":return{};default:throw new Error("Invalid member name for RecipientIdentifier class: "+e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"variant":return-1===t;case"values":return 0===Object.keys(t).length;default:throw new Error("Invalid member name for RecipientIdentifier class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Ke({value:[Wt.schema({names:{blockName:e.blockName||""}}),new z({name:e.blockName||"",idBlock:{tagClass:3,tagNumber:0},value:[new ne]})]})}}]),e}(),Mt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.version=t(r,"version",e.defaultValues("version")),this.rid=t(r,"rid",e.defaultValues("rid")),this.keyEncryptionAlgorithm=t(r,"keyEncryptionAlgorithm",e.defaultValues("keyEncryptionAlgorithm")),this.encryptedKey=t(r,"encryptedKey",e.defaultValues("encryptedKey")),this.recipientCertificate=t(r,"recipientCertificate",e.defaultValues("recipientCertificate")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{version:"version",rid:{names:{blockName:"rid"}},keyEncryptionAlgorithm:{names:{blockName:"keyEncryptionAlgorithm"}},encryptedKey:"encryptedKey"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for KeyTransRecipientInfo");this.version=r.result.version.valueBlock.valueDec,3===r.result.rid.idBlock.tagClass?this.rid=r.result.rid.valueBlock.value[0]:this.rid=new Wt({schema:r.result.rid}),this.keyEncryptionAlgorithm=new Te({schema:r.result.keyEncryptionAlgorithm}),this.encryptedKey=r.result.encryptedKey}},{key:"toSchema",value:function(){var e=[];return this.rid instanceof Wt?(this.version=0,e.push(new ue({value:this.version})),e.push(this.rid.toSchema())):(this.version=2,e.push(new ue({value:this.version})),e.push(new z({idBlock:{tagClass:3,tagNumber:0},value:[this.rid]}))),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new ee({value:e})}},{key:"toJSON",value:function(){return{version:this.version,rid:this.rid.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case"version":return-1;case"rid":return{};case"keyEncryptionAlgorithm":return new Te;case"encryptedKey":return new ne;case"recipientCertificate":return new Vt;default:throw new Error("Invalid member name for KeyTransRecipientInfo class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"version":return r===e.defaultValues("version");case"rid":return 0===Object.keys(r).length;case"keyEncryptionAlgorithm":case"encryptedKey":return r.isEqual(e.defaultValues(t));case"recipientCertificate":return!1;default:throw new Error("Invalid member name for KeyTransRecipientInfo class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new ue({name:e.version||""}),Ft.schema(e.rid||{}),Te.schema(e.keyEncryptionAlgorithm||{}),new ne({name:e.encryptedKey||""})]})}}]),e}(),Gt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.algorithm=t(r,"algorithm",e.defaultValues("algorithm")),this.publicKey=t(r,"publicKey",e.defaultValues("publicKey")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{algorithm:{names:{blockName:"algorithm"}},publicKey:"publicKey"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for OriginatorPublicKey");this.algorithm=new Te({schema:r.result.algorithm}),this.publicKey=r.result.publicKey}},{key:"toSchema",value:function(){return new ee({value:[this.algorithm.toSchema(),this.publicKey]})}},{key:"toJSON",value:function(){return{algorithm:this.algorithm.toJSON(),publicKey:this.publicKey.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case"algorithm":return new Te;case"publicKey":return new se;default:throw new Error("Invalid member name for OriginatorPublicKey class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"algorithm":case"publicKey":return r.isEqual(e.defaultValues(t));default:throw new Error("Invalid member name for OriginatorPublicKey class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[Te.schema(e.algorithm||{}),new se({name:e.publicKey||""})]})}}]),e}(),Qt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.variant=t(r,"variant",e.defaultValues("variant")),"value"in r&&(this.value=t(r,"value",e.defaultValues("value"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{blockName:"blockName"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for OriginatorIdentifierOrKey");1===r.result.blockName.idBlock.tagClass?(this.variant=1,this.value=new Wt({schema:r.result.blockName})):0===r.result.blockName.idBlock.tagNumber?(r.result.blockName.idBlock.tagClass=1,r.result.blockName.idBlock.tagNumber=4,this.variant=2,this.value=r.result.blockName):(r.result.blockName.idBlock.tagClass=1,r.result.blockName.idBlock.tagNumber=16,this.variant=3,this.value=new Gt({schema:r.result.blockName}))}},{key:"toSchema",value:function(){switch(this.variant){case 1:return this.value.toSchema();case 2:return this.value.idBlock.tagClass=3,this.value.idBlock.tagNumber=0,this.value;case 3:var e=this.value.toSchema();return e.idBlock.tagClass=3,e.idBlock.tagNumber=1,e;default:return new He}}},{key:"toJSON",value:function(){var e={variant:this.variant};return 1!==this.variant&&2!==this.variant&&3!==this.variant||(e.value=this.value.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case"variant":return-1;case"value":return{};default:throw new Error("Invalid member name for OriginatorIdentifierOrKey class: "+e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"variant":return-1===t;case"value":return 0===Object.keys(t).length;default:throw new Error("Invalid member name for OriginatorIdentifierOrKey class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Ke({value:[Wt.schema({names:{blockName:e.blockName||""}}),new G({idBlock:{tagClass:3,tagNumber:0},name:e.blockName||""}),new z({idBlock:{tagClass:3,tagNumber:1},name:e.blockName||"",value:Gt.schema().valueBlock.value})]})}}]),e}(),zt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.keyAttrId=t(r,"keyAttrId",e.defaultValues("keyAttrId")),"keyAttr"in r&&(this.keyAttr=t(r,"keyAttr",e.defaultValues("keyAttr"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{keyAttrId:"keyAttrId",keyAttr:"keyAttr"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for OtherKeyAttribute");this.keyAttrId=r.result.keyAttrId.valueBlock.toString(),"keyAttr"in r.result&&(this.keyAttr=r.result.keyAttr)}},{key:"toSchema",value:function(){var e=[];return e.push(new me({value:this.keyAttrId})),"keyAttr"in this&&e.push(this.keyAttr.toSchema()),new ee({value:e})}},{key:"toJSON",value:function(){var e={keyAttrId:this.keyAttrId};return"keyAttr"in this&&(e.keyAttr=this.keyAttr.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case"keyAttrId":return"";case"keyAttr":return{};default:throw new Error("Invalid member name for OtherKeyAttribute class: "+e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"keyAttrId":return""===t;case"keyAttr":return 0===Object.keys(t).length;default:throw new Error("Invalid member name for OtherKeyAttribute class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({optional:e.optional||!0,name:e.blockName||"",value:[new me({name:e.keyAttrId||""}),new He({optional:!0,name:e.keyAttr||""})]})}}]),e}(),Zt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.subjectKeyIdentifier=t(r,"subjectKeyIdentifier",e.defaultValues("subjectKeyIdentifier")),"date"in r&&(this.date=t(r,"date",e.defaultValues("date"))),"other"in r&&(this.other=t(r,"other",e.defaultValues("other"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{subjectKeyIdentifier:"subjectKeyIdentifier",date:"date",other:{names:{blockName:"other"}}}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for RecipientKeyIdentifier");this.subjectKeyIdentifier=r.result.subjectKeyIdentifier,"date"in r.result&&(this.date=r.result.date),"other"in r.result&&(this.other=new zt({schema:r.result.other}))}},{key:"toSchema",value:function(){var e=[];return e.push(this.subjectKeyIdentifier),"date"in this&&e.push(this.date),"other"in this&&e.push(this.other.toSchema()),new ee({value:e})}},{key:"toJSON",value:function(){var e={subjectKeyIdentifier:this.subjectKeyIdentifier.toJSON()};return"date"in this&&(e.date=this.date),"other"in this&&(e.other=this.other.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case"subjectKeyIdentifier":return new ne;case"date":return new Oe;case"other":return new zt;default:throw new Error("Invalid member name for RecipientKeyIdentifier class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"subjectKeyIdentifier":return r.isEqual(e.defaultValues("subjectKeyIdentifier"));case"date":return 0===r.year&&0===r.month&&0===r.day&&0===r.hour&&0===r.minute&&0===r.second&&0===r.millisecond;case"other":return""===r.keyAttrId&&"keyAttr"in r==!1;default:throw new Error("Invalid member name for RecipientKeyIdentifier class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new ne({name:e.subjectKeyIdentifier||""}),new Oe({optional:!0,name:e.date||""}),zt.schema(e.other||{})]})}}]),e}(),$t=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.variant=t(r,"variant",e.defaultValues("variant")),this.value=t(r,"value",e.defaultValues("value")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{blockName:"blockName"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for KeyAgreeRecipientIdentifier");1===r.result.blockName.idBlock.tagClass?(this.variant=1,this.value=new Wt({schema:r.result.blockName})):(this.variant=2,r.result.blockName.idBlock.tagClass=1,r.result.blockName.idBlock.tagNumber=16,this.value=new Zt({schema:r.result.blockName}))}},{key:"toSchema",value:function(){switch(this.variant){case 1:return this.value.toSchema();case 2:return new z({idBlock:{tagClass:3,tagNumber:0},value:this.value.toSchema().valueBlock.value});default:return new He}}},{key:"toJSON",value:function(){var e={variant:this.variant};return 1!==this.variant&&2!==this.variant||(e.value=this.value.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case"variant":return-1;case"value":return{};default:throw new Error("Invalid member name for KeyAgreeRecipientIdentifier class: "+e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"variant":return-1===t;case"value":return 0===Object.keys(t).length;default:throw new Error("Invalid member name for KeyAgreeRecipientIdentifier class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Ke({value:[Wt.schema(e.issuerAndSerialNumber||{names:{blockName:e.blockName||""}}),new z({name:e.blockName||"",idBlock:{tagClass:3,tagNumber:0},value:Zt.schema(e.rKeyId||{names:{blockName:e.blockName||""}}).valueBlock.value})]})}}]),e}(),Xt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.rid=t(r,"rid",e.defaultValues("rid")),this.encryptedKey=t(r,"encryptedKey",e.defaultValues("encryptedKey")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{rid:{names:{blockName:"rid"}},encryptedKey:"encryptedKey"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for RecipientEncryptedKey");this.rid=new $t({schema:r.result.rid}),this.encryptedKey=r.result.encryptedKey}},{key:"toSchema",value:function(){return new ee({value:[this.rid.toSchema(),this.encryptedKey]})}},{key:"toJSON",value:function(){return{rid:this.rid.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case"rid":return new $t;case"encryptedKey":return new ne;default:throw new Error("Invalid member name for RecipientEncryptedKey class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"rid":return-1===r.variant&&"value"in r==!1;case"encryptedKey":return r.isEqual(e.defaultValues("encryptedKey"));default:throw new Error("Invalid member name for RecipientEncryptedKey class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[$t.schema(e.rid||{}),new ne({name:e.encryptedKey||""})]})}}]),e}(),Yt=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.encryptedKeys=t(r,"encryptedKeys",e.defaultValues("encryptedKeys")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{RecipientEncryptedKeys:"RecipientEncryptedKeys"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for RecipientEncryptedKeys");this.encryptedKeys=Array.from(r.result.RecipientEncryptedKeys,function(e){return new Xt({schema:e})})}},{key:"toSchema",value:function(){return new ee({value:Array.from(this.encryptedKeys,function(e){return e.toSchema()})})}},{key:"toJSON",value:function(){return{encryptedKeys:Array.from(this.encryptedKeys,function(e){return e.toJSON()})}}}],[{key:"defaultValues",value:function(e){switch(e){case"encryptedKeys":return[];default:throw new Error("Invalid member name for RecipientEncryptedKeys class: "+e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"encryptedKeys":return 0===t.length;default:throw new Error("Invalid member name for RecipientEncryptedKeys class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new Ue({name:e.RecipientEncryptedKeys||"",value:Xt.schema()})]})}}]),e}(),er=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.version=t(r,"version",e.defaultValues("version")),this.originator=t(r,"originator",e.defaultValues("originator")),"ukm"in r&&(this.ukm=t(r,"ukm",e.defaultValues("ukm"))),this.keyEncryptionAlgorithm=t(r,"keyEncryptionAlgorithm",e.defaultValues("keyEncryptionAlgorithm")),this.recipientEncryptedKeys=t(r,"recipientEncryptedKeys",e.defaultValues("recipientEncryptedKeys")),this.recipientCertificate=t(r,"recipientCertificate",e.defaultValues("recipientCertificate")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{version:"version",originator:{names:{blockName:"originator"}},ukm:"ukm",keyEncryptionAlgorithm:{names:{blockName:"keyEncryptionAlgorithm"}},recipientEncryptedKeys:{names:{blockName:"recipientEncryptedKeys"}}}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for KeyAgreeRecipientInfo");this.version=r.result.version.valueBlock.valueDec,this.originator=new Qt({schema:r.result.originator}),"ukm"in r.result&&(this.ukm=r.result.ukm),this.keyEncryptionAlgorithm=new Te({schema:r.result.keyEncryptionAlgorithm}),this.recipientEncryptedKeys=new Yt({schema:r.result.recipientEncryptedKeys})}},{key:"toSchema",value:function(){var e=[];return e.push(new ue({value:this.version})),e.push(new z({idBlock:{tagClass:3,tagNumber:0},value:[this.originator.toSchema()]})),"ukm"in this&&e.push(new z({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[this.ukm]})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.recipientEncryptedKeys.toSchema()),new ee({value:e})}},{key:"toJSON",value:function(){var e={version:this.version,originator:this.originator.toJSON()};return"ukm"in this&&(e.ukm=this.ukm.toJSON()),e.keyEncryptionAlgorithm=this.keyEncryptionAlgorithm.toJSON(),e.recipientEncryptedKeys=this.recipientEncryptedKeys.toJSON(),e}}],[{key:"defaultValues",value:function(e){switch(e){case"version":return 0;case"originator":return new Qt;case"ukm":return new ne;case"keyEncryptionAlgorithm":return new Te;case"recipientEncryptedKeys":return new Yt;case"recipientCertificate":return new Vt;default:throw new Error("Invalid member name for KeyAgreeRecipientInfo class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"version":return 0===r;case"originator":return-1===r.variant&&"value"in r==!1;case"ukm":return r.isEqual(e.defaultValues("ukm"));case"keyEncryptionAlgorithm":return""===r.algorithmId&&"algorithmParams"in r==!1;case"recipientEncryptedKeys":return 0===r.encryptedKeys.length;case"recipientCertificate":return!1;default:throw new Error("Invalid member name for KeyAgreeRecipientInfo class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new ue({name:e.version||""}),new z({idBlock:{tagClass:3,tagNumber:0},value:[Qt.schema(e.originator||{})]}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new ne({name:e.ukm||""})]}),Te.schema(e.keyEncryptionAlgorithm||{}),Yt.schema(e.recipientEncryptedKeys||{})]})}}]),e}(),tr=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.keyIdentifier=t(r,"keyIdentifier",e.defaultValues("keyIdentifier")),"date"in r&&(this.date=t(r,"date",e.defaultValues("date"))),"other"in r&&(this.other=t(r,"other",e.defaultValues("other"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{keyIdentifier:"keyIdentifier",date:"date",other:{names:{blockName:"other"}}}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for KEKIdentifier");this.keyIdentifier=r.result.keyIdentifier,"date"in r.result&&(this.date=r.result.date),"other"in r.result&&(this.other=new zt({schema:r.result.other}))}},{key:"toSchema",value:function(){var e=[];return e.push(this.keyIdentifier),"date"in this&&e.push(this.date),"other"in this&&e.push(this.other.toSchema()),new ee({value:e})}},{key:"toJSON",value:function(){var e={keyIdentifier:this.keyIdentifier.toJSON()};return"date"in this&&(e.date=this.date),"other"in this&&(e.other=this.other.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case"keyIdentifier":return new ne;case"date":return new Oe;case"other":return new zt;default:throw new Error("Invalid member name for KEKIdentifier class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"keyIdentifier":return r.isEqual(e.defaultValues("keyIdentifier"));case"date":return 0===r.year&&0===r.month&&0===r.day&&0===r.hour&&0===r.minute&&0===r.second&&0===r.millisecond;case"other":return r.compareWithDefault("keyAttrId",r.keyAttrId)&&"keyAttr"in r==!1;default:throw new Error("Invalid member name for KEKIdentifier class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new ne({name:e.keyIdentifier||""}),new Oe({optional:!0,name:e.date||""}),zt.schema(e.other||{})]})}}]),e}(),rr=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.version=t(r,"version",e.defaultValues("version")),this.kekid=t(r,"kekid",e.defaultValues("kekid")),this.keyEncryptionAlgorithm=t(r,"keyEncryptionAlgorithm",e.defaultValues("keyEncryptionAlgorithm")),this.encryptedKey=t(r,"encryptedKey",e.defaultValues("encryptedKey")),this.preDefinedKEK=t(r,"preDefinedKEK",e.defaultValues("preDefinedKEK")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{version:"version",kekid:{names:{blockName:"kekid"}},keyEncryptionAlgorithm:{names:{blockName:"keyEncryptionAlgorithm"}},encryptedKey:"encryptedKey"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for KEKRecipientInfo");this.version=r.result.version.valueBlock.valueDec,this.kekid=new tr({schema:r.result.kekid}),this.keyEncryptionAlgorithm=new Te({schema:r.result.keyEncryptionAlgorithm}),this.encryptedKey=r.result.encryptedKey}},{key:"toSchema",value:function(){return new ee({value:[new ue({value:this.version}),this.kekid.toSchema(),this.keyEncryptionAlgorithm.toSchema(),this.encryptedKey]})}},{key:"toJSON",value:function(){return{version:this.version,kekid:this.originator.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case"version":return 0;case"kekid":return new tr;case"keyEncryptionAlgorithm":return new Te;case"encryptedKey":return new ne;case"preDefinedKEK":return new ArrayBuffer(0);default:throw new Error("Invalid member name for KEKRecipientInfo class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"KEKRecipientInfo":return r===e.defaultValues("version");case"kekid":return r.compareWithDefault("keyIdentifier",r.keyIdentifier)&&"date"in r==!1&&"other"in r==!1;case"keyEncryptionAlgorithm":return""===r.algorithmId&&"algorithmParams"in r==!1;case"encryptedKey":return r.isEqual(e.defaultValues("encryptedKey"));case"preDefinedKEK":return 0===r.byteLength;default:throw new Error("Invalid member name for KEKRecipientInfo class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new ue({name:e.version||""}),tr.schema(e.kekid||{}),Te.schema(e.keyEncryptionAlgorithm||{}),new ne({name:e.encryptedKey||""})]})}}]),e}(),ar=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.version=t(r,"version",e.defaultValues("version")),"keyDerivationAlgorithm"in r&&(this.keyDerivationAlgorithm=t(r,"keyDerivationAlgorithm",e.defaultValues("keyDerivationAlgorithm"))),this.keyEncryptionAlgorithm=t(r,"keyEncryptionAlgorithm",e.defaultValues("keyEncryptionAlgorithm")),this.encryptedKey=t(r,"encryptedKey",e.defaultValues("encryptedKey")),this.password=t(r,"password",e.defaultValues("password")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{version:"version",keyDerivationAlgorithm:"keyDerivationAlgorithm",keyEncryptionAlgorithm:{names:{blockName:"keyEncryptionAlgorithm"}},encryptedKey:"encryptedKey"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PasswordRecipientinfo");this.version=r.result.version.valueBlock.valueDec,"keyDerivationAlgorithm"in r.result&&(r.result.keyDerivationAlgorithm.idBlock.tagClass=1,r.result.keyDerivationAlgorithm.idBlock.tagNumber=16,this.keyDerivationAlgorithm=new Te({schema:r.result.keyDerivationAlgorithm})),this.keyEncryptionAlgorithm=new Te({schema:r.result.keyEncryptionAlgorithm}),this.encryptedKey=r.result.encryptedKey}},{key:"toSchema",value:function(){var e=[];return e.push(new ue({value:this.version})),"keyDerivationAlgorithm"in this&&e.push(new z({idBlock:{tagClass:3,tagNumber:0},value:this.keyDerivationAlgorithm.toSchema().valueBlock.value})),e.push(this.keyEncryptionAlgorithm.toSchema()),e.push(this.encryptedKey),new ee({value:e})}},{key:"toJSON",value:function(){return{version:this.version,keyDerivationAlgorithm:this.keyDerivationAlgorithm.toJSON(),keyEncryptionAlgorithm:this.keyEncryptionAlgorithm.toJSON(),encryptedKey:this.encryptedKey.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case"version":return-1;case"keyDerivationAlgorithm":case"keyEncryptionAlgorithm":return new Te;case"encryptedKey":return new ne;case"password":return new ArrayBuffer(0);default:throw new Error("Invalid member name for PasswordRecipientinfo class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"version":return-1===r;case"keyDerivationAlgorithm":case"keyEncryptionAlgorithm":return""===r.algorithmId&&"algorithmParams"in r==!1;case"encryptedKey":return r.isEqual(e.defaultValues("encryptedKey"));case"password":return 0===r.byteLength;default:throw new Error("Invalid member name for PasswordRecipientinfo class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new ue({name:e.version||""}),new z({name:e.keyDerivationAlgorithm||"",optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Te.schema().valueBlock.value}),Te.schema(e.keyEncryptionAlgorithm||{}),new ne({name:e.encryptedKey||""})]})}}]),e}(),nr=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.oriType=t(r,"oriType",e.defaultValues("oriType")),this.oriValue=t(r,"oriValue",e.defaultValues("oriValue")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{oriType:"oriType",oriValue:"oriValue"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for OtherRecipientInfo");this.oriType=r.result.oriType.valueBlock.toString(),this.oriValue=r.result.oriValue}},{key:"toSchema",value:function(){return new ee({value:[new me({value:this.oriType}),this.oriValue]})}},{key:"toJSON",value:function(){var t={oriType:this.oriType};return!1===e.compareWithDefault("oriValue",this.oriValue)&&(t.oriValue=this.oriValue.toJSON()),t}}],[{key:"defaultValues",value:function(e){switch(e){case"oriType":return"";case"oriValue":return{};default:throw new Error("Invalid member name for OtherRecipientInfo class: "+e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"oriType":return""===t;case"oriValue":return 0===Object.keys(t).length;default:throw new Error("Invalid member name for OtherRecipientInfo class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new me({name:e.oriType||""}),new He({name:e.oriValue||""})]})}}]),e}(),ir=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.variant=t(r,"variant",e.defaultValues("variant")),"value"in r&&(this.value=t(r,"value",e.defaultValues("value"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{blockName:"blockName"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for CMS_RECIPIENT_INFO");if(1===r.result.blockName.idBlock.tagClass)this.variant=1,this.value=new Mt({schema:r.result.blockName});else{var a=r.result.blockName.idBlock.tagNumber;switch(r.result.blockName.idBlock.tagClass=1,r.result.blockName.idBlock.tagNumber=16,a){case 1:this.variant=2,this.value=new er({schema:r.result.blockName});break;case 2:this.variant=3,this.value=new rr({schema:r.result.blockName});break;case 3:this.variant=4,this.value=new ar({schema:r.result.blockName});break;case 4:this.variant=5,this.value=new nr({schema:r.result.blockName});break;default:throw new Error("Incorrect structure of RecipientInfo block")}}}},{key:"toSchema",value:function(){var e=this.value.toSchema();switch(this.variant){case 1:return e;case 2:case 3:case 4:return e.idBlock.tagClass=3,e.idBlock.tagNumber=this.variant-1,e;default:return new He}}},{key:"toJSON",value:function(){var e={variant:this.variant};return this.variant>=1&&this.variant<=4&&(e.value=this.value.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case"variant":return-1;case"value":return{};default:throw new Error("Invalid member name for RecipientInfo class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"variant":return r===e.defaultValues(t);case"value":return 0===Object.keys(r).length;default:throw new Error("Invalid member name for RecipientInfo class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new Ke({value:[Mt.schema({names:{blockName:e.blockName||""}}),new z({name:e.blockName||"",idBlock:{tagClass:3,tagNumber:1},value:er.schema().valueBlock.value}),new z({name:e.blockName||"",idBlock:{tagClass:3,tagNumber:2},value:rr.schema().valueBlock.value}),new z({name:e.blockName||"",idBlock:{tagClass:3,tagNumber:3},value:ar.schema().valueBlock.value}),new z({name:e.blockName||"",idBlock:{tagClass:3,tagNumber:4},value:nr.schema().valueBlock.value})]})}}]),e}(),sr=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.hashAlgorithm=t(r,"hashAlgorithm",e.defaultValues("hashAlgorithm")),this.maskGenAlgorithm=t(r,"maskGenAlgorithm",e.defaultValues("maskGenAlgorithm")),this.pSourceAlgorithm=t(r,"pSourceAlgorithm",e.defaultValues("pSourceAlgorithm")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{hashAlgorithm:{names:{blockName:"hashAlgorithm"}},maskGenAlgorithm:{names:{blockName:"maskGenAlgorithm"}},pSourceAlgorithm:{names:{blockName:"pSourceAlgorithm"}}}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for RSAESOAEPParams");"hashAlgorithm"in r.result&&(this.hashAlgorithm=new Te({schema:r.result.hashAlgorithm})),"maskGenAlgorithm"in r.result&&(this.maskGenAlgorithm=new Te({schema:r.result.maskGenAlgorithm})),"pSourceAlgorithm"in r.result&&(this.pSourceAlgorithm=new Te({schema:r.result.pSourceAlgorithm}))}},{key:"toSchema",value:function(){var t=[];return this.hashAlgorithm.isEqual(e.defaultValues("hashAlgorithm"))||t.push(new z({idBlock:{tagClass:3,tagNumber:0},value:[this.hashAlgorithm.toSchema()]})),this.maskGenAlgorithm.isEqual(e.defaultValues("maskGenAlgorithm"))||t.push(new z({idBlock:{tagClass:3,tagNumber:1},value:[this.maskGenAlgorithm.toSchema()]})),this.pSourceAlgorithm.isEqual(e.defaultValues("pSourceAlgorithm"))||t.push(new z({idBlock:{tagClass:3,tagNumber:2},value:[this.pSourceAlgorithm.toSchema()]})),new ee({value:t})}},{key:"toJSON",value:function(){var t={};return this.hashAlgorithm.isEqual(e.defaultValues("hashAlgorithm"))||(t.hashAlgorithm=this.hashAlgorithm.toJSON()),this.maskGenAlgorithm.isEqual(e.defaultValues("maskGenAlgorithm"))||(t.maskGenAlgorithm=this.maskGenAlgorithm.toJSON()),this.pSourceAlgorithm.isEqual(e.defaultValues("pSourceAlgorithm"))||(t.pSourceAlgorithm=this.pSourceAlgorithm.toJSON()),t}}],[{key:"defaultValues",value:function(e){switch(e){case"hashAlgorithm":return new Te({algorithmId:"1.3.14.3.2.26",algorithmParams:new re});case"maskGenAlgorithm":return new Te({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:new Te({algorithmId:"1.3.14.3.2.26",algorithmParams:new re}).toSchema()});case"pSourceAlgorithm":return new Te({algorithmId:"1.2.840.113549.1.1.9",algorithmParams:new ne({valueHex:new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer})});default:throw new Error("Invalid member name for RSAESOAEPParams class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new z({idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[Te.schema(e.hashAlgorithm||{})]}),new z({idBlock:{tagClass:3,tagNumber:1},optional:!0,value:[Te.schema(e.maskGenAlgorithm||{})]}),new z({idBlock:{tagClass:3,tagNumber:2},optional:!0,value:[Te.schema(e.pSourceAlgorithm||{})]})]})}}]),e}(),or=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.keyInfo=t(r,"keyInfo",e.defaultValues("keyInfo")),"entityUInfo"in r&&(this.entityUInfo=t(r,"entityUInfo",e.defaultValues("entityUInfo"))),this.suppPubInfo=t(r,"suppPubInfo",e.defaultValues("suppPubInfo")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{keyInfo:{names:{blockName:"keyInfo"}},entityUInfo:"entityUInfo",suppPubInfo:"suppPubInfo"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for ECC_CMS_SharedInfo");this.keyInfo=new Te({schema:r.result.keyInfo}),"entityUInfo"in r.result&&(this.entityUInfo=r.result.entityUInfo.valueBlock.value[0]),this.suppPubInfo=r.result.suppPubInfo.valueBlock.value[0]}},{key:"toSchema",value:function(){var e=[];return e.push(this.keyInfo.toSchema()),"entityUInfo"in this&&e.push(new z({idBlock:{tagClass:3,tagNumber:0},value:[this.entityUInfo]})),e.push(new z({idBlock:{tagClass:3,tagNumber:2},value:[this.suppPubInfo]})),new ee({value:e})}},{key:"toJSON",value:function(){var e={keyInfo:this.keyInfo.toJSON()};return"entityUInfo"in this&&(e.entityUInfo=this.entityUInfo.toJSON()),e.suppPubInfo=this.suppPubInfo.toJSON(),e}}],[{key:"defaultValues",value:function(e){switch(e){case"keyInfo":return new Te;case"entityUInfo":case"suppPubInfo":return new ne;default:throw new Error("Invalid member name for ECCCMSSharedInfo class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"keyInfo":case"entityUInfo":case"suppPubInfo":return r.isEqual(e.defaultValues(t));default:throw new Error("Invalid member name for ECCCMSSharedInfo class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[Te.schema(e.keyInfo||{}),new z({name:e.entityUInfo||"",idBlock:{tagClass:3,tagNumber:0},optional:!0,value:[new ne]}),new z({name:e.suppPubInfo||"",idBlock:{tagClass:3,tagNumber:2},value:[new ne]})]})}}]),e}(),ur=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.version=t(r,"version",e.defaultValues("version")),"originatorInfo"in r&&(this.originatorInfo=t(r,"originatorInfo",e.defaultValues("originatorInfo"))),this.recipientInfos=t(r,"recipientInfos",e.defaultValues("recipientInfos")),this.encryptedContentInfo=t(r,"encryptedContentInfo",e.defaultValues("encryptedContentInfo")),"unprotectedAttrs"in r&&(this.unprotectedAttrs=t(r,"unprotectedAttrs",e.defaultValues("unprotectedAttrs"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{version:"version",originatorInfo:"originatorInfo",recipientInfos:"recipientInfos",encryptedContentInfo:{names:{blockName:"encryptedContentInfo"}},unprotectedAttrs:"unprotectedAttrs"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for CMS_ENVELOPED_DATA");this.version=r.result.version.valueBlock.valueDec,"originatorInfo"in r.result&&(r.result.originatorInfo.idBlock.tagClass=1,r.result.originatorInfo.idBlock.tagNumber=16,this.originatorInfo=new qt({schema:r.result.originatorInfo})),this.recipientInfos=Array.from(r.result.recipientInfos,function(e){return new ir({schema:e})}),this.encryptedContentInfo=new st({schema:r.result.encryptedContentInfo}),"unprotectedAttrs"in r.result&&(this.unprotectedAttrs=Array.from(r.result.unprotectedAttrs,function(e){return new Me({schema:e})}))}},{key:"toSchema",value:function(){var e=[];return e.push(new ue({value:this.version})),"originatorInfo"in this&&e.push(new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:this.originatorInfo.toSchema().valueBlock.value})),e.push(new te({value:Array.from(this.recipientInfos,function(e){return e.toSchema()})})),e.push(this.encryptedContentInfo.toSchema()),"unprotectedAttrs"in this&&e.push(new z({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.unprotectedAttrs,function(e){return e.toSchema()})})),new ee({value:e})}},{key:"toJSON",value:function(){var e={version:this.version};return"originatorInfo"in this&&(e.originatorInfo=this.originatorInfo.toJSON()),e.recipientInfos=Array.from(this.recipientInfos,function(e){return e.toJSON()}),e.encryptedContentInfo=this.encryptedContentInfo.toJSON(),"unprotectedAttrs"in this&&(e.unprotectedAttrs=Array.from(this.unprotectedAttrs,function(e){return e.toJSON()})),e}},{key:"addRecipientByCertificate",value:function(e,t,r){var a=t||{};if(-1!==e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.113549"))r=1;else{if(-1===e.subjectPublicKeyInfo.algorithm.algorithmId.indexOf("1.2.840.10045"))throw new Error("Unknown type of certificate's public key: "+e.subjectPublicKeyInfo.algorithm.algorithmId);r=2}switch("oaepHashAlgorithm"in a==!1&&(a.oaepHashAlgorithm="SHA-512"),"kdfAlgorithm"in a==!1&&(a.kdfAlgorithm="SHA-512"),"kekEncryptionLength"in a==!1&&(a.kekEncryptionLength=256),r){case 1:var n=C({name:"RSA-OAEP"});if(""===n)throw new Error("Can not find OID for OAEP");var i=C({name:a.oaepHashAlgorithm});if(""===i)throw new Error("Unknown OAEP hash algorithm: "+a.oaepHashAlgorithm);var s=new Te({algorithmId:i,algorithmParams:new re}),o=new sr({hashAlgorithm:s,maskGenAlgorithm:new Te({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:s.toSchema()})}),u=new Mt({version:0,rid:new Wt({issuer:e.issuer,serialNumber:e.serialNumber}),keyEncryptionAlgorithm:new Te({algorithmId:n,algorithmParams:o.toSchema()}),recipientCertificate:e});this.recipientInfos.push(new ir({variant:1,value:u}));break;case 2:var l=new Xt({rid:new $t({variant:1,value:new Wt({issuer:e.issuer,serialNumber:e.serialNumber})})}),c=C({name:"AES-KW",length:a.kekEncryptionLength});if(""===c)throw new Error("Unknown length for key encryption algorithm: "+a.kekEncryptionLength);var h=new Te({algorithmId:c,algorithmParams:new re}),m=C({name:"ECDH",kdf:a.kdfAlgorithm});if(""===m)throw new Error("Unknown KDF algorithm: "+a.kdfAlgorithm);var f=new ArrayBuffer(64);w(new Uint8Array(f));var v=new er({version:3,ukm:new ne({valueHex:f}),keyEncryptionAlgorithm:new Te({algorithmId:m,algorithmParams:h.toSchema()}),recipientEncryptedKeys:new Yt({encryptedKeys:[l]}),recipientCertificate:e});this.recipientInfos.push(new ir({variant:2,value:v}));break;default:throw new Error('Unknown "variant" value: '+r)}return!0}},{key:"addRecipientByPreDefinedData",value:function(e,t,r){var a=t||{};if(e instanceof ArrayBuffer==!1)throw new Error('Please pass "preDefinedData" in ArrayBuffer type');if(0===e.byteLength)throw new Error("Pre-defined data could have zero length");if("keyIdentifier"in a==!1){var n=new ArrayBuffer(16);w(new Uint8Array(n)),a.keyIdentifier=n}switch("hmacHashAlgorithm"in a==!1&&(a.hmacHashAlgorithm="SHA-512"),"iterationCount"in a==!1&&(a.iterationCount=2048),"keyEncryptionAlgorithm"in a==!1&&(a.keyEncryptionAlgorithm={name:"AES-KW",length:256}),"keyEncryptionAlgorithmParams"in a==!1&&(a.keyEncryptionAlgorithmParams=new re),r){case 1:var i=C(a.keyEncryptionAlgorithm);if(""===i)throw new Error('Incorrect value for "keyEncryptionAlgorithm"');var s=new rr({version:4,kekid:new tr({keyIdentifier:new ne({valueHex:a.keyIdentifier})}),keyEncryptionAlgorithm:new Te({algorithmId:i,algorithmParams:a.keyEncryptionAlgorithmParams}),preDefinedKEK:e});this.recipientInfos.push(new ir({variant:3,value:s}));break;case 2:var o=C({name:"PBKDF2"});if(""===o)throw new Error("Can not find OID for PBKDF2");var u=new ArrayBuffer(64);w(new Uint8Array(u));var l=C({name:"HMAC",hash:{name:a.hmacHashAlgorithm}});if(""===l)throw new Error('Incorrect value for "hmacHashAlgorithm": '+a.hmacHashAlgorithm);var c=new ot({salt:new ne({valueHex:u}),iterationCount:a.iterationCount,prf:new Te({algorithmId:l,algorithmParams:new re})}),h=C(a.keyEncryptionAlgorithm);if(""===h)throw new Error('Incorrect value for "keyEncryptionAlgorithm"');var m=new ar({version:0,keyDerivationAlgorithm:new Te({algorithmId:o,algorithmParams:c.toSchema()}),keyEncryptionAlgorithm:new Te({algorithmId:h,algorithmParams:a.keyEncryptionAlgorithmParams}),password:e});this.recipientInfos.push(new ir({variant:4,value:m}));break;default:throw new Error('Unknown value for "variant": '+r)}}},{key:"encrypt",value:function(e,t){function r(e){var t=Promise.resolve(),r=void 0,a=void 0,n=void 0,i=void 0,s=void 0;return t=t.then(function(){var t=d.recipientInfos[e].value.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(t instanceof me==!1)return Promise.reject('Incorrect "recipientCertificate" for index '+e);switch(t.valueBlock.toString()){case"1.2.840.10045.3.1.7":n="P-256",i=256;break;case"1.3.132.0.34":n="P-384",i=384;break;case"1.3.132.0.35":n="P-521",i=528;break;default:return Promise.reject("Incorrect curve OID for index "+e)}return n},function(e){return Promise.reject(e)}),t=t.then(function(e){return p.generateKey({name:"ECDH",namedCurve:e},!0,["deriveBits"])},function(e){return Promise.reject(e)}),t=t.then(function(e){return r=e.publicKey,a=e.privateKey,p.exportKey("spki",r)},function(e){return Promise.reject(e)}),t=t.then(function(t){return s=t,d.recipientInfos[e].value.recipientCertificate.getPublicKey({algorithm:{algorithm:{name:"ECDH",namedCurve:n},usages:[]}})},function(e){return Promise.reject(e)}),t=t.then(function(e){return p.deriveBits({name:"ECDH",public:e},a,i)},function(e){return Promise.reject(e)}),t=t.then(function(t){var r=new Te({schema:d.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmParams}),a=N(r.algorithmId);if("name"in a==!1)return Promise.reject("Incorrect OID for key encryption algorithm: "+r.algorithmId);for(var n=a.length,i=new ArrayBuffer(4),s=new Uint8Array(i),o=3;o>=0;o--)s[o]=n,n>>=8;var u=new or({keyInfo:new Te({algorithmId:r.algorithmId,algorithmParams:new re}),entityUInfo:d.recipientInfos[e].value.ukm,suppPubInfo:new ne({valueHex:i})}).toSchema().toBER(!1),l=N(d.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmId);return"name"in l==!1?Promise.reject("Incorrect OID for key encryption algorithm: "+d.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmId):x(l.kdf,t,a.length,u)},function(e){return Promise.reject(e)}),t=t.then(function(e){return p.importKey("raw",e,{name:"AES-KW"},!0,["wrapKey"])},function(e){return Promise.reject(e)}),t=t.then(function(e){return p.wrapKey("raw",h,e,{name:"AES-KW"})},function(e){return Promise.reject(e)}),t=t.then(function(t){var r=g(s),a=new Qt;a.variant=3,a.value=new Gt({schema:r.result}),"algorithmParams"in a.value.algorithm&&delete a.value.algorithm.algorithmParams,d.recipientInfos[e].value.originator=a,d.recipientInfos[e].value.recipientEncryptedKeys.encryptedKeys[0].encryptedKey=new ne({valueHex:t})},function(e){return Promise.reject(e)})}function a(e){var t=Promise.resolve();return t=t.then(function(){var t=d.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmParams,r=new sr({schema:t}),a=N(r.hashAlgorithm.algorithmId);return"name"in a==!1?Promise.reject("Incorrect OID for hash algorithm: "+r.hashAlgorithm.algorithmId):d.recipientInfos[e].value.recipientCertificate.getPublicKey({algorithm:{algorithm:{name:"RSA-OAEP",hash:{name:a.name}},usages:["encrypt","wrapKey"]}})},function(e){return Promise.reject(e)}),t=t.then(function(e){return p.encrypt(e.algorithm,e,f)},function(e){return Promise.reject(e)}),t=t.then(function(t){d.recipientInfos[e].value.encryptedKey=new ne({valueHex:t})},function(e){return Promise.reject(e)})}function n(e){var t=Promise.resolve(),r=void 0;return t=t.then(function(){return r=N(d.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmId),"name"in r==!1?Promise.reject('Incorrect OID for "keyEncryptionAlgorithm": '+d.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmId):p.importKey("raw",new Uint8Array(d.recipientInfos[e].value.preDefinedKEK),r,!0,["wrapKey"])},function(e){return Promise.reject(e)}),t=t.then(function(e){return p.wrapKey("raw",h,e,r)},function(e){return Promise.reject(e)}),t=t.then(function(t){d.recipientInfos[e].value.encryptedKey=new ne({valueHex:t})},function(e){return Promise.reject(e)})}function i(e){var t=Promise.resolve(),r=void 0,a=void 0;return t=t.then(function(){if("keyDerivationAlgorithm"in d.recipientInfos[e].value==!1)return Promise.reject('Please append encoded "keyDerivationAlgorithm"');if("algorithmParams"in d.recipientInfos[e].value.keyDerivationAlgorithm==!1)return Promise.reject('Incorrectly encoded "keyDerivationAlgorithm"');try{r=new ot({schema:d.recipientInfos[e].value.keyDerivationAlgorithm.algorithmParams})}catch(e){return Promise.reject('Incorrectly encoded "keyDerivationAlgorithm"')}return Promise.resolve()},function(e){return Promise.reject(e)}),t=t.then(function(){var t=new Uint8Array(d.recipientInfos[e].value.password);return p.importKey("raw",t,"PBKDF2",!1,["deriveKey"])},function(e){return Promise.reject(e)}),t=t.then(function(t){if("name"in(a=N(d.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmId))==!1)return Promise.reject('Incorrect OID for "keyEncryptionAlgorithm": '+d.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmId);var n="SHA-1";if("prf"in r){var i=N(r.prf.algorithmId);if("name"in i==!1)return Promise.reject("Incorrect OID for HMAC hash algorithm");n=i.hash.name}var s=new Uint8Array(r.salt.valueBlock.valueHex),o=r.iterationCount;return p.deriveKey({name:"PBKDF2",hash:{name:n},salt:s,iterations:o},t,a,!0,["wrapKey"])},function(e){return Promise.reject(e)}),t=t.then(function(e){return p.wrapKey("raw",h,e,a)},function(e){return Promise.reject(e)}),t=t.then(function(t){d.recipientInfos[e].value.encryptedKey=new ne({valueHex:t})},function(e){return Promise.reject(e)})}var s=this,o=Promise.resolve(),u=new ArrayBuffer(16),l=new Uint8Array(u);w(l);var c=new Uint8Array(t),h=void 0,m=void 0,f=void 0,v=[],d=this,y=C(e);if(""===y)return Promise.reject('Wrong "contentEncryptionAlgorithm" value');var p=b();return void 0===p?Promise.reject("Unable to create WebCrypto object"):(o=o.then(function(){return p.generateKey(e,!0,["encrypt"])}),o=o.then(function(t){return h=t,p.encrypt({name:e.name,iv:l},h,c)},function(e){return Promise.reject(e)}),o=o.then(function(e){return m=e,p.exportKey("raw",h)},function(e){return Promise.reject(e)}).then(function(e){return f=e,!0},function(e){return Promise.reject(e)}),o=o.then(function(){s.version=2,s.encryptedContentInfo=new st({contentType:"1.2.840.113549.1.7.1",contentEncryptionAlgorithm:new Te({algorithmId:y,algorithmParams:new ne({valueHex:u})}),encryptedContent:new ne({valueHex:m})})},function(e){return Promise.reject(e)}),o=o.then(function(){for(var e=0;e<s.recipientInfos.length;e++){var t=Promise.resolve();switch(s.recipientInfos[e].variant){case 1:t=a(e);break;case 2:t=r(e);break;case 3:t=n(e);break;case 4:t=i(e);break;default:return Promise.reject("Uknown recipient type in array with index "+e)}v.push(t)}return Promise.all(v)},function(e){return Promise.reject(e)}))}},{key:"decrypt",value:function(e,t){function r(e){var t=Promise.resolve(),r=void 0,a=void 0,n=void 0,i=void 0;return t=t.then(function(){if("recipientCertificate"in l==!1)return Promise.reject('Parameter "recipientCertificate" is mandatory for "KeyAgreeRecipientInfo"');if("recipientPrivateKey"in l==!1)return Promise.reject('Parameter "recipientPrivateKey" is mandatory for "KeyAgreeRecipientInfo"');var t=l.recipientCertificate.subjectPublicKeyInfo.algorithm.algorithmParams;if(t instanceof me==!1)return Promise.reject('Incorrect "recipientCertificate" for index '+e);switch(n=t.valueBlock.toString()){case"1.2.840.10045.3.1.7":r="P-256",a=256;break;case"1.3.132.0.34":r="P-384",a=384;break;case"1.3.132.0.35":r="P-521",a=528;break;default:return Promise.reject("Incorrect curve OID for index "+e)}return h.importKey("pkcs8",l.recipientPrivateKey,{name:"ECDH",namedCurve:r},!0,["deriveBits"])},function(e){return Promise.reject(e)}),t=t.then(function(t){i=t,"algorithmParams"in c.recipientInfos[e].value.originator.value.algorithm==!1&&(c.recipientInfos[e].value.originator.value.algorithm.algorithmParams=new me({value:n}));var a=c.recipientInfos[e].value.originator.value.toSchema().toBER(!1);return h.importKey("spki",a,{name:"ECDH",namedCurve:r},!0,[])},function(e){return Promise.reject(e)}),t=t.then(function(e){return h.deriveBits({name:"ECDH",public:e},i,a)},function(e){return Promise.reject(e)}),t=t.then(function(t){var r=new Te({schema:c.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmParams}),a=N(r.algorithmId);if("name"in a==!1)return Promise.reject("Incorrect OID for key encryption algorithm: "+r.algorithmId);for(var n=a.length,i=new ArrayBuffer(4),s=new Uint8Array(i),o=3;o>=0;o--)s[o]=n,n>>=8;var u=new or({keyInfo:new Te({algorithmId:r.algorithmId,algorithmParams:new re}),entityUInfo:c.recipientInfos[e].value.ukm,suppPubInfo:new ne({valueHex:i})}).toSchema().toBER(!1),l=N(c.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmId);return"name"in l==!1?Promise.reject("Incorrect OID for key encryption algorithm: "+c.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmId):x(l.kdf,t,a.length,u)},function(e){return Promise.reject(e)}),t=t.then(function(e){return h.importKey("raw",e,{name:"AES-KW"},!0,["unwrapKey"])},function(e){return Promise.reject(e)}),t=t.then(function(t){var r=N(c.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId);return"name"in r==!1?Promise.reject('Incorrect "contentEncryptionAlgorithm": '+c.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId):h.unwrapKey("raw",c.recipientInfos[e].value.recipientEncryptedKeys.encryptedKeys[0].encryptedKey.valueBlock.valueHex,t,{name:"AES-KW"},r,!0,["decrypt"])},function(e){return Promise.reject(e)})}function a(e){var t=Promise.resolve();return t=t.then(function(){if("recipientPrivateKey"in l==!1)return Promise.reject('Parameter "recipientPrivateKey" is mandatory for "KeyTransRecipientInfo"');var t=c.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmParams,r=new sr({schema:t}),a=N(r.hashAlgorithm.algorithmId);return"name"in a==!1?Promise.reject("Incorrect OID for hash algorithm: "+r.hashAlgorithm.algorithmId):h.importKey("pkcs8",l.recipientPrivateKey,{name:"RSA-OAEP",hash:{name:a.name}},!0,["decrypt"])},function(e){return Promise.reject(e)}),t=t.then(function(t){return h.decrypt(t.algorithm,t,c.recipientInfos[e].value.encryptedKey.valueBlock.valueHex)},function(e){return Promise.reject(e)}),t=t.then(function(e){var t=N(c.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId);return"name"in t==!1?Promise.reject('Incorrect "contentEncryptionAlgorithm": '+c.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId):h.importKey("raw",e,t,!0,["decrypt"])},function(e){return Promise.reject(e)})}function n(e){var t=Promise.resolve(),r=void 0;return t=t.then(function(){return"preDefinedData"in l==!1?Promise.reject('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"'):(r=N(c.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmId),"name"in r==!1?Promise.reject('Incorrect OID for "keyEncryptionAlgorithm": '+c.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmId):h.importKey("raw",l.preDefinedData,r,!0,["unwrapKey"]))},function(e){return Promise.reject(e)}),t=t.then(function(t){var a=N(c.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId);return"name"in a==!1?Promise.reject('Incorrect "contentEncryptionAlgorithm": '+c.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId):h.unwrapKey("raw",c.recipientInfos[e].value.encryptedKey.valueBlock.valueHex,t,r,a,!0,["decrypt"])},function(e){return Promise.reject(e)})}function i(e){var t=Promise.resolve(),r=void 0,a=void 0;return t=t.then(function(){if("preDefinedData"in l==!1)return Promise.reject('Parameter "preDefinedData" is mandatory for "KEKRecipientInfo"');if("keyDerivationAlgorithm"in c.recipientInfos[e].value==!1)return Promise.reject('Please append encoded "keyDerivationAlgorithm"');if("algorithmParams"in c.recipientInfos[e].value.keyDerivationAlgorithm==!1)return Promise.reject('Incorrectly encoded "keyDerivationAlgorithm"');try{r=new ot({schema:c.recipientInfos[e].value.keyDerivationAlgorithm.algorithmParams})}catch(e){return Promise.reject('Incorrectly encoded "keyDerivationAlgorithm"')}return h.importKey("raw",l.preDefinedData,"PBKDF2",!1,["deriveKey"])},function(e){return Promise.reject(e)}),t=t.then(function(t){if("name"in(a=N(c.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmId))==!1)return Promise.reject('Incorrect OID for "keyEncryptionAlgorithm": '+c.recipientInfos[e].value.keyEncryptionAlgorithm.algorithmId);var n="SHA-1";if("prf"in r){var i=N(r.prf.algorithmId);if("name"in i==!1)return Promise.reject("Incorrect OID for HMAC hash algorithm");n=i.hash.name}var s=new Uint8Array(r.salt.valueBlock.valueHex),o=r.iterationCount;return h.deriveKey({name:"PBKDF2",hash:{name:n},salt:s,iterations:o},t,a,!0,["unwrapKey"])},function(e){return Promise.reject(e)}),t=t.then(function(t){var r=N(c.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId);return"name"in r==!1?Promise.reject('Incorrect "contentEncryptionAlgorithm": '+c.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId):h.unwrapKey("raw",c.recipientInfos[e].value.encryptedKey.valueBlock.valueHex,t,a,r,!0,["decrypt"])},function(e){return Promise.reject(e)})}var o=this,u=Promise.resolve(),l=t||{},c=this;if(e+1>this.recipientInfos.length)return Promise.reject('Maximum value for "index" is: '+(this.recipientInfos.length-1));var h=b();return void 0===h?Promise.reject("Unable to create WebCrypto object"):(u=u.then(function(){var t=Promise.resolve();switch(o.recipientInfos[e].variant){case 1:t=a(e);break;case 2:t=r(e);break;case 3:t=n(e);break;case 4:t=i(e);break;default:return Promise.reject("Uknown recipient type in array with index "+e)}return t},function(e){return Promise.reject(e)}),u=u.then(function(e){var t=N(o.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId);if("name"in t==!1)return Promise.reject('Incorrect "contentEncryptionAlgorithm": '+o.encryptedContentInfo.contentEncryptionAlgorithm.algorithmId);var r=o.encryptedContentInfo.contentEncryptionAlgorithm.algorithmParams.valueBlock.valueHex,a=new Uint8Array(r),n=new ArrayBuffer(0);if(!1===o.encryptedContentInfo.encryptedContent.idBlock.isConstructed)n=o.encryptedContentInfo.encryptedContent.valueBlock.valueHex;else{var i=!0,u=!1,l=void 0;try{for(var c,m=o.encryptedContentInfo.encryptedContent.valueBlock.value[Symbol.iterator]();!(i=(c=m.next()).done);i=!0)n=s(n,c.value.valueBlock.valueHex)}catch(e){u=!0,l=e}finally{try{!i&&m.return&&m.return()}finally{if(u)throw l}}}return h.decrypt({name:t.name,iv:a},e,n)},function(e){return Promise.reject(e)}))}}],[{key:"defaultValues",value:function(e){switch(e){case"version":return 0;case"originatorInfo":return new qt;case"recipientInfos":return[];case"encryptedContentInfo":return new st;case"unprotectedAttrs":return[];default:throw new Error("Invalid member name for EnvelopedData class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"version":return r===e.defaultValues(t);case"originatorInfo":return 0===r.certs.certificates.length&&0===r.crls.crls.length;case"recipientInfos":case"unprotectedAttrs":return 0===r.length;case"encryptedContentInfo":return st.compareWithDefault("contentType",r.contentType)&&st.compareWithDefault("contentEncryptionAlgorithm",r.contentEncryptionAlgorithm)&&st.compareWithDefault("encryptedContent",r.encryptedContent);default:throw new Error("Invalid member name for EnvelopedData class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new ue({name:e.version||""}),new z({name:e.originatorInfo||"",optional:!0,idBlock:{tagClass:3,tagNumber:0},value:qt.schema().valueBlock.value}),new te({value:[new Ue({name:e.recipientInfos||"",value:ir.schema()})]}),st.schema(e.encryptedContentInfo||{}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Ue({name:e.unprotectedAttrs||"",value:Me.schema()})]})]})}}]),e}(),lr=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.safeContents=t(r,"safeContents",e.defaultValues("safeContents")),"parsedValue"in r&&(this.parsedValue=t(r,"parsedValue",e.defaultValues("parsedValue"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{contentInfos:"contentInfos"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for AuthenticatedSafe");this.safeContents=Array.from(r.result.contentInfos,function(e){return new it({schema:e})})}},{key:"toSchema",value:function(){return new ee({value:Array.from(this.safeContents,function(e){return e.toSchema()})})}},{key:"toJSON",value:function(){return{safeContents:Array.from(this.safeContents,function(e){return e.toJSON()})}}},{key:"parseInternalValues",value:function(e){var t=this;if(e instanceof Object==!1)return Promise.reject('The "parameters" must has "Object" type');if("safeContents"in e==!1)return Promise.reject('Absent mandatory parameter "safeContents"');if(e.safeContents instanceof Array==!1)return Promise.reject('The "parameters.safeContents" must has "Array" type');if(e.safeContents.length!==this.safeContents.length)return Promise.reject('Length of "parameters.safeContents" must be equal to "this.safeContents.length"');var r=Promise.resolve();this.parsedValue={safeContents:[]};var a=!0,n=!1,i=void 0;try{for(var s,o=this.safeContents.entries()[Symbol.iterator]();!(a=(s=o.next()).done);a=!0){var u=_slicedToArray(s.value,2),l=u[0],c=u[1];switch(c.contentType){case"1.2.840.113549.1.7.1":if(c.content instanceof ne==!1)return Promise.reject('Wrong type of "this.safeContents[j].content"');var h=g(c.content.valueBlock.valueHex);if(-1===h.offset)return Promise.reject('Error during parsing of ASN.1 data inside "content.content"');this.parsedValue.safeContents.push({privacyMode:0,value:new Ut({schema:h.result})});break;case"1.2.840.113549.1.7.3":var m=function(){var a=new ur({schema:c.content});if("recipientCertificate"in e.safeContents[l]==!1)return{v:Promise.reject('Absent mandatory parameter "recipientCertificate" in "parameters.safeContents[j]"')};var n=e.safeContents[l].recipientCertificate;if("recipientKey"in e.safeContents[l]==!1)return{v:Promise.reject('Absent mandatory parameter "recipientKey" in "parameters.safeContents[j]"')};var i=e.safeContents[l].recipientKey;r=r.then(function(){return a.decrypt(0,{recipientCertificate:n,recipientPrivateKey:i})}),r=r.then(function(e){var r=g(e);return-1===r.offset?Promise.reject("Error during parsing of decrypted data"):(t.parsedValue.safeContents.push({privacyMode:2,value:new Ut({schema:r.result})}),Promise.resolve())})}();if("object"===(void 0===m?"undefined":_typeof(m)))return m.v;break;case"1.2.840.113549.1.7.6":var f=function(){var a=new lt({schema:c.content});if("password"in e.safeContents[l]==!1)return{v:Promise.reject('Absent mandatory parameter "password" in "parameters.safeContents[j]"')};var n=e.safeContents[l].password;r=r.then(function(){return a.decrypt({password:n})},function(e){return Promise.reject(e)}),r=r.then(function(e){var r=g(e);return-1===r.offset?Promise.reject("Error during parsing of decrypted data"):(t.parsedValue.safeContents.push({privacyMode:1,value:new Ut({schema:r.result})}),Promise.resolve())},function(e){return Promise.reject(e)})}();if("object"===(void 0===f?"undefined":_typeof(f)))return f.v;break;default:throw new Error('Unknown "contentType" for AuthenticatedSafe: " '+c.contentType)}}}catch(e){n=!0,i=e}finally{try{!a&&o.return&&o.return()}finally{if(n)throw i}}return r}},{key:"makeInternalValues",value:function(e){var t=this;if("parsedValue"in this==!1)return Promise.reject('Please run "parseValues" first or add "parsedValue" manually');if(this.parsedValue instanceof Object==!1)return Promise.reject('The "this.parsedValue" must has "Object" type');if(this.parsedValue.safeContents instanceof Array==!1)return Promise.reject('The "this.parsedValue.safeContents" must has "Array" type');if(e instanceof Object==!1)return Promise.reject('The "parameters" must has "Object" type');if("safeContents"in e==!1)return Promise.reject('Absent mandatory parameter "safeContents"');if(e.safeContents instanceof Array==!1)return Promise.reject('The "parameters.safeContents" must has "Array" type');if(e.safeContents.length!==this.parsedValue.safeContents.length)return Promise.reject('Length of "parameters.safeContents" must be equal to "this.parsedValue.safeContents"');var r=Promise.resolve();this.safeContents=[];var a=!0,n=!1,i=void 0;try{for(var s,o=this.parsedValue.safeContents.entries()[Symbol.iterator]();!(a=(s=o.next()).done);a=!0){var u=_slicedToArray(s.value,2),l=u[0],c=u[1];if("privacyMode"in c==!1)return Promise.reject('The "privacyMode" is a mandatory parameter for "content"');if("value"in c==!1)return Promise.reject('The "value" is a mandatory parameter for "content"');if(c.value instanceof Ut==!1)return Promise.reject('The "content.value" must has "SafeContents" type');switch(c.privacyMode){case 0:!function(){var e=c.value.toSchema().toBER(!1);r=r.then(function(){t.safeContents.push(new it({contentType:"1.2.840.113549.1.7.1",content:new ne({valueHex:e})}))})}();break;case 1:!function(){var a=new lt,n=e.safeContents[l];n.contentToEncrypt=c.value.toSchema().toBER(!1),r=r.then(function(){return a.encrypt(n)},function(e){return Promise.reject(e)}),r=r.then(function(){t.safeContents.push(new it({contentType:"1.2.840.113549.1.7.6",content:a.toSchema()}))},function(e){return Promise.reject(e)})}();break;case 2:var h=function(){var a=new ur,n=c.value.toSchema().toBER(!1);if("encryptingCertificate"in e.safeContents[l]==!1)return{v:Promise.reject('Absent mandatory parameter "encryptingCertificate" in "parameters.safeContents[i]"')};if("encryptionAlgorithm"in e.safeContents[l]==!1)return{v:Promise.reject('Absent mandatory parameter "encryptionAlgorithm" in "parameters.safeContents[i]"')};switch(!0){case"aes-cbc"===e.safeContents[l].encryptionAlgorithm.name.toLowerCase():case"aes-gcm"===e.safeContents[l].encryptionAlgorithm.name.toLowerCase():break;default:return{v:Promise.reject('Incorrect parameter "encryptionAlgorithm" in "parameters.safeContents[i]": '+e.safeContents[l].encryptionAlgorithm)}}switch(!0){case 128===e.safeContents[l].encryptionAlgorithm.length:case 192===e.safeContents[l].encryptionAlgorithm.length:case 256===e.safeContents[l].encryptionAlgorithm.length:break;default:return{v:Promise.reject('Incorrect parameter "encryptionAlgorithm.length" in "parameters.safeContents[i]": '+e.safeContents[l].encryptionAlgorithm.length)}}var i=e.safeContents[l].encryptionAlgorithm;a.addRecipientByCertificate(e.safeContents[l].encryptingCertificate),r=r.then(function(){return a.encrypt(i,n)}),r=r.then(function(){t.safeContents.push(new it({contentType:"1.2.840.113549.1.7.3",content:a.toSchema()}))})}();if("object"===(void 0===h?"undefined":_typeof(h)))return h.v;break;default:return Promise.reject('Incorrect value for "content.privacyMode": '+c.privacyMode)}}}catch(e){n=!0,i=e}finally{try{!a&&o.return&&o.return()}finally{if(n)throw i}}return r.then(function(){return t},function(e){return Promise.reject("Error during parsing: "+e)})}}],[{key:"defaultValues",value:function(e){switch(e){case"safeContents":return[];case"parsedValue":return{};default:throw new Error("Invalid member name for AuthenticatedSafe class: "+e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"safeContents":return 0===t.length;case"parsedValue":return t instanceof Object&&0===Object.keys(t).length;default:throw new Error("Invalid member name for AuthenticatedSafe class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new Ue({name:e.contentInfos||"",value:it.schema()})]})}}]),e}(),cr=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.hashAlgorithm=t(r,"hashAlgorithm",e.defaultValues("hashAlgorithm")),this.issuerNameHash=t(r,"issuerNameHash",e.defaultValues("issuerNameHash")),this.issuerKeyHash=t(r,"issuerKeyHash",e.defaultValues("issuerKeyHash")),this.serialNumber=t(r,"serialNumber",e.defaultValues("serialNumber")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{hashAlgorithm:"hashAlgorithm",issuerNameHash:"issuerNameHash",issuerKeyHash:"issuerKeyHash",serialNumber:"serialNumber"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for CertID");this.hashAlgorithm=new Te({schema:r.result.hashAlgorithm}),this.issuerNameHash=r.result.issuerNameHash,this.issuerKeyHash=r.result.issuerKeyHash,this.serialNumber=r.result.serialNumber}},{key:"toSchema",value:function(){return new ee({value:[this.hashAlgorithm.toSchema(),this.issuerNameHash,this.issuerKeyHash,this.serialNumber]})}},{key:"toJSON",value:function(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),issuerNameHash:this.issuerNameHash.toJSON(),issuerKeyHash:this.issuerKeyHash.toJSON(),serialNumber:this.serialNumber.toJSON()}}},{key:"isEqual",value:function(e){return!this.hashAlgorithm.algorithmId!==e.hashAlgorithm.algorithmId&&(!1!==l(this.issuerNameHash.valueBlock.valueHex,e.issuerNameHash.valueBlock.valueHex)&&(!1!==l(this.issuerKeyHash.valueBlock.valueHex,e.issuerKeyHash.valueBlock.valueHex)&&!!this.serialNumber.isEqual(e.serialNumber)))}},{key:"createForCertificate",value:function(e,t){var r=this,a=Promise.resolve(),n=void 0,i=b();if(void 0===i)return Promise.reject("Unable to create WebCrypto object");if("hashAlgorithm"in t==!1)return Promise.reject('Parameter "hashAlgorithm" is mandatory for "OCSP_REQUEST.createForCertificate"');var s=C({name:t.hashAlgorithm});return""===s?Promise.reject('Incorrect "hashAlgorithm": '+this.hashAlgorithm):(this.hashAlgorithm=new Te({algorithmId:s,algorithmParams:new re}),"issuerCertificate"in t?(n=t.issuerCertificate,this.serialNumber=e.serialNumber,a=a.then(function(){return i.digest({name:t.hashAlgorithm},n.subject.toSchema().toBER(!1))},function(e){return Promise.reject(e)}),a=a.then(function(e){r.issuerNameHash=new ne({valueHex:e});var a=n.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHex;return i.digest({name:t.hashAlgorithm},a)},function(e){return Promise.reject(e)}).then(function(e){r.issuerKeyHash=new ne({valueHex:e})},function(e){return Promise.reject(e)})):Promise.reject('Parameter "issuerCertificate" is mandatory for "OCSP_REQUEST.createForCertificate"'))}}],[{key:"defaultValues",value:function(e){switch(e){case"hashAlgorithm":return new Te;case"issuerNameHash":case"issuerKeyHash":return new ne;case"serialNumber":return new ue;default:throw new Error("Invalid member name for CertID class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"hashAlgorithm":return""===r.algorithmId&&"algorithmParams"in r==!1;case"issuerNameHash":case"issuerKeyHash":case"serialNumber":return r.isEqual(e.defaultValues(t));default:throw new Error("Invalid member name for CertID class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[Te.schema(e.hashAlgorithmObject||{names:{blockName:e.hashAlgorithm||""}}),new ne({name:e.issuerNameHash||""}),new ne({name:e.issuerKeyHash||""}),new ue({name:e.serialNumber||""})]})}}]),e}(),hr=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.certID=t(r,"certID",e.defaultValues("certID")),this.certStatus=t(r,"certStatus",e.defaultValues("certStatus")),this.thisUpdate=t(r,"thisUpdate",e.defaultValues("thisUpdate")),"nextUpdate"in r&&(this.nextUpdate=t(r,"nextUpdate",e.defaultValues("nextUpdate"))),"singleExtensions"in r&&(this.singleExtensions=t(r,"singleExtensions",e.defaultValues("singleExtensions"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{certID:{names:{blockName:"certID"}},certStatus:"certStatus",thisUpdate:"thisUpdate",nextUpdate:"nextUpdate",singleExtensions:{names:{blockName:"singleExtensions"}}}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for SingleResponse");this.certID=new cr({schema:r.result.certID}),this.certStatus=r.result.certStatus,this.thisUpdate=r.result.thisUpdate.toDate(),"nextUpdate"in r.result&&(this.nextUpdate=r.result.nextUpdate.toDate()),"singleExtensions"in r.result&&(this.singleExtensions=Array.from(r.result.singleExtensions.valueBlock.value,function(e){return new xt({schema:e})}))}},{key:"toSchema",value:function(){var e=[];return e.push(this.certID.toSchema()),e.push(this.certStatus),e.push(new Oe({valueDate:this.thisUpdate})),"nextUpdate"in this&&e.push(new Oe({valueDate:this.nextUpdate})),"singleExtensions"in this&&e.push(new ee({value:Array.from(this.singleExtensions,function(e){return e.toSchema()})})),new ee({value:e})}},{key:"toJSON",value:function(){var e={certID:this.certID.toJSON(),certStatus:this.certStatus.toJSON(),thisUpdate:this.thisUpdate};return"nextUpdate"in this&&(e.nextUpdate=this.nextUpdate),"singleExtensions"in this&&(e.singleExtensions=Array.from(this.singleExtensions,function(e){return e.toJSON()})),e}}],[{key:"defaultValues",value:function(e){switch(e){case"certID":return new cr;case"certStatus":return{};case"thisUpdate":case"nextUpdate":return new Date(0,0,0);case"singleExtensions":return[];default:throw new Error("Invalid member name for SingleResponse class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"certID":return cr.compareWithDefault("hashAlgorithm",r.hashAlgorithm)&&cr.compareWithDefault("issuerNameHash",r.issuerNameHash)&&cr.compareWithDefault("issuerKeyHash",r.issuerKeyHash)&&cr.compareWithDefault("serialNumber",r.serialNumber);case"certStatus":return 0===Object.keys(r).length;case"thisUpdate":case"nextUpdate":return r===e.defaultValues(t);default:throw new Error("Invalid member name for SingleResponse class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[cr.schema(e.certID||{}),new Ke({value:[new G({name:e.certStatus||"",idBlock:{tagClass:3,tagNumber:0},lenBlockLength:1}),new z({name:e.certStatus||"",idBlock:{tagClass:3,tagNumber:1},value:[new Oe,new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new le]})]}),new G({name:e.certStatus||"",idBlock:{tagClass:3,tagNumber:2},lenBlock:{length:1}})]}),new Oe({name:e.thisUpdate||""}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Oe({name:e.nextUpdate||""})]}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[Ot.schema(e.singleExtensions||{})]})]})}}]),e}(),mr=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.tbs=t(r,"tbs",e.defaultValues("tbs")),this.responderID=t(r,"responderID",e.defaultValues("responderID")),this.producedAt=t(r,"producedAt",e.defaultValues("producedAt")),this.responses=t(r,"responses",e.defaultValues("responses")),"responseExtensions"in r&&(this.responseExtensions=t(r,"responseExtensions",e.defaultValues("responseExtensions"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema());if(!1===r.verified)throw new Error("Object's schema was not verified against input data for ocsp.ResponseData");this.tbs=r.result.ResponseData.valueBeforeDecode,"ResponseData.version"in r.result&&(this.version=r.result["ResponseData.version"].valueBlock.valueDec),1===r.result["ResponseData.responderID"].idBlock.tagNumber?this.responderID=new et({schema:r.result["ResponseData.responderID"].valueBlock.value[0]}):this.responderID=r.result["ResponseData.responderID"].valueBlock.value[0],this.producedAt=r.result["ResponseData.producedAt"].toDate(),this.responses=Array.from(r.result["ResponseData.responses"],function(e){return new hr({schema:e})}),"ResponseData.responseExtensions"in r.result&&(this.responseExtensions=Array.from(r.result["ResponseData.responseExtensions"].valueBlock.value,function(e){return new xt({schema:e})}))}},{key:"toSchema",value:function(){var t=void 0;if(!1===(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){if(0===this.tbs.length)return e.schema();t=g(this.tbs).result}else{var r=[];"version"in this&&r.push(new z({idBlock:{tagClass:3,tagNumber:0},value:[new ue({value:this.version})]})),this.responderID instanceof et?r.push(new z({idBlock:{tagClass:3,tagNumber:1},value:[this.responderID.toSchema()]})):r.push(new z({idBlock:{tagClass:3,tagNumber:2},value:[this.responderID]})),r.push(new Oe({valueDate:this.producedAt})),r.push(new ee({value:Array.from(this.responses,function(e){return e.toSchema()})})),"responseExtensions"in this&&r.push(new ee({value:Array.from(this.responseExtensions,function(e){return e.toSchema()})})),t=new ee({value:r})}return t}},{key:"toJSON",value:function(){var e={};return"version"in this&&(e.version=this.version),"responderID"in this&&(e.responderID=this.responderID),"producedAt"in this&&(e.producedAt=this.producedAt),"responses"in this&&(e.responses=Array.from(this.responses,function(e){return e.toJSON()})),"responseExtensions"in this&&(e.responseExtensions=Array.from(this.responseExtensions,function(e){return e.toJSON()})),e}}],[{key:"defaultValues",value:function(e){switch(e){case"tbs":return new ArrayBuffer(0);case"responderID":return{};case"producedAt":return new Date(0,0,0);case"responses":case"responseExtensions":return[];default:throw new Error("Invalid member name for ResponseData class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"tbs":return 0===r.byteLength;case"responderID":return 0===Object.keys(r).length;case"producedAt":return r===e.defaultValues(t);case"responses":case"responseExtensions":return 0===r.length;default:throw new Error("Invalid member name for ResponseData class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"ResponseData",value:[new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ue({name:e.version||"ResponseData.version"})]}),new Ke({value:[new z({name:e.responderID||"ResponseData.responderID",idBlock:{tagClass:3,tagNumber:1},value:[et.schema(e.ResponseDataByName||{names:{blockName:"ResponseData.byName"}})]}),new z({name:e.responderID||"ResponseData.responderID",idBlock:{tagClass:3,tagNumber:2},value:[new ne({name:e.ResponseDataByKey||"ResponseData.byKey"})]})]}),new Oe({name:e.producedAt||"ResponseData.producedAt"}),new ee({value:[new Ue({name:"ResponseData.responses",value:hr.schema(e.response||{})})]}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[Ot.schema(e.extensions||{names:{blockName:"ResponseData.responseExtensions"}})]})]})}}]),e}(),fr=function(e){return void 0!==e&&("function"==typeof e.next&&"function"==typeof e.throw)},vr=function(e){if(void 0===e)return!1;var t=e.constructor;return!!t&&("GeneratorFunction"===t.name||"GeneratorFunction"===t.displayName||fr(e))},dr=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.trustedCerts=t(r,"trustedCerts",e.defaultValues("trustedCerts")),this.certs=t(r,"certs",e.defaultValues("certs")),this.crls=t(r,"crls",e.defaultValues("crls")),this.ocsps=t(r,"ocsps",e.defaultValues("ocsps")),this.checkDate=t(r,"checkDate",e.defaultValues("checkDate")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"sort",value:function(){function e(e,t){var r,a,n,i;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(r=[],!e.subject.isEqual(e.issuer)){s.next=12;break}return s.prev=2,s.next=5,e.verify();case 5:if(!0!==(a=s.sent)){s.next=8;break}return s.abrupt("return",[t]);case 8:s.next=12;break;case 10:s.prev=10,s.t0=s.catch(2);case 12:n=0;case 13:if(!(n<o.length)){s.next=26;break}return s.prev=14,s.next=17,e.verify(o[n]);case 17:!0===(i=s.sent)&&r.push(n),s.next=23;break;case 21:s.prev=21,s.t1=s.catch(14);case 23:n++,s.next=13;break;case 26:return s.abrupt("return",r.length?r:[-1]);case 27:case"end":return s.stop()}},s[0],this,[[2,10],[14,21]])}function t(r,a){var n,i,u,l,c,h,m,f,v,d;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return i=function(e){for(var t=!0,r=0;r<e.length;r++){for(var a=0;a<e.length;a++)if(a!==r&&e[r]===e[a]){t=!1;break}if(!t)break}return t},n=[],s.next=4,e(r,a);case 4:if(1!==(u=s.sent).length||-1!==u[0]){s.next=7;break}throw new Error("Incorrect result");case 7:if(1!==u.length){s.next=17;break}if(u[0]!==a){s.next=11;break}return n.push(u),s.abrupt("return",n);case 11:return s.next=13,t(o[u[0]],u[0]);case 13:for(l=s.sent,c=0;c<l.length;c++)(h=l[c].slice()).splice(0,0,u[0]),i(h)?n.push(h):n.push(l[c]);s.next=29;break;case 17:m=0;case 18:if(!(m<u.length)){s.next=29;break}if(u[m]!==a){s.next=22;break}return n.push([u[m]]),s.abrupt("continue",26);case 22:return s.next=24,t(o[u[m]],u[m]);case 24:for(f=s.sent,v=0;v<f.length;v++)(d=f[v].slice()).splice(0,0,u[m]),i(d)?n.push(d):n.push(f[v]);case 26:m++,s.next=18;break;case 29:return s.abrupt("return",n);case 30:case"end":return s.stop()}},s[1],this)}function r(e){var t,r,a,n,i,l;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(t=[],r=[],a=[],t.push.apply(t,_toConsumableArray(o.filter(function(t){return e.issuer.isEqual(t.subject)}))),0!==t.length){s.next=6;break}return s.abrupt("return",{status:1,statusMessage:"No certificate's issuers"});case 6:if(r.push.apply(r,_toConsumableArray(u.crls.filter(function(t){return t.issuer.isEqual(e.issuer)}))),0!==r.length){s.next=9;break}return s.abrupt("return",{status:1,statusMessage:"No CRLs for specific certificate issuer"});case 9:n=0;case 10:if(!(n<r.length)){s.next=32;break}if(!(r[n].nextUpdate.value<u.checkDate)){s.next=13;break}return s.abrupt("continue",29);case 13:i=0;case 14:if(!(i<t.length)){s.next=29;break}return s.prev=15,s.next=18,r[n].verify({issuerCertificate:t[i]});case 18:if(!(l=s.sent)){s.next=22;break}return a.push({crl:r[n],certificate:t[i]}),s.abrupt("break",29);case 22:s.next=26;break;case 24:s.prev=24,s.t0=s.catch(15);case 26:i++,s.next=14;break;case 29:n++,s.next=10;break;case 32:if(!a.length){s.next=34;break}return s.abrupt("return",{status:0,statusMessage:"",result:a});case 34:return s.abrupt("return",{status:1,statusMessage:"No valid CRLs found"});case 35:case"end":return s.stop()}},s[2],this,[[15,24]])}function a(e,t){var r,a,n;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if("name"in(r=N(e.signatureAlgorithm.algorithmId))!=!1){i.next=3;break}return i.abrupt("return",1);case 3:if("hash"in r!=!1){i.next=5;break}return i.abrupt("return",1);case 5:a=0;case 6:if(!(a<u.ocsps.length)){i.next=17;break}return i.next=9,u.ocsps[a].getCertificateStatus(e,t);case 9:if(!(n=i.sent).isForCertificate){i.next=14;break}if(0!==n.status){i.next=13;break}return i.abrupt("return",0);case 13:return i.abrupt("return",1);case 14:a++,i.next=6;break;case 17:return i.abrupt("return",2);case 18:case"end":return i.stop()}},s[3],this)}function n(e){var t,r,a,n,i,o,u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(t=!1,r=!1,a=!1,n=!1,!("extensions"in e)){s.next=20;break}i=0;case 6:if(!(i<e.extensions.length)){s.next=14;break}if(!0!==e.extensions[i].critical||"parsedValue"in e.extensions[i]!=!1){s.next=9;break}return s.abrupt("return",{result:!1,resultCode:6,resultMessage:"Unable to parse critical certificate extension: "+e.extensions[i].extnID});case 9:"2.5.29.15"===e.extensions[i].extnID&&(a=!0,4==(4&(o=new Uint8Array(e.extensions[i].parsedValue.valueBlock.valueHex))[0])&&(r=!0),2==(2&o[0])&&(n=!0)),"2.5.29.19"===e.extensions[i].extnID&&"cA"in e.extensions[i].parsedValue&&!0===e.extensions[i].parsedValue.cA&&(t=!0);case 11:i++,s.next=6;break;case 14:if(!0!==r||!1!==t){s.next=16;break}return s.abrupt("return",{result:!1,resultCode:3,resultMessage:'Unable to build certificate chain - using "keyCertSign" flag set without BasicConstaints'});case 16:if(!0!==a||!0!==t||!1!==r){s.next=18;break}return s.abrupt("return",{result:!1,resultCode:4,resultMessage:'Unable to build certificate chain - "keyCertSign" flag was not set'});case 18:if(!0!==t||!0!==a||!u||!1!==n){s.next=20;break}return s.abrupt("return",{result:!1,resultCode:5,resultMessage:'Unable to build certificate chain - intermediate certificate must have "cRLSign" key usage flag'});case 20:if(!1!==t){s.next=22;break}return s.abrupt("return",{result:!1,resultCode:7,resultMessage:"Unable to build certificate chain - more than one possible end-user certificate"});case 22:return s.abrupt("return",{result:!0,resultCode:0,resultMessage:""});case 23:case"end":return s.stop()}},s[4],this)}function i(e,t){var i,o,l,c,h,m,f,v,d,g;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:i=0;case 1:if(!(i<e.length)){s.next=7;break}if(!(e[i].notBefore.value>t||e[i].notAfter.value<t)){s.next=4;break}return s.abrupt("return",{result:!1,resultCode:8,resultMessage:"Certificate validity period is out of checking date"});case 4:i++,s.next=1;break;case 7:if(!(e.length<2)){s.next=9;break}return s.abrupt("return",{result:!1,resultCode:9,resultMessage:"Too short certificate path"});case 9:o=e.length-2;case 10:if(!(o>=0)){s.next=17;break}if(!1!==e[o].issuer.isEqual(e[o].subject)){s.next=14;break}if(!1!==e[o].issuer.isEqual(e[o+1].subject)){s.next=14;break}return s.abrupt("return",{result:!1,resultCode:10,resultMessage:"Incorrect name chaining"});case 14:o--,s.next=10;break;case 17:if(0===u.crls.length&&0===u.ocsps.length){s.next=58;break}l=0;case 19:if(!(l<e.length-2)){s.next=58;break}if(c=void 0,h=void 0,0===u.ocsps.length){s.next=32;break}return s.next=25,a(e[l],e[l+1]);case 25:c=s.sent,s.t0=c,s.next=0===s.t0?29:1===s.t0?30:2===s.t0?31:32;break;case 29:return s.abrupt("continue",55);case 30:return s.abrupt("return",{result:!1,resultCode:12,resultMessage:"One of certificates was revoked via OCSP response"});case 31:return s.abrupt("break",32);case 32:if(0===u.crls.length){s.next=53;break}return s.next=35,r(e[l]);case 35:if(!(h=s.sent).status){s.next=38;break}throw{result:!1,resultCode:11,resultMessage:"No revocation values found for one of certificates: "+h.statusMessage};case 38:m=0;case 39:if(!(m<h.result.length)){s.next=51;break}if(!(f=h.result[m].crl.isCertificateRevoked(e[l]))){s.next=43;break}return s.abrupt("return",{result:!1,resultCode:12,resultMessage:"One of certificates had been revoked"});case 43:return s.next=45,n(h.result[m].certificate,!0);case 45:if(!1!==(v=s.sent).result){s.next=48;break}return s.abrupt("return",{result:!1,resultCode:13,resultMessage:"CRL issuer certificate is not a CA certificate or does not have crlSign flag"});case 48:m++,s.next=39;break;case 51:s.next=55;break;case 53:if(2!==c){s.next=55;break}return s.abrupt("return",{result:!1,resultCode:11,resultMessage:"No revocation values found for one of certificates"});case 55:l++,s.next=19;break;case 58:d=1;case 59:if(!(d<e.length)){s.next=68;break}return s.next=62,n(e[d]);case 62:if(!1!==(g=s.sent).result){s.next=65;break}return s.abrupt("return",{result:!1,resultCode:14,resultMessage:"One of intermediate certificates is not a CA certificate"});case 65:d++,s.next=59;break;case 68:return s.abrupt("return",{result:!0});case 69:case"end":return s.stop()}},s[5],this)}var s=[e,t,r,a,n,i].map(regeneratorRuntime.mark),o=[],u=this;return R(regeneratorRuntime.mark(function e(){var r,a,n,s,c,h,m,f,v,d,g,y,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o.push.apply(o,_toConsumableArray(u.trustedCerts)),o.push.apply(o,_toConsumableArray(u.certs)),r=0;case 3:if(!(r<o.length)){e.next=18;break}a=0;case 5:if(!(a<o.length)){e.next=15;break}if(r!==a){e.next=8;break}return e.abrupt("continue",12);case 8:if(!l(o[r].tbs,o[a].tbs)){e.next=12;break}return o.splice(a,1),r=0,e.abrupt("break",15);case 12:a++,e.next=5;break;case 15:r++,e.next=3;break;case 18:return n=void 0,s=[o[o.length-1]],e.next=22,t(o[o.length-1],o.length-1);case 22:if(0!==(n=e.sent).length){e.next=25;break}return e.abrupt("return",{result:!1,resultCode:60,resultMessage:"Unable to find certificate path"});case 25:c=0;case 26:if(!(c<n.length)){e.next=48;break}h=!1,m=0;case 29:if(!(m<n[c].length)){e.next=44;break}f=o[n[c][m]],v=0;case 32:if(!(v<u.trustedCerts.length)){e.next=39;break}if(!l(f.tbs,u.trustedCerts[v].tbs)){e.next=36;break}return h=!0,e.abrupt("break",39);case 36:v++,e.next=32;break;case 39:if(!h){e.next=41;break}return e.abrupt("break",44);case 41:m++,e.next=29;break;case 44:h||(n.splice(c,1),c=0);case 45:c++,e.next=26;break;case 48:if(0!==n.length){e.next=50;break}throw{result:!1,resultCode:97,resultMessage:"No valid certificate paths found"};case 50:for(d=n[0].length,g=0,y=0;y<n.length;y++)n[y].length<d&&(d=n[y].length,g=y);for(p=0;p<n[g].length;p++)s.push(o[n[g][p]]);return e.next=56,i(s,u.checkDate);case 56:if(!1!==(n=e.sent).result){e.next=59;break}throw n;case 59:return e.abrupt("return",s);case 60:case"end":return e.stop()}},e,this)}))}},{key:"verify",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(0===this.certs.length)return Promise.reject("Empty certificate array");var r=Promise.resolve(),a=[];a.push("2.5.29.32.0");var n=!1,i=!1,s=!1,o=[],u=[],l=[];"initialPolicySet"in t&&(a=t.initialPolicySet),"initialExplicitPolicy"in t&&(n=t.initialExplicitPolicy),"initialPolicyMappingInhibit"in t&&(i=t.initialPolicyMappingInhibit),"initialInhibitPolicy"in t&&(s=t.initialInhibitPolicy),"initialPermittedSubtreesSet"in t&&(o=t.initialPermittedSubtreesSet),"initialExcludedSubtreesSet"in t&&(u=t.initialExcludedSubtreesSet),"initialRequiredNameForms"in t&&(l=t.initialRequiredNameForms);var c=n,h=i,m=s,f=new Array(3);f[0]=!1,f[1]=!1,f[2]=!1;var v=0,d=0,g=0,y=o,p=u,k=l,b=1;return r=this.sort().then(function(t){e.certs=t}),r=r.then(function(){var t=[];t.push("2.5.29.32.0");for(var r=[],n=new Array(e.certs.length-1),i=0;i<e.certs.length-1;i++)n[i]=!0;r.push(n);for(var s=new Array(e.certs.length-1),o=new Array(e.certs.length-1),u=c?e.certs.length-1:-1,l=e.certs.length-2;l>=0;l--,b++)if("extensions"in e.certs[l]){for(var y=0;y<e.certs[l].extensions.length;y++){if("2.5.29.32"===e.certs[l].extensions[y].extnID){o[l]=e.certs[l].extensions[y].parsedValue;for(var p=0;p<t.length;p++)if("2.5.29.32.0"===t[p]){delete r[p][l];break}for(var k=0;k<e.certs[l].extensions[y].parsedValue.certificatePolicies.length;k++){for(var w=-1,C=0;C<t.length;C++)if(e.certs[l].extensions[y].parsedValue.certificatePolicies[k].policyIdentifier===t[C]){w=C;break}if(-1===w){t.push(e.certs[l].extensions[y].parsedValue.certificatePolicies[k].policyIdentifier);var S=new Array(e.certs.length-1);S[l]=!0,r.push(S)}else r[w][l]=!0}}if("2.5.29.33"===e.certs[l].extensions[y].extnID){if(h)return{result:!1,resultCode:98,resultMessage:"Policy mapping prohibited"};s[l]=e.certs[l].extensions[y].parsedValue}"2.5.29.36"===e.certs[l].extensions[y].extnID&&!1===c&&(0===e.certs[l].extensions[y].parsedValue.requireExplicitPolicy?(c=!0,u=l):!1===f[0]?(f[0]=!0,v=e.certs[l].extensions[y].parsedValue.requireExplicitPolicy):v=v>e.certs[l].extensions[y].parsedValue.requireExplicitPolicy?e.certs[l].extensions[y].parsedValue.requireExplicitPolicy:v,0===e.certs[l].extensions[y].parsedValue.inhibitPolicyMapping?h=!0:!1===f[1]?(f[1]=!0,d=e.certs[l].extensions[y].parsedValue.inhibitPolicyMapping+1):d=d>e.certs[l].extensions[y].parsedValue.inhibitPolicyMapping+1?e.certs[l].extensions[y].parsedValue.inhibitPolicyMapping+1:d),"2.5.29.54"===e.certs[l].extensions[y].extnID&&!1===m&&(0===e.certs[l].extensions[y].parsedValue.valueBlock.valueDec?m=!0:!1===f[2]?(f[2]=!0,g=e.certs[l].extensions[y].parsedValue.valueBlock.valueDec):g=g>e.certs[l].extensions[y].parsedValue.valueBlock.valueDec?e.certs[l].extensions[y].parsedValue.valueBlock.valueDec:g)}if(!0===m){for(var A=-1,I=0;I<t.length;I++)if("2.5.29.32.0"===t[I]){A=I;break}-1!==A&&delete r[0][l]}!1===c&&!0===f[0]&&0===--v&&(c=!0,u=l,f[0]=!1),!1===h&&!0===f[1]&&0===--d&&(h=!0,f[1]=!1),!1===m&&!0===f[2]&&0===--g&&(m=!0,f[2]=!1)}for(var B=0;B<e.certs.length-1;B++)if(B<e.certs.length-2&&void 0!==s[B+1])for(var N=0;N<s[B+1].mappings.length;N++){if("2.5.29.32.0"===s[B+1].mappings[N].issuerDomainPolicy||"2.5.29.32.0"===s[B+1].mappings[N].subjectDomainPolicy)return{result:!1,resultCode:99,resultMessage:'The "anyPolicy" should not be a part of policy mapping scheme'};for(var P=-1,E=-1,x=0;x<t.length;x++)t[x]===s[B+1].mappings[N].issuerDomainPolicy&&(P=x),t[x]===s[B+1].mappings[N].subjectDomainPolicy&&(E=x);void 0!==r[P][B]&&delete r[P][B];for(var O=0;O<o[B].certificatePolicies.length;O++)if(s[B+1].mappings[N].subjectDomainPolicy===o[B].certificatePolicies[O].policyIdentifier&&-1!==P&&-1!==E)for(var V=0;V<=B;V++)void 0!==r[E][V]&&(r[P][V]=!0,delete r[E][V])}for(var _=0;_<t.length;_++)if("2.5.29.32.0"===t[_])for(var j=0;j<u;j++)delete r[_][j];for(var D=[],R=0;R<r.length;R++){for(var K=!0,H=0;H<e.certs.length-1;H++){var U=!1;if(H<u&&"2.5.29.32.0"===t[R]&&t.length>1){K=!1;break}if(void 0===r[R][H]){if(H>=u)for(var L=0;L<t.length;L++)if("2.5.29.32.0"===t[L]){!0===r[L][H]&&(U=!0);break}if(!U){K=!1;break}}}!0===K&&D.push(t[R])}var T=[];if(1===a.length&&"2.5.29.32.0"===a[0]&&!1===c)T=a;else if(1===D.length&&"2.5.29.32.0"===D[0])T=a;else for(var J=0;J<D.length;J++)for(var q=0;q<a.length;q++)if(a[q]===D[J]||"2.5.29.32.0"===a[q]){T.push(D[J]);break}return{result:T.length>0,resultCode:0,resultMessage:T.length>0?"":'Zero "userConstrPolicies" array, no intersections with "authConstrPolicies"',authConstrPolicies:D,userConstrPolicies:T,explicitPolicyIndicator:c,policyMappings:s}}),r=r.then(function(t){function r(e,t){var r=I(e),a=I(t),n=r.split("."),i=a.split("."),s=n.length,o=i.length;if(0===s||0===o||s<o)return!1;for(var u=0;u<s;u++)if(0===n[u].length)return!1;for(var l=0;l<o;l++)if(0===i[l].length){if(0===l){if(1===o)return!1;continue}return!1}for(var c=0;c<o;c++)if(0!==i[o-1-c].length&&0!==n[s-1-c].localeCompare(i[o-1-c]))return!1;return!0}function a(e,t){var a=I(e),n=I(t),i=a.split("@"),s=n.split("@");if(0===i.length||0===s.length||i.length<s.length)return!1;if(1===s.length){if(r(i[1],s[0])){var o=i[1].split("."),u=s[0].split(".");return 0===u[0].length||o.length===u.length}return!1}return 0===a.localeCompare(n)}function n(e,t){var a=I(e),n=I(t),i=a.split("/");if(n.split("/").length>1)return!1;if(i.length>1)for(var s=0;s<i.length;s++)if(i[s].length>0&&":"!==i[s].charAt(i[s].length-1)){a=i[s].split(":")[0];break}if(r(a,n)){var o=a.split("."),u=n.split(".");return 0===u[0].length||o.length===u.length}return!1}function i(e,t){var r=new Uint8Array(e.valueBlock.valueHex),a=new Uint8Array(t.valueBlock.valueHex);if(4===r.length&&8===a.length){for(var n=0;n<4;n++)if((r[n]^a[n])&a[n+4])return!1;return!0}if(16===r.length&&32===a.length){for(var i=0;i<16;i++)if((r[i]^a[i])&a[i+16])return!1;return!0}return!1}function s(e,t){if(0===e.typesAndValues.length||0===t.typesAndValues.length)return!0;if(e.typesAndValues.length<t.typesAndValues.length)return!1;for(var r=!0,a=0,n=0;n<t.typesAndValues.length;n++){for(var i=!1,s=a;s<e.typesAndValues.length;s++)if(i=e.typesAndValues[s].isEqual(t.typesAndValues[n]),e.typesAndValues[s].type===t.typesAndValues[n].type&&(r=r&&i),!0===i){if(0===a||a===s){a=s+1;break}return!1}if(!1===i)return!1}return 0!==a&&r}if(!1===t.result)return t;b=1;for(var o=e.certs.length-2;o>=0;o--,b++){var u=[],l=[],c=[];if("extensions"in e.certs[o])for(var h=0;h<e.certs[o].extensions.length;h++)"2.5.29.30"===e.certs[o].extensions[h].extnID&&("permittedSubtrees"in e.certs[o].extensions[h].parsedValue&&(l=l.concat(e.certs[o].extensions[h].parsedValue.permittedSubtrees)),"excludedSubtrees"in e.certs[o].extensions[h].parsedValue&&(c=c.concat(e.certs[o].extensions[h].parsedValue.excludedSubtrees))),"2.5.29.17"===e.certs[o].extensions[h].extnID&&(u=u.concat(e.certs[o].extensions[h].parsedValue.altNames));for(var m=k.length<=0,f=0;f<k.length;f++)switch(k[f].base.type){case 4:if(k[f].base.value.typesAndValues.length!==e.certs[o].subject.typesAndValues.length)continue;m=!0;for(var v=0;v<e.certs[o].subject.typesAndValues.length;v++)if(e.certs[o].subject.typesAndValues[v].type!==k[f].base.value.typesAndValues[v].type){m=!1;break}if(!0===m)break}if(!1===m)return t.result=!1,t.resultCode=21,t.resultMessage="No neccessary name form found",Promise.reject(t);var d=[];d[0]=[],d[1]=[],d[2]=[],d[3]=[],d[4]=[];for(var g=0;g<y.length;g++)switch(y[g].base.type){case 1:d[0].push(y[g]);break;case 2:d[1].push(y[g]);break;case 4:d[2].push(y[g]);break;case 6:d[3].push(y[g]);break;case 7:d[4].push(y[g])}for(var w=0;w<5;w++){for(var C=!1,S=!1,A=d[w],B=0;B<A.length;B++){switch(w){case 0:if(u.length>0)for(var N=0;N<u.length;N++)1===u[N].type&&(S=!0,C=C||a(u[N].value,A[B].base.value));else for(var P=0;P<e.certs[o].subject.typesAndValues.length;P++)"1.2.840.113549.1.9.1"!==e.certs[o].subject.typesAndValues[P].type&&"0.9.2342.19200300.100.1.3"!==e.certs[o].subject.typesAndValues[P].type||(S=!0,C=C||a(e.certs[o].subject.typesAndValues[P].value.valueBlock.value,A[B].base.value));break;case 1:if(u.length>0)for(var E=0;E<u.length;E++)2===u[E].type&&(S=!0,C=C||r(u[E].value,A[B].base.value));break;case 2:S=!0,C=s(e.certs[o].subject,A[B].base.value);break;case 3:if(u.length>0)for(var x=0;x<u.length;x++)6===u[x].type&&(S=!0,C=C||n(u[x].value,A[B].base.value));break;case 4:if(u.length>0)for(var O=0;O<u.length;O++)7===u[O].type&&(S=!0,C=C||i(u[O].value,A[B].base.value))}if(C)break}if(!1===C&&A.length>0&&S)return t.result=!1,t.resultCode=41,t.resultMessage='Failed to meet "permitted sub-trees" name constraint',Promise.reject(t)}for(var V=!1,_=0;_<p.length;_++){switch(p[_].base.type){case 1:if(u.length>=0)for(var j=0;j<u.length;j++)1===u[j].type&&(V=V||a(u[j].value,p[_].base.value));else for(var D=0;D<e.subject.typesAndValues.length;D++)"1.2.840.113549.1.9.1"!==e.subject.typesAndValues[D].type&&"0.9.2342.19200300.100.1.3"!==e.subject.typesAndValues[D].type||(V=V||a(e.subject.typesAndValues[D].value.valueBlock.value,p[_].base.value));break;case 2:if(u.length>0)for(var R=0;R<u.length;R++)2===u[R].type&&(V=V||r(u[R].value,p[_].base.value));break;case 4:V=V||s(e.certs[o].subject,p[_].base.value);break;case 6:if(u.length>0)for(var K=0;K<u.length;K++)6===u[K].type&&(V=V||n(u[K].value,p[_].base.value));break;case 7:if(u.length>0)for(var H=0;H<u.length;H++)7===u[H].type&&(V=V||i(u[H].value,p[_].base.value))}if(V)break}if(!0===V)return t.result=!1,t.resultCode=42,t.resultMessage='Failed to meet "excluded sub-trees" name constraint',Promise.reject(t);y=y.concat(l),p=p.concat(c)}return t}),r=r.then(function(e){return e},function(e){if(e instanceof Object){if("resultMessage"in e)return e;if("message"in e)return{result:!1,resultCode:-1,resultMessage:e.message}}return{result:!1,resultCode:-1,resultMessage:e}})}}],[{key:"defaultValues",value:function(e){switch(e){case"trustedCerts":case"certs":case"crls":case"ocsps":return[];case"checkDate":return new Date;default:throw new Error("Invalid member name for CertificateChainValidationEngine class: "+e)}}}]),e}(),gr=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.tbsResponseData=t(r,"tbsResponseData",e.defaultValues("tbsResponseData")),this.signatureAlgorithm=t(r,"signatureAlgorithm",e.defaultValues("signatureAlgorithm")),this.signature=t(r,"signature",e.defaultValues("signature")),"certs"in r&&(this.certs=t(r,"certs",e.defaultValues("certs"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema());if(!1===r.verified)throw new Error("Object's schema was not verified against input data for OCSP_BASIC_RESPONSE");this.tbsResponseData=new mr({schema:r.result["BasicOCSPResponse.tbsResponseData"]}),this.signatureAlgorithm=new Te({schema:r.result["BasicOCSPResponse.signatureAlgorithm"]}),this.signature=r.result["BasicOCSPResponse.signature"],"BasicOCSPResponse.certs"in r.result&&(this.certs=Array.from(r.result["BasicOCSPResponse.certs"],function(e){return new Vt({schema:e})}))}},{key:"toSchema",value:function(){var e=[];return e.push(this.tbsResponseData.toSchema()),e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),"certs"in this&&e.push(new z({idBlock:{tagClass:3,tagNumber:0},value:[new ee({value:Array.from(this.certs,function(e){return e.toSchema()})})]})),new ee({value:e})}},{key:"toJSON",value:function(){var e={tbsResponseData:this.tbsResponseData.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return"certs"in this&&(e.certs=Array.from(this.certs,function(e){return e.toJSON()})),e}},{key:"getCertificateStatus",value:function(e,t){var r=this,a=Promise.resolve(),n={isForCertificate:!1,status:2},i={},s=[],o=[],u=!0,l=!1,c=void 0;try{for(var h,m=this.tbsResponseData.responses[Symbol.iterator]();!(u=(h=m.next()).done);u=!0){var f=h.value,v=N(f.certID.hashAlgorithm.algorithmId);if("name"in v==!1)return Promise.reject("Wrong CertID hashing algorithm: "+f.certID.hashAlgorithm.algorithmId);if(v.name in i==!1){i[v.name]=1;var d=new cr;s.push(d),o.push(d.createForCertificate(e,{hashAlgorithm:v.name,issuerCertificate:t}))}}}catch(e){l=!0,c=e}finally{try{!u&&m.return&&m.return()}finally{if(l)throw c}}return a=a.then(function(){return Promise.all(o)}),a=a.then(function(){var e=!0,t=!1,a=void 0;try{for(var i,o=r.tbsResponseData.responses[Symbol.iterator]();!(e=(i=o.next()).done);e=!0){var u=i.value,l=!0,c=!1,h=void 0;try{for(var m,f=s[Symbol.iterator]();!(l=(m=f.next()).done);l=!0){var v=m.value;if(u.certID.isEqual(v)){n.isForCertificate=!0;try{switch(u.certStatus.idBlock.isConstructed){case!0:1===u.certStatus.idBlock.tagNumber&&(n.status=1);break;case!1:switch(u.certStatus.idBlock.tagNumber){case 0:n.status=0;break;case 2:n.status=2}}}catch(e){}return n}}}catch(e){c=!0,h=e}finally{try{!l&&f.return&&f.return()}finally{if(c)throw h}}}}catch(e){t=!0,a=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw a}}return n})}},{key:"sign",value:function(e,t){var r=this;if(void 0===e)return Promise.reject("Need to provide a private key for signing");if(void 0===t)t="SHA-1";else if(""===C({name:t}))return Promise.reject("Unsupported hash algorithm: "+t);var a=S(e.algorithm.name,"sign");switch(a.algorithm.hash.name=t,e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":this.signatureAlgorithm.algorithmId=C(a.algorithm);break;case"RSA-PSS":switch(t.toUpperCase()){case"SHA-256":a.algorithm.saltLength=32;break;case"SHA-384":a.algorithm.saltLength=48;break;case"SHA-512":a.algorithm.saltLength=64}var n={};if("SHA-1"!==t.toUpperCase()){var i=C({name:t});if(""===i)return Promise.reject("Unsupported hash algorithm: "+t);n.hashAlgorithm=new Te({algorithmId:i,algorithmParams:new re}),n.maskGenAlgorithm=new Te({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:n.hashAlgorithm.toSchema()})}20!==a.algorithm.saltLength&&(n.saltLength=a.algorithm.saltLength);var s=new Je(n);this.signatureAlgorithm=new Te({algorithmId:"1.2.840.113549.1.1.10",algorithmParams:s.toSchema()});break;default:return Promise.reject("Unsupported signature algorithm: "+e.algorithm.name)}this.tbsResponseData.tbs=this.tbsResponseData.toSchema(!0).toBER(!1);var o=b();return void 0===o?Promise.reject("Unable to create WebCrypto object"):o.sign(a.algorithm,e,new Uint8Array(this.tbsResponseData.tbs)).then(function(e){"ECDSA"===a.algorithm.name&&(e=A(e)),r.signature=new se({valueHex:e})},function(e){return Promise.reject("Signing error: "+e)})}},{key:"verify",value:function(){function e(e){if(!0===e.issuer.isEqual(a.issuer)&&!0===e.serialNumber.isEqual(a.serialNumber))return null;var t=!1,r=!0,n=!1,i=void 0;try{for(var s,o=e.extensions[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var u=s.value;"2.5.29.19"===u.extnID&&"cA"in u.parsedValue&&!0===u.parsedValue.cA&&(t=!0)}}catch(e){n=!0,i=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw i}}return t?e:null}var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("certs"in this==!1)return Promise.reject("No certificates attached to the BasicOCSPResponce");var a=null,n=new Uint8Array(this.tbsResponseData.tbs),i=-1,s=Promise.resolve(),o="",u=[];"trustedCerts"in r&&(u=r.trustedCerts);var c=b();if(void 0===c)return Promise.reject("Unable to create WebCrypto object");if(""===(o=P(this.signatureAlgorithm)))return Promise.reject("Unsupported signature algorithm: "+this.signatureAlgorithm.algorithmId);var h=0,m={};if(this.tbsResponseData.responderID instanceof et)h=0,m=this.tbsResponseData.responderID;else{if(!(this.tbsResponseData.responderID instanceof ne))return Promise.reject("Wrong value for responderID");h=1,m=this.tbsResponseData.responderID}return s=0===h?s.then(function(){var e=!0,r=!1,a=void 0;try{for(var n,s=t.certs.entries()[Symbol.iterator]();!(e=(n=s.next()).done);e=!0){var o=_slicedToArray(n.value,2),u=o[0];if(o[1].subject.isEqual(m)){i=u;break}}}catch(e){r=!0,a=e}finally{try{!e&&s.return&&s.return()}finally{if(r)throw a}}}):s.then(function(){return Promise.all(Array.from(t.certs,function(e){return c.digest({name:"sha-1"},new Uint8Array(e.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHex))})).then(function(e){var r=!0,a=!1,n=void 0;try{for(var s,o=t.certs.entries()[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var u=_slicedToArray(s.value,2),c=u[0];u[1];if(l(e[c],m.valueBlock.valueHex)){i=c;break}}}catch(e){a=!0,n=e}finally{try{!r&&o.return&&o.return()}finally{if(a)throw n}}})}),s=s.then(function(){return-1===i?Promise.reject("Correct certificate was not found in OCSP response"):(a=t.certs[i],Promise.all(Array.from(t.certs,function(t){return e(t)})).then(function(e){var t=[];t.push(a);var r=!0,n=!1,i=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var l=s.value;null!==l&&t.push(l)}}catch(e){n=!0,i=e}finally{try{!r&&o.return&&o.return()}finally{if(n)throw i}}return new dr({certs:t,trustedCerts:u}).verify().then(function(e){return!0===e.result?Promise.resolve():Promise.reject("Validation of signer's certificate failed")},function(e){return Promise.reject("Validation of signer's certificate failed with error: "+(e instanceof Object?e.resultMessage:e))})},function(e){return Promise.reject("Error during checking certificates for CA flag: "+e)}))}),s=s.then(function(){var e=void 0,r=N(e="1.2.840.113549.1.1.10"===t.certs[i].signatureAlgorithm.algorithmId?t.certs[i].signatureAlgorithm.algorithmId:t.certs[i].subjectPublicKeyInfo.algorithm.algorithmId);if("name"in r==!1)return Promise.reject("Unsupported public key algorithm: "+e);var a=r.name,n=S(a,"importkey");if("hash"in n.algorithm&&(n.algorithm.hash.name=o),"ECDSA"===a){if(t.certs[i].subjectPublicKeyInfo.algorithm.algorithmParams instanceof me==!1)return Promise.reject("Incorrect type for ECDSA public key parameters");var s=N(t.certs[i].subjectPublicKeyInfo.algorithm.algorithmParams.valueBlock.toString());if("name"in s==!1)return Promise.reject("Unsupported named curve algorithm: "+t.certs[i].subjectPublicKeyInfo.algorithm.algorithmParams.valueBlock.toString());n.algorithm.namedCurve=s.name}var u=t.certs[i].subjectPublicKeyInfo.toSchema().toBER(!1),l=new Uint8Array(u);return c.importKey("spki",l,n.algorithm,!0,n.usages)}),s=s.then(function(e){var r=S(e.algorithm.name,"verify");"hash"in r.algorithm&&(r.algorithm.hash.name=o);var a=t.signature.valueBlock.valueHex;if("ECDSA"===e.algorithm.name&&(a=B(g(a).result)),"RSA-PSS"===e.algorithm.name){var i=void 0;try{i=new Je({schema:t.signatureAlgorithm.algorithmParams})}catch(e){return Promise.reject(e)}r.algorithm.saltLength="saltLength"in i?i.saltLength:20;var s="SHA-1";if("hashAlgorithm"in i){var u=N(i.hashAlgorithm.algorithmId);if("name"in u==!1)return Promise.reject("Unrecognized hash algorithm: "+i.hashAlgorithm.algorithmId);s=u.name}r.algorithm.hash.name=s}return c.verify(r.algorithm,e,new Uint8Array(a),n)})}}],[{key:"defaultValues",value:function(e){switch(e){case"tbsResponseData":return new mr;case"signatureAlgorithm":return new Te;case"signature":return new se;case"certs":return[];default:throw new Error("Invalid member name for BasicOCSPResponse class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"type":var a=mr.compareWithDefault("tbs",r.tbs)&&mr.compareWithDefault("responderID",r.responderID)&&mr.compareWithDefault("producedAt",r.producedAt)&&mr.compareWithDefault("responses",r.responses);return"responseExtensions"in r&&(a=a&&mr.compareWithDefault("responseExtensions",r.responseExtensions)),a;case"signatureAlgorithm":return""===r.algorithmId&&"algorithmParams"in r==!1;case"signature":return r.isEqual(e.defaultValues(t));case"certs":return 0===r.length;default:throw new Error("Invalid member name for BasicOCSPResponse class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"BasicOCSPResponse",value:[mr.schema(e.tbsResponseData||{names:{blockName:"BasicOCSPResponse.tbsResponseData"}}),Te.schema(e.signatureAlgorithm||{names:{blockName:"BasicOCSPResponse.signatureAlgorithm"}}),new se({name:e.signature||"BasicOCSPResponse.signature"}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ee({value:[new Ue({name:"BasicOCSPResponse.certs",value:Vt.schema(e.certs||{})})]})]})]})}}]),e}(),yr=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.tbs=t(r,"tbs",e.defaultValues("tbs")),this.version=t(r,"version",e.defaultValues("version")),this.subject=t(r,"subject",e.defaultValues("subject")),this.subjectPublicKeyInfo=t(r,"subjectPublicKeyInfo",e.defaultValues("subjectPublicKeyInfo")),"attributes"in r&&(this.attributes=t(r,"attributes",e.defaultValues("attributes"))),this.signatureAlgorithm=t(r,"signatureAlgorithm",e.defaultValues("signatureAlgorithm")),this.signatureValue=t(r,"signatureValue",e.defaultValues("signatureValue")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema());if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PKCS10");this.tbs=r.result.CertificationRequestInfo.valueBeforeDecode,this.version=r.result["CertificationRequestInfo.version"].valueBlock.valueDec,this.subject=new et({schema:r.result["CertificationRequestInfo.subject"]}),this.subjectPublicKeyInfo=new Fe({schema:r.result["CertificationRequestInfo.subjectPublicKeyInfo"]}),"CertificationRequestInfo.attributes"in r.result&&(this.attributes=Array.from(r.result["CertificationRequestInfo.attributes"],function(e){return new Me({schema:e})})),this.signatureAlgorithm=new Te({schema:r.result.signatureAlgorithm}),this.signatureValue=r.result.signatureValue}},{key:"encodeTBS",value:function(){var e=[new ue({value:this.version}),this.subject.toSchema(),this.subjectPublicKeyInfo.toSchema()];return"attributes"in this&&e.push(new z({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.attributes,function(e){return e.toSchema()})})),new ee({value:e})}},{key:"toSchema",value:function(){var t=void 0;if(!1===(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){if(0===this.tbs.length)return e.schema();t=g(this.tbs).result}else t=this.encodeTBS();return new ee({value:[t,this.signatureAlgorithm.toSchema(),this.signatureValue]})}},{key:"toJSON",value:function(){var e={tbs:r(this.tbs,0,this.tbs.byteLength),version:this.version,subject:this.subject.toJSON(),subjectPublicKeyInfo:this.subjectPublicKeyInfo.toJSON(),signatureAlgorithm:this.signatureAlgorithm.toJSON(),signatureValue:this.signatureValue.toJSON()};return"attributes"in this&&(e.attributes=Array.from(this.attributes,function(e){return e.toJSON()})),e}},{key:"sign",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"SHA-1";if(void 0===e)return Promise.reject("Need to provide a private key for signing");if(""===C({name:r}))return Promise.reject("Unsupported hash algorithm: {$hashAlgorithm}");var a=S(e.algorithm.name,"sign");switch(a.algorithm.hash.name=r,e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":this.signatureAlgorithm.algorithmId=C(a.algorithm);break;case"RSA-PSS":switch(r.toUpperCase()){case"SHA-256":a.algorithm.saltLength=32;break;case"SHA-384":a.algorithm.saltLength=48;break;case"SHA-512":a.algorithm.saltLength=64}var n={};if("SHA-1"!==r.toUpperCase()){var i=C({name:r});if(""===i)return Promise.reject("Unsupported hash algorithm: "+r);n.hashAlgorithm=new Te({algorithmId:i,algorithmParams:new re}),n.maskGenAlgorithm=new Te({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:n.hashAlgorithm.toSchema()})}20!==a.algorithm.saltLength&&(n.saltLength=a.algorithm.saltLength);var s=new Je(n);this.signatureAlgorithm=new Te({algorithmId:"1.2.840.113549.1.1.10",algorithmParams:s.toSchema()});break;default:return Promise.reject("Unsupported signature algorithm: "+e.algorithm.name)}this.tbs=this.encodeTBS().toBER(!1);var o=b();return void 0===o?Promise.reject("Unable to create WebCrypto object"):o.sign(a.algorithm,e,new Uint8Array(this.tbs)).then(function(e){"ECDSA"===a.algorithm.name&&(e=A(e)),t.signatureValue=new se({valueHex:e})},function(e){return Promise.reject("Signing error: "+e)})}},{key:"verify",value:function(){var e=this,t=Promise.resolve(),r=this.subjectPublicKeyInfo,a=this.signatureValue,n=this.tbs,i=b();if(void 0===i)return Promise.reject("Unable to create WebCrypto object");var s=P(this.signatureAlgorithm);return""===s?Promise.reject("Unsupported signature algorithm: "+this.signatureAlgorithm.algorithmId):(t=t.then(function(){var t=void 0,a=N(t="1.2.840.113549.1.1.10"===e.signatureAlgorithm.algorithmId?e.signatureAlgorithm.algorithmId:e.subjectPublicKeyInfo.algorithm.algorithmId);if("name"in a==!1)return Promise.reject("Unsupported public key algorithm: "+t);var n=S(a.name,"importkey");if("hash"in n.algorithm&&(n.algorithm.hash.name=s),"ECDSA"===a.name){var o=!1;if("algorithmParams"in r.algorithm==!0&&"idBlock"in r.algorithm.algorithmParams&&1===r.algorithm.algorithmParams.idBlock.tagClass&&6===r.algorithm.algorithmParams.idBlock.tagNumber&&(o=!0),!1===o)return Promise.reject("Incorrect type for ECDSA public key parameters");var u=N(r.algorithm.algorithmParams.valueBlock.toString());if("name"in u==!1)return Promise.reject("Unsupported named curve algorithm: "+r.algorithm.algorithmParams.valueBlock.toString());n.algorithm.namedCurve=u.name}var l=r.toSchema().toBER(!1),c=new Uint8Array(l);return i.importKey("spki",c,n.algorithm,!0,n.usages)}),t=t.then(function(t){var r=S(t.algorithm.name,"verify");"hash"in r.algorithm&&(r.algorithm.hash.name=s);var o=a.valueBlock.valueHex;if("ECDSA"===t.algorithm.name&&(o=B(g(o).result)),"RSA-PSS"===t.algorithm.name){var u=void 0;try{u=new Je({schema:e.signatureAlgorithm.algorithmParams})}catch(e){return Promise.reject(e)}r.algorithm.saltLength="saltLength"in u?u.saltLength:20;var l="SHA-1";if("hashAlgorithm"in u){var c=N(u.hashAlgorithm.algorithmId);if("name"in c==!1)return Promise.reject("Unrecognized hash algorithm: "+u.hashAlgorithm.algorithmId);l=c.name}r.algorithm.hash.name=l}return i.verify(r.algorithm,t,new Uint8Array(o),new Uint8Array(n))}))}}],[{key:"defaultValues",value:function(e){switch(e){case"tbs":return new ArrayBuffer(0);case"version":return 0;case"subject":return new et;case"subjectPublicKeyInfo":return new Fe;case"attributes":return[];case"signatureAlgorithm":return new Te;case"signatureValue":return new se;default:throw new Error("Invalid member name for CertificationRequest class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({value:[K(e.certificationRequestInfo||{}),new ee({name:e.signatureAlgorithm||"signatureAlgorithm",value:[new me,new He({optional:!0})]}),new se({name:e.signatureValue||"signatureValue"})]})}}]),e}(),pr=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.digestAlgorithm=t(r,"digestAlgorithm",e.defaultValues("digestAlgorithm")),this.digest=t(r,"digest",e.defaultValues("digest")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{digestAlgorithm:{names:{blockName:"digestAlgorithm"}},digest:"digest"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for DigestInfo");this.digestAlgorithm=new Te({schema:r.result.digestAlgorithm}),this.digest=r.result.digest}},{key:"toSchema",value:function(){return new ee({value:[this.digestAlgorithm.toSchema(),this.digest]})}},{key:"toJSON",value:function(){return{digestAlgorithm:this.digestAlgorithm.toJSON(),digest:this.digest.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case"digestAlgorithm":return new Te;case"digest":return new ne;default:throw new Error("Invalid member name for DigestInfo class: "+e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"digestAlgorithm":return Te.compareWithDefault("algorithmId",t.algorithmId)&&"algorithmParams"in t==!1;case"digest":return t.isEqual(this.constructor.defaultValues(e));default:throw new Error("Invalid member name for DigestInfo class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[Te.schema(e.digestAlgorithm||{names:{blockName:"digestAlgorithm"}}),new ne({name:e.digest||"digest"})]})}}]),e}(),kr=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(_classCallCheck(this,e),this.eContentType=t(r,"eContentType",e.defaultValues("eContentType")),"eContent"in r&&(this.eContent=t(r,"eContent",e.defaultValues("eContent")),1===this.eContent.idBlock.tagClass&&4===this.eContent.idBlock.tagNumber&&!1===this.eContent.idBlock.isConstructed)){for(var a=new ne({idBlock:{isConstructed:!0},isConstructed:!0}),n=0,i=this.eContent.valueBlock.valueHex.byteLength;i>0;){for(var s=new Uint8Array(this.eContent.valueBlock.valueHex,n,n+65536>this.eContent.valueBlock.valueHex.byteLength?this.eContent.valueBlock.valueHex.byteLength-n:65536),o=new ArrayBuffer(s.length),u=new Uint8Array(o),l=0;l<u.length;l++)u[l]=s[l];a.valueBlock.value.push(new ne({valueHex:o})),i-=s.length,n+=s.length}this.eContent=a}"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{eContentType:"eContentType",eContent:"eContent"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for EncapsulatedContentInfo");this.eContentType=r.result.eContentType.valueBlock.toString(),"eContent"in r.result&&(this.eContent=r.result.eContent)}},{key:"toSchema",value:function(){var t=[];return t.push(new me({value:this.eContentType})),"eContent"in this&&!1===e.compareWithDefault("eContent",this.eContent)&&t.push(new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.eContent]})),new ee({value:t})}},{key:"toJSON",value:function(){var t={eContentType:this.eContentType};return"eContent"in this&&!1===e.compareWithDefault("eContent",this.eContent)&&(t.eContent=this.eContent.toJSON()),t}}],[{key:"defaultValues",value:function(e){switch(e){case"eContentType":return"";case"eContent":return new ne;default:throw new Error("Invalid member name for EncapsulatedContentInfo class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"eContentType":return""===r;case"eContent":return r.isEqual(e.defaultValues("eContent"));default:throw new Error("Invalid member name for EncapsulatedContentInfo class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new me({name:e.eContentType||""}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new He({name:e.eContent||""})]})]})}}]),e}(),br=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return _inherits(t,e),t}(Ze),wr=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.mac=t(r,"mac",e.defaultValues("mac")),this.macSalt=t(r,"macSalt",e.defaultValues("macSalt")),"iterations"in r&&(this.iterations=t(r,"iterations",e.defaultValues("iterations"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{mac:{names:{blockName:"mac"}},macSalt:"macSalt",iterations:"iterations"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for MacData");this.mac=new pr({schema:r.result.mac}),this.macSalt=r.result.macSalt,"iterations"in r.result&&(this.iterations=r.result.iterations.valueBlock.valueDec)}},{key:"toSchema",value:function(){var e=[this.mac.toSchema(),this.macSalt];return"iterations"in this&&e.push(new ue({value:this.iterations})),new ee({value:e})}},{key:"toJSON",value:function(){var e={mac:this.mac.toJSON(),macSalt:this.macSalt.toJSON()};return"iterations"in this&&(e.iterations=this.iterations.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case"mac":return new pr;case"macSalt":return new ne;case"iterations":return 1;default:throw new Error("Invalid member name for MacData class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"mac":return pr.compareWithDefault("digestAlgorithm",r.digestAlgorithm)&&pr.compareWithDefault("digest",r.digest);case"macSalt":return r.isEqual(e.defaultValues(t));case"iterations":return r===e.defaultValues(t);default:throw new Error("Invalid member name for MacData class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",optional:e.optional||!0,value:[pr.schema(e.mac||{names:{blockName:"mac"}}),new ne({name:e.macSalt||"macSalt"}),new ue({optional:!0,name:e.iterations||"iterations"})]})}}]),e}(),Cr=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.hashAlgorithm=t(r,"hashAlgorithm",e.defaultValues("hashAlgorithm")),this.hashedMessage=t(r,"hashedMessage",e.defaultValues("hashedMessage")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{hashAlgorithm:{names:{blockName:"hashAlgorithm"}},hashedMessage:"hashedMessage"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for MessageImprint");this.hashAlgorithm=new Te({schema:r.result.hashAlgorithm}),this.hashedMessage=r.result.hashedMessage}},{key:"toSchema",value:function(){return new ee({value:[this.hashAlgorithm.toSchema(),this.hashedMessage]})}},{key:"toJSON",value:function(){return{hashAlgorithm:this.hashAlgorithm.toJSON(),hashedMessage:this.hashedMessage.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case"hashAlgorithm":return new Te;case"hashedMessage":return new ne;default:throw new Error("Invalid member name for MessageImprint class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"hashAlgorithm":return""===r.algorithmId&&"algorithmParams"in r==!1;case"hashedMessage":return 0===r.isEqual(e.defaultValues(t));default:throw new Error("Invalid member name for MessageImprint class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[Te.schema(e.hashAlgorithm||{}),new ne({name:e.hashedMessage||""})]})}}]),e}(),Sr=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.reqCert=t(r,"reqCert",e.defaultValues("reqCert")),"singleRequestExtensions"in r&&(this.singleRequestExtensions=t(r,"singleRequestExtensions",e.defaultValues("singleRequestExtensions"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{reqCert:{names:{blockName:"reqCert"}},singleRequestExtensions:{names:{blockName:"singleRequestExtensions"}}}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for Request");this.reqCert=new cr({schema:r.result.reqCert}),"singleRequestExtensions"in r.result&&(this.singleRequestExtensions=Array.from(r.result.singleRequestExtensions.valueBlock.value,function(e){return new xt({schema:e})}))}},{key:"toSchema",value:function(){var e=[];return e.push(this.reqCert.toSchema()),"singleRequestExtensions"in this&&e.push(new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ee({value:Array.from(this.singleRequestExtensions,function(e){return e.toSchema()})})]})),new ee({value:e})}},{key:"toJSON",value:function(){var e={reqCert:this.reqCert.toJSON()};return"singleRequestExtensions"in this&&(e.singleRequestExtensions=Array.from(this.singleRequestExtensions,function(e){return e.toJSON()})),e}}],[{key:"defaultValues",value:function(e){switch(e){case"reqCert":return new cr;case"singleRequestExtensions":return[];default:throw new Error("Invalid member name for Request class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"reqCert":return r.isEqual(e.defaultValues(t));case"singleRequestExtensions":return 0===r.length;default:throw new Error("Invalid member name for Request class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[cr.schema(e.reqCert||{}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[xt.schema(e.extensions||{names:{blockName:e.singleRequestExtensions||""}})]})]})}}]),e}(),Ar=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.tbs=t(r,"tbs",e.defaultValues("tbs")),"version"in r&&(this.version=t(r,"version",e.defaultValues("version"))),"requestorName"in r&&(this.requestorName=t(r,"requestorName",e.defaultValues("requestorName"))),this.requestList=t(r,"requestList",e.defaultValues("requestList")),"requestExtensions"in r&&(this.requestExtensions=t(r,"requestExtensions",e.defaultValues("requestExtensions"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema());if(!1===r.verified)throw new Error("Object's schema was not verified against input data for TBSRequest");this.tbs=r.result.TBSRequest.valueBeforeDecode,"TBSRequest.version"in r.result&&(this.version=r.result["TBSRequest.version"].valueBlock.valueDec),"TBSRequest.requestorName"in r.result&&(this.requestorName=new tt({schema:r.result["TBSRequest.requestorName"]})),this.requestList=Array.from(r.result["TBSRequest.requests"],function(e){return new Sr({schema:e})}),"TBSRequest.requestExtensions"in r.result&&(this.requestExtensions=Array.from(r.result["TBSRequest.requestExtensions"].valueBlock.value,function(e){return new xt({schema:e})}))}},{key:"toSchema",value:function(){var t=void 0;if(!1===(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){if(0===this.tbs.byteLength)return e.schema();t=g(this.tbs).result}else{var r=[];"version"in this&&r.push(new z({idBlock:{tagClass:3,tagNumber:0},value:[new ue({value:this.version})]})),"requestorName"in this&&r.push(new z({idBlock:{tagClass:3,tagNumber:1},value:[this.requestorName.toSchema()]})),r.push(new ee({value:Array.from(this.requestList,function(e){return e.toSchema()})})),"requestExtensions"in this&&r.push(new z({idBlock:{tagClass:3,tagNumber:2},value:[new ee({value:Array.from(this.requestExtensions,function(e){return e.toSchema()})})]})),t=new ee({value:r})}return t}},{key:"toJSON",value:function(){var e={};return"version"in this&&(e.version=this.version),"requestorName"in this&&(e.requestorName=this.requestorName.toJSON()),e.requestList=Array.from(this.requestList,function(e){return e.toJSON()}),"requestExtensions"in this&&(e.requestExtensions=Array.from(this.requestExtensions,function(e){return e.toJSON()})),e}}],[{key:"defaultValues",value:function(e){switch(e){case"tbs":return new ArrayBuffer(0);case"version":return 0;case"requestorName":return new tt;case"requestList":case"requestExtensions":return[];default:throw new Error("Invalid member name for TBSRequest class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"tbs":return 0===r.byteLength;case"version":return r===e.defaultValues(t);case"requestorName":return r.type===tt.defaultValues("type")&&0===Object.keys(r.value).length;case"requestList":case"requestExtensions":return 0===r.length;default:throw new Error("Invalid member name for TBSRequest class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"TBSRequest",value:[new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ue({name:e.TBSRequestVersion||"TBSRequest.version"})]}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[tt.schema(e.requestorName||{names:{blockName:"TBSRequest.requestorName"}})]}),new ee({name:e.requestList||"TBSRequest.requestList",value:[new Ue({name:e.requests||"TBSRequest.requests",value:Sr.schema(e.requestNames||{})})]}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:2},value:[Ot.schema(e.extensions||{names:{blockName:e.requestExtensions||"TBSRequest.requestExtensions"}})]})]})}}]),e}(),Ir=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.signatureAlgorithm=t(r,"signatureAlgorithm",e.defaultValues("signatureAlgorithm")),this.signature=t(r,"signature",e.defaultValues("signature")),"certs"in r&&(this.certs=t(r,"certs",e.defaultValues("certs"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{signatureAlgorithm:{names:{blockName:"signatureAlgorithm"}},signature:"signature",certs:"certs"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for ocsp.Signature");this.signatureAlgorithm=new Te({schema:r.result.signatureAlgorithm}),this.signature=r.result.signature,"certs"in r.result&&(this.certs=Array.from(r.result.certs,function(e){return new Vt({schema:e})}))}},{key:"toSchema",value:function(){var e=[];return e.push(this.signatureAlgorithm.toSchema()),e.push(this.signature),"certs"in this&&e.push(new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ee({value:Array.from(this.certs,function(e){return e.toSchema()})})]})),new ee({value:e})}},{key:"toJSON",value:function(){var e={signatureAlgorithm:this.signatureAlgorithm.toJSON(),signature:this.signature.toJSON()};return"certs"in this&&(e.certs=Array.from(this.certs,function(e){return e.toJSON()})),e}}],[{key:"defaultValues",value:function(e){switch(e){case"signatureAlgorithm":return new Te;case"signature":return new se;case"certs":return[];default:throw new Error("Invalid member name for Signature class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"signatureAlgorithm":return""===r.algorithmId&&"algorithmParams"in r==!1;case"signature":return r.isEqual(e.defaultValues(t));case"certs":return 0===r.length;default:throw new Error("Invalid member name for Signature class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[Te.schema(e.signatureAlgorithm||{}),new se({name:e.signature||""}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new ee({value:[new Ue({name:e.certs||"",value:Vt.schema(e.certs||{})})]})]})]})}}]),e}(),Br=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.tbsRequest=t(r,"tbsRequest",e.defaultValues("tbsRequest")),"optionalSignature"in r&&(this.optionalSignature=t(r,"optionalSignature",e.defaultValues("optionalSignature"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema());if(!1===r.verified)throw new Error("Object's schema was not verified against input data for OCSP_REQUEST");this.tbsRequest=new Ar({schema:r.result.tbsRequest}),"optionalSignature"in r.result&&(this.optionalSignature=new Ir({schema:r.result.optionalSignature}))}},{key:"toSchema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=[];return t.push(this.tbsRequest.toSchema(e)),"optionalSignature"in this&&t.push(this.optionalSignature.toSchema()),new ee({value:t})}},{key:"toJSON",value:function(){var e={tbsRequest:this.tbsRequest.toJSON()};return"optionalSignature"in this&&(e.optionalSignature=this.optionalSignature.toJSON()),e}},{key:"createForCertificate",value:function(e,t){var r=this,a=Promise.resolve(),n=new cr;return a=a.then(function(){return n.createForCertificate(e,t)}),a=a.then(function(){r.tbsRequest=new Ar({requestList:[new Sr({reqCert:n})]})},function(e){return Promise.reject(e)})}},{key:"sign",value:function(e,t){var r=this;if(void 0===e)return Promise.reject("Need to provide a private key for signing");if(void 0===t)t="SHA-1";else if(""===C({name:t}))return Promise.reject("Unsupported hash algorithm: "+t);if("optionalSignature"in this==!1)return Promise.reject('Need to create "optionalSignature" field before signing');var a=S(e.algorithm.name,"sign");switch(a.algorithm.hash.name=t,e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":this.optionalSignature.signatureAlgorithm.algorithmId=C(a.algorithm);break;case"RSA-PSS":switch(t.toUpperCase()){case"SHA-256":a.algorithm.saltLength=32;break;case"SHA-384":a.algorithm.saltLength=48;break;case"SHA-512":a.algorithm.saltLength=64}var n={};if("SHA-1"!==t.toUpperCase()){var i=C({name:t});if(""===i)return Promise.reject("Unsupported hash algorithm: "+t);n.hashAlgorithm=new Te({algorithmId:i,algorithmParams:new re}),n.maskGenAlgorithm=new Te({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:n.hashAlgorithm.toSchema()})}20!==a.algorithm.saltLength&&(n.saltLength=a.algorithm.saltLength);var s=new Je(n);this.optionalSignature.signatureAlgorithm=new Te({algorithmId:"1.2.840.113549.1.1.10",algorithmParams:s.toSchema()});break;default:return Promise.reject("Unsupported signature algorithm: "+e.algorithm.name)}var o=this.tbsRequest.toSchema(!0).toBER(!1),u=b();return void 0===u?Promise.reject("Unable to create WebCrypto object"):u.sign(a.algorithm,e,new Uint8Array(o)).then(function(e){"ECDSA"===a.algorithm.name&&(e=A(e)),r.optionalSignature.signature=new se({valueHex:e})},function(e){return Promise.reject("Signing error: "+e)})}},{key:"verify",value:function(){}}],[{key:"defaultValues",value:function(e){switch(e){case"tbsRequest":return new Ar;case"optionalSignature":return new Ir;default:throw new Error("Invalid member name for OCSPRequest class: "+e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"tbsRequest":return Ar.compareWithDefault("tbs",t.tbs)&&Ar.compareWithDefault("version",t.version)&&Ar.compareWithDefault("requestorName",t.requestorName)&&Ar.compareWithDefault("requestList",t.requestList)&&Ar.compareWithDefault("requestExtensions",t.requestExtensions);case"optionalSignature":return Ir.compareWithDefault("signatureAlgorithm",t.signatureAlgorithm)&&Ir.compareWithDefault("signature",t.signature)&&Ir.compareWithDefault("certs",t.certs);default:throw new Error("Invalid member name for OCSPRequest class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"OCSPRequest",value:[Ar.schema(e.tbsRequest||{names:{blockName:"tbsRequest"}}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Ir.schema(e.optionalSignature||{names:{blockName:"optionalSignature"}})]})]})}}]),e}(),Nr=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.responseType=t(r,"responseType",e.defaultValues("responseType")),this.response=t(r,"response",e.defaultValues("response")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{responseType:"responseType",response:"response"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for ResponseBytes");this.responseType=r.result.responseType.valueBlock.toString(),this.response=r.result.response}},{key:"toSchema",value:function(){return new ee({value:[new me({value:this.responseType}),this.response]})}},{key:"toJSON",value:function(){return{responseType:this.responseType,response:this.response.toJSON()}}}],[{key:"defaultValues",value:function(e){switch(e){case"responseType":return"";case"response":return new ne;default:throw new Error("Invalid member name for ResponseBytes class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"responseType":return""===r;case"response":return r.isEqual(e.defaultValues(t));default:throw new Error("Invalid member name for ResponseBytes class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new me({name:e.responseType||""}),new ne({name:e.response||""})]})}}]),e}(),Pr=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.responseStatus=t(r,"responseStatus",e.defaultValues("responseStatus")),"responseBytes"in r&&(this.responseBytes=t(r,"responseBytes",e.defaultValues("responseBytes"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema());if(!1===r.verified)throw new Error("Object's schema was not verified against input data for OCSP_RESPONSE");this.responseStatus=r.result.responseStatus,"responseBytes"in r.result&&(this.responseBytes=new Nr({schema:r.result.responseBytes}))}},{key:"toSchema",value:function(){var e=[];return e.push(this.responseStatus),"responseBytes"in this&&e.push(new z({idBlock:{tagClass:3,tagNumber:0},value:[this.responseBytes.toSchema()]})),new ee({value:e})}},{key:"toJSON",value:function(){var e={responseStatus:this.responseStatus.toJSON()};return"responseBytes"in this&&(e.responseBytes=this.responseBytes.toJSON()),e}},{key:"getCertificateStatus",value:function(e,t){var r=void 0,a={isForCertificate:!1,status:2};if("responseBytes"in this==!1)return a;if("1.3.6.1.5.5.7.48.1.1"!==this.responseBytes.responseType)return a;try{var n=g(this.responseBytes.response.valueBlock.valueHex);r=new gr({schema:n.result})}catch(e){return a}return r.getCertificateStatus(e,t)}},{key:"sign",value:function(e,t){if("1.3.6.1.5.5.7.48.1.1"===this.responseBytes.responseType){var r=g(this.responseBytes.response.valueBlock.valueHex);return new gr({schema:r.result}).sign(e,t)}return Promise.reject("Unknown ResponseBytes type: "+this.responseBytes.responseType)}},{key:"verify",value:function(){if("responseBytes"in this==!1)return Promise.reject("Empty ResponseBytes field");if("1.3.6.1.5.5.7.48.1.1"===this.responseBytes.responseType){var e=g(this.responseBytes.response.valueBlock.valueHex);return new gr({schema:e.result}).verify()}return Promise.reject("Unknown ResponseBytes type: "+this.responseBytes.responseType)}}],[{key:"defaultValues",value:function(e){switch(e){case"responseStatus":return new le;case"responseBytes":return new Nr;default:throw new Error("Invalid member name for OCSPResponse class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"responseStatus":return r.isEqual(e.defaultValues(t));case"responseBytes":return Nr.compareWithDefault("responseType",r.responseType)&&Nr.compareWithDefault("response",r.response);default:throw new Error("Invalid member name for OCSPResponse class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"OCSPResponse",value:[new le({name:e.responseStatus||"responseStatus"}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[Nr.schema(e.responseBytes||{names:{blockName:"responseBytes"}})]})]})}}]),e}(),Er=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.otherCertFormat=t(r,"otherCertFormat",e.defaultValues("otherCertFormat")),this.otherCert=t(r,"otherCert",e.defaultValues("otherCert")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema());if(!1===r.verified)throw new Error("Object's schema was not verified against input data for OtherCertificateFormat");this.otherCertFormat=r.result.otherCertFormat.valueBlock.toString(),this.otherCert=r.result.otherCert}},{key:"toSchema",value:function(){return new ee({value:[new me({value:this.otherCertFormat}),this.otherCert]})}},{key:"toJSON",value:function(){var e={otherCertFormat:this.otherCertFormat};return this.otherCert instanceof He||(e.otherCert=this.otherCert.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case"otherCertFormat":return"";case"otherCert":return new He;default:throw new Error("Invalid member name for OtherCertificateFormat class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new me({name:e.otherCertFormat||"otherCertFormat"}),new He({name:e.otherCert||"otherCert"})]})}}]),e}(),xr=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.type=t(r,"type",e.defaultValues("type")),this.attributes=t(r,"attributes",e.defaultValues("attributes")),this.encodedValue=t(r,"encodedValue",e.defaultValues("encodedValue")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{tagNumber:this.type,attributes:"attributes"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for SignedUnsignedAttributes");if(this.type=r.result.idBlock.tagNumber,this.encodedValue=r.result.valueBeforeDecode,new Uint8Array(this.encodedValue)[0]=49,"attributes"in r.result!=!1)this.attributes=Array.from(r.result.attributes,function(e){return new Me({schema:e})});else if(0===this.type)throw new Error("Wrong structure of SignedUnsignedAttributes")}},{key:"toSchema",value:function(){if(e.compareWithDefault("type",this.type)||e.compareWithDefault("attributes",this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return new z({optional:!0,idBlock:{tagClass:3,tagNumber:this.type},value:Array.from(this.attributes,function(e){return e.toSchema()})})}},{key:"toJSON",value:function(){if(e.compareWithDefault("type",this.type)||e.compareWithDefault("attributes",this.attributes))throw new Error('Incorrectly initialized "SignedAndUnsignedAttributes" class');return{type:this.type,attributes:Array.from(this.attributes,function(e){return e.toJSON()})}}}],[{key:"defaultValues",value:function(e){switch(e){case"type":return-1;case"attributes":return[];case"encodedValue":return new ArrayBuffer(0);default:throw new Error("Invalid member name for SignedAndUnsignedAttributes class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"type":return r===e.defaultValues("type");case"attributes":return 0===r.length;case"encodedValue":return 0===r.byteLength;default:throw new Error("Invalid member name for SignedAndUnsignedAttributes class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new z({name:e.blockName||"",optional:!0,idBlock:{tagClass:3,tagNumber:e.tagNumber},value:[new Ue({name:e.attributes||"",value:Me.schema()})]})}}]),e}(),Or=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.version=t(r,"version",e.defaultValues("version")),this.sid=t(r,"sid",e.defaultValues("sid")),this.digestAlgorithm=t(r,"digestAlgorithm",e.defaultValues("digestAlgorithm")),"signedAttrs"in r&&(this.signedAttrs=t(r,"signedAttrs",e.defaultValues("signedAttrs"))),this.signatureAlgorithm=t(r,"signatureAlgorithm",e.defaultValues("signatureAlgorithm")),this.signature=t(r,"signature",e.defaultValues("signature")),"unsignedAttrs"in r&&(this.unsignedAttrs=t(r,"unsignedAttrs",e.defaultValues("unsignedAttrs"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema());if(!1===r.verified)throw new Error("Object's schema was not verified against input data for CMS_SIGNER_INFO");this.version=r.result["SignerInfo.version"].valueBlock.valueDec;var a=r.result["SignerInfo.sid"];1===a.idBlock.tagClass?this.sid=new Wt({schema:a}):this.sid=a,this.digestAlgorithm=new Te({schema:r.result["SignerInfo.digestAlgorithm"]}),"SignerInfo.signedAttrs"in r.result&&(this.signedAttrs=new xr({type:0,schema:r.result["SignerInfo.signedAttrs"]})),this.signatureAlgorithm=new Te({schema:r.result["SignerInfo.signatureAlgorithm"]}),this.signature=r.result["SignerInfo.signature"],"SignerInfo.unsignedAttrs"in r.result&&(this.unsignedAttrs=new xr({type:1,schema:r.result["SignerInfo.unsignedAttrs"]}))}},{key:"toSchema",value:function(){if(e.compareWithDefault("sid",this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');var t=[];return t.push(new ue({value:this.version})),this.sid instanceof Wt?t.push(this.sid.toSchema()):t.push(this.sid),t.push(this.digestAlgorithm.toSchema()),"signedAttrs"in this&&!1===e.compareWithDefault("signedAttrs",this.signedAttrs)&&t.push(this.signedAttrs.toSchema()),t.push(this.signatureAlgorithm.toSchema()),t.push(this.signature),"unsignedAttrs"in this&&!1===e.compareWithDefault("unsignedAttrs",this.unsignedAttrs)&&t.push(this.unsignedAttrs.toSchema()),new ee({value:t})}},{key:"toJSON",value:function(){if(e.compareWithDefault("sid",this.sid))throw new Error('Incorrectly initialized "SignerInfo" class');var t={version:this.version};return this.sid instanceof He||(t.sid=this.sid.toJSON()),t.digestAlgorithm=this.digestAlgorithm.toJSON(),!1===e.compareWithDefault("signedAttrs",this.signedAttrs)&&(t.signedAttrs=this.signedAttrs.toJSON()),t.signatureAlgorithm=this.signatureAlgorithm.toJSON(),t.signature=this.signature.toJSON(),!1===e.compareWithDefault("unsignedAttrs",this.unsignedAttrs)&&(t.unsignedAttrs=this.unsignedAttrs.toJSON()),t}}],[{key:"defaultValues",value:function(e){switch(e){case"version":return 0;case"sid":return new He;case"digestAlgorithm":return new Te;case"signedAttrs":return new xr({type:0});case"signatureAlgorithm":return new Te;case"signature":return new ne;case"unsignedAttrs":return new xr({type:1});default:throw new Error("Invalid member name for SignerInfo class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"version":return e.defaultValues("version")===r;case"sid":return r instanceof He;case"digestAlgorithm":return r instanceof Te!=!1&&r.isEqual(e.defaultValues("digestAlgorithm"));case"signedAttrs":return xr.compareWithDefault("type",r.type)&&xr.compareWithDefault("attributes",r.attributes)&&xr.compareWithDefault("encodedValue",r.encodedValue);case"signatureAlgorithm":return r instanceof Te!=!1&&r.isEqual(e.defaultValues("signatureAlgorithm"));case"signature":case"unsignedAttrs":return xr.compareWithDefault("type",r.type)&&xr.compareWithDefault("attributes",r.attributes)&&xr.compareWithDefault("encodedValue",r.encodedValue);default:throw new Error("Invalid member name for SignerInfo class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:"SignerInfo",value:[new ue({name:e.version||"SignerInfo.version"}),new Ke({value:[Wt.schema(e.sid||{names:{blockName:"SignerInfo.sid"}}),new z({optional:!0,name:e.sid||"SignerInfo.sid",idBlock:{tagClass:3,tagNumber:0},value:[new ne]})]}),Te.schema(e.digestAlgorithm||{names:{blockName:"SignerInfo.digestAlgorithm"}}),xr.schema(e.signedAttrs||{names:{blockName:"SignerInfo.signedAttrs",tagNumber:0}}),Te.schema(e.signatureAlgorithm||{names:{blockName:"SignerInfo.signatureAlgorithm"}}),new ne({name:e.signature||"SignerInfo.signature"}),xr.schema(e.unsignedAttrs||{names:{blockName:"SignerInfo.unsignedAttrs",tagNumber:1}})]})}}]),e}(),Vr=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.version=t(r,"version",e.defaultValues("version")),this.policy=t(r,"policy",e.defaultValues("policy")),this.messageImprint=t(r,"messageImprint",e.defaultValues("messageImprint")),this.serialNumber=t(r,"serialNumber",e.defaultValues("serialNumber")),this.genTime=t(r,"genTime",e.defaultValues("genTime")),"accuracy"in r&&(this.accuracy=t(r,"accuracy",e.defaultValues("accuracy"))),"ordering"in r&&(this.ordering=t(r,"ordering",e.defaultValues("ordering"))),"nonce"in r&&(this.nonce=t(r,"nonce",e.defaultValues("nonce"))),"tsa"in r&&(this.tsa=t(r,"tsa",e.defaultValues("tsa"))),"extensions"in r&&(this.extensions=t(r,"extensions",e.defaultValues("extensions"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema());if(!1===r.verified)throw new Error("Object's schema was not verified against input data for TST_INFO");this.version=r.result["TSTInfo.version"].valueBlock.valueDec,this.policy=r.result["TSTInfo.policy"].valueBlock.toString(),this.messageImprint=new Cr({schema:r.result["TSTInfo.messageImprint"]}),this.serialNumber=r.result["TSTInfo.serialNumber"],this.genTime=r.result["TSTInfo.genTime"].toDate(),"TSTInfo.accuracy"in r.result&&(this.accuracy=new at({schema:r.result["TSTInfo.accuracy"]})),"TSTInfo.ordering"in r.result&&(this.ordering=r.result["TSTInfo.ordering"].valueBlock.value),"TSTInfo.nonce"in r.result&&(this.nonce=r.result["TSTInfo.nonce"]),"TSTInfo.tsa"in r.result&&(this.tsa=new tt({schema:r.result["TSTInfo.tsa"]})),"TSTInfo.extensions"in r.result&&(this.extensions=Array.from(r.result["TSTInfo.extensions"],function(e){return new xt({schema:e})}))}},{key:"toSchema",value:function(){var e=[];return e.push(new ue({value:this.version})),e.push(new me({value:this.policy})),e.push(this.messageImprint.toSchema()),e.push(this.serialNumber),e.push(new Oe({valueDate:this.genTime})),"accuracy"in this&&e.push(this.accuracy.toSchema()),"ordering"in this&&e.push(new Y({value:this.ordering})),"nonce"in this&&e.push(this.nonce),"tsa"in this&&e.push(new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[this.tsa.toSchema()]})),"extensions"in this&&e.push(new z({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.extensions,function(e){return e.toSchema()})})),new ee({value:e})}},{key:"toJSON",value:function(){var e={version:this.version,policy:this.policy,messageImprint:this.messageImprint.toJSON(),serialNumber:this.serialNumber.toJSON(),genTime:this.genTime};return"accuracy"in this&&(e.accuracy=this.accuracy.toJSON()),"ordering"in this&&(e.ordering=this.ordering),"nonce"in this&&(e.nonce=this.nonce.toJSON()),"tsa"in this&&(e.tsa=this.tsa.toJSON()),"extensions"in this&&(e.extensions=Array.from(this.extensions,function(e){return e.toJSON()})),e}},{key:"verify",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=Promise.resolve(),a=void 0,n=b();if(void 0===n)return Promise.reject("Unable to create WebCrypto object");if(!("data"in t))return Promise.reject('"data" is a mandatory attribute for TST_INFO verification');a=t.data,"notBefore"in t&&t.notBefore,"notAfter"in t&&t.notAfter;var i=N(this.messageImprint.hashAlgorithm.algorithmId);return"name"in i==!1?Promise.reject("Unsupported signature algorithm: "+this.messageImprint.hashAlgorithm.algorithmId):r=r.then(function(){return n.digest(i.name,new Uint8Array(a))}).then(function(t){return l(t,e.messageImprint.hashedMessage.valueBlock.valueHex)})}}],[{key:"defaultValues",value:function(e){switch(e){case"version":return 0;case"policy":return"";case"messageImprint":return new Cr;case"serialNumber":return new ue;case"genTime":return new Date(0,0,0);case"accuracy":return new at;case"ordering":return!1;case"nonce":return new ue;case"tsa":return new tt;case"extensions":return[];default:throw new Error("Invalid member name for TSTInfo class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"version":case"policy":case"genTime":case"ordering":return r===e.defaultValues(t);case"messageImprint":return Cr.compareWithDefault("hashAlgorithm",r.hashAlgorithm)&&Cr.compareWithDefault("hashedMessage",r.hashedMessage);case"serialNumber":case"nonce":return r.isEqual(e.defaultValues(t));case"accuracy":return at.compareWithDefault("seconds",r.seconds)&&at.compareWithDefault("millis",r.millis)&&at.compareWithDefault("micros",r.micros);case"tsa":return tt.compareWithDefault("type",r.type)&&tt.compareWithDefault("value",r.value);case"extensions":return 0===r.length;default:throw new Error("Invalid member name for TSTInfo class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"TSTInfo",value:[new ue({name:e.version||"TSTInfo.version"}),new me({name:e.policy||"TSTInfo.policy"}),Cr.schema(e.messageImprint||{names:{blockName:"TSTInfo.messageImprint"}}),new ue({name:e.serialNumber||"TSTInfo.serialNumber"}),new Oe({name:e.genTime||"TSTInfo.genTime"}),at.schema(e.accuracy||{names:{blockName:"TSTInfo.accuracy"}}),new Y({name:e.ordering||"TSTInfo.ordering",optional:!0}),new ue({name:e.nonce||"TSTInfo.nonce",optional:!0}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[tt.schema(e.tsa||{names:{blockName:"TSTInfo.tsa"}})]}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:[new Ue({name:e.extensions||"TSTInfo.extensions",value:xt.schema(e.extension||{})})]})]})}}]),e}(),_r=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.version=t(r,"version",e.defaultValues("version")),this.digestAlgorithms=t(r,"digestAlgorithms",e.defaultValues("digestAlgorithms")),this.encapContentInfo=t(r,"encapContentInfo",e.defaultValues("encapContentInfo")),"certificates"in r&&(this.certificates=t(r,"certificates",e.defaultValues("certificates"))),"crls"in r&&(this.crls=t(r,"crls",e.defaultValues("crls"))),this.signerInfos=t(r,"signerInfos",e.defaultValues("signerInfos")),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema());if(!1===r.verified)throw new Error("Object's schema was not verified against input data for CMS_SIGNED_DATA");this.version=r.result["SignedData.version"].valueBlock.valueDec,"SignedData.digestAlgorithms"in r.result&&(this.digestAlgorithms=Array.from(r.result["SignedData.digestAlgorithms"],function(e){return new Te({schema:e})})),this.encapContentInfo=new kr({schema:r.result["SignedData.encapContentInfo"]}),"SignedData.certificates"in r.result&&(this.certificates=Array.from(r.result["SignedData.certificates"],function(e){return 1===e.idBlock.tagClass?new Vt({schema:e}):3===e.idBlock.tagClass&&3===e.idBlock.tagNumber?(e.idBlock.tagClass=1,e.idBlock.tagNumber=16,new Er({schema:e})):new Vt})),"SignedData.crls"in r.result&&(this.crls=Array.from(r.result["SignedData.crls"],function(e){return 1===e.idBlock.tagClass?new Dt({schema:e}):(e.idBlock.tagClass=1,e.idBlock.tagNumber=16,new Tt({schema:e}))})),"SignedData.signerInfos"in r.result&&(this.signerInfos=Array.from(r.result["SignedData.signerInfos"],function(e){return new Or({schema:e})}))}},{key:"toSchema",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=[];return t.push(new ue({value:this.version})),t.push(new te({value:Array.from(this.digestAlgorithms,function(t){return t.toSchema(e)})})),t.push(this.encapContentInfo.toSchema()),"certificates"in this&&t.push(new z({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.certificates,function(t){if(t instanceof Er){var r=t.toSchema(e);return r.idBlock.tagClass=3,r.idBlock.tagNumber=3,r}return t.toSchema(e)})})),"crls"in this&&t.push(new z({idBlock:{tagClass:3,tagNumber:1},value:Array.from(this.crls,function(t){if(t instanceof Tt){var r=t.toSchema(e);return r.idBlock.tagClass=3,r.idBlock.tagNumber=1,r}return t.toSchema(e)})})),t.push(new te({value:Array.from(this.signerInfos,function(t){return t.toSchema(e)})})),new ee({value:t})}},{key:"toJSON",value:function(){var e={version:this.version,digestAlgorithms:Array.from(this.digestAlgorithms,function(e){return e.toJSON()}),encapContentInfo:this.encapContentInfo.toJSON()};return"certificates"in this&&(e.certificates=Array.from(this.certificates,function(e){return e.toJSON()})),"crls"in this&&(e.crls=Array.from(this.crls,function(e){return e.toJSON()})),e.signerInfos=Array.from(this.signerInfos,function(e){return e.toJSON()}),e}},{key:"verify",value:function(){function e(e){if(!0===e.issuer.isEqual(A.issuer)&&!0===e.serialNumber.isEqual(A.serialNumber))return null;var t=!1,r=!0,a=!1,n=void 0;try{for(var i,s=e.extensions[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var o=i.value;"2.5.29.19"===o.extnID&&"cA"in o.parsedValue&&!0===o.parsedValue.cA&&(t=!0)}}catch(e){a=!0,n=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw n}}return t?e:null}var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=r.signer,n=void 0===a?-1:a,i=r.data,o=void 0===i?new ArrayBuffer(0):i,u=r.trustedCerts,c=void 0===u?[]:u,h=r.checkDate,m=void 0===h?new Date:h,f=r.checkChain,v=void 0!==f&&f,d=(r.includeSignerCertificate,r.extendedMode),y=void 0!==d&&d,p=Promise.resolve(),k=new ArrayBuffer(0),w=void 0,C="",A={},I=b();return void 0===I?Promise.reject("Unable to create WebCrypto object"):-1===n?y?Promise.reject({date:m,code:1,message:"Unable to get signer index from input parameters",signatureVerified:null,signerCertificate:null,signerCertificateVerified:null}):Promise.reject("Unable to get signer index from input parameters"):"certificates"in this==!1?y?Promise.reject({date:m,code:2,message:"No certificates attached to this signed data",signatureVerified:null,signerCertificate:null,signerCertificateVerified:null}):Promise.reject("No certificates attached to this signed data"):(p=this.signerInfos[n].sid instanceof Wt?p.then(function(){var e=!0,r=!1,a=void 0;try{for(var i,s=t.certificates[Symbol.iterator]();!(e=(i=s.next()).done);e=!0){var o=i.value;if(o instanceof Vt!=!1&&(o.issuer.isEqual(t.signerInfos[n].sid.issuer)&&o.serialNumber.isEqual(t.signerInfos[n].sid.serialNumber)))return A=o,Promise.resolve()}}catch(e){r=!0,a=e}finally{try{!e&&s.return&&s.return()}finally{if(r)throw a}}return y?Promise.reject({date:m,code:3,message:"Unable to find signer certificate",signatureVerified:null,signerCertificate:null,signerCertificateVerified:null}):Promise.reject("Unable to find signer certificate")}):p.then(function(){return Promise.all(Array.from(t.certificates.filter(function(e){return e instanceof Vt}),function(e){return I.digest({name:"sha-1"},new Uint8Array(e.subjectPublicKeyInfo.subjectPublicKey.valueBlock.valueHex))})).then(function(e){var r=!0,a=!1,i=void 0;try{for(var s,o=t.certificates.entries()[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var u=_slicedToArray(s.value,2),c=u[0],h=u[1];if(h instanceof Vt!=!1&&l(e[c],t.signerInfos[n].sid.valueBlock.valueHex))return A=h,Promise.resolve()}}catch(e){a=!0,i=e}finally{try{!r&&o.return&&o.return()}finally{if(a)throw i}}return y?Promise.reject({date:m,code:3,message:"Unable to find signer certificate",signatureVerified:null,signerCertificate:null,signerCertificateVerified:null}):Promise.reject("Unable to find signer certificate")},function(){return y?Promise.reject({date:m,code:3,message:"Unable to find signer certificate",signatureVerified:null,signerCertificate:null,signerCertificateVerified:null}):Promise.reject("Unable to find signer certificate")})}),p=p.then(function(){if("1.2.840.113549.1.9.16.1.4"===t.encapContentInfo.eContentType){if("eContent"in t.encapContentInfo==!1)return!1;var e=g(t.encapContentInfo.eContent.valueBlock.valueHex),r=void 0;try{r=new Vr({schema:e.result})}catch(e){return!1}return 0===o.byteLength?y?Promise.reject({date:m,code:4,message:"Missed detached data input array",signatureVerified:null,signerCertificate:A,signerCertificateVerified:null}):Promise.reject("Missed detached data input array"):r.verify({data:o})}return!0}),v&&(p=p.then(function(r){return!1!==r&&Promise.all(Array.from(t.certificates.filter(function(e){return e instanceof Vt}),function(t){return e(t)})).then(function(e){var r,a=new dr({checkDate:m,certs:Array.from(e.filter(function(e){return null!==e})),trustedCerts:c});if(a.certs.push(A),"crls"in t){var n=!0,i=!1,s=void 0;try{for(var o,u=t.crls[Symbol.iterator]();!(n=(o=u.next()).done);n=!0){var l=o.value;l instanceof Dt?a.crls.push(l):"1.3.6.1.5.5.7.48.1.1"===l.otherRevInfoFormat&&a.ocsps.push(new gr({schema:l.otherRevInfo}))}}catch(e){i=!0,s=e}finally{try{!n&&u.return&&u.return()}finally{if(i)throw s}}}return"ocsps"in t&&(r=a.ocsps).push.apply(r,_toConsumableArray(t.ocsps)),a.verify().then(function(e){return!0===e.result?Promise.resolve(!0):y?Promise.reject({date:m,code:5,message:"Validation of signer's certificate failed: "+e.resultMessage,signatureVerified:null,signerCertificate:A,signerCertificateVerified:!1}):Promise.reject("Validation of signer's certificate failed")},function(e){return y?Promise.reject({date:m,code:5,message:"Validation of signer's certificate failed with error: "+(e instanceof Object?e.resultMessage:e),signatureVerified:null,signerCertificate:A,signerCertificateVerified:!1}):Promise.reject("Validation of signer's certificate failed with error: "+(e instanceof Object?e.resultMessage:e))})},function(e){return y?Promise.reject({date:m,code:6,message:"Error during checking certificates for CA flag: "+e,signatureVerified:null,signerCertificate:A,signerCertificateVerified:null}):Promise.reject("Error during checking certificates for CA flag: "+e)})})),p=p.then(function(e){if(!1===e)return!1;var r=N(t.signerInfos[n].digestAlgorithm.algorithmId);return"name"in r==!1?y?Promise.reject({date:m,code:7,message:"Unsupported signature algorithm: "+t.signerInfos[n].digestAlgorithm.algorithmId,signatureVerified:null,signerCertificate:A,signerCertificateVerified:!0}):Promise.reject("Unsupported signature algorithm: "+t.signerInfos[n].digestAlgorithm.algorithmId):(C=r.name,!0)}),p=p.then(function(e){if(!1===e)return!1;if("eContent"in t.encapContentInfo)if(1===t.encapContentInfo.eContent.idBlock.tagClass&&4===t.encapContentInfo.eContent.idBlock.tagNumber)if(!1===t.encapContentInfo.eContent.idBlock.isConstructed)o=t.encapContentInfo.eContent.valueBlock.valueHex;else{var r=!0,a=!1,i=void 0;try{for(var u,l=t.encapContentInfo.eContent.valueBlock.value[Symbol.iterator]();!(r=(u=l.next()).done);r=!0){var c=u.value;o=s(o,c.valueBlock.valueHex)}}catch(e){a=!0,i=e}finally{try{!r&&l.return&&l.return()}finally{if(a)throw i}}}else o=t.encapContentInfo.eContent.valueBlock.valueHex;else if(0===o.byteLength)return y?Promise.reject({date:m,code:8,message:"Missed detached data input array",signatureVerified:null,signerCertificate:A,signerCertificateVerified:!0}):Promise.reject("Missed detached data input array");if("signedAttrs"in t.signerInfos[n]){var h=!1,f=!1,v=!0,d=!1,g=void 0;try{for(var p,b=t.signerInfos[n].signedAttrs.attributes[Symbol.iterator]();!(v=(p=b.next()).done);v=!0){var w=p.value;if("1.2.840.113549.1.9.3"===w.type&&(h=!0),"1.2.840.113549.1.9.4"===w.type&&(f=!0,k=w.values[0].valueBlock.valueHex),h&&f)break}}catch(e){d=!0,g=e}finally{try{!v&&b.return&&b.return()}finally{if(d)throw g}}if(!1===h)return y?Promise.reject({date:m,code:9,message:'Attribute "content-type" is a mandatory attribute for "signed attributes"',signatureVerified:null,signerCertificate:A,signerCertificateVerified:!0}):Promise.reject('Attribute "content-type" is a mandatory attribute for "signed attributes"');if(!1===f)return y?Promise.reject({date:m,code:10,message:'Attribute "message-digest" is a mandatory attribute for "signed attributes"',signatureVerified:null,signerCertificate:A,signerCertificateVerified:!0}):Promise.reject('Attribute "message-digest" is a mandatory attribute for "signed attributes"')}return!0}),p=p.then(function(e){if(!1===e)return!1;var t=void 0,r=N(t="1.2.840.113549.1.1.10"===A.signatureAlgorithm.algorithmId?A.signatureAlgorithm.algorithmId:A.subjectPublicKeyInfo.algorithm.algorithmId);if("name"in r==!1)return y?Promise.reject({date:m,code:11,message:"Unsupported public key algorithm: "+t,signatureVerified:null,signerCertificate:A,signerCertificateVerified:!0}):Promise.reject("Unsupported public key algorithm: "+t);var a=S(r.name,"importkey");if("hash"in a.algorithm&&(a.algorithm.hash.name=C),"ECDSA"===r.name){var n=!1;if("algorithmParams"in A.subjectPublicKeyInfo.algorithm==!0&&"idBlock"in A.subjectPublicKeyInfo.algorithm.algorithmParams&&1===A.subjectPublicKeyInfo.algorithm.algorithmParams.idBlock.tagClass&&6===A.subjectPublicKeyInfo.algorithm.algorithmParams.idBlock.tagNumber&&(n=!0),!1===n)return Promise.reject("Incorrect type for ECDSA public key parameters");var i=N(A.subjectPublicKeyInfo.algorithm.algorithmParams.valueBlock.toString());if("name"in i==!1)return Promise.reject("Unsupported named curve algorithm: "+A.subjectPublicKeyInfo.algorithm.algorithmParams.valueBlock.toString());a.algorithm.namedCurve=i.name}var s=A.subjectPublicKeyInfo.toSchema().toBER(!1),o=new Uint8Array(s);return I.importKey("spki",o,a.algorithm,!0,a.usages)}),p=p.then(function(e){return"boolean"!=typeof e&&(w=e,!("signedAttrs"in t.signerInfos[n])||I.digest(C,new Uint8Array(o)))}).then(function(e){return!1!==e&&(!("signedAttrs"in t.signerInfos[n])||!!l(e,k)&&(o=t.signerInfos[n].signedAttrs.encodedValue,!0))}).then(function(e){if(!1===e)return!1;var r=S(w.algorithm.name,"verify");if("hash"in r.algorithm&&(r.algorithm.hash.name=C),"RSA-PSS"===w.algorithm.name){var a=void 0;try{a=new Je({schema:t.signerInfos[n].signatureAlgorithm.algorithmParams})}catch(e){return y?Promise.reject({date:m,code:12,message:e,signatureVerified:null,signerCertificate:A,signerCertificateVerified:!0}):Promise.reject(e)}r.algorithm.saltLength="saltLength"in a?a.saltLength:20;var i="SHA-1";if("hashAlgorithm"in a){var s=N(a.hashAlgorithm.algorithmId);if("name"in s==!1)return y?Promise.reject({date:m,code:13,message:"Unrecognized hash algorithm: "+a.hashAlgorithm.algorithmId,signatureVerified:null,signerCertificate:A,signerCertificateVerified:!0}):Promise.reject("Unrecognized hash algorithm: "+a.hashAlgorithm.algorithmId);i=s.name}r.algorithm.hash.name=i}var u=t.signerInfos[n].signature.valueBlock.valueHex;return"ECDSA"===w.algorithm.name&&(u=B(g(u).result)),I.verify(r.algorithm,w,new Uint8Array(u),new Uint8Array(o))}),p=p.then(function(e){return y?{date:m,code:14,message:"",signatureVerified:e,signerCertificate:A,signerCertificateVerified:!0}:e},function(e){return y?"code"in e?Promise.reject(e):Promise.reject({date:m,code:15,message:"Error during verification: "+e.message,signatureVerified:null,signerCertificate:A,signerCertificateVerified:!0}):Promise.reject(e)}))}},{key:"sign",value:function(e,t,r,a){var n=this;a=a||new ArrayBuffer(0);var i="";if(void 0===e)return Promise.reject("Need to provide a private key for signing");if(void 0===r&&(r="SHA-1"),""===(i=C({name:r})))return Promise.reject("Unsupported hash algorithm: "+r);0===this.digestAlgorithms.filter(function(e){return e.algorithmId===i}).length&&this.digestAlgorithms.push(new Te({algorithmId:i,algorithmParams:new re})),this.signerInfos[t].digestAlgorithm=new Te({algorithmId:i,algorithmParams:new re});var o=S(e.algorithm.name,"sign");switch(o.algorithm.hash.name=r,e.algorithm.name.toUpperCase()){case"RSASSA-PKCS1-V1_5":case"ECDSA":this.signerInfos[t].signatureAlgorithm.algorithmId=C(o.algorithm);break;case"RSA-PSS":switch(r.toUpperCase()){case"SHA-256":o.algorithm.saltLength=32;break;case"SHA-384":o.algorithm.saltLength=48;break;case"SHA-512":o.algorithm.saltLength=64}var u={};if("SHA-1"!==r.toUpperCase()){if(""===(i=C({name:r})))return Promise.reject("Unsupported hash algorithm: "+r);u.hashAlgorithm=new Te({algorithmId:i,algorithmParams:new re}),u.maskGenAlgorithm=new Te({algorithmId:"1.2.840.113549.1.1.8",algorithmParams:u.hashAlgorithm.toSchema()})}20!==o.algorithm.saltLength&&(u.saltLength=o.algorithm.saltLength);var l=new Je(u);this.signerInfos[t].signatureAlgorithm=new Te({algorithmId:"1.2.840.113549.1.1.10",algorithmParams:l.toSchema()});break;default:return Promise.reject("Unsupported signature algorithm: "+e.algorithm.name)}if("signedAttrs"in this.signerInfos[t])0!==this.signerInfos[t].signedAttrs.encodedValue.byteLength?a=this.signerInfos[t].signedAttrs.encodedValue:(a=this.signerInfos[t].signedAttrs.toSchema(!0).toBER(!1),new Uint8Array(a)[0]=49);else if("eContent"in this.encapContentInfo)if(1===this.encapContentInfo.eContent.idBlock.tagClass&&4===this.encapContentInfo.eContent.idBlock.tagNumber)if(!1===this.encapContentInfo.eContent.idBlock.isConstructed)a=this.encapContentInfo.eContent.valueBlock.valueHex;else{var c=!0,h=!1,m=void 0;try{for(var f,v=this.encapContentInfo.eContent.valueBlock.value[Symbol.iterator]();!(c=(f=v.next()).done);c=!0)a=s(a,f.value.valueBlock.valueHex)}catch(e){h=!0,m=e}finally{try{!c&&v.return&&v.return()}finally{if(h)throw m}}}else a=this.encapContentInfo.eContent.valueBlock.valueHex;else if(0===a.byteLength)return Promise.reject("Missed detached data input array");var d=b();return void 0===d?Promise.reject("Unable to create WebCrypto object"):d.sign(o.algorithm,e,new Uint8Array(a)).then(function(e){return"ECDSA"===o.algorithm.name&&(e=A(e)),n.signerInfos[t].signature=new ne({valueHex:e}),e},function(e){return Promise.reject("Signing error: "+e)})}}],[{key:"defaultValues",value:function(e){switch(e){case"version":return 0;case"digestAlgorithms":return[];case"encapContentInfo":return new kr;case"certificates":case"crls":case"signerInfos":return[];default:throw new Error("Invalid member name for SignedData class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"version":return r===e.defaultValues("version");case"encapContentInfo":return new kr;case"digestAlgorithms":case"certificates":case"crls":case"signerInfos":return 0===r.length;default:throw new Error("Invalid member name for SignedData class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return"optional"in e==!1&&(e.optional=!1),new ee({name:e.blockName||"SignedData",optional:e.optional,value:[new ue({name:e.version||"SignedData.version"}),new te({value:[new Ue({name:e.digestAlgorithms||"SignedData.digestAlgorithms",value:Te.schema()})]}),kr.schema(e.encapContentInfo||{names:{blockName:"SignedData.encapContentInfo"}}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:Lt.schema(e.certificates||{names:{certificates:"SignedData.certificates"}}).valueBlock.value}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:1},value:Jt.schema(e.crls||{names:{crls:"SignedData.crls"}}).valueBlock.value}),new te({value:[new Ue({name:e.signerInfos||"SignedData.signerInfos",value:Or.schema()})]})]})}}]),e}(),jr=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.version=t(r,"version",e.defaultValues("version")),this.authSafe=t(r,"authSafe",e.defaultValues("authSafe")),"macData"in r&&(this.macData=t(r,"macData",e.defaultValues("macData"))),"parsedValue"in r&&(this.parsedValue=t(r,"parsedValue",e.defaultValues("parsedValue"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{version:"version",authSafe:{names:{blockName:"authSafe"}},macData:{names:{blockName:"macData"}}}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PFX");this.version=r.result.version.valueBlock.valueDec,this.authSafe=new it({schema:r.result.authSafe}),"macData"in r.result&&(this.macData=new wr({schema:r.result.macData}))}},{key:"toSchema",value:function(){var e=[new ue({value:this.version}),this.authSafe.toSchema()];return"macData"in this&&e.push(this.macData.toSchema()),new ee({value:e})}},{key:"toJSON",value:function(){var e={version:this.version,authSafe:this.authSafe.toJSON()};return"macData"in this&&(e.macData=this.macData.toJSON()),e}},{key:"makeInternalValues",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t instanceof Object==!1)return Promise.reject('The "parameters" must has "Object" type');if("parsedValue"in this==!1)return Promise.reject('Please call "parseValues" function first in order to make "parsedValue" data');if("integrityMode"in this.parsedValue==!1)return Promise.reject('Absent mandatory parameter "integrityMode" inside "parsedValue"');var r=Promise.resolve(),a=b();if(void 0===a)return Promise.reject("Unable to create WebCrypto object");if("authenticatedSafe"in this.parsedValue==!1)return Promise.reject('Absent mandatory parameter "authenticatedSafe" in "parsedValue"');switch(this.parsedValue.integrityMode){case 0:if("iterations"in t==!1)return Promise.reject('Absent mandatory parameter "iterations"');if("pbkdf2HashAlgorithm"in t==!1)return Promise.reject('Absent mandatory parameter "pbkdf2HashAlgorithm"');if("hmacHashAlgorithm"in t==!1)return Promise.reject('Absent mandatory parameter "hmacHashAlgorithm"');if("password"in t==!1)return Promise.reject('Absent mandatory parameter "password"');var n=new ArrayBuffer(64),i=new Uint8Array(n);w(i);var s=void 0;switch(t.hmacHashAlgorithm.toLowerCase()){case"sha-1":s=160;break;case"sha-256":s=256;break;case"sha-384":s=384;break;case"sha-512":s=512;break;default:return Promise.reject('Incorrect "parameters.hmacHashAlgorithm" parameter: '+t.hmacHashAlgorithm)}var o={name:"HMAC",length:s,hash:{name:t.hmacHashAlgorithm}};r=(r=(r=(r=r.then(function(){var e=new Uint8Array(t.password);return a.importKey("raw",e,"PBKDF2",!1,["deriveKey"])},function(e){return Promise.reject(e)})).then(function(e){return a.deriveKey({name:"PBKDF2",hash:{name:t.pbkdf2HashAlgorithm},salt:i,iterations:t.iterations},e,o,!1,["sign"])},function(e){return Promise.reject(e)})).then(function(t){e.authSafe=new it({contentType:"1.2.840.113549.1.7.1",content:new ne({valueHex:e.parsedValue.authenticatedSafe.toSchema().toBER(!1)})});var r=e.authSafe.content.toBER(!1),n=new Uint8Array(r);return a.sign(o,t,n)},function(e){return Promise.reject(e)})).then(function(r){e.macData=new wr({mac:new pr({digestAlgorithm:new Te({algorithmId:C({name:t.hmacHashAlgorithm})}),digest:new ne({valueHex:r})}),macSalt:new ne({valueHex:n}),iterations:t.iterations})},function(e){return Promise.reject(e)});break;case 1:if("signingCertificate"in t==!1)return Promise.reject('Absent mandatory parameter "signingCertificate"');if("privateKey"in t==!1)return Promise.reject('Absent mandatory parameter "privateKey"');if("hashAlgorithm"in t==!1)return Promise.reject('Absent mandatory parameter "hashAlgorithm"');var u=this.parsedValue.authenticatedSafe.toSchema().toBER(!1),l=new _r({version:1,encapContentInfo:new kr({eContentType:"1.2.840.113549.1.7.1",eContent:new ne({valueHex:u})}),certificates:[t.signingCertificate]});r=(r=(r=(r=r.then(function(){return a.digest({name:t.hashAlgorithm},new Uint8Array(u))})).then(function(e){var r=[];r.push(new Me({type:"1.2.840.113549.1.9.3",values:[new me({value:"1.2.840.113549.1.7.1"})]})),r.push(new Me({type:"1.2.840.113549.1.9.5",values:[new xe({valueDate:new Date})]})),r.push(new Me({type:"1.2.840.113549.1.9.4",values:[new ne({valueHex:e})]})),l.signerInfos.push(new Or({version:1,sid:new Wt({issuer:t.signingCertificate.issuer,serialNumber:t.signingCertificate.serialNumber}),signedAttrs:new xr({type:0,attributes:r})}))},function(e){return Promise.reject("Error during making digest for message: "+e)})).then(function(){return l.sign(t.privateKey,0,t.hashAlgorithm)})).then(function(){e.authSafe=new it({contentType:"1.2.840.113549.1.7.2",content:l.toSchema(!0)})},function(e){return Promise.reject("Error during making signature: "+e)});break;default:return Promise.reject('Parameter "integrityMode" has unknown value: '+t.integrityMode)}return r}},{key:"parseInternalValues",value:function(e){var t=this;if(e instanceof Object==!1)return Promise.reject('The "parameters" must has "Object" type');"checkIntegrity"in e==!1&&(e.checkIntegrity=!0);var r=Promise.resolve(),a=b();if(void 0===a)return Promise.reject("Unable to create WebCrypto object");switch(this.parsedValue={},this.authSafe.contentType){case"1.2.840.113549.1.7.1":if("password"in e==!1)return Promise.reject('Absent mandatory parameter "password"');if(this.parsedValue.integrityMode=0,this.authSafe.content instanceof ne==!1)return Promise.reject('Wrong type of "this.authSafe.content"');var n=g(this.authSafe.content.valueBlock.valueHex);if(-1===n.offset)return Promise.reject('Error during parsing of ASN.1 data inside "this.authSafe.content"');if(this.parsedValue.authenticatedSafe=new lr({schema:n.result}),e.checkIntegrity){if("macData"in this==!1)return Promise.reject('Absent "macData" value, can not check PKCS# data integrity');var i=N(this.macData.mac.digestAlgorithm.algorithmId);if("name"in i==!1)return Promise.reject("Unsupported digest algorithm: "+this.macData.mac.digestAlgorithm.algorithmId);var o=void 0;switch(i.name.toLowerCase()){case"sha-1":o=160;break;case"sha-256":o=256;break;case"sha-384":o=384;break;case"sha-512":o=512;break;default:return Promise.reject('Incorrect "hashAlgorithm": '+i.name)}var u={name:"HMAC",length:o,hash:{name:i.name}};r=(r=(r=(r=r.then(function(){var t=new Uint8Array(e.password);return a.importKey("raw",t,"PBKDF2",!1,["deriveKey"])},function(e){return Promise.reject(e)})).then(function(e){return a.deriveKey({name:"PBKDF2",hash:{name:i.name},salt:new Uint8Array(t.macData.macSalt.valueBlock.valueHex),iterations:t.macData.iterations},e,u,!1,["verify"])},function(e){return Promise.reject(e)})).then(function(e){var r=t.authSafe.content.toBER(!1),n=new Uint8Array(r);return a.verify(u,e,new Uint8Array(t.macData.mac.digest.valueBlock.valueHex),n)},function(e){return Promise.reject(e)})).then(function(e){if(!1===e)return Promise.reject("Integrity for the PKCS#12 data is broken!")},function(e){return Promise.reject(e)})}break;case"1.2.840.113549.1.7.2":this.parsedValue.integrityMode=1;var l=new _r({schema:this.authSafe.content});if("eContent"in l.encapContentInfo==!1)return Promise.reject('Absent of attached data in "cmsSigned.encapContentInfo"');if(l.encapContentInfo.eContent instanceof ne==!1)return Promise.reject('Wrong type of "cmsSigned.encapContentInfo.eContent"');var c=new ArrayBuffer(0);if(!1===l.encapContentInfo.eContent.idBlock.isConstructed)c=l.encapContentInfo.eContent.valueBlock.valueHex;else for(var h=0;h<l.encapContentInfo.eContent.valueBlock.value.length;h++)c=s(c,l.encapContentInfo.eContent.valueBlock.value[h].valueBlock.valueHex);var m=g(c);if(-1===m.offset)return Promise.reject('Error during parsing of ASN.1 data inside "this.authSafe.content"');this.parsedValue.authenticatedSafe=new lr({schema:m.result}),r=r.then(function(){return l.verify({signer:0,checkChain:!1})}).then(function(e){if(!1===e)return Promise.reject("Integrity for the PKCS#12 data is broken!")},function(e){return Promise.reject("Error during integrity verification: "+e)});break;default:return Promise.reject('Incorrect value for "this.authSafe.contentType": '+this.authSafe.contentType)}return r.then(function(){return t},function(e){return Promise.reject("Error during parsing: "+e)})}}],[{key:"defaultValues",value:function(e){switch(e){case"version":return 3;case"authSafe":return new it;case"macData":return new wr;case"parsedValue":return{};default:throw new Error("Invalid member name for PFX class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"version":return r===e.defaultValues(t);case"authSafe":return it.compareWithDefault("contentType",r.contentType)&&it.compareWithDefault("content",r.content);case"macData":return wr.compareWithDefault("mac",r.mac)&&wr.compareWithDefault("macSalt",r.macSalt)&&wr.compareWithDefault("iterations",r.iterations);case"parsedValue":return r instanceof Object&&0===Object.keys(r).length;default:throw new Error("Invalid member name for PFX class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new ue({name:e.version||"version"}),it.schema(e.authSafe||{names:{blockName:"authSafe"}}),wr.schema(e.macData||{names:{blockName:"macData",optional:!0}})]})}}]),e}(),Dr=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.status=t(r,"status",e.defaultValues("status")),"statusStrings"in r&&(this.statusStrings=t(r,"statusStrings",e.defaultValues("statusStrings"))),"failInfo"in r&&(this.failInfo=t(r,"failInfo",e.defaultValues("failInfo"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema({names:{status:"status",statusStrings:"statusStrings",failInfo:"failInfo"}}));if(!1===r.verified)throw new Error("Object's schema was not verified against input data for PKIStatusInfo");var a=r.result.status;if(!0===a.valueBlock.isHexOnly||a.valueBlock.valueDec<0||a.valueBlock.valueDec>5)throw new Error('PKIStatusInfo "status" has invalid value');this.status=a.valueBlock.valueDec,"statusStrings"in r.result&&(this.statusStrings=r.result.statusStrings),"failInfo"in r.result&&(this.failInfo=r.result.failInfo)}},{key:"toSchema",value:function(){var e=[];return e.push(new ue({value:this.status})),"statusStrings"in this&&e.push(new ee({optional:!0,value:this.statusStrings})),"failInfo"in this&&e.push(this.failInfo),new ee({value:e})}},{key:"toJSON",value:function(){var e={status:this.status};return"statusStrings"in this&&(e.statusStrings=Array.from(this.statusStrings,function(e){return e.toJSON()})),"failInfo"in this&&(e.failInfo=this.failInfo.toJSON()),e}}],[{key:"defaultValues",value:function(e){switch(e){case"status":return 2;case"statusStrings":return[];case"failInfo":return new se;default:throw new Error("Invalid member name for PKIStatusInfo class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"status":return r===e.defaultValues(t);case"statusStrings":return 0===r.length;case"failInfo":return r.isEqual(e.defaultValues(t));default:throw new Error("Invalid member name for PKIStatusInfo class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"",value:[new ue({name:e.status||""}),new ee({optional:!0,value:[new Ue({name:e.statusStrings||"",value:new ve})]}),new se({name:e.failInfo||"",optional:!0})]})}}]),e}(),Rr=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.version=t(r,"version",e.defaultValues("version")),this.messageImprint=t(r,"messageImprint",e.defaultValues("messageImprint")),"reqPolicy"in r&&(this.reqPolicy=t(r,"reqPolicy",e.defaultValues("reqPolicy"))),"nonce"in r&&(this.nonce=t(r,"nonce",e.defaultValues("nonce"))),"certReq"in r&&(this.certReq=t(r,"certReq",e.defaultValues("certReq"))),"extensions"in r&&(this.extensions=t(r,"extensions",e.defaultValues("extensions"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema());if(!1===r.verified)throw new Error("Object's schema was not verified against input data for TSP_REQUEST");this.version=r.result["TimeStampReq.version"].valueBlock.valueDec,this.messageImprint=new Cr({schema:r.result["TimeStampReq.messageImprint"]}),"TimeStampReq.reqPolicy"in r.result&&(this.reqPolicy=r.result["TimeStampReq.reqPolicy"].valueBlock.toString()),"TimeStampReq.nonce"in r.result&&(this.nonce=r.result["TimeStampReq.nonce"]),"TimeStampReq.certReq"in r.result&&(this.certReq=r.result["TimeStampReq.certReq"].valueBlock.value),"TimeStampReq.extensions"in r.result&&(this.extensions=Array.from(r.result["TimeStampReq.extensions"],function(e){return new xt({schema:e})}))}},{key:"toSchema",value:function(){var t=[];return t.push(new ue({value:this.version})),t.push(this.messageImprint.toSchema()),"reqPolicy"in this&&t.push(new me({value:this.reqPolicy})),"nonce"in this&&t.push(this.nonce),"certReq"in this&&!1===e.compareWithDefault("certReq",this.certReq)&&t.push(new Y({value:this.certReq})),"extensions"in this&&t.push(new z({idBlock:{tagClass:3,tagNumber:0},value:Array.from(this.extensions,function(e){return e.toSchema()})})),new ee({value:t})}},{key:"toJSON",value:function(){var t={version:this.version,messageImprint:this.messageImprint.toJSON()};return"reqPolicy"in this&&(t.reqPolicy=this.reqPolicy),"nonce"in this&&(t.nonce=this.nonce.toJSON()),"certReq"in this&&!1===e.compareWithDefault("certReq",this.certReq)&&(t.certReq=this.certReq),"extensions"in this&&(t.extensions=Array.from(this.extensions,function(e){return e.toJSON()})),t}}],[{key:"defaultValues",value:function(e){switch(e){case"version":return 0;case"messageImprint":return new Cr;case"reqPolicy":return"";case"nonce":return new ue;case"certReq":return!1;case"extensions":return[];default:throw new Error("Invalid member name for TimeStampReq class: "+e)}}},{key:"compareWithDefault",value:function(t,r){switch(t){case"version":case"reqPolicy":case"certReq":return r===e.defaultValues(t);case"messageImprint":return Cr.compareWithDefault("hashAlgorithm",r.hashAlgorithm)&&Cr.compareWithDefault("hashedMessage",r.hashedMessage);case"nonce":return r.isEqual(e.defaultValues(t));case"extensions":return 0===r.length;default:throw new Error("Invalid member name for TimeStampReq class: "+t)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"TimeStampReq",value:[new ue({name:e.version||"TimeStampReq.version"}),Cr.schema(e.messageImprint||{names:{blockName:"TimeStampReq.messageImprint"}}),new me({name:e.reqPolicy||"TimeStampReq.reqPolicy",optional:!0}),new ue({name:e.nonce||"TimeStampReq.nonce",optional:!0}),new Y({name:e.certReq||"TimeStampReq.certReq",optional:!0}),new z({optional:!0,idBlock:{tagClass:3,tagNumber:0},value:[new Ue({name:e.extensions||"TimeStampReq.extensions",value:xt.schema()})]})]})}}]),e}(),Kr=function(){function e(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,e),this.status=t(r,"status",e.defaultValues("status")),"timeStampToken"in r&&(this.timeStampToken=t(r,"timeStampToken",e.defaultValues("timeStampToken"))),"schema"in r&&this.fromSchema(r.schema)}return _createClass(e,[{key:"fromSchema",value:function(t){var r=y(t,t,e.schema());if(!1===r.verified)throw new Error("Object's schema was not verified against input data for TSP_RESPONSE");this.status=new Dr({schema:r.result["TimeStampResp.status"]}),"TimeStampResp.timeStampToken"in r.result&&(this.timeStampToken=new it({schema:r.result["TimeStampResp.timeStampToken"]}))}},{key:"toSchema",value:function(){var e=[];return e.push(this.status.toSchema()),"timeStampToken"in this&&e.push(this.timeStampToken.toSchema()),new ee({value:e})}},{key:"toJSON",value:function(){var e={status:this.status};return"timeStampToken"in this&&(e.timeStampToken=this.timeStampToken.toJSON()),e}},{key:"sign",value:function(e,t){return"timeStampToken"in this==!1?Promise.reject("timeStampToken is absent in TSP response"):"1.2.840.113549.1.7.2"!==this.timeStampToken.contentType?Promise.reject("Wrong format of timeStampToken: "+this.timeStampToken.contentType):new it({schema:this.timeStampToken.content}).sign(e,0,t)}},{key:"verify",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{signer:0,trustedCerts:[],data:new ArrayBuffer(0)};return"timeStampToken"in this==!1?Promise.reject("timeStampToken is absent in TSP response"):"1.2.840.113549.1.7.2"!==this.timeStampToken.contentType?Promise.reject("Wrong format of timeStampToken: "+this.timeStampToken.contentType):new _r({schema:this.timeStampToken.content}).verify(e)}}],[{key:"defaultValues",value:function(e){switch(e){case"status":return new Dr;case"timeStampToken":return new it;default:throw new Error("Invalid member name for TimeStampResp class: "+e)}}},{key:"compareWithDefault",value:function(e,t){switch(e){case"status":return Dr.compareWithDefault("status",t.status)&&"statusStrings"in t==!1&&"failInfo"in t==!1;case"timeStampToken":return""===t.contentType&&t.content instanceof He;default:throw new Error("Invalid member name for TimeStampResp class: "+e)}}},{key:"schema",value:function(){var e=t(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},"names",{});return new ee({name:e.blockName||"TimeStampResp",value:[Dr.schema(e.status||{names:{blockName:"TimeStampResp.status"}}),it.schema(e.timeStampToken||{names:{blockName:"TimeStampResp.timeStampToken",optional:!0}})]})}}]),e}();e.setEngine=p,e.getEngine=k,e.getCrypto=b,e.getRandomValues=w,e.getOIDByAlgorithm=C,e.getAlgorithmParameters=S,e.createCMSECDSASignature=A,e.stringPrep=I,e.createECDSASignatureFromCMS=B,e.getAlgorithmByOID=N,e.getHashAlgorithm=P,e.kdfWithCounter=E,e.kdf=x,e.AccessDescription=rt,e.Accuracy=at,e.AlgorithmIdentifier=Te,e.AltName=nt,e.Attribute=Me,e.AttributeTypeAndValue=Ye,e.AuthenticatedSafe=lr,e.AuthorityKeyIdentifier=Bt,e.BasicConstraints=vt,e.BasicOCSPResponse=gr,e.CRLBag=Rt,e.CRLDistributionPoints=bt,e.CertBag=_t,e.CertID=cr,e.Certificate=Vt,e.CertificateChainValidationEngine=dr,e.CertificatePolicies=St,e.CertificateRevocationList=Dt,e.CertificateSet=Lt,e.CertificationRequest=yr,e.ContentInfo=it,e.CryptoEngine=$e,e.DigestInfo=pr,e.DistributionPoint=kt,e.ECCCMSSharedInfo=or,e.ECPrivateKey=Ge,e.ECPublicKey=qe,e.EncapsulatedContentInfo=kr,e.EncryptedContentInfo=st,e.EncryptedData=lt,e.EnvelopedData=ur,e.ExtKeyUsage=Pt,e.Extension=xt,e.Extensions=Ot,e.GeneralName=tt,e.GeneralNames=gt,e.GeneralSubtree=yt,e.GeneratorsDriver=R,e.InfoAccess=Et,e.IssuerAndSerialNumber=Wt,e.IssuingDistributionPoint=dt,e.KEKIdentifier=tr,e.KEKRecipientInfo=rr,e.KeyAgreeRecipientIdentifier=$t,e.KeyAgreeRecipientInfo=er,e.KeyBag=br,e.KeyTransRecipientInfo=Mt,e.MacData=wr,e.MessageImprint=Cr,e.NameConstraints=pt,e.OCSPRequest=Br,e.OCSPResponse=Pr,e.OriginatorIdentifierOrKey=Qt,e.OriginatorInfo=qt,e.OriginatorPublicKey=Gt,e.OtherCertificateFormat=Er,e.OtherKeyAttribute=zt,e.OtherPrimeInfo=Qe,e.OtherRecipientInfo=nr,e.OtherRevocationInfoFormat=Tt,e.PBES2Params=ut,e.PBKDF2Params=ot,e.PFX=jr,e.PKCS8ShroudedKeyBag=ct,e.PKIStatusInfo=Dr,e.PasswordRecipientinfo=ar,e.PolicyConstraints=Nt,e.PolicyInformation=Ct,e.PolicyMapping=At,e.PolicyMappings=It,e.PolicyQualifierInfo=wt,e.PrivateKeyInfo=Ze,e.PrivateKeyUsagePeriod=ft,e.PublicKeyInfo=Fe,e.RSAESOAEPParams=sr,e.RSAPrivateKey=ze,e.RSAPublicKey=We,e.RSASSAPSSParams=Je,e.RecipientEncryptedKey=Xt,e.RecipientEncryptedKeys=Yt,e.RecipientIdentifier=Ft,e.RecipientInfo=ir,e.RecipientKeyIdentifier=Zt,e.RelativeDistinguishedNames=et,e.Request=Sr,e.ResponseBytes=Nr,e.ResponseData=mr,e.RevocationInfoChoices=Jt,e.RevokedCertificate=jt,e.SafeBag=Ht,e.SafeContents=Ut,e.SecretBag=Kt,e.Signature=Ir,e.SignedAndUnsignedAttributes=xr,e.SignedData=_r,e.SignerInfo=Or,e.SingleResponse=hr,e.SubjectDirectoryAttributes=mt,e.TBSRequest=Ar,e.TSTInfo=Vr,e.Time=ht,e.TimeStampReq=Rr,e.TimeStampResp=Kr,Object.defineProperty(e,"__esModule",{value:!0})});